console.log("JS 실행:","msgbox.js");const exports$1={};function showMessageBox_implementation({message:n,buttons:e}){return new Promise(a=>{const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="9999";const i=document.createElement("div");i.style.backgroundColor="#fff",i.style.padding="20px",i.style.borderRadius="8px",i.style.width="300px",i.style.textAlign="center",i.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.1)";const s=document.createElement("p");s.textContent=n,i.appendChild(s),e.forEach(r=>{const u=document.createElement("button");u.textContent=r.label,u.style.margin="5px",u.onclick=()=>{a(r.value),document.body.removeChild(t)},i.appendChild(u),r.default&&(u.style.fontWeight="bold")}),t.appendChild(i),document.body.appendChild(t)})}exports$1.showMessageBox=window.showMessageBox||showMessageBox_implementation;const{showMessageBox}=exports$1,UPNG={};UPNG.toRGBA8=function(n){var e=n.width,a=n.height;if(n.tabs.acTL==null)return[UPNG.toRGBA8.decodeImage(n.data,e,a,n).buffer];var t=[];n.frames[0].data==null&&(n.frames[0].data=n.data);for(var i=e*a*4,s=new Uint8Array(i),r=new Uint8Array(i),u=new Uint8Array(i),h=0;h<n.frames.length;h++){var o=n.frames[h],d=o.rect.x,_=o.rect.y,b=o.rect.width,f=o.rect.height,v=UPNG.toRGBA8.decodeImage(o.data,b,f,n);if(h!=0)for(var A=0;A<i;A++)u[A]=s[A];if(o.blend==0?UPNG._copyTile(v,b,f,s,e,a,d,_,0):o.blend==1&&UPNG._copyTile(v,b,f,s,e,a,d,_,1),t.push(s.buffer.slice(0)),o.dispose!=0){if(o.dispose==1)UPNG._copyTile(r,b,f,s,e,a,d,_,0);else if(o.dispose==2)for(var A=0;A<i;A++)s[A]=u[A]}}return t};UPNG.toRGBA8.decodeImage=function(n,e,a,t){var i=e*a,s=UPNG.decode._getBPP(t),r=Math.ceil(e*s/8),u=new Uint8Array(i*4),h=new Uint32Array(u.buffer),o=t.ctype,d=t.depth,_=UPNG._bin.readUshort;if(o==6){var b=i<<2;if(d==8)for(var f=0;f<b;f+=4)u[f]=n[f],u[f+1]=n[f+1],u[f+2]=n[f+2],u[f+3]=n[f+3];if(d==16)for(var f=0;f<b;f++)u[f]=n[f<<1]}else if(o==2){var v=t.tabs.tRNS;if(v==null){if(d==8)for(var f=0;f<i;f++){var A=f*3;h[f]=255<<24|n[A+2]<<16|n[A+1]<<8|n[A]}if(d==16)for(var f=0;f<i;f++){var A=f*6;h[f]=255<<24|n[A+4]<<16|n[A+2]<<8|n[A]}}else{var x=v[0],C=v[1],M=v[2];if(d==8)for(var f=0;f<i;f++){var I=f<<2,A=f*3;h[f]=255<<24|n[A+2]<<16|n[A+1]<<8|n[A],n[A]==x&&n[A+1]==C&&n[A+2]==M&&(u[I+3]=0)}if(d==16)for(var f=0;f<i;f++){var I=f<<2,A=f*6;h[f]=255<<24|n[A+4]<<16|n[A+2]<<8|n[A],_(n,A)==x&&_(n,A+2)==C&&_(n,A+4)==M&&(u[I+3]=0)}}}else if(o==3){var w=t.tabs.PLTE,l=t.tabs.tRNS,c=l?l.length:0;if(d==1)for(var p=0;p<a;p++)for(var m=p*r,y=p*e,f=0;f<e;f++){var I=y+f<<2,P=n[m+(f>>3)]>>7-((f&7)<<0)&1,F=3*P;u[I]=w[F],u[I+1]=w[F+1],u[I+2]=w[F+2],u[I+3]=P<c?l[P]:255}if(d==2)for(var p=0;p<a;p++)for(var m=p*r,y=p*e,f=0;f<e;f++){var I=y+f<<2,P=n[m+(f>>2)]>>6-((f&3)<<1)&3,F=3*P;u[I]=w[F],u[I+1]=w[F+1],u[I+2]=w[F+2],u[I+3]=P<c?l[P]:255}if(d==4)for(var p=0;p<a;p++)for(var m=p*r,y=p*e,f=0;f<e;f++){var I=y+f<<2,P=n[m+(f>>1)]>>4-((f&1)<<2)&15,F=3*P;u[I]=w[F],u[I+1]=w[F+1],u[I+2]=w[F+2],u[I+3]=P<c?l[P]:255}if(d==8)for(var f=0;f<i;f++){var I=f<<2,P=n[f],F=3*P;u[I]=w[F],u[I+1]=w[F+1],u[I+2]=w[F+2],u[I+3]=P<c?l[P]:255}}else if(o==4){if(d==8)for(var f=0;f<i;f++){var I=f<<2,R=f<<1,B=n[R];u[I]=B,u[I+1]=B,u[I+2]=B,u[I+3]=n[R+1]}if(d==16)for(var f=0;f<i;f++){var I=f<<2,R=f<<2,B=n[R];u[I]=B,u[I+1]=B,u[I+2]=B,u[I+3]=n[R+2]}}else if(o==0)for(var x=t.tabs.tRNS?t.tabs.tRNS:-1,p=0;p<a;p++){var V=p*r,Z=p*e;if(d==1)for(var ne=0;ne<e;ne++){var B=255*(n[V+(ne>>>3)]>>>7-(ne&7)&1),H=B==x*255?0:255;h[Z+ne]=H<<24|B<<16|B<<8|B}else if(d==2)for(var ne=0;ne<e;ne++){var B=85*(n[V+(ne>>>2)]>>>6-((ne&3)<<1)&3),H=B==x*85?0:255;h[Z+ne]=H<<24|B<<16|B<<8|B}else if(d==4)for(var ne=0;ne<e;ne++){var B=17*(n[V+(ne>>>1)]>>>4-((ne&1)<<2)&15),H=B==x*17?0:255;h[Z+ne]=H<<24|B<<16|B<<8|B}else if(d==8)for(var ne=0;ne<e;ne++){var B=n[V+ne],H=B==x?0:255;h[Z+ne]=H<<24|B<<16|B<<8|B}else if(d==16)for(var ne=0;ne<e;ne++){var B=n[V+(ne<<1)],H=_(n,V+(ne<<f))==x?0:255;h[Z+ne]=H<<24|B<<16|B<<8|B}}return u};UPNG.decode=function(n){for(var e=new Uint8Array(n),a=8,t=UPNG._bin,i=t.readUshort,s=t.readUint,r={tabs:{},frames:[]},u=new Uint8Array(e.length),h=0,o,d=0,_=[137,80,78,71,13,10,26,10],b=0;b<8;b++)if(e[b]!=_[b])throw"The input is not a PNG file!";for(;a<e.length;){var f=t.readUint(e,a);a+=4;var v=t.readASCII(e,a,4);if(a+=4,v=="IHDR")UPNG.decode._IHDR(e,a,r);else if(v=="CgBI")r.tabs[v]=e.slice(a,a+4);else if(v=="IDAT"){for(var b=0;b<f;b++)u[h+b]=e[a+b];h+=f}else if(v=="acTL")r.tabs[v]={num_frames:s(e,a),num_plays:s(e,a+4)},o=new Uint8Array(e.length);else if(v=="fcTL"){if(d!=0){var A=r.frames[r.frames.length-1];A.data=UPNG.decode._decompress(r,o.slice(0,d),A.rect.width,A.rect.height),d=0}var x={x:s(e,a+12),y:s(e,a+16),width:s(e,a+4),height:s(e,a+8)},C=i(e,a+22);C=i(e,a+20)/(C==0?100:C);var M={rect:x,delay:Math.round(C*1e3),dispose:e[a+24],blend:e[a+25]};r.frames.push(M)}else if(v=="fdAT"){for(var b=0;b<f-4;b++)o[d+b]=e[a+b+4];d+=f-4}else if(v=="pHYs")r.tabs[v]=[t.readUint(e,a),t.readUint(e,a+4),e[a+8]];else if(v=="cHRM"){r.tabs[v]=[];for(var b=0;b<8;b++)r.tabs[v].push(t.readUint(e,a+b*4))}else if(v=="tEXt"||v=="zTXt"){r.tabs[v]==null&&(r.tabs[v]={});var I=t.nextZero(e,a),w=t.readASCII(e,a,I-a),l,c=a+f-I-1;if(v=="tEXt")l=t.readASCII(e,I+1,c);else{var p=UPNG.decode._inflate(e.slice(I+2,I+2+c));l=t.readUTF8(p,0,p.length)}r.tabs[v][w]=l}else if(v=="iTXt"){r.tabs[v]==null&&(r.tabs[v]={});var I=0,m=a;I=t.nextZero(e,m);var w=t.readASCII(e,m,I-m);m=I+1;var y=e[m];e[m+1],m+=2,I=t.nextZero(e,m),t.readASCII(e,m,I-m),m=I+1,I=t.nextZero(e,m),t.readUTF8(e,m,I-m),m=I+1;var l,c=f-(m-a);if(y==0)l=t.readUTF8(e,m,c);else{var p=UPNG.decode._inflate(e.slice(m,m+c));l=t.readUTF8(p,0,p.length)}r.tabs[v][w]=l}else if(v=="PLTE")r.tabs[v]=t.readBytes(e,a,f);else if(v=="hIST"){var P=r.tabs.PLTE.length/3;r.tabs[v]=[];for(var b=0;b<P;b++)r.tabs[v].push(i(e,a+b*2))}else if(v=="tRNS")r.ctype==3?r.tabs[v]=t.readBytes(e,a,f):r.ctype==0?r.tabs[v]=i(e,a):r.ctype==2&&(r.tabs[v]=[i(e,a),i(e,a+2),i(e,a+4)]);else if(v=="gAMA")r.tabs[v]=t.readUint(e,a)/1e5;else if(v=="sRGB")r.tabs[v]=e[a];else if(v=="bKGD")r.ctype==0||r.ctype==4?r.tabs[v]=[i(e,a)]:r.ctype==2||r.ctype==6?r.tabs[v]=[i(e,a),i(e,a+2),i(e,a+4)]:r.ctype==3&&(r.tabs[v]=e[a]);else if(v=="IEND")break;a+=f,t.readUint(e,a),a+=4}if(d!=0){var A=r.frames[r.frames.length-1];A.data=UPNG.decode._decompress(r,o.slice(0,d),A.rect.width,A.rect.height),d=0}return r.data=UPNG.decode._decompress(r,u,r.width,r.height),delete r.compress,delete r.interlace,delete r.filter,r};UPNG.decode._decompress=function(n,e,a,t){var i=UPNG.decode._getBPP(n),s=Math.ceil(a*i/8),r=new Uint8Array((s+1+n.interlace)*t);return n.tabs.CgBI?e=UPNG.inflateRaw(e,r):e=UPNG.decode._inflate(e,r),n.interlace==0?e=UPNG.decode._filterZero(e,n,0,a,t):n.interlace==1&&(e=UPNG.decode._readInterlace(e,n)),e};UPNG.decode._inflate=function(n,e){var a=UPNG.inflateRaw(new Uint8Array(n.buffer,2,n.length-6),e);return a};UPNG.inflateRaw=function(){var n={};return n.H={},n.H.N=function(e,a){var t=Uint8Array,i=0,s=0,r=0,u=0,h=0,o=0,d=0,_=0,b=0,f,v;if(e[0]==3&&e[1]==0)return a||new t(0);var A=n.H,x=A.b,C=A.e,M=A.R,I=A.n,w=A.A,l=A.Z,c=A.m,p=a==null;for(p&&(a=new t(e.length>>>2<<5));i==0;){if(i=x(e,b,1),s=x(e,b+1,2),b+=3,s==0){b&7&&(b+=8-(b&7));var m=(b>>>3)+4,y=e[m-4]|e[m-3]<<8;p&&(a=n.H.W(a,_+y)),a.set(new t(e.buffer,e.byteOffset+m,y),_),b=m+y<<3,_+=y;continue}if(p&&(a=n.H.W(a,_+(1<<17))),s==1&&(f=c.J,v=c.h,o=512-1,d=32-1),s==2){r=C(e,b,5)+257,u=C(e,b+5,5)+1,h=C(e,b+10,4)+4,b+=14;for(var P=1,F=0;F<38;F+=2)c.Q[F]=0,c.Q[F+1]=0;for(var F=0;F<h;F++){var R=C(e,b+F*3,3);c.Q[(c.X[F]<<1)+1]=R,R>P&&(P=R)}b+=3*h,I(c.Q,P),w(c.Q,P,c.u),f=c.w,v=c.d,b=M(c.u,(1<<P)-1,r+u,e,b,c.v);var B=A.V(c.v,0,r,c.C);o=(1<<B)-1;var V=A.V(c.v,r,u,c.D);d=(1<<V)-1,I(c.C,B),w(c.C,B,f),I(c.D,V),w(c.D,V,v)}for(;;){var Z=f[l(e,b)&o];b+=Z&15;var ne=Z>>>4;if(!(ne>>>8))a[_++]=ne;else{if(ne==256)break;var H=_+ne-254;if(ne>264){var N=c.q[ne-257];H=_+(N>>>3)+C(e,b,N&7),b+=N&7}var g=v[l(e,b)&d];b+=g&15;var O=g>>>4,D=c.c[O],z=(D>>>4)+x(e,b,D&15);for(b+=D&15;_<H;)a[_]=a[_++-z],a[_]=a[_++-z],a[_]=a[_++-z],a[_]=a[_++-z];_=H}}}return a.length==_?a:a.slice(0,_)},n.H.W=function(e,a){var t=e.length;if(a<=t)return e;var i=new Uint8Array(t<<1);return i.set(e,0),i},n.H.R=function(e,a,t,i,s,r){for(var u=n.H.e,h=n.H.Z,o=0;o<t;){var d=e[h(i,s)&a];s+=d&15;var _=d>>>4;if(_<=15)r[o]=_,o++;else{var b=0,f=0;_==16?(f=3+u(i,s,2),s+=2,b=r[o-1]):_==17?(f=3+u(i,s,3),s+=3):_==18&&(f=11+u(i,s,7),s+=7);for(var v=o+f;o<v;)r[o]=b,o++}}return s},n.H.V=function(e,a,t,i){for(var s=0,r=0,u=i.length>>>1;r<t;){var h=e[r+a];i[r<<1]=0,i[(r<<1)+1]=h,h>s&&(s=h),r++}for(;r<u;)i[r<<1]=0,i[(r<<1)+1]=0,r++;return s},n.H.n=function(e,a){for(var t=n.H.m,i=e.length,s,r,u,h,o,d=t.j,h=0;h<=a;h++)d[h]=0;for(h=1;h<i;h+=2)d[e[h]]++;var _=t.K;for(s=0,d[0]=0,r=1;r<=a;r++)s=s+d[r-1]<<1,_[r]=s;for(u=0;u<i;u+=2)o=e[u+1],o!=0&&(e[u]=_[o],_[o]++)},n.H.A=function(e,a,t){for(var i=e.length,s=n.H.m,r=s.r,u=0;u<i;u+=2)if(e[u+1]!=0)for(var h=u>>1,o=e[u+1],d=h<<4|o,_=a-o,b=e[u]<<_,f=b+(1<<_);b!=f;){var v=r[b]>>>15-a;t[v]=d,b++}},n.H.l=function(e,a){for(var t=n.H.m.r,i=15-a,s=0;s<e.length;s+=2){var r=e[s]<<a-e[s+1];e[s]=t[r]>>>i}},n.H.M=function(e,a,t){t=t<<(a&7);var i=a>>>3;e[i]|=t,e[i+1]|=t>>>8},n.H.I=function(e,a,t){t=t<<(a&7);var i=a>>>3;e[i]|=t,e[i+1]|=t>>>8,e[i+2]|=t>>>16},n.H.e=function(e,a,t){return(e[a>>>3]|e[(a>>>3)+1]<<8)>>>(a&7)&(1<<t)-1},n.H.b=function(e,a,t){return(e[a>>>3]|e[(a>>>3)+1]<<8|e[(a>>>3)+2]<<16)>>>(a&7)&(1<<t)-1},n.H.Z=function(e,a){return(e[a>>>3]|e[(a>>>3)+1]<<8|e[(a>>>3)+2]<<16)>>>(a&7)},n.H.i=function(e,a){return(e[a>>>3]|e[(a>>>3)+1]<<8|e[(a>>>3)+2]<<16|e[(a>>>3)+3]<<24)>>>(a&7)},n.H.m=function(){var e=Uint16Array,a=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new a(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new a(286),Y:new a(30),a:new a(19),t:new a(15e3),k:new e(65536),g:new e(32768)}}(),function(){for(var e=n.H.m,a=32768,t=0;t<a;t++){var i=t;i=(i&2863311530)>>>1|(i&1431655765)<<1,i=(i&3435973836)>>>2|(i&858993459)<<2,i=(i&4042322160)>>>4|(i&252645135)<<4,i=(i&4278255360)>>>8|(i&16711935)<<8,e.r[t]=(i>>>16|i<<16)>>>17}function s(r,u,h){for(;u--!=0;)r.push(0,h)}for(var t=0;t<32;t++)e.q[t]=e.S[t]<<3|e.T[t],e.c[t]=e.p[t]<<4|e.z[t];s(e._,144,8),s(e._,255-143,9),s(e._,279-255,7),s(e._,287-279,8),n.H.n(e._,9),n.H.A(e._,9,e.J),n.H.l(e._,9),s(e.$,32,5),n.H.n(e.$,5),n.H.A(e.$,5,e.h),n.H.l(e.$,5),s(e.Q,19,0),s(e.C,286,0),s(e.D,30,0),s(e.v,320,0)}(),n.H.N}();UPNG.decode._readInterlace=function(n,e){for(var a=e.width,t=e.height,i=UPNG.decode._getBPP(e),s=i>>3,r=Math.ceil(a*i/8),u=new Uint8Array(t*r),h=0,o=[0,0,4,0,2,0,1],d=[0,4,0,2,0,1,0],_=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1],f=0;f<7;){for(var v=_[f],A=b[f],x=0,C=0,M=o[f];M<t;)M+=v,C++;for(var I=d[f];I<a;)I+=A,x++;var w=Math.ceil(x*i/8);UPNG.decode._filterZero(n,e,h,x,C);for(var l=0,c=o[f];c<t;){for(var p=d[f],m=h+l*w<<3;p<a;){if(i==1){var y=n[m>>3];y=y>>7-(m&7)&1,u[c*r+(p>>3)]|=y<<7-((p&7)<<0)}if(i==2){var y=n[m>>3];y=y>>6-(m&7)&3,u[c*r+(p>>2)]|=y<<6-((p&3)<<1)}if(i==4){var y=n[m>>3];y=y>>4-(m&7)&15,u[c*r+(p>>1)]|=y<<4-((p&1)<<2)}if(i>=8)for(var P=c*r+p*s,F=0;F<s;F++)u[P+F]=n[(m>>3)+F];m+=i,p+=A}l++,c+=v}x*C!=0&&(h+=C*(1+w)),f=f+1}return u};UPNG.decode._getBPP=function(n){var e=[1,null,3,1,2,null,4][n.ctype];return e*n.depth};UPNG.decode._filterZero=function(n,e,a,t,i){var s=UPNG.decode._getBPP(e),r=Math.ceil(t*s/8),u=UPNG.decode._paeth;s=Math.ceil(s/8);var h=0,o=1,d=n[a],_=0;if(d>1&&(n[a]=[0,0,1][d-2]),d==3)for(_=s;_<r;_++)n[_+1]=n[_+1]+(n[_+1-s]>>>1)&255;for(var b=0;b<i;b++)if(h=a+b*r,o=h+b+1,d=n[o-1],_=0,d==0)for(;_<r;_++)n[h+_]=n[o+_];else if(d==1){for(;_<s;_++)n[h+_]=n[o+_];for(;_<r;_++)n[h+_]=n[o+_]+n[h+_-s]}else if(d==2)for(;_<r;_++)n[h+_]=n[o+_]+n[h+_-r];else if(d==3){for(;_<s;_++)n[h+_]=n[o+_]+(n[h+_-r]>>>1);for(;_<r;_++)n[h+_]=n[o+_]+(n[h+_-r]+n[h+_-s]>>>1)}else{for(;_<s;_++)n[h+_]=n[o+_]+u(0,n[h+_-r],0);for(;_<r;_++)n[h+_]=n[o+_]+u(n[h+_-s],n[h+_-r],n[h+_-s-r])}return n};UPNG.decode._paeth=function(n,e,a){var t=n+e-a,i=t-n,s=t-e,r=t-a;return i*i<=s*s&&i*i<=r*r?n:s*s<=r*r?e:a};UPNG.decode._IHDR=function(n,e,a){var t=UPNG._bin;a.width=t.readUint(n,e),e+=4,a.height=t.readUint(n,e),e+=4,a.depth=n[e],e++,a.ctype=n[e],e++,a.compress=n[e],e++,a.filter=n[e],e++,a.interlace=n[e],e++};UPNG._bin={nextZero:function(n,e){for(;n[e]!=0;)e++;return e},readUshort:function(n,e){return n[e]<<8|n[e+1]},writeUshort:function(n,e,a){n[e]=a>>8&255,n[e+1]=a&255},readUint:function(n,e){return n[e]*(256*256*256)+(n[e+1]<<16|n[e+2]<<8|n[e+3])},writeUint:function(n,e,a){n[e]=a>>24&255,n[e+1]=a>>16&255,n[e+2]=a>>8&255,n[e+3]=a&255},readASCII:function(n,e,a){for(var t="",i=0;i<a;i++)t+=String.fromCharCode(n[e+i]);return t},writeASCII:function(n,e,a){for(var t=0;t<a.length;t++)n[e+t]=a.charCodeAt(t)},readBytes:function(n,e,a){for(var t=[],i=0;i<a;i++)t.push(n[e+i]);return t},pad:function(n){return n.length<2?"0"+n:n},readUTF8:function(n,e,a){for(var t="",i,s=0;s<a;s++)t+="%"+UPNG._bin.pad(n[e+s].toString(16));try{i=decodeURIComponent(t)}catch{return UPNG._bin.readASCII(n,e,a)}return i}};UPNG._copyTile=function(n,e,a,t,i,s,r,u,h){for(var o=Math.min(e,i),d=Math.min(a,s),_=0,b=0,f=0;f<d;f++)for(var v=0;v<o;v++)if(r>=0&&u>=0?(_=f*e+v<<2,b=(u+f)*i+r+v<<2):(_=(-u+f)*e-r+v<<2,b=f*i+v<<2),h==0)t[b]=n[_],t[b+1]=n[_+1],t[b+2]=n[_+2],t[b+3]=n[_+3];else if(h==1){var A=n[_+3]*.00392156862745098,x=n[_]*A,C=n[_+1]*A,M=n[_+2]*A,I=t[b+3]*(1/255),w=t[b]*I,l=t[b+1]*I,c=t[b+2]*I,p=1-A,m=A+I*p,y=m==0?0:1/m;t[b+3]=255*m,t[b+0]=(x+w*p)*y,t[b+1]=(C+l*p)*y,t[b+2]=(M+c*p)*y}else if(h==2){var A=n[_+3],x=n[_],C=n[_+1],M=n[_+2],I=t[b+3],w=t[b],l=t[b+1],c=t[b+2];A==I&&x==w&&C==l&&M==c?(t[b]=0,t[b+1]=0,t[b+2]=0,t[b+3]=0):(t[b]=x,t[b+1]=C,t[b+2]=M,t[b+3]=A)}else if(h==3){var A=n[_+3],x=n[_],C=n[_+1],M=n[_+2],I=t[b+3],w=t[b],l=t[b+1],c=t[b+2];if(A==I&&x==w&&C==l&&M==c)continue;if(A<220&&I>20)return!1}return!0};UPNG.encode=function(n,e,a,t,i,s,r){t==null&&(t=0),r==null&&(r=!1);var u=UPNG.encode.compress(n,e,a,t,[!1,!1,!1,0,r]);return UPNG.encode.compressPNG(u,-1),UPNG.encode._main(u,e,a,i,s)};UPNG.encodeLL=function(n,e,a,t,i,s,r,u){for(var h={ctype:0+(t==1?0:2)+(i==0?0:4),depth:s,frames:[]},o=(t+i)*s,d=o*e,_=0;_<n.length;_++)h.frames.push({rect:{x:0,y:0,width:e,height:a},img:new Uint8Array(n[_]),blend:0,dispose:1,bpp:Math.ceil(o/8),bpl:Math.ceil(d/8)});UPNG.encode.compressPNG(h,0,!0);var b=UPNG.encode._main(h,e,a,r,u);return b};UPNG.encode._main=function(n,e,a,t,i){i==null&&(i={});var s=UPNG.crc.crc,r=UPNG._bin.writeUint,u=UPNG._bin.writeUshort,h=UPNG._bin.writeASCII,o=8,d=n.frames.length>1,_=!1,b=8+(16+5+4)+(d?20:0);if(i.sRGB!=null&&(b+=8+1+4),i.pHYs!=null&&(b+=8+9+4),n.ctype==3){for(var f=n.plte.length,v=0;v<f;v++)n.plte[v]>>>24!=255&&(_=!0);b+=8+f*3+4+(_?8+f*1+4:0)}for(var A=0;A<n.frames.length;A++){var x=n.frames[A];d&&(b+=38),b+=x.cimg.length+12,A!=0&&(b+=4)}b+=12;for(var C=new Uint8Array(b),M=[137,80,78,71,13,10,26,10],v=0;v<8;v++)C[v]=M[v];if(r(C,o,13),o+=4,h(C,o,"IHDR"),o+=4,r(C,o,e),o+=4,r(C,o,a),o+=4,C[o]=n.depth,o++,C[o]=n.ctype,o++,C[o]=0,o++,C[o]=0,o++,C[o]=0,o++,r(C,o,s(C,o-17,17)),o+=4,i.sRGB!=null&&(r(C,o,1),o+=4,h(C,o,"sRGB"),o+=4,C[o]=i.sRGB,o++,r(C,o,s(C,o-5,5)),o+=4),i.pHYs!=null&&(r(C,o,9),o+=4,h(C,o,"pHYs"),o+=4,r(C,o,i.pHYs[0]),o+=4,r(C,o,i.pHYs[1]),o+=4,C[o]=i.pHYs[2],o++,r(C,o,s(C,o-13,13)),o+=4),d&&(r(C,o,8),o+=4,h(C,o,"acTL"),o+=4,r(C,o,n.frames.length),o+=4,r(C,o,i.loop!=null?i.loop:0),o+=4,r(C,o,s(C,o-12,12)),o+=4),n.ctype==3){var f=n.plte.length;r(C,o,f*3),o+=4,h(C,o,"PLTE"),o+=4;for(var v=0;v<f;v++){var I=v*3,w=n.plte[v],l=w&255,c=w>>>8&255,p=w>>>16&255;C[o+I+0]=l,C[o+I+1]=c,C[o+I+2]=p}if(o+=f*3,r(C,o,s(C,o-f*3-4,f*3+4)),o+=4,_){r(C,o,f),o+=4,h(C,o,"tRNS"),o+=4;for(var v=0;v<f;v++)C[o+v]=n.plte[v]>>>24&255;o+=f,r(C,o,s(C,o-f-4,f+4)),o+=4}}for(var m=0,A=0;A<n.frames.length;A++){var x=n.frames[A];d&&(r(C,o,26),o+=4,h(C,o,"fcTL"),o+=4,r(C,o,m++),o+=4,r(C,o,x.rect.width),o+=4,r(C,o,x.rect.height),o+=4,r(C,o,x.rect.x),o+=4,r(C,o,x.rect.y),o+=4,u(C,o,t[A]),o+=2,u(C,o,1e3),o+=2,C[o]=x.dispose,o++,C[o]=x.blend,o++,r(C,o,s(C,o-30,30)),o+=4);var y=x.cimg,f=y.length;r(C,o,f+(A==0?0:4)),o+=4;var P=o;h(C,o,A==0?"IDAT":"fdAT"),o+=4,A!=0&&(r(C,o,m++),o+=4),C.set(y,o),o+=f,r(C,o,s(C,P,o-P)),o+=4}return r(C,o,0),o+=4,h(C,o,"IEND"),o+=4,r(C,o,s(C,o-4,4)),o+=4,C.buffer};UPNG.encode.compressPNG=function(n,e,a){for(var t=0;t<n.frames.length;t++){var i=n.frames[t];i.rect.width;var s=i.rect.height,r=new Uint8Array(s*i.bpl+s);i.cimg=UPNG.encode._filterZero(i.img,s,i.bpp,i.bpl,r,e,a)}};UPNG.encode.compress=function(n,e,a,t,i){for(var s=i[0],r=i[1],u=i[2],h=i[3],o=i[4],d=6,_=8,b=255,f=0;f<n.length;f++)for(var v=new Uint8Array(n[f]),A=v.length,x=0;x<A;x+=4)b&=v[x+3];var C=b!=255,M=UPNG.encode.framize(n,e,a,s,r,u),I={},w=[],l=[];if(t!=0){for(var c=[],x=0;x<M.length;x++)c.push(M[x].img.buffer);var p=UPNG.encode.concatRGBA(c),m=UPNG.quantize(p,t);console.log(m);for(var y=0,P=new Uint8Array(m.abuf),x=0;x<M.length;x++){var F=M[x].img,R=F.length;l.push(new Uint8Array(m.inds.buffer,y>>2,R>>2));for(var f=0;f<R;f+=4)F[f]=P[y+f],F[f+1]=P[y+f+1],F[f+2]=P[y+f+2],F[f+3]=P[y+f+3];y+=R}for(var x=0;x<m.plte.length;x++)w.push(m.plte[x].est.rgba)}else for(var f=0;f<M.length;f++){var B=M[f],V=new Uint32Array(B.img.buffer),Z=B.rect.width,A=V.length,ne=new Uint8Array(A);l.push(ne);for(var x=0;x<A;x++){var H=V[x];if(x!=0&&H==V[x-1])ne[x]=ne[x-1];else if(x>Z&&H==V[x-Z])ne[x]=ne[x-Z];else{var N=I[H];if(N==null&&(I[H]=N=w.length,w.push(H),w.length>=300))break;ne[x]=N}}}var g=w.length;g<=256&&o==!1&&(g<=2?_=1:g<=4?_=2:g<=16?_=4:_=8,_=Math.max(_,h));for(var f=0;f<M.length;f++){var B=M[f];B.rect.x,B.rect.y;var Z=B.rect.width,O=B.rect.height,D=B.img;new Uint32Array(D.buffer);var z=4*Z,W=4;if(g<=256&&o==!1){z=Math.ceil(_*Z/8);for(var J=new Uint8Array(z*O),ie=l[f],ue=0;ue<O;ue++){var x=ue*z,he=ue*Z;if(_==8)for(var se=0;se<Z;se++)J[x+se]=ie[he+se];else if(_==4)for(var se=0;se<Z;se++)J[x+(se>>1)]|=ie[he+se]<<4-(se&1)*4;else if(_==2)for(var se=0;se<Z;se++)J[x+(se>>2)]|=ie[he+se]<<6-(se&3)*2;else if(_==1)for(var se=0;se<Z;se++)J[x+(se>>3)]|=ie[he+se]<<7-(se&7)*1}D=J,d=3,W=1}else if(C==!1&&M.length==1){for(var J=new Uint8Array(Z*O*3),de=Z*O,x=0;x<de;x++){var F=x*3,U=x*4;J[F]=D[U],J[F+1]=D[U+1],J[F+2]=D[U+2]}D=J,d=2,W=3,z=3*Z}B.img=D,B.bpl=z,B.bpp=W}return{ctype:d,depth:_,plte:w,frames:M}};UPNG.encode.framize=function(n,e,a,t,i,s){for(var r=[],u=0;u<n.length;u++){var h=new Uint8Array(n[u]),o=new Uint32Array(h.buffer),d,_=0,b=0,f=e,v=a,A=t?1:0;if(u!=0){for(var x=s||t||u==1||r[u-2].dispose!=0?1:2,C=0,M=1e9,I=0;I<x;I++){for(var B=new Uint8Array(n[u-1-I]),w=new Uint32Array(n[u-1-I]),l=e,c=a,p=-1,m=-1,y=0;y<a;y++)for(var P=0;P<e;P++){var F=y*e+P;o[F]!=w[F]&&(P<l&&(l=P),P>p&&(p=P),y<c&&(c=y),y>m&&(m=y))}p==-1&&(l=c=p=m=0),i&&((l&1)==1&&l--,(c&1)==1&&c--);var R=(p-l+1)*(m-c+1);R<M&&(M=R,C=I,_=l,b=c,f=p-l+1,v=m-c+1)}var B=new Uint8Array(n[u-1-C]);C==1&&(r[u-1].dispose=2),d=new Uint8Array(f*v*4),UPNG._copyTile(B,e,a,d,f,v,-_,-b,0),A=UPNG._copyTile(h,e,a,d,f,v,-_,-b,3)?1:0,A==1?UPNG.encode._prepareDiff(h,e,a,d,{x:_,y:b,width:f,height:v}):UPNG._copyTile(h,e,a,d,f,v,-_,-b,0)}else d=h.slice(0);r.push({rect:{x:_,y:b,width:f,height:v},img:d,blend:A,dispose:0})}if(t)for(var u=0;u<r.length;u++){var V=r[u];if(V.blend!=1){var Z=V.rect,ne=r[u-1].rect,H=Math.min(Z.x,ne.x),N=Math.min(Z.y,ne.y),g=Math.max(Z.x+Z.width,ne.x+ne.width),O=Math.max(Z.y+Z.height,ne.y+ne.height),D={x:H,y:N,width:g-H,height:O-N};r[u-1].dispose=1,u-1!=0&&UPNG.encode._updateFrame(n,e,a,r,u-1,D,i),UPNG.encode._updateFrame(n,e,a,r,u,D,i)}}var z=0;if(n.length!=1)for(var F=0;F<r.length;F++){var V=r[F];z+=V.rect.width*V.rect.height}return r};UPNG.encode._updateFrame=function(n,e,a,t,i,s,r){for(var u=Uint8Array,h=Uint32Array,o=new u(n[i-1]),d=new h(n[i-1]),_=i+1<n.length?new u(n[i+1]):null,b=new u(n[i]),f=new h(b.buffer),v=e,A=a,x=-1,C=-1,M=0;M<s.height;M++)for(var I=0;I<s.width;I++){var w=s.x+I,l=s.y+M,c=l*e+w,p=f[c];p==0||t[i-1].dispose==0&&d[c]==p&&(_==null||_[c*4+3]!=0)||(w<v&&(v=w),w>x&&(x=w),l<A&&(A=l),l>C&&(C=l))}x==-1&&(v=A=x=C=0),r&&((v&1)==1&&v--,(A&1)==1&&A--),s={x:v,y:A,width:x-v+1,height:C-A+1};var m=t[i];m.rect=s,m.blend=1,m.img=new Uint8Array(s.width*s.height*4),t[i-1].dispose==0?(UPNG._copyTile(o,e,a,m.img,s.width,s.height,-s.x,-s.y,0),UPNG.encode._prepareDiff(b,e,a,m.img,s)):UPNG._copyTile(b,e,a,m.img,s.width,s.height,-s.x,-s.y,0)};UPNG.encode._prepareDiff=function(n,e,a,t,i){UPNG._copyTile(n,e,a,t,i.width,i.height,-i.x,-i.y,2)};UPNG.encode._filterZero=function(n,e,a,t,i,s,r){var u=[],h=[0,1,2,3,4];s!=-1?h=[s]:(e*t>5e5||a==1)&&(h=[0]);var o;r&&(o={level:0});for(var d=i.length>1e7&&typeof UZIP<"u"&&UZIP!=null?UZIP:pako,_=0;_<h.length;_++){for(var b=0;b<e;b++)UPNG.encode._filterLine(i,n,b,t,a,h[_]);u.push(d.deflate(i,o))}for(var f,v=1e9,_=0;_<u.length;_++)u[_].length<v&&(f=_,v=u[_].length);return u[f]};UPNG.encode._filterLine=function(n,e,a,t,i,s){var r=a*t,u=r+a,h=UPNG.decode._paeth;if(n[u]=s,u++,s==0)if(t<500)for(var o=0;o<t;o++)n[u+o]=e[r+o];else n.set(new Uint8Array(e.buffer,r,t),u);else if(s==1){for(var o=0;o<i;o++)n[u+o]=e[r+o];for(var o=i;o<t;o++)n[u+o]=e[r+o]-e[r+o-i]+256&255}else if(a==0){for(var o=0;o<i;o++)n[u+o]=e[r+o];if(s==2)for(var o=i;o<t;o++)n[u+o]=e[r+o];if(s==3)for(var o=i;o<t;o++)n[u+o]=e[r+o]-(e[r+o-i]>>1)+256&255;if(s==4)for(var o=i;o<t;o++)n[u+o]=e[r+o]-h(e[r+o-i],0,0)+256&255}else{if(s==2)for(var o=0;o<t;o++)n[u+o]=e[r+o]+256-e[r+o-t]&255;if(s==3){for(var o=0;o<i;o++)n[u+o]=e[r+o]+256-(e[r+o-t]>>1)&255;for(var o=i;o<t;o++)n[u+o]=e[r+o]+256-(e[r+o-t]+e[r+o-i]>>1)&255}if(s==4){for(var o=0;o<i;o++)n[u+o]=e[r+o]+256-h(0,e[r+o-t],0)&255;for(var o=i;o<t;o++)n[u+o]=e[r+o]+256-h(e[r+o-i],e[r+o-t],e[r+o-i-t])&255}}};UPNG.crc={table:function(){for(var n=new Uint32Array(256),e=0;e<256;e++){for(var a=e,t=0;t<8;t++)a&1?a=3988292384^a>>>1:a=a>>>1;n[e]=a}return n}(),update:function(n,e,a,t){for(var i=0;i<t;i++)n=UPNG.crc.table[(n^e[a+i])&255]^n>>>8;return n},crc:function(n,e,a){return UPNG.crc.update(4294967295,n,e,a)^4294967295}};UPNG.quantize=function(n,e){var a=new Uint8Array(n),t=a.slice(0),i=new Uint32Array(t.buffer),s=UPNG.quantize.getKDtree(t,e),r=s[0],u=s[1],h=UPNG.quantize.planeDst,o=a,d=i,_=o.length,b=new Uint8Array(a.length>>2),f;if(a.length<2e7)for(var v=0;v<_;v+=4){var A=o[v]*.00392156862745098,x=o[v+1]*(1/255),C=o[v+2]*(1/255),M=o[v+3]*(1/255);f=UPNG.quantize.getNearest(r,A,x,C,M),b[v>>2]=f.ind,d[v>>2]=f.est.rgba}else for(var v=0;v<_;v+=4){var A=o[v]*.00392156862745098,x=o[v+1]*(1/255),C=o[v+2]*(1/255),M=o[v+3]*(1/255);for(f=r;f.left;)f=h(f.est,A,x,C,M)<=0?f.left:f.right;b[v>>2]=f.ind,d[v>>2]=f.est.rgba}return{abuf:t.buffer,inds:b,plte:u}};UPNG.quantize.getKDtree=function(n,e,a){a==null&&(a=1e-4);var t=new Uint32Array(n.buffer),i={i0:0,i1:n.length,bst:null,est:null,tdst:0,left:null,right:null};i.bst=UPNG.quantize.stats(n,i.i0,i.i1),i.est=UPNG.quantize.estats(i.bst);for(var s=[i];s.length<e;){for(var r=0,u=0,h=0;h<s.length;h++)s[h].est.L>r&&(r=s[h].est.L,u=h);if(r<a)break;var o=s[u],d=UPNG.quantize.splitPixels(n,t,o.i0,o.i1,o.est.e,o.est.eMq255),_=o.i0>=d||o.i1<=d;if(_){o.est.L=0;continue}var b={i0:o.i0,i1:d,bst:null,est:null,tdst:0,left:null,right:null};b.bst=UPNG.quantize.stats(n,b.i0,b.i1),b.est=UPNG.quantize.estats(b.bst);var f={i0:d,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};f.bst={R:[],m:[],N:o.bst.N-b.bst.N};for(var h=0;h<16;h++)f.bst.R[h]=o.bst.R[h]-b.bst.R[h];for(var h=0;h<4;h++)f.bst.m[h]=o.bst.m[h]-b.bst.m[h];f.est=UPNG.quantize.estats(f.bst),o.left=b,o.right=f,s[u]=b,s.push(f)}s.sort(function(v,A){return A.bst.N-v.bst.N});for(var h=0;h<s.length;h++)s[h].ind=h;return[i,s]};UPNG.quantize.getNearest=function(n,e,a,t,i){if(n.left==null)return n.tdst=UPNG.quantize.dist(n.est.q,e,a,t,i),n;var s=UPNG.quantize.planeDst(n.est,e,a,t,i),r=n.left,u=n.right;s>0&&(r=n.right,u=n.left);var h=UPNG.quantize.getNearest(r,e,a,t,i);if(h.tdst<=s*s)return h;var o=UPNG.quantize.getNearest(u,e,a,t,i);return o.tdst<h.tdst?o:h};UPNG.quantize.planeDst=function(n,e,a,t,i){var s=n.e;return s[0]*e+s[1]*a+s[2]*t+s[3]*i-n.eMq};UPNG.quantize.dist=function(n,e,a,t,i){var s=e-n[0],r=a-n[1],u=t-n[2],h=i-n[3];return s*s+r*r+u*u+h*h};UPNG.quantize.splitPixels=function(n,e,a,t,i,s){var r=UPNG.quantize.vecDot;for(t-=4;a<t;){for(;r(n,a,i)<=s;)a+=4;for(;r(n,t,i)>s;)t-=4;if(a>=t)break;var u=e[a>>2];e[a>>2]=e[t>>2],e[t>>2]=u,a+=4,t-=4}for(;r(n,a,i)>s;)a-=4;return a+4};UPNG.quantize.vecDot=function(n,e,a){return n[e]*a[0]+n[e+1]*a[1]+n[e+2]*a[2]+n[e+3]*a[3]};UPNG.quantize.stats=function(n,e,a){for(var t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],s=a-e>>2,r=e;r<a;r+=4){var u=n[r]*.00392156862745098,h=n[r+1]*(1/255),o=n[r+2]*(1/255),d=n[r+3]*(1/255);i[0]+=u,i[1]+=h,i[2]+=o,i[3]+=d,t[0]+=u*u,t[1]+=u*h,t[2]+=u*o,t[3]+=u*d,t[5]+=h*h,t[6]+=h*o,t[7]+=h*d,t[10]+=o*o,t[11]+=o*d,t[15]+=d*d}return t[4]=t[1],t[8]=t[2],t[9]=t[6],t[12]=t[3],t[13]=t[7],t[14]=t[11],{R:t,m:i,N:s}};UPNG.quantize.estats=function(n){var e=n.R,a=n.m,t=n.N,i=a[0],s=a[1],r=a[2],u=a[3],h=t==0?0:1/t,o=[e[0]-i*i*h,e[1]-i*s*h,e[2]-i*r*h,e[3]-i*u*h,e[4]-s*i*h,e[5]-s*s*h,e[6]-s*r*h,e[7]-s*u*h,e[8]-r*i*h,e[9]-r*s*h,e[10]-r*r*h,e[11]-r*u*h,e[12]-u*i*h,e[13]-u*s*h,e[14]-u*r*h,e[15]-u*u*h],d=o,_=UPNG.M4,b=[Math.random(),Math.random(),Math.random(),Math.random()],f=0,v=0;if(t!=0)for(var A=0;A<16&&(b=_.multVec(d,b),v=Math.sqrt(_.dot(b,b)),b=_.sml(1/v,b),!(A!=0&&Math.abs(v-f)<1e-9));A++)f=v;var x=[i*h,s*h,r*h,u*h],C=_.dot(_.sml(255,x),b);return{Cov:o,q:x,e:b,L:f,eMq255:C,eMq:_.dot(b,x),rgba:(Math.round(255*x[3])<<24|Math.round(255*x[2])<<16|Math.round(255*x[1])<<8|Math.round(255*x[0])<<0)>>>0}};UPNG.M4={multVec:function(n,e){return[n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3],n[4]*e[0]+n[5]*e[1]+n[6]*e[2]+n[7]*e[3],n[8]*e[0]+n[9]*e[1]+n[10]*e[2]+n[11]*e[3],n[12]*e[0]+n[13]*e[1]+n[14]*e[2]+n[15]*e[3]]},dot:function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]},sml:function(n,e){return[n*e[0],n*e[1],n*e[2],n*e[3]]}};UPNG.encode.concatRGBA=function(n){for(var e=0,a=0;a<n.length;a++)e+=n[a].byteLength;for(var t=new Uint8Array(e),i=0,a=0;a<n.length;a++){for(var s=new Uint8Array(n[a]),r=s.length,u=0;u<r;u+=4){var h=s[u],o=s[u+1],d=s[u+2],_=s[u+3];_==0&&(h=o=d=0),t[i+u]=h,t[i+u+1]=o,t[i+u+2]=d,t[i+u+3]=_}i+=r}return t.buffer};let pdfjs;const pdfjs$1=pdfjs;(function(e,a){typeof exports=="object"&&typeof module=="object"?module.exports=a():typeof define=="function"&&define.amd?define("pdfjs-dist/build/pdf",[],a):typeof exports=="object"?exports["pdfjs-dist/build/pdf"]=a():(window["pdfjs-dist/build/pdf"]=window.pdfjsLib=a(),pdfjs=a())})(globalThis,function(){return(()=>{var __webpack_modules__=[,(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.addLinkAttributes=v,e.deprecated=p,e.getFilenameFromUrl=C,e.getPdfFilenameFromUrl=M,e.isDataScheme=A,e.isFetchSupported=w,e.isPdfFile=x,e.isValidFetchUrl=l,e.loadScript=c,e.StatTimer=e.RenderingCancelledException=e.PDFDateString=e.PageViewport=e.LinkTarget=e.DOMSVGFactory=e.DOMCMapReaderFactory=e.DOMCanvasFactory=e.DEFAULT_LINK_REL=e.BaseCMapReaderFactory=e.BaseCanvasFactory=void 0;var t=a(2);const i="noopener noreferrer nofollow";e.DEFAULT_LINK_REL=i;const s="http://www.w3.org/2000/svg";class r{constructor(){this.constructor===r&&(0,t.unreachable)("Cannot initialize BaseCanvasFactory.")}create(F,R){(0,t.unreachable)("Abstract method `create` called.")}reset(F,R,B){if(!F.canvas)throw new Error("Canvas is not specified");if(R<=0||B<=0)throw new Error("Invalid canvas size");F.canvas.width=R,F.canvas.height=B}destroy(F){if(!F.canvas)throw new Error("Canvas is not specified");F.canvas.width=0,F.canvas.height=0,F.canvas=null,F.context=null}}e.BaseCanvasFactory=r;class u extends r{constructor({ownerDocument:F=globalThis.document}={}){super(),this._document=F}create(F,R){if(F<=0||R<=0)throw new Error("Invalid canvas size");const B=this._document.createElement("canvas"),V=B.getContext("2d");return B.width=F,B.height=R,{canvas:B,context:V}}}e.DOMCanvasFactory=u;class h{constructor({baseUrl:F=null,isCompressed:R=!1}){this.constructor===h&&(0,t.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=F,this.isCompressed=R}async fetch({name:F}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!F)throw new Error("CMap name must be specified.");const R=this.baseUrl+F+(this.isCompressed?".bcmap":""),B=this.isCompressed?t.CMapCompressionType.BINARY:t.CMapCompressionType.NONE;return this._fetchData(R,B).catch(V=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${R}`)})}_fetchData(F,R){(0,t.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=h;class o extends h{_fetchData(F,R){return w()&&l(F,document.baseURI)?fetch(F).then(async B=>{if(!B.ok)throw new Error(B.statusText);let V;return this.isCompressed?V=new Uint8Array(await B.arrayBuffer()):V=(0,t.stringToBytes)(await B.text()),{cMapData:V,compressionType:R}}):new Promise((B,V)=>{const Z=new XMLHttpRequest;Z.open("GET",F,!0),this.isCompressed&&(Z.responseType="arraybuffer"),Z.onreadystatechange=()=>{if(Z.readyState===XMLHttpRequest.DONE){if(Z.status===200||Z.status===0){let ne;if(this.isCompressed&&Z.response?ne=new Uint8Array(Z.response):!this.isCompressed&&Z.responseText&&(ne=(0,t.stringToBytes)(Z.responseText)),ne){B({cMapData:ne,compressionType:R});return}}V(new Error(Z.statusText))}},Z.send(null)})}}e.DOMCMapReaderFactory=o;class d{create(F,R){(0,t.assert)(F>0&&R>0,"Invalid SVG dimensions");const B=document.createElementNS(s,"svg:svg");return B.setAttribute("version","1.1"),B.setAttribute("width",F+"px"),B.setAttribute("height",R+"px"),B.setAttribute("preserveAspectRatio","none"),B.setAttribute("viewBox","0 0 "+F+" "+R),B}createElement(F){return(0,t.assert)(typeof F=="string","Invalid SVG element type"),document.createElementNS(s,F)}}e.DOMSVGFactory=d;class _{constructor({viewBox:F,scale:R,rotation:B,offsetX:V=0,offsetY:Z=0,dontFlip:ne=!1}){this.viewBox=F,this.scale=R,this.rotation=B,this.offsetX=V,this.offsetY=Z;const H=(F[2]+F[0])/2,N=(F[3]+F[1])/2;let g,O,D,z;switch(B%=360,B<0&&(B+=360),B){case 180:g=-1,O=0,D=0,z=1;break;case 90:g=0,O=1,D=1,z=0;break;case 270:g=0,O=-1,D=-1,z=0;break;case 0:g=1,O=0,D=0,z=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}ne&&(D=-D,z=-z);let W,J,ie,ue;g===0?(W=Math.abs(N-F[1])*R+V,J=Math.abs(H-F[0])*R+Z,ie=Math.abs(F[3]-F[1])*R,ue=Math.abs(F[2]-F[0])*R):(W=Math.abs(H-F[0])*R+V,J=Math.abs(N-F[1])*R+Z,ie=Math.abs(F[2]-F[0])*R,ue=Math.abs(F[3]-F[1])*R),this.transform=[g*R,O*R,D*R,z*R,W-g*R*H-D*R*N,J-O*R*H-z*R*N],this.width=ie,this.height=ue}clone({scale:F=this.scale,rotation:R=this.rotation,offsetX:B=this.offsetX,offsetY:V=this.offsetY,dontFlip:Z=!1}={}){return new _({viewBox:this.viewBox.slice(),scale:F,rotation:R,offsetX:B,offsetY:V,dontFlip:Z})}convertToViewportPoint(F,R){return t.Util.applyTransform([F,R],this.transform)}convertToViewportRectangle(F){const R=t.Util.applyTransform([F[0],F[1]],this.transform),B=t.Util.applyTransform([F[2],F[3]],this.transform);return[R[0],R[1],B[0],B[1]]}convertToPdfPoint(F,R){return t.Util.applyInverseTransform([F,R],this.transform)}}e.PageViewport=_;class b extends t.BaseException{constructor(F,R){super(F),this.type=R}}e.RenderingCancelledException=b;const f={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};e.LinkTarget=f;function v(P,{url:F,target:R,rel:B,enabled:V=!0}={}){(0,t.assert)(F&&typeof F=="string",'addLinkAttributes: A valid "url" parameter must provided.');const Z=(0,t.removeNullCharacters)(F);V?P.href=P.title=Z:(P.href="",P.title=`Disabled: ${Z}`,P.onclick=()=>!1);let ne="";switch(R){case f.NONE:break;case f.SELF:ne="_self";break;case f.BLANK:ne="_blank";break;case f.PARENT:ne="_parent";break;case f.TOP:ne="_top";break}P.target=ne,P.rel=typeof B=="string"?B:i}function A(P){const F=P.length;let R=0;for(;R<F&&P[R].trim()==="";)R++;return P.substring(R,R+5).toLowerCase()==="data:"}function x(P){return typeof P=="string"&&/\.pdf$/i.test(P)}function C(P){const F=P.indexOf("#"),R=P.indexOf("?"),B=Math.min(F>0?F:P.length,R>0?R:P.length);return P.substring(P.lastIndexOf("/",B)+1,B)}function M(P,F="document.pdf"){if(typeof P!="string")return F;if(A(P))return(0,t.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),F;const R=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,B=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,V=R.exec(P);let Z=B.exec(V[1])||B.exec(V[2])||B.exec(V[3]);if(Z&&(Z=Z[0],Z.includes("%")))try{Z=B.exec(decodeURIComponent(Z))[0]}catch{}return Z||F}class I{constructor(){this.started=Object.create(null),this.times=[]}time(F){F in this.started&&(0,t.warn)(`Timer is already running for ${F}`),this.started[F]=Date.now()}timeEnd(F){F in this.started||(0,t.warn)(`Timer has not been started for ${F}`),this.times.push({name:F,start:this.started[F],end:Date.now()}),delete this.started[F]}toString(){const F=[];let R=0;for(const B of this.times){const V=B.name;V.length>R&&(R=V.length)}for(const B of this.times){const V=B.end-B.start;F.push(`${B.name.padEnd(R)} ${V}ms
`)}return F.join("")}}e.StatTimer=I;function w(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype&&typeof ReadableStream<"u"}function l(P,F){try{const{protocol:R}=F?new URL(P,F):new URL(P);return R==="http:"||R==="https:"}catch{return!1}}function c(P,F=!1){return new Promise((R,B)=>{const V=document.createElement("script");V.src=P,V.onload=function(Z){F&&V.remove(),R(Z)},V.onerror=function(){B(new Error(`Cannot load script at: ${V.src}`))},(document.head||document.documentElement).appendChild(V)})}function p(P){console.log("Deprecated API usage: "+P)}let m;class y{static toDateObject(F){if(!F||!(0,t.isString)(F))return null;m||(m=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const R=m.exec(F);if(!R)return null;const B=parseInt(R[1],10);let V=parseInt(R[2],10);V=V>=1&&V<=12?V-1:0;let Z=parseInt(R[3],10);Z=Z>=1&&Z<=31?Z:1;let ne=parseInt(R[4],10);ne=ne>=0&&ne<=23?ne:0;let H=parseInt(R[5],10);H=H>=0&&H<=59?H:0;let N=parseInt(R[6],10);N=N>=0&&N<=59?N:0;const g=R[7]||"Z";let O=parseInt(R[8],10);O=O>=0&&O<=23?O:0;let D=parseInt(R[9],10)||0;return D=D>=0&&D<=59?D:0,g==="-"?(ne+=O,H+=D):g==="+"&&(ne-=O,H-=D),new Date(Date.UTC(B,V,Z,ne,H,N))}}e.PDFDateString=y},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.arrayByteLength=Y,e.arraysToBytes=fe,e.assert=ne,e.bytesToString=T,e.createObjectURL=_e,e.createPromiseCapability=le,e.createValidAbsoluteUrl=g,e.escapeString=xe,e.getModificationDate=te,e.getVerbosityLevel=R,e.info=B,e.isArrayBuffer=j,e.isArrayEqual=X,e.isAscii=Se,e.isBool=Re,e.isNum=Fe,e.isSameOrigin=H,e.isString=L,e.objectFromMap=ee,e.objectSize=q,e.removeNullCharacters=U,e.setVerbosityLevel=F,e.shadow=O,e.string32=we,e.stringToBytes=K,e.stringToPDFString=Ae,e.stringToUTF16BEString=Ce,e.stringToUTF8String=Ee,e.unreachable=Z,e.utf8StringToString=Le,e.warn=V,e.VerbosityLevel=e.Util=e.UNSUPPORTED_FEATURES=e.UnknownErrorException=e.UnexpectedResponseException=e.TextRenderingMode=e.StreamType=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.IsLittleEndianCached=e.IsEvalSupportedCached=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FontType=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,a(3);const t=[1,0,0,1,0,0];e.IDENTITY_MATRIX=t;const i=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=i;const s={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=s;const r={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=r;const u={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=u;const h={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=h;const o={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=o;const d={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=d;const _={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=_;const b={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=b;const f={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=f;const v={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=v;const A={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=A;const x={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=x;const C={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=C;const M={O:"PageOpen",C:"PageClose"};e.PageActionEventType=M;const I={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};e.StreamType=I;const w={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};e.FontType=w;const l={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=l;const c={NONE:0,BINARY:1,STREAM:2};e.CMapCompressionType=c;const p={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=p;const m={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent"};e.UNSUPPORTED_FEATURES=m;const y={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=y;let P=l.WARNINGS;function F(re){Number.isInteger(re)&&(P=re)}function R(){return P}function B(re){P>=l.INFOS&&console.log(`Info: ${re}`)}function V(re){P>=l.WARNINGS&&console.log(`Warning: ${re}`)}function Z(re){throw new Error(re)}function ne(re,ae){re||Z(ae)}function H(re,ae){let ce;try{if(ce=new URL(re),!ce.origin||ce.origin==="null")return!1}catch{return!1}const me=new URL(ae,ce);return ce.origin===me.origin}function N(re){if(!re)return!1;switch(re.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function g(re,ae){if(!re)return null;try{const ce=ae?new URL(re,ae):new URL(re);if(N(ce))return ce}catch{}return null}function O(re,ae,ce){return Object.defineProperty(re,ae,{value:ce,enumerable:!0,configurable:!0,writable:!1}),ce}const D=function(){function ae(ce){this.constructor===ae&&Z("Cannot initialize BaseException."),this.message=ce,this.name=this.constructor.name}return ae.prototype=new Error,ae.constructor=ae,ae}();e.BaseException=D;class z extends D{constructor(ae,ce){super(ae),this.code=ce}}e.PasswordException=z;class W extends D{constructor(ae,ce){super(ae),this.details=ce}}e.UnknownErrorException=W;class J extends D{}e.InvalidPDFException=J;class ie extends D{}e.MissingPDFException=ie;class ue extends D{constructor(ae,ce){super(ae),this.status=ce}}e.UnexpectedResponseException=ue;class he extends D{}e.FormatError=he;class se extends D{}e.AbortException=se;const de=/\x00/g;function U(re){return typeof re!="string"?(V("The argument for removeNullCharacters must be a string."),re):re.replace(de,"")}function T(re){ne(re!==null&&typeof re=="object"&&re.length!==void 0,"Invalid argument for bytesToString");const ae=re.length,ce=8192;if(ae<ce)return String.fromCharCode.apply(null,re);const me=[];for(let be=0;be<ae;be+=ce){const ve=Math.min(be+ce,ae),ye=re.subarray(be,ve);me.push(String.fromCharCode.apply(null,ye))}return me.join("")}function K(re){ne(typeof re=="string","Invalid argument for stringToBytes");const ae=re.length,ce=new Uint8Array(ae);for(let me=0;me<ae;++me)ce[me]=re.charCodeAt(me)&255;return ce}function Y(re){return re.length!==void 0?re.length:(ne(re.byteLength!==void 0,"arrayByteLength - invalid argument."),re.byteLength)}function fe(re){const ae=re.length;if(ae===1&&re[0]instanceof Uint8Array)return re[0];let ce=0;for(let ve=0;ve<ae;ve++)ce+=Y(re[ve]);let me=0;const be=new Uint8Array(ce);for(let ve=0;ve<ae;ve++){let ye=re[ve];ye instanceof Uint8Array||(typeof ye=="string"?ye=K(ye):ye=new Uint8Array(ye));const Pe=ye.byteLength;be.set(ye,me),me+=Pe}return be}function we(re){return String.fromCharCode(re>>24&255,re>>16&255,re>>8&255,re&255)}function q(re){return Object.keys(re).length}function ee(re){const ae=Object.create(null);for(const[ce,me]of re)ae[ce]=me;return ae}function G(){const re=new Uint8Array(4);return re[0]=1,new Uint32Array(re.buffer,0,1)[0]===1}const S={get value(){return O(this,"value",G())}};e.IsLittleEndianCached=S;function k(){try{return new Function(""),!0}catch{return!1}}const Q={get value(){return O(this,"value",k())}};e.IsEvalSupportedCached=Q;const oe=[...Array(256).keys()].map(re=>re.toString(16).padStart(2,"0"));class pe{static makeHexColor(ae,ce,me){return`#${oe[ae]}${oe[ce]}${oe[me]}`}static transform(ae,ce){return[ae[0]*ce[0]+ae[2]*ce[1],ae[1]*ce[0]+ae[3]*ce[1],ae[0]*ce[2]+ae[2]*ce[3],ae[1]*ce[2]+ae[3]*ce[3],ae[0]*ce[4]+ae[2]*ce[5]+ae[4],ae[1]*ce[4]+ae[3]*ce[5]+ae[5]]}static applyTransform(ae,ce){const me=ae[0]*ce[0]+ae[1]*ce[2]+ce[4],be=ae[0]*ce[1]+ae[1]*ce[3]+ce[5];return[me,be]}static applyInverseTransform(ae,ce){const me=ce[0]*ce[3]-ce[1]*ce[2],be=(ae[0]*ce[3]-ae[1]*ce[2]+ce[2]*ce[5]-ce[4]*ce[3])/me,ve=(-ae[0]*ce[1]+ae[1]*ce[0]+ce[4]*ce[1]-ce[5]*ce[0])/me;return[be,ve]}static getAxialAlignedBoundingBox(ae,ce){const me=pe.applyTransform(ae,ce),be=pe.applyTransform(ae.slice(2,4),ce),ve=pe.applyTransform([ae[0],ae[3]],ce),ye=pe.applyTransform([ae[2],ae[1]],ce);return[Math.min(me[0],be[0],ve[0],ye[0]),Math.min(me[1],be[1],ve[1],ye[1]),Math.max(me[0],be[0],ve[0],ye[0]),Math.max(me[1],be[1],ve[1],ye[1])]}static inverseTransform(ae){const ce=ae[0]*ae[3]-ae[1]*ae[2];return[ae[3]/ce,-ae[1]/ce,-ae[2]/ce,ae[0]/ce,(ae[2]*ae[5]-ae[4]*ae[3])/ce,(ae[4]*ae[1]-ae[5]*ae[0])/ce]}static apply3dTransform(ae,ce){return[ae[0]*ce[0]+ae[1]*ce[1]+ae[2]*ce[2],ae[3]*ce[0]+ae[4]*ce[1]+ae[5]*ce[2],ae[6]*ce[0]+ae[7]*ce[1]+ae[8]*ce[2]]}static singularValueDecompose2dScale(ae){const ce=[ae[0],ae[2],ae[1],ae[3]],me=ae[0]*ce[0]+ae[1]*ce[2],be=ae[0]*ce[1]+ae[1]*ce[3],ve=ae[2]*ce[0]+ae[3]*ce[2],ye=ae[2]*ce[1]+ae[3]*ce[3],Pe=(me+ye)/2,Te=Math.sqrt((me+ye)**2-4*(me*ye-ve*be))/2,ke=Pe+Te||1,Ie=Pe-Te||1;return[Math.sqrt(ke),Math.sqrt(Ie)]}static normalizeRect(ae){const ce=ae.slice(0);return ae[0]>ae[2]&&(ce[0]=ae[2],ce[2]=ae[0]),ae[1]>ae[3]&&(ce[1]=ae[3],ce[3]=ae[1]),ce}static intersect(ae,ce){function me(Pe,Te){return Pe-Te}const be=[ae[0],ae[2],ce[0],ce[2]].sort(me),ve=[ae[1],ae[3],ce[1],ce[3]].sort(me),ye=[];if(ae=pe.normalizeRect(ae),ce=pe.normalizeRect(ce),be[0]===ae[0]&&be[1]===ce[0]||be[0]===ce[0]&&be[1]===ae[0])ye[0]=be[1],ye[2]=be[2];else return null;if(ve[0]===ae[1]&&ve[1]===ce[1]||ve[0]===ce[1]&&ve[1]===ae[1])ye[1]=ve[1],ye[3]=ve[2];else return null;return ye}}e.Util=pe;const ge=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Ae(re){const ae=re.length,ce=[];if(re[0]==="þ"&&re[1]==="ÿ")for(let me=2;me<ae;me+=2)ce.push(String.fromCharCode(re.charCodeAt(me)<<8|re.charCodeAt(me+1)));else if(re[0]==="ÿ"&&re[1]==="þ")for(let me=2;me<ae;me+=2)ce.push(String.fromCharCode(re.charCodeAt(me+1)<<8|re.charCodeAt(me)));else for(let me=0;me<ae;++me){const be=ge[re.charCodeAt(me)];ce.push(be?String.fromCharCode(be):re.charAt(me))}return ce.join("")}function xe(re){return re.replace(/([()\\\n\r])/g,ae=>ae===`
`?"\\n":ae==="\r"?"\\r":`\\${ae}`)}function Se(re){return/^[\x00-\x7F]*$/.test(re)}function Ce(re){const ae=["þÿ"];for(let ce=0,me=re.length;ce<me;ce++){const be=re.charCodeAt(ce);ae.push(String.fromCharCode(be>>8&255)),ae.push(String.fromCharCode(be&255))}return ae.join("")}function Ee(re){return decodeURIComponent(escape(re))}function Le(re){return unescape(encodeURIComponent(re))}function Re(re){return typeof re=="boolean"}function Fe(re){return typeof re=="number"}function L(re){return typeof re=="string"}function j(re){return typeof re=="object"&&re!==null&&re.byteLength!==void 0}function X(re,ae){if(re.length!==ae.length)return!1;for(let ce=0,me=re.length;ce<me;ce++)if(re[ce]!==ae[ce])return!1;return!0}function te(re=new Date){return[re.getUTCFullYear().toString(),(re.getUTCMonth()+1).toString().padStart(2,"0"),re.getUTCDate().toString().padStart(2,"0"),re.getUTCHours().toString().padStart(2,"0"),re.getUTCMinutes().toString().padStart(2,"0"),re.getUTCSeconds().toString().padStart(2,"0")].join("")}function le(){const re=Object.create(null);let ae=!1;return Object.defineProperty(re,"settled",{get(){return ae}}),re.promise=new Promise(function(ce,me){re.resolve=function(be){ae=!0,ce(be)},re.reject=function(be){ae=!0,me(be)}}),re}function _e(re,ae="",ce=!1){if(URL.createObjectURL&&!ce)return URL.createObjectURL(new Blob([re],{type:ae}));const me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let be=`data:${ae};base64,`;for(let ve=0,ye=re.length;ve<ye;ve+=3){const Pe=re[ve]&255,Te=re[ve+1]&255,ke=re[ve+2]&255,Ie=Pe>>2,Me=(Pe&3)<<4|Te>>4,Oe=ve+1<ye?(Te&15)<<2|ke>>6:64,Ne=ve+2<ye?ke&63:64;be+=me[Ie]+me[Me]+me[Oe]+me[Ne]}return be}},(n,e,a)=>{a(4)},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;const a=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=a},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultCMapReaderFactory=exports.DefaultCanvasFactory=exports.build=void 0;var _util=__w_pdfjs_require__(2),_display_utils=__w_pdfjs_require__(1),_font_loader=__w_pdfjs_require__(6),_node_utils=__w_pdfjs_require__(7),_annotation_storage=__w_pdfjs_require__(8),_api_compatibility=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(10),_worker_options=__w_pdfjs_require__(12),_is_node=__w_pdfjs_require__(4),_message_handler=__w_pdfjs_require__(13),_metadata=__w_pdfjs_require__(14),_optional_content_config=__w_pdfjs_require__(15),_transport_stream=__w_pdfjs_require__(16),_webgl=__w_pdfjs_require__(17);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_is_node.isNodeJS?_node_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_is_node.isNodeJS?_node_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let createPDFNetworkStream;function setPDFNetworkStreamFactory(n){createPDFNetworkStream=n}function getDocument(n){const e=new PDFDocumentLoadingTask;let a;if(typeof n=="string"||n instanceof URL)a={url:n};else if((0,_util.isArrayBuffer)(n))a={data:n};else if(n instanceof PDFDataRangeTransport)a={range:n};else{if(typeof n!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, Uint8Array, or parameter object.");if(!n.url&&!n.data&&!n.range)throw new Error("Invalid parameter object: need either .data, .range or .url");a=n}const t=Object.create(null);let i=null,s=null;for(const u in a){const h=a[u];switch(u){case"url":if(typeof window<"u")try{t[u]=new URL(h,window.location).href;continue}catch(o){(0,_util.warn)(`Cannot create valid URL: "${o}".`)}else if(typeof h=="string"||h instanceof URL){t[u]=h.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":i=h;continue;case"worker":s=h;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&h instanceof Buffer)t[u]=new Uint8Array(h);else{if(h instanceof Uint8Array)break;if(typeof h=="string")t[u]=(0,_util.stringToBytes)(h);else if(typeof h=="object"&&h!==null&&!isNaN(h.length))t[u]=new Uint8Array(h);else if((0,_util.isArrayBuffer)(h))t[u]=new Uint8Array(h);else throw new Error("Invalid PDF binary data: either typed array, string, or array-like object is expected in the data property.")}continue}t[u]=h}if(t.rangeChunkSize=t.rangeChunkSize||DEFAULT_RANGE_CHUNK_SIZE,t.CMapReaderFactory=t.CMapReaderFactory||DefaultCMapReaderFactory,t.ignoreErrors=t.stopAtErrors!==!0,t.fontExtraProperties=t.fontExtraProperties===!0,t.pdfBug=t.pdfBug===!0,t.enableXfa=t.enableXfa===!0,(typeof t.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(t.docBaseUrl))&&(t.docBaseUrl=null),Number.isInteger(t.maxImageSize)||(t.maxImageSize=-1),typeof t.isEvalSupported!="boolean"&&(t.isEvalSupported=!0),typeof t.disableFontFace!="boolean"&&(t.disableFontFace=_api_compatibility.apiCompatibilityParams.disableFontFace||!1),typeof t.ownerDocument>"u"&&(t.ownerDocument=globalThis.document),typeof t.disableRange!="boolean"&&(t.disableRange=!1),typeof t.disableStream!="boolean"&&(t.disableStream=!1),typeof t.disableAutoFetch!="boolean"&&(t.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(t.verbosity),!s){const u={verbosity:t.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};s=u.port?PDFWorker.fromPort(u):new PDFWorker(u),e._worker=s}const r=e.docId;return s.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");const u=_fetchDocument(s,t,i,r),h=new Promise(function(o){let d;i?d=new _transport_stream.PDFDataTransportStream({length:t.length,initialData:t.initialData,progressiveDone:t.progressiveDone,contentDispositionFilename:t.contentDispositionFilename,disableRange:t.disableRange,disableStream:t.disableStream},i):t.data||(d=createPDFNetworkStream({url:t.url,length:t.length,httpHeaders:t.httpHeaders,withCredentials:t.withCredentials,rangeChunkSize:t.rangeChunkSize,disableRange:t.disableRange,disableStream:t.disableStream})),o(d)});return Promise.all([u,h]).then(function([o,d]){if(e.destroyed)throw new Error("Loading aborted");const _=new _message_handler.MessageHandler(r,o,s.port);_.postMessageTransfers=s.postMessageTransfers;const b=new WorkerTransport(_,e,d,t);e._transport=b,_.send("Ready",null)})}).catch(e._capability.reject),e}function _fetchDocument(n,e,a,t){return n.destroyed?Promise.reject(new Error("Worker was destroyed")):(a&&(e.length=a.length,e.initialData=a.initialData,e.progressiveDone=a.progressiveDone,e.contentDispositionFilename=a.contentDispositionFilename),n.messageHandler.sendWithPromise("GetDocRequest",{docId:t,apiVersion:"2.8.335",source:{data:e.data,url:e.url,password:e.password,disableAutoFetch:e.disableAutoFetch,rangeChunkSize:e.rangeChunkSize,length:e.length},maxImageSize:e.maxImageSize,disableFontFace:e.disableFontFace,postMessageTransfers:n.postMessageTransfers,docBaseUrl:e.docBaseUrl,ignoreErrors:e.ignoreErrors,isEvalSupported:e.isEvalSupported,fontExtraProperties:e.fontExtraProperties,enableXfa:e.enableXfa}).then(function(i){if(n.destroyed)throw new Error("Worker was destroyed");return i}))}const PDFDocumentLoadingTask=function(){let e=0;class a{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId="d"+e++,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}destroy(){return this.destroyed=!0,(this._transport?this._transport.destroy():Promise.resolve()).then(()=>{this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)})}}return a}();class PDFDataRangeTransport{constructor(e,a,t=!1,i=null){this.length=e,this.initialData=a,this.progressiveDone=t,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,a){for(const t of this._rangeListeners)t(e,a)}onDataProgress(e,a){this._readyCapability.promise.then(()=>{for(const t of this._progressListeners)t(e,a)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const a of this._progressiveReadListeners)a(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,a){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,a){this._pdfInfo=e,this._transport=a}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get numPages(){return this._pdfInfo.numPages}get fingerprint(){return this._pdfInfo.fingerprint}get isPureXfa(){return this._pdfInfo.isPureXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}getStats(){return this._transport.getStats()}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(e){return this._transport.saveDocument(e)}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,a,t,i,s=!1){this._pageIndex=e,this._pageInfo=a,this._ownerDocument=i,this._transport=t,this._stats=s?new _display_utils.StatTimer:null,this._pdfBug=s,this.commonObjs=t.commonObjs,this.objs=new PDFObjects,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:a=this.rotate,offsetX:t=0,offsetY:i=0,dontFlip:s=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:a,offsetX:t,offsetY:i,dontFlip:s})}getAnnotations({intent:e=null}={}){return(!this._annotationsPromise||this._annotationsIntent!==e)&&(this._annotationsPromise=this._transport.getAnnotations(this._pageIndex,e),this._annotationsIntent=e),this._annotationsPromise}getJSActions(){return this._jsActionsPromise||(this._jsActionsPromise=this._transport.getPageJSActions(this._pageIndex))}getXfa(){return this._xfaPromise||(this._xfaPromise=this._transport.getPageXfa(this._pageIndex))}render({canvasContext:e,viewport:a,intent:t="display",enableWebGL:i=!1,renderInteractiveForms:s=!1,transform:r=null,imageLayer:u=null,canvasFactory:h=null,background:o=null,annotationStorage:d=null,optionalContentConfigPromise:_=null}){var b;this._stats&&this._stats.time("Overall");const f=t==="print"?"print":"display";this.pendingCleanup=!1,_||(_=this._transport.getOptionalContentConfig());let v=this._intentStates.get(f);v||(v=Object.create(null),this._intentStates.set(f,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);const A=h||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),x=new _webgl.WebGLContext({enable:i});v.displayReadyCapability||(v.displayReadyCapability=(0,_util.createPromiseCapability)(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:f,renderInteractiveForms:s===!0,annotationStorage:(d==null?void 0:d.serializable)||null}));const C=w=>{v.renderTasks.delete(M),(this.cleanupAfterRender||f==="print")&&(this.pendingCleanup=!0),this._tryCleanup(),w?(M.capability.reject(w),this._abortOperatorList({intentState:v,reason:w})):M.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},M=new InternalRenderTask({callback:C,params:{canvasContext:e,viewport:a,transform:r,imageLayer:u,background:o},objs:this.objs,commonObjs:this.commonObjs,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:A,webGLContext:x,useRequestAnimationFrame:f!=="print",pdfBug:this._pdfBug});((b=v).renderTasks||(b.renderTasks=new Set)).add(M);const I=M.task;return Promise.all([v.displayReadyCapability.promise,_]).then(([w,l])=>{if(this.pendingCleanup){C();return}this._stats&&this._stats.time("Rendering"),M.initializeGraphics({transparency:w,optionalContentConfig:l}),M.operatorListChanged()}).catch(C),I}getOperatorList(){function e(){t.operatorList.lastChunk&&(t.opListReadCapability.resolve(t.operatorList),t.renderTasks.delete(i))}const a="oplist";let t=this._intentStates.get(a);t||(t=Object.create(null),this._intentStates.set(a,t));let i;if(!t.opListReadCapability){var s;i=Object.create(null),i.operatorListChanged=e,t.opListReadCapability=(0,_util.createPromiseCapability)(),((s=t).renderTasks||(s.renderTasks=new Set)).add(i),t.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:a})}return t.opListReadCapability.promise}streamTextContent({normalizeWhitespace:e=!1,disableCombineTextItems:a=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,normalizeWhitespace:e===!0,combineTextItems:a!==!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){const a=this.streamTextContent(e);return new Promise(function(t,i){function s(){r.read().then(function({value:h,done:o}){if(o){t(u);return}Object.assign(u.styles,h.styles),u.items.push(...h.items),s()},i)}const r=a.getReader(),u={items:[],styles:Object.create(null)};s()})}_destroy(){this.destroyed=!0,this._transport.pageCache[this._pageIndex]=null;const e=[];for(const[a,t]of this._intentStates)if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),a!=="oplist")for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this._annotationsPromise=null,this._jsActionsPromise=null,this._xfaPromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:a,operatorList:t}of this._intentStates.values())if(a.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this._annotationsPromise=null,this._jsActionsPromise=null,this._xfaPromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer),this.pendingCleanup=!1,!0}_startRenderPage(e,a){const t=this._intentStates.get(a);t&&(this._stats&&this._stats.timeEnd("Page Request"),t.displayReadyCapability&&t.displayReadyCapability.resolve(e))}_renderPageChunk(e,a){for(let t=0,i=e.length;t<i;t++)a.operatorList.fnArray.push(e.fnArray[t]),a.operatorList.argsArray.push(e.argsArray[t]);a.operatorList.lastChunk=e.lastChunk;for(const t of a.renderTasks)t.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList(e){(0,_util.assert)(e.intent,'PDFPageProxy._pumpOperatorList: Expected "intent" argument.');const t=this._transport.messageHandler.sendWithStream("GetOperatorList",e).getReader(),i=this._intentStates.get(e.intent);i.streamReader=t;const s=()=>{t.read().then(({value:r,done:u})=>{if(u){i.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(r,i),s())},r=>{if(i.streamReader=null,!this._transport.destroyed){if(i.operatorList){i.operatorList.lastChunk=!0;for(const u of i.renderTasks)u.operatorListChanged();this._tryCleanup()}if(i.displayReadyCapability)i.displayReadyCapability.reject(r);else if(i.opListReadCapability)i.opListReadCapability.reject(r);else throw r}})};s()}_abortOperatorList({intentState:e,reason:a,force:t=!1}){if((0,_util.assert)(a instanceof Error||typeof a=="object"&&a!==null,'PDFPageProxy._abortOperatorList: Expected "reason" argument.'),!!e.streamReader){if(!t){if(e.renderTasks.size>0)return;if(a instanceof _display_utils.RenderingCancelledException){e.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:e,reason:a,force:!0}),e.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(e.streamReader.cancel(new _util.AbortException(a==null?void 0:a.message)),e.streamReader=null,!this._transport.destroyed){for(const[i,s]of this._intentStates)if(s===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve(void 0)}postMessage(e,a){function t(r){var o;if(typeof r!="object"||r===null)return r;if(i.has(r))return i.get(r);let u,h;if((u=r.buffer)&&(0,_util.isArrayBuffer)(u))return a!=null&&a.includes(u)?h=new r.constructor(u,r.byteOffset,r.byteLength):h=new r.constructor(r),i.set(r,h),h;if(r instanceof Map){h=new Map,i.set(r,h);for(const[d,_]of r)h.set(d,t(_));return h}if(r instanceof Set){h=new Set,i.set(r,h);for(const d of r)h.add(t(d));return h}h=Array.isArray(r)?[]:{},i.set(r,h);for(const d in r){let _,b=r;for(;!(_=Object.getOwnPropertyDescriptor(b,d));)b=Object.getPrototypeOf(b);if(!(typeof _.value>"u")){if(typeof _.value=="function"){if((o=r.hasOwnProperty)!=null&&o.call(r,d))throw new Error(`LoopbackPort.postMessage - cannot clone: ${r[d]}`);continue}h[d]=t(_.value)}}return h}const i=new WeakMap,s={data:t(e)};this._deferred.then(()=>{for(const r of this._listeners)r.call(this,s)})}addEventListener(e,a){this._listeners.push(a)}removeEventListener(e,a){const t=this._listeners.indexOf(a);this._listeners.splice(t,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorker=function PDFWorkerClosure(){var n;const pdfWorkerPorts=new WeakMap;let isWorkerDisabled=!1,fallbackWorkerSrc,nextFakeWorkerId=0,fakeWorkerCapability;if(_is_node.isNodeJS&&typeof require=="function")isWorkerDisabled=!0,fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"&&"currentScript"in document){const e=(n=document.currentScript)==null?void 0:n.src;e&&(fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}function getWorkerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(typeof fallbackWorkerSrc<"u")return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}function getMainThreadWorkerMessageHandler(){var a;let e;try{e=(a=globalThis.pdfjsWorker)==null?void 0:a.WorkerMessageHandler}catch{}return e||null}function setupFakeWorkerGlobal(){if(fakeWorkerCapability)return fakeWorkerCapability.promise;fakeWorkerCapability=(0,_util.createPromiseCapability)();const loader=async function(){const mainWorkerMessageHandler=getMainThreadWorkerMessageHandler();if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof require=="function"){const worker=eval("require")(getWorkerSrc());return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(getWorkerSrc()),window.pdfjsWorker.WorkerMessageHandler};return loader().then(fakeWorkerCapability.resolve,fakeWorkerCapability.reject),fakeWorkerCapability.promise}function createCDNWrapper(e){const a="importScripts('"+e+"');";return URL.createObjectURL(new Blob([a]))}class PDFWorker{constructor({name:a=null,port:t=null,verbosity:i=(0,_util.getVerbosityLevel)()}={}){if(t&&pdfWorkerPorts.has(t))throw new Error("Cannot use more than one PDFWorker per port");if(this.name=a,this.destroyed=!1,this.postMessageTransfers=!0,this.verbosity=i,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,t){pdfWorkerPorts.set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(a){this._port=a,this._messageHandler=new _message_handler.MessageHandler("main","worker",a),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(typeof Worker<"u"&&!isWorkerDisabled&&!getMainThreadWorkerMessageHandler()){let a=getWorkerSrc();try{(0,_util.isSameOrigin)(window.location.href,a)||(a=createCDNWrapper(new URL(a,window.location).href));const t=new Worker(a),i=new _message_handler.MessageHandler("main","worker",t),s=()=>{t.removeEventListener("error",r),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=()=>{this._webWorker||s()};t.addEventListener("error",r),i.on("test",h=>{if(t.removeEventListener("error",r),this.destroyed){s();return}h?(this._messageHandler=i,this._port=t,this._webWorker=t,h.supportTransfers||(this.postMessageTransfers=!1),this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),i.destroy(),t.terminate())}),i.on("ready",h=>{if(t.removeEventListener("error",r),this.destroyed){s();return}try{u()}catch{this._setupFakeWorker()}});const u=()=>{const h=new Uint8Array([this.postMessageTransfers?255:0]);try{i.send("test",h,[h.buffer])}catch{(0,_util.warn)("Cannot use postMessage transfers."),h[0]=0,i.send("test",h)}};u();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),isWorkerDisabled=!0),setupFakeWorkerGlobal().then(a=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new LoopbackPort;this._port=t;const i="fake"+nextFakeWorkerId++,s=new _message_handler.MessageHandler(i+"_worker",i,t);a.setup(s,t);const r=new _message_handler.MessageHandler(i,i+"_worker",t);this._messageHandler=r,this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})}).catch(a=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${a.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),pdfWorkerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(a){if(!a||!a.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return pdfWorkerPorts.has(a.port)?pdfWorkerPorts.get(a.port):new PDFWorker(a)}static getWorkerSrc(){return getWorkerSrc()}}return PDFWorker}();exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(e,a,t,i){this.messageHandler=e,this.loadingTask=a,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:a.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:i.ownerDocument}),this._params=i,this.CMapReaderFactory=new i.CMapReaderFactory({baseUrl:i.cMapUrl,isCompressed:i.cMapPacked}),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=t,this._fullReader=null,this._lastProgress=null,this.pageCache=[],this.pagePromises=[],this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get loadingTaskSettled(){return this.loadingTask._capability.settled}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];this.pageCache.forEach(function(t){t&&e.push(t._destroy())}),this.pageCache.length=0,this.pagePromises.length=0;const a=this.messageHandler.sendWithPromise("Terminate",null);if(e.push(a),this.loadingTaskSettled){const t=this.loadingTask.promise.then(i=>{i.hasOwnProperty("annotationStorage")&&i.annotationStorage.resetModified()}).catch(()=>{});e.push(t)}return Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:a}=this;e.on("GetReader",(t,i)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},i.onPull=()=>{this._fullReader.read().then(function({value:s,done:r}){if(r){i.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(s),"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{i.error(s)})},i.onCancel=s=>{this._fullReader.cancel(s),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",t=>{const i=(0,_util.createPromiseCapability)(),s=this._fullReader;return s.headersReady.then(()=>{(!s.isStreamingSupported||!s.isRangeSupported)&&(this._lastProgress&&a.onProgress&&a.onProgress(this._lastProgress),s.onProgress=r=>{a.onProgress&&a.onProgress({loaded:r.loaded,total:r.total})}),i.resolve({isStreamingSupported:s.isStreamingSupported,isRangeSupported:s.isRangeSupported,contentLength:s.contentLength})},i.reject),i.promise}),e.on("GetRangeReader",(t,i)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(t.begin,t.end);if(!s){i.close();return}i.onPull=()=>{s.read().then(function({value:r,done:u}){if(u){i.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(r),"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{s.cancel(r),i.ready.catch(u=>{if(!this.destroyed)throw u})}}),e.on("GetDoc",({pdfInfo:t})=>{this._numPages=t.numPages,a._capability.resolve(new PDFDocumentProxy(t,this))}),e.on("DocException",function(t){let i;switch(t.name){case"PasswordException":i=new _util.PasswordException(t.message,t.code);break;case"InvalidPDFException":i=new _util.InvalidPDFException(t.message);break;case"MissingPDFException":i=new _util.MissingPDFException(t.message);break;case"UnexpectedResponseException":i=new _util.UnexpectedResponseException(t.message,t.status);break;case"UnknownErrorException":i=new _util.UnknownErrorException(t.message,t.details);break}if(!(i instanceof Error)){const s="DocException - expected a valid Error.";(0,_util.warn)(s)}a._capability.reject(i)}),e.on("PasswordRequest",t=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),a.onPassword){const i=s=>{this._passwordCapability.resolve({password:s})};try{a.onPassword(i,t.code)}catch(s){this._passwordCapability.reject(s)}}else this._passwordCapability.reject(new _util.PasswordException(t.message,t.code));return this._passwordCapability.promise}),e.on("DataLoaded",t=>{a.onProgress&&a.onProgress({loaded:t.length,total:t.length}),this.downloadInfoCapability.resolve(t)}),e.on("StartRenderPage",t=>{if(this.destroyed)return;this.pageCache[t.pageIndex]._startRenderPage(t.transparency,t.intent)}),e.on("commonobj",t=>{var u;if(this.destroyed)return;const[i,s,r]=t;if(!this.commonObjs.has(i))switch(s){case"Font":const h=this._params;if("error"in r){const _=r.error;(0,_util.warn)(`Error during font loading: ${_}`),this.commonObjs.resolve(i,_);break}let o=null;h.pdfBug&&((u=globalThis.FontInspector)!=null&&u.enabled)&&(o={registerFont(_,b){globalThis.FontInspector.fontAdded(_,b)}});const d=new _font_loader.FontFaceObject(r,{isEvalSupported:h.isEvalSupported,disableFontFace:h.disableFontFace,ignoreErrors:h.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:o});this.fontLoader.bind(d).catch(_=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!h.fontExtraProperties&&d.data&&(d.data=null),this.commonObjs.resolve(i,d)});break;case"FontPath":case"Image":this.commonObjs.resolve(i,r);break;default:throw new Error(`Got unknown common object type ${s}`)}}),e.on("obj",t=>{var o;if(this.destroyed)return;const[i,s,r,u]=t,h=this.pageCache[s];if(!h.objs.has(i))switch(r){case"Image":h.objs.resolve(i,u);const d=8e6;((o=u==null?void 0:u.data)==null?void 0:o.length)>d&&(h.cleanupAfterRender=!0);break;default:throw new Error(`Got unknown object type ${r}`)}}),e.on("DocProgress",t=>{this.destroyed||a.onProgress&&a.onProgress({loaded:t.loaded,total:t.total})}),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",(t,i)=>{if(this.destroyed){i.error(new Error("Worker was destroyed"));return}let s=!1;i.onPull=()=>{if(s){i.close();return}s=!0,this.CMapReaderFactory.fetch(t).then(function(r){i.enqueue(r,1,[r.cMapData.buffer])}).catch(function(r){i.error(r)})}})}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature&&this.loadingTask.onUnsupportedFeature(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request"));const a=e-1;if(a in this.pagePromises)return this.pagePromises[a];const t=this.messageHandler.sendWithPromise("GetPage",{pageIndex:a}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");const s=new PDFPageProxy(a,i,this,this._params.ownerDocument,this._params.pdfBug);return this.pageCache[a]=s,s});return this.pagePromises[a]=t,t}getPageIndex(e){return this.messageHandler.sendWithPromise("GetPageIndex",{ref:e}).catch(function(a){return Promise.reject(new Error(a))})}getAnnotations(e,a){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:a})}saveDocument(e){var a;return this.messageHandler.sendWithPromise("SaveDocument",{numPages:this._numPages,annotationStorage:(e==null?void 0:e.serializable)||null,filename:((a=this._fullReader)==null?void 0:a.filename)??null}).finally(()=>{e&&e.resetModified()})}getFieldObjects(){return this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||(this._hasJSActionsPromise=this.messageHandler.sendWithPromise("HasJSActions",null))}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getPageXfa(e){return this.messageHandler.sendWithPromise("GetPageXfa",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(e=>new _optional_content_config.OptionalContentConfig(e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.messageHandler.sendWithPromise("GetMetadata",null).then(e=>{var a,t;return{info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:((a=this._fullReader)==null?void 0:a.filename)??null,contentLength:((t=this._fullReader)==null?void 0:t.contentLength)??null}})}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}getStats(){return this.messageHandler.sendWithPromise("GetStats",null)}async startCleanup(e=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(let a=0,t=this.pageCache.length;a<t;a++){const i=this.pageCache[a];if(!i)continue;if(!i.cleanup())throw new Error(`startCleanup: Page ${a+1} is currently rendering.`)}this.commonObjs.clear(),e||this.fontLoader.clear(),this._hasJSActionsPromise=null}}get loadingParams(){const e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,disableFontFace:e.disableFontFace})}}class PDFObjects{constructor(){this._objs=Object.create(null)}_ensureObj(e){return this._objs[e]?this._objs[e]:this._objs[e]={capability:(0,_util.createPromiseCapability)(),data:null,resolved:!1}}get(e,a=null){if(a)return this._ensureObj(e).capability.promise.then(a),null;const t=this._objs[e];if(!t||!t.resolved)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return t.data}has(e){const a=this._objs[e];return(a==null?void 0:a.resolved)||!1}resolve(e,a){const t=this._ensureObj(e);t.resolved=!0,t.data=a,t.capability.resolve(a)}clear(){this._objs=Object.create(null)}}class RenderTask{constructor(e){this._internalRenderTask=e,this.onContinue=null}get promise(){return this._internalRenderTask.capability.promise}cancel(){this._internalRenderTask.cancel()}}const InternalRenderTask=function n(){const e=new WeakSet;class a{constructor({callback:i,params:s,objs:r,commonObjs:u,operatorList:h,pageIndex:o,canvasFactory:d,webGLContext:_,useRequestAnimationFrame:b=!1,pdfBug:f=!1}){this.callback=i,this.params=s,this.objs=r,this.commonObjs=u,this.operatorListIdx=null,this.operatorList=h,this._pageIndex=o,this.canvasFactory=d,this.webGLContext=_,this._pdfBug=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=b===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=s.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:i=!1,optionalContentConfig:s}){var _;if(this.cancelled)return;if(this._canvas){if(e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");e.add(this._canvas)}this._pdfBug&&((_=globalThis.StepperManager)!=null&&_.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:r,viewport:u,transform:h,imageLayer:o,background:d}=this.params;this.gfx=new _canvas.CanvasGraphics(r,this.commonObjs,this.objs,this.canvasFactory,this.webGLContext,o,s),this.gfx.beginDrawing({transform:h,viewport:u,transparency:i,background:d}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(i=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&e.delete(this._canvas),this.callback(i||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&e.delete(this._canvas),this.callback())))}}return a}(),version="2.8.335";exports.version=version;const build="228adbf67";exports.build=build},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var t=a(2);class i{constructor({docId:h,onUnsupportedFeature:o,ownerDocument:d=globalThis.document}){this.constructor===i&&(0,t.unreachable)("Cannot initialize BaseFontLoader."),this.docId=h,this._onUnsupportedFeature=o,this._document=d,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(h){this.nativeFontFaces.push(h),this._document.fonts.add(h)}insertRule(h){let o=this.styleElement;o||(o=this.styleElement=this._document.createElement("style"),o.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].appendChild(o));const d=o.sheet;d.insertRule(h,d.cssRules.length)}clear(){this.nativeFontFaces.forEach(h=>{this._document.fonts.delete(h)}),this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(h){if(h.attached||h.missingFile)return;if(h.attached=!0,this.isFontLoadingAPISupported){const d=h.createNativeFontFace();if(d){this.addNativeFontFace(d);try{await d.loaded}catch(_){throw this._onUnsupportedFeature({featureId:t.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,t.warn)(`Failed to load font '${d.family}': '${_}'.`),h.disableFontFace=!0,_}}return}const o=h.createFontFaceRule();if(o){if(this.insertRule(o),this.isSyncFontLoadingSupported)return;await new Promise(d=>{const _=this._queueLoadingCallback(d);this._prepareFontLoadEvent([o],[h],_)})}}_queueLoadingCallback(h){(0,t.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){var h;return(0,t.shadow)(this,"isFontLoadingAPISupported",!!((h=this._document)!=null&&h.fonts))}get isSyncFontLoadingSupported(){(0,t.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,t.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(h,o,d){(0,t.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let s;e.FontLoader=s,e.FontLoader=s=class extends i{constructor(h){super(h),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let h=!1;if(typeof navigator>"u")h=!0;else{const o=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);(o==null?void 0:o[1])>=14&&(h=!0)}return(0,t.shadow)(this,"isSyncFontLoadingSupported",h)}_queueLoadingCallback(h){function o(){for((0,t.assert)(!_.done,"completeRequest() cannot be called twice."),_.done=!0;d.requests.length>0&&d.requests[0].done;){const b=d.requests.shift();setTimeout(b.callback,0)}}const d=this.loadingContext,_={id:`pdfjs-font-loading-${d.nextRequestId++}`,done:!1,complete:o,callback:h};return d.requests.push(_),_}get _loadTestFont(){const h=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,t.shadow)(this,"_loadTestFont",h())}_prepareFontLoadEvent(h,o,d){function _(B,V){return B.charCodeAt(V)<<24|B.charCodeAt(V+1)<<16|B.charCodeAt(V+2)<<8|B.charCodeAt(V+3)&255}function b(B,V,Z,ne){const H=B.substring(0,V),N=B.substring(V+Z);return H+ne+N}let f,v;const A=this._document.createElement("canvas");A.width=1,A.height=1;const x=A.getContext("2d");let C=0;function M(B,V){if(C++,C>30){(0,t.warn)("Load test font never loaded."),V();return}if(x.font="30px "+B,x.fillText(".",0,20),x.getImageData(0,0,1,1).data[3]>0){V();return}setTimeout(M.bind(null,B,V))}const I=`lt${Date.now()}${this.loadTestFontId++}`;let w=this._loadTestFont;w=b(w,976,I.length,I);const c=16,p=1482184792;let m=_(w,c);for(f=0,v=I.length-3;f<v;f+=4)m=m-p+_(I,f)|0;f<I.length&&(m=m-p+_(I+"XXX",f)|0),w=b(w,c,4,(0,t.string32)(m));const y=`url(data:font/opentype;base64,${btoa(w)});`,P=`@font-face {font-family:"${I}";src:${y}}`;this.insertRule(P);const F=[];for(f=0,v=o.length;f<v;f++)F.push(o[f].loadedName);F.push(I);const R=this._document.createElement("div");for(R.style.visibility="hidden",R.style.width=R.style.height="10px",R.style.position="absolute",R.style.top=R.style.left="0px",f=0,v=F.length;f<v;++f){const B=this._document.createElement("span");B.textContent="Hi",B.style.fontFamily=F[f],R.appendChild(B)}this._document.body.appendChild(R),M(I,()=>{this._document.body.removeChild(R),d.complete()})}};class r{constructor(h,{isEvalSupported:o=!0,disableFontFace:d=!1,ignoreErrors:_=!1,onUnsupportedFeature:b,fontRegistry:f=null}){this.compiledGlyphs=Object.create(null);for(const v in h)this[v]=h[v];this.isEvalSupported=o!==!1,this.disableFontFace=d===!0,this.ignoreErrors=_===!0,this._onUnsupportedFeature=b,this.fontRegistry=f}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;const h=new FontFace(this.loadedName,this.data,{});return this.fontRegistry&&this.fontRegistry.registerFont(this),h}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const h=(0,t.bytesToString)(new Uint8Array(this.data)),o=`url(data:${this.mimetype};base64,${btoa(h)});`,d=`@font-face {font-family:"${this.loadedName}";src:${o}}`;return this.fontRegistry&&this.fontRegistry.registerFont(this,o),d}getPathGenerator(h,o){if(this.compiledGlyphs[o]!==void 0)return this.compiledGlyphs[o];let d,_;try{d=h.get(this.loadedName+"_path_"+o)}catch(b){if(!this.ignoreErrors)throw b;return this._onUnsupportedFeature({featureId:t.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,t.warn)(`getPathGenerator - ignoring character: "${b}".`),this.compiledGlyphs[o]=function(f,v){}}if(this.isEvalSupported&&t.IsEvalSupportedCached.value){let b,f="";for(let v=0,A=d.length;v<A;v++)_=d[v],_.args!==void 0?b=_.args.join(","):b="",f+="c."+_.cmd+"("+b+`);
`;return this.compiledGlyphs[o]=new Function("c","size",f)}return this.compiledGlyphs[o]=function(b,f){for(let v=0,A=d.length;v<A;v++)_=d[v],_.cmd==="scale"&&(_.args=[f,-f]),b[_.cmd].apply(b,_.args)}}}e.FontFaceObject=r},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeCMapReaderFactory=e.NodeCanvasFactory=void 0;var t=a(1),i=a(4),s=a(2);let r=class{constructor(){(0,s.unreachable)("Not implemented: NodeCanvasFactory")}};e.NodeCanvasFactory=r;let u=class{constructor(){(0,s.unreachable)("Not implemented: NodeCMapReaderFactory")}};e.NodeCMapReaderFactory=u,i.isNodeJS&&(e.NodeCanvasFactory=r=class extends t.BaseCanvasFactory{create(h,o){if(h<=0||o<=0)throw new Error("Invalid canvas size");const _=require("canvas").createCanvas(h,o);return{canvas:_,context:_.getContext("2d")}}},e.NodeCMapReaderFactory=u=class extends t.BaseCMapReaderFactory{_fetchData(h,o){return new Promise((d,_)=>{require("fs").readFile(h,(f,v)=>{if(f||!v){_(new Error(f));return}d({cMapData:new Uint8Array(v),compressionType:o})})})}})},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationStorage=void 0;var t=a(1),i=a(2);class s{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null}getValue(u,h){const o=this._storage.get(u);return o!==void 0?o:h}getOrCreateValue(u,h){return(0,t.deprecated)("Use getValue instead."),this._storage.has(u)?this._storage.get(u):(this._storage.set(u,h),h)}setValue(u,h){const o=this._storage.get(u);let d=!1;if(o!==void 0)for(const[_,b]of Object.entries(h))o[_]!==b&&(d=!0,o[_]=b);else this._storage.set(u,h),d=!0;d&&this._setModified()}getAll(){return this._storage.size>0?(0,i.objectFromMap)(this._storage):null}get size(){return this._storage.size}_setModified(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get serializable(){return this._storage.size>0?this._storage:null}}e.AnnotationStorage=s},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.apiCompatibilityParams=void 0;var t=a(4);const i=Object.create(null);(function(){t.isNodeJS&&(i.disableFontFace=!0)})();const s=Object.freeze(i);e.apiCompatibilityParams=s},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var t=a(2),i=a(11);const s=16,r=100,u=4096,h=1e3,o=16,d=1.000001;function _(x){if(!x.mozCurrentTransform){x._originalSave=x.save,x._originalRestore=x.restore,x._originalRotate=x.rotate,x._originalScale=x.scale,x._originalTranslate=x.translate,x._originalTransform=x.transform,x._originalSetTransform=x.setTransform,x._originalResetTransform=x.resetTransform,x._transformMatrix=x._transformMatrix||[1,0,0,1,0,0],x._transformStack=[];try{const C=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(x),"lineWidth");x._setLineWidth=C.set,x._getLineWidth=C.get,Object.defineProperty(x,"lineWidth",{set:function(I){this._setLineWidth(I*d)},get:function(){return this._getLineWidth()}})}catch{}Object.defineProperty(x,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(x,"mozCurrentTransformInverse",{get:function(){const M=this._transformMatrix,I=M[0],w=M[1],l=M[2],c=M[3],p=M[4],m=M[5],y=I*c-w*l,P=w*l-I*c;return[c/y,w/P,l/P,I/y,(c*p-l*m)/P,(w*p-I*m)/y]}}),x.save=function(){const M=this._transformMatrix;this._transformStack.push(M),this._transformMatrix=M.slice(0,6),this._originalSave()},x.restore=function(){const M=this._transformStack.pop();M&&(this._transformMatrix=M,this._originalRestore())},x.translate=function(M,I){const w=this._transformMatrix;w[4]=w[0]*M+w[2]*I+w[4],w[5]=w[1]*M+w[3]*I+w[5],this._originalTranslate(M,I)},x.scale=function(M,I){const w=this._transformMatrix;w[0]=w[0]*M,w[1]=w[1]*M,w[2]=w[2]*I,w[3]=w[3]*I,this._originalScale(M,I)},x.transform=function(M,I,w,l,c,p){const m=this._transformMatrix;this._transformMatrix=[m[0]*M+m[2]*I,m[1]*M+m[3]*I,m[0]*w+m[2]*l,m[1]*w+m[3]*l,m[0]*c+m[2]*p+m[4],m[1]*c+m[3]*p+m[5]],x._originalTransform(M,I,w,l,c,p)},x.setTransform=function(M,I,w,l,c,p){this._transformMatrix=[M,I,w,l,c,p],x._originalSetTransform(M,I,w,l,c,p)},x.resetTransform=function(){this._transformMatrix=[1,0,0,1,0,0],x._originalResetTransform()},x.rotate=function(M){const I=Math.cos(M),w=Math.sin(M),l=this._transformMatrix;this._transformMatrix=[l[0]*I+l[2]*w,l[1]*I+l[3]*w,l[0]*-w+l[2]*I,l[1]*-w+l[3]*I,l[4],l[5]],this._originalRotate(M)}}}const b=function(){function C(M){this.canvasFactory=M,this.cache=Object.create(null)}return C.prototype={getCanvas:function(I,w,l,c){let p;return this.cache[I]!==void 0?(p=this.cache[I],this.canvasFactory.reset(p,w,l),p.context.setTransform(1,0,0,1,0,0)):(p=this.canvasFactory.create(w,l),this.cache[I]=p),c&&_(p.context),p},clear(){for(const M in this.cache){const I=this.cache[M];this.canvasFactory.destroy(I),delete this.cache[M]}}},C}();function f(x){const M=x.width,I=x.height,w=M+1;let l,c,p,m;const y=new Uint8Array(w*(I+1)),P=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),F=M+7&-8,R=x.data,B=new Uint8Array(F*I);let V=0;for(l=0,c=R.length;l<c;l++){const g=R[l];let O=128;for(;O>0;)B[V++]=g&O?0:255,O>>=1}let Z=0;for(V=0,B[V]!==0&&(y[0]=1,++Z),p=1;p<M;p++)B[V]!==B[V+1]&&(y[p]=B[V]?2:1,++Z),V++;for(B[V]!==0&&(y[p]=2,++Z),l=1;l<I;l++){V=l*F,m=l*w,B[V-F]!==B[V]&&(y[m]=B[V]?1:8,++Z);let g=(B[V]?4:0)+(B[V-F]?8:0);for(p=1;p<M;p++)g=(g>>2)+(B[V+1]?4:0)+(B[V-F+1]?8:0),P[g]&&(y[m+p]=P[g],++Z),V++;if(B[V-F]!==B[V]&&(y[m+p]=B[V]?2:4,++Z),Z>1e3)return null}for(V=F*(I-1),m=l*w,B[V]!==0&&(y[m]=8,++Z),p=1;p<M;p++)B[V]!==B[V+1]&&(y[m+p]=B[V]?4:8,++Z),V++;if(B[V]!==0&&(y[m+p]=4,++Z),Z>1e3)return null;const ne=new Int32Array([0,w,-1,0,-w,0,0,0,1]),H=[];for(l=0;Z&&l<=I;l++){let g=l*w;const O=g+M;for(;g<O&&!y[g];)g++;if(g===O)continue;const D=[g%w,l],z=g;let W=y[g];do{const J=ne[W];do g+=J;while(!y[g]);const ie=y[g];ie!==5&&ie!==10?(W=ie,y[g]=0):(W=ie&51*W>>4,y[g]&=W>>2|W<<2),D.push(g%w),D.push(g/w|0),y[g]||--Z}while(z!==g);H.push(D),--l}return function(g){g.save(),g.scale(1/M,-1/I),g.translate(0,-I),g.beginPath();for(let O=0,D=H.length;O<D;O++){const z=H[O];g.moveTo(z[0],z[1]);for(let W=2,J=z.length;W<J;W+=2)g.lineTo(z[W],z[W+1])}g.fill(),g.beginPath(),g.restore()}}const v=function(){function C(){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=t.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=t.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=t.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.resumeSMaskCtx=null,this.transferMaps=null}return C.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(I,w){this.x=I,this.y=w}},C}(),A=function(){function I(H,N,g,O,D,z,W){this.ctx=H,this.current=new v,this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=N,this.objs=g,this.canvasFactory=O,this.webGLContext=D,this.imageLayer=z,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=W,this.cachedCanvases=new b(this.canvasFactory),H&&_(H),this._cachedGetSinglePixelWidth=null}function w(H,N,g=null){if(typeof ImageData<"u"&&N instanceof ImageData){H.putImageData(N,0,0);return}const O=N.height,D=N.width,z=O%o,W=(O-z)/o,J=z===0?W:W+1,ie=H.createImageData(D,o);let ue=0,he;const se=N.data,de=ie.data;let U,T,K,Y,fe,we,q,ee;if(g)switch(g.length){case 1:fe=g[0],we=g[0],q=g[0],ee=g[0];break;case 4:fe=g[0],we=g[1],q=g[2],ee=g[3];break}if(N.kind===t.ImageKind.GRAYSCALE_1BPP){const G=se.byteLength,S=new Uint32Array(de.buffer,0,de.byteLength>>2),k=S.length,Q=D+7>>3;let oe=4294967295,pe=t.IsLittleEndianCached.value?4278190080:255;for(ee&&ee[0]===255&&ee[255]===0&&([oe,pe]=[pe,oe]),U=0;U<J;U++){for(K=U<W?o:z,he=0,T=0;T<K;T++){const ge=G-ue;let Ae=0;const xe=ge>Q?D:ge*8-7,Se=xe&-8;let Ce=0,Ee=0;for(;Ae<Se;Ae+=8)Ee=se[ue++],S[he++]=Ee&128?oe:pe,S[he++]=Ee&64?oe:pe,S[he++]=Ee&32?oe:pe,S[he++]=Ee&16?oe:pe,S[he++]=Ee&8?oe:pe,S[he++]=Ee&4?oe:pe,S[he++]=Ee&2?oe:pe,S[he++]=Ee&1?oe:pe;for(;Ae<xe;Ae++)Ce===0&&(Ee=se[ue++],Ce=128),S[he++]=Ee&Ce?oe:pe,Ce>>=1}for(;he<k;)S[he++]=0;H.putImageData(ie,0,U*o)}}else if(N.kind===t.ImageKind.RGBA_32BPP){const G=!!(fe||we||q);for(T=0,Y=D*o*4,U=0;U<W;U++){if(de.set(se.subarray(ue,ue+Y)),ue+=Y,G)for(let S=0;S<Y;S+=4)fe&&(de[S+0]=fe[de[S+0]]),we&&(de[S+1]=we[de[S+1]]),q&&(de[S+2]=q[de[S+2]]);H.putImageData(ie,0,T),T+=o}if(U<J){if(Y=D*z*4,de.set(se.subarray(ue,ue+Y)),G)for(let S=0;S<Y;S+=4)fe&&(de[S+0]=fe[de[S+0]]),we&&(de[S+1]=we[de[S+1]]),q&&(de[S+2]=q[de[S+2]]);H.putImageData(ie,0,T)}}else if(N.kind===t.ImageKind.RGB_24BPP){const G=!!(fe||we||q);for(K=o,Y=D*K,U=0;U<J;U++){for(U>=W&&(K=z,Y=D*K),he=0,T=Y;T--;)de[he++]=se[ue++],de[he++]=se[ue++],de[he++]=se[ue++],de[he++]=255;if(G)for(let S=0;S<he;S+=4)fe&&(de[S+0]=fe[de[S+0]]),we&&(de[S+1]=we[de[S+1]]),q&&(de[S+2]=q[de[S+2]]);H.putImageData(ie,0,U*o)}}else throw new Error(`bad image kind: ${N.kind}`)}function l(H,N){const g=N.height,O=N.width,D=g%o,z=(g-D)/o,W=D===0?z:z+1,J=H.createImageData(O,o);let ie=0;const ue=N.data,he=J.data;for(let se=0;se<W;se++){const de=se<z?o:D;let U=3;for(let T=0;T<de;T++){let K,Y=0;for(let fe=0;fe<O;fe++)Y||(K=ue[ie++],Y=128),he[U]=K&Y?0:255,U+=4,Y>>=1}H.putImageData(J,0,se*o)}}function c(H,N){const g=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let O=0,D=g.length;O<D;O++){const z=g[O];H[z]!==void 0&&(N[z]=H[z])}H.setLineDash!==void 0&&(N.setLineDash(H.getLineDash()),N.lineDashOffset=H.lineDashOffset)}function p(H){H.strokeStyle="#000000",H.fillStyle="#000000",H.fillRule="nonzero",H.globalAlpha=1,H.lineWidth=1,H.lineCap="butt",H.lineJoin="miter",H.miterLimit=10,H.globalCompositeOperation="source-over",H.font="10px sans-serif",H.setLineDash!==void 0&&(H.setLineDash([]),H.lineDashOffset=0)}function m(H,N,g,O){const D=H.length;for(let z=3;z<D;z+=4){const W=H[z];if(W===0)H[z-3]=N,H[z-2]=g,H[z-1]=O;else if(W<255){const J=255-W;H[z-3]=H[z-3]*W+N*J>>8,H[z-2]=H[z-2]*W+g*J>>8,H[z-1]=H[z-1]*W+O*J>>8}}}function y(H,N,g){const O=H.length,D=1/255;for(let z=3;z<O;z+=4){const W=g?g[H[z]]:H[z];N[z]=N[z]*W*D|0}}function P(H,N,g){const O=H.length;for(let D=3;D<O;D+=4){const z=H[D-3]*77+H[D-2]*152+H[D-1]*28;N[D]=g?N[D]*g[z>>8]>>8:N[D]*z>>16}}function F(H,N,g,O,D,z,W){const J=!!z,ie=J?z[0]:0,ue=J?z[1]:0,he=J?z[2]:0;let se;D==="Luminosity"?se=P:se=y;const U=Math.min(O,Math.ceil(1048576/g));for(let T=0;T<O;T+=U){const K=Math.min(U,O-T),Y=H.getImageData(0,T,g,K),fe=N.getImageData(0,T,g,K);J&&m(Y.data,ie,ue,he),se(Y.data,fe.data,W),H.putImageData(fe,0,T)}}function R(H,N,g,O){const D=N.canvas,z=N.context;H.setTransform(N.scaleX,0,0,N.scaleY,N.offsetX,N.offsetY);const W=N.backdrop||null;if(!N.transferMap&&O.isEnabled){const J=O.composeSMask({layer:g.canvas,mask:D,properties:{subtype:N.subtype,backdrop:W}});H.setTransform(1,0,0,1,0,0),H.drawImage(J,N.offsetX,N.offsetY);return}F(z,g,D.width,D.height,N.subtype,W,N.transferMap),H.drawImage(D,0,0)}const B=["butt","round","square"],V=["miter","round","bevel"],Z={},ne={};I.prototype={beginDrawing({transform:H,viewport:N,transparency:g=!1,background:O=null}){const D=this.ctx.canvas.width,z=this.ctx.canvas.height;if(this.ctx.save(),this.ctx.fillStyle=O||"rgb(255, 255, 255)",this.ctx.fillRect(0,0,D,z),this.ctx.restore(),g){const W=this.cachedCanvases.getCanvas("transparent",D,z,!0);this.compositeCtx=this.ctx,this.transparentCanvas=W.canvas,this.ctx=W.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform)}this.ctx.save(),p(this.ctx),H&&this.ctx.transform.apply(this.ctx,H),this.ctx.transform.apply(this.ctx,N.transform),this.baseTransform=this.ctx.mozCurrentTransform.slice(),this._combinedScaleFactor=Math.hypot(this.baseTransform[0],this.baseTransform[2]),this.imageLayer&&this.imageLayer.beginLayout()},executeOperatorList:function(N,g,O,D){const z=N.argsArray,W=N.fnArray;let J=g||0;const ie=z.length;if(ie===J)return J;const ue=ie-J>10&&typeof O=="function",he=ue?Date.now()+15:0;let se=0;const de=this.commonObjs,U=this.objs;let T;for(;;){if(D!==void 0&&J===D.nextBreakPoint)return D.breakIt(J,O),J;if(T=W[J],T!==t.OPS.dependency)this[T].apply(this,z[J]);else for(const K of z[J]){const Y=K.startsWith("g_")?de:U;if(!Y.has(K))return Y.get(K,O),J}if(J++,J===ie)return J;if(ue&&++se>10){if(Date.now()>he)return O(),J;se=0}}},endDrawing:function(){for(;this.stateStack.length||this.current.activeSMask!==null;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null),this.cachedCanvases.clear(),this.webGLContext.clear(),this.imageLayer&&this.imageLayer.endLayout()},setLineWidth:function(N){this.current.lineWidth=N,this.ctx.lineWidth=N},setLineCap:function(N){this.ctx.lineCap=B[N]},setLineJoin:function(N){this.ctx.lineJoin=V[N]},setMiterLimit:function(N){this.ctx.miterLimit=N},setDash:function(N,g){const O=this.ctx;O.setLineDash!==void 0&&(O.setLineDash(N),O.lineDashOffset=g)},setRenderingIntent(H){},setFlatness(H){},setGState:function(N){for(let g=0,O=N.length;g<O;g++){const D=N[g],z=D[0],W=D[1];switch(z){case"LW":this.setLineWidth(W);break;case"LC":this.setLineCap(W);break;case"LJ":this.setLineJoin(W);break;case"ML":this.setMiterLimit(W);break;case"D":this.setDash(W[0],W[1]);break;case"RI":this.setRenderingIntent(W);break;case"FL":this.setFlatness(W);break;case"Font":this.setFont(W[0],W[1]);break;case"CA":this.current.strokeAlpha=D[1];break;case"ca":this.current.fillAlpha=D[1],this.ctx.globalAlpha=D[1];break;case"BM":this.ctx.globalCompositeOperation=W;break;case"SMask":this.current.activeSMask&&(this.stateStack.length>0&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask?this.suspendSMaskGroup():this.endSMaskGroup()),this.current.activeSMask=W?this.tempSMask:null,this.current.activeSMask&&this.beginSMaskGroup(),this.tempSMask=null;break;case"TR":this.current.transferMaps=W}}},beginSMaskGroup:function(){const N=this.current.activeSMask,g=N.canvas.width,O=N.canvas.height,D="smaskGroupAt"+this.groupLevel,z=this.cachedCanvases.getCanvas(D,g,O,!0),W=this.ctx,J=W.mozCurrentTransform;this.ctx.save();const ie=z.context;ie.scale(1/N.scaleX,1/N.scaleY),ie.translate(-N.offsetX,-N.offsetY),ie.transform.apply(ie,J),N.startTransformInverse=ie.mozCurrentTransformInverse,c(W,ie),this.ctx=ie,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(W),this.groupLevel++},suspendSMaskGroup:function(){const N=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),R(this.ctx,this.current.activeSMask,N,this.webGLContext),this.ctx.restore(),this.ctx.save(),c(N,this.ctx),this.current.resumeSMaskCtx=N;const g=t.Util.transform(this.current.activeSMask.startTransformInverse,N.mozCurrentTransform);this.ctx.transform.apply(this.ctx,g),N.save(),N.setTransform(1,0,0,1,0,0),N.clearRect(0,0,N.canvas.width,N.canvas.height),N.restore()},resumeSMaskGroup:function(){const N=this.current.resumeSMaskCtx,g=this.ctx;this.ctx=N,this.groupStack.push(g),this.groupLevel++},endSMaskGroup:function(){const N=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),R(this.ctx,this.current.activeSMask,N,this.webGLContext),this.ctx.restore(),c(N,this.ctx);const g=t.Util.transform(this.current.activeSMask.startTransformInverse,N.mozCurrentTransform);this.ctx.transform.apply(this.ctx,g)},save:function(){this.ctx.save();const N=this.current;this.stateStack.push(N),this.current=N.clone(),this.current.resumeSMaskCtx=null},restore:function(){this.current.resumeSMaskCtx&&this.resumeSMaskGroup(),this.current.activeSMask!==null&&(this.stateStack.length===0||this.stateStack[this.stateStack.length-1].activeSMask!==this.current.activeSMask)&&this.endSMaskGroup(),this.stateStack.length!==0?(this.current=this.stateStack.pop(),this.ctx.restore(),this.pendingClip=null,this._cachedGetSinglePixelWidth=null):this.current.activeSMask=null},transform:function(N,g,O,D,z,W){this.ctx.transform(N,g,O,D,z,W),this._cachedGetSinglePixelWidth=null},constructPath:function(N,g){const O=this.ctx,D=this.current;let z=D.x,W=D.y;for(let J=0,ie=0,ue=N.length;J<ue;J++)switch(N[J]|0){case t.OPS.rectangle:z=g[ie++],W=g[ie++];const he=g[ie++],se=g[ie++],de=z+he,U=W+se;O.moveTo(z,W),he===0||se===0?O.lineTo(de,U):(O.lineTo(de,W),O.lineTo(de,U),O.lineTo(z,U)),O.closePath();break;case t.OPS.moveTo:z=g[ie++],W=g[ie++],O.moveTo(z,W);break;case t.OPS.lineTo:z=g[ie++],W=g[ie++],O.lineTo(z,W);break;case t.OPS.curveTo:z=g[ie+4],W=g[ie+5],O.bezierCurveTo(g[ie],g[ie+1],g[ie+2],g[ie+3],z,W),ie+=6;break;case t.OPS.curveTo2:O.bezierCurveTo(z,W,g[ie],g[ie+1],g[ie+2],g[ie+3]),z=g[ie+2],W=g[ie+3],ie+=4;break;case t.OPS.curveTo3:z=g[ie+2],W=g[ie+3],O.bezierCurveTo(g[ie],g[ie+1],z,W,z,W),ie+=4;break;case t.OPS.closePath:O.closePath();break}D.setCurrentPoint(z,W)},closePath:function(){this.ctx.closePath()},stroke:function(N){N=typeof N<"u"?N:!0;const g=this.ctx,O=this.current.strokeColor;if(g.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof O=="object"&&(O!=null&&O.getPattern)){g.save();const D=g.mozCurrentTransform,z=t.Util.singularValueDecompose2dScale(D)[0];g.strokeStyle=O.getPattern(g,this);const W=this.getSinglePixelWidth(),J=this.current.lineWidth*z;W<0&&-W>=J?(g.resetTransform(),g.lineWidth=Math.round(this._combinedScaleFactor)):g.lineWidth=Math.max(W,J),g.stroke(),g.restore()}else{const D=this.getSinglePixelWidth();D<0&&-D>=this.current.lineWidth?(g.save(),g.resetTransform(),g.lineWidth=Math.round(this._combinedScaleFactor),g.stroke(),g.restore()):(g.lineWidth=Math.max(D,this.current.lineWidth),g.stroke())}N&&this.consumePath(),g.globalAlpha=this.current.fillAlpha},closeStroke:function(){this.closePath(),this.stroke()},fill:function(N){N=typeof N<"u"?N:!0;const g=this.ctx,O=this.current.fillColor,D=this.current.patternFill;let z=!1;D&&(g.save(),this.baseTransform&&g.setTransform.apply(g,this.baseTransform),g.fillStyle=O.getPattern(g,this),z=!0),this.contentVisible&&(this.pendingEOFill?(g.fill("evenodd"),this.pendingEOFill=!1):g.fill()),z&&g.restore(),N&&this.consumePath()},eoFill:function(){this.pendingEOFill=!0,this.fill()},fillStroke:function(){this.fill(!1),this.stroke(!1),this.consumePath()},eoFillStroke:function(){this.pendingEOFill=!0,this.fillStroke()},closeFillStroke:function(){this.closePath(),this.fillStroke()},closeEOFillStroke:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()},endPath:function(){this.consumePath()},clip:function(){this.pendingClip=Z},eoClip:function(){this.pendingClip=ne},beginText:function(){this.current.textMatrix=t.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},endText:function(){const N=this.pendingTextPaths,g=this.ctx;if(N===void 0){g.beginPath();return}g.save(),g.beginPath();for(let O=0;O<N.length;O++){const D=N[O];g.setTransform.apply(g,D.transform),g.translate(D.x,D.y),D.addToPath(g,D.fontSize)}g.restore(),g.clip(),g.beginPath(),delete this.pendingTextPaths},setCharSpacing:function(N){this.current.charSpacing=N},setWordSpacing:function(N){this.current.wordSpacing=N},setHScale:function(N){this.current.textHScale=N/100},setLeading:function(N){this.current.leading=-N},setFont:function(N,g){const O=this.commonObjs.get(N),D=this.current;if(!O)throw new Error(`Can't find font for ${N}`);if(D.fontMatrix=O.fontMatrix||t.FONT_IDENTITY_MATRIX,(D.fontMatrix[0]===0||D.fontMatrix[3]===0)&&(0,t.warn)("Invalid font matrix for font "+N),g<0?(g=-g,D.fontDirection=-1):D.fontDirection=1,this.current.font=O,this.current.fontSize=g,O.isType3Font)return;const z=O.loadedName||"sans-serif";let W="normal";O.black?W="900":O.bold&&(W="bold");const J=O.italic?"italic":"normal",ie=`"${z}", ${O.fallbackName}`;let ue=g;g<s?ue=s:g>r&&(ue=r),this.current.fontSizeScale=g/ue,this.ctx.font=`${J} ${W} ${ue}px ${ie}`},setTextRenderingMode:function(N){this.current.textRenderingMode=N},setTextRise:function(N){this.current.textRise=N},moveText:function(N,g){this.current.x=this.current.lineX+=N,this.current.y=this.current.lineY+=g},setLeadingMoveText:function(N,g){this.setLeading(-g),this.moveText(N,g)},setTextMatrix:function(N,g,O,D,z,W){this.current.textMatrix=[N,g,O,D,z,W],this.current.textMatrixScale=Math.hypot(N,g),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},nextLine:function(){this.moveText(0,this.current.leading)},paintChar(H,N,g,O,D){const z=this.ctx,W=this.current,J=W.font,ie=W.textRenderingMode,ue=W.fontSize/W.fontSizeScale,he=ie&t.TextRenderingMode.FILL_STROKE_MASK,se=!!(ie&t.TextRenderingMode.ADD_TO_PATH_FLAG),de=W.patternFill&&!J.missingFile;let U;(J.disableFontFace||se||de)&&(U=J.getPathGenerator(this.commonObjs,H)),J.disableFontFace||de?(z.save(),z.translate(N,g),z.beginPath(),U(z,ue),O&&z.setTransform.apply(z,O),(he===t.TextRenderingMode.FILL||he===t.TextRenderingMode.FILL_STROKE)&&z.fill(),(he===t.TextRenderingMode.STROKE||he===t.TextRenderingMode.FILL_STROKE)&&(D&&(z.resetTransform(),z.lineWidth=Math.round(this._combinedScaleFactor)),z.stroke()),z.restore()):((he===t.TextRenderingMode.FILL||he===t.TextRenderingMode.FILL_STROKE)&&z.fillText(H,N,g),(he===t.TextRenderingMode.STROKE||he===t.TextRenderingMode.FILL_STROKE)&&(D?(z.save(),z.moveTo(N,g),z.resetTransform(),z.lineWidth=Math.round(this._combinedScaleFactor),z.strokeText(H,0,0),z.restore()):z.strokeText(H,N,g))),se&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:z.mozCurrentTransform,x:N,y:g,fontSize:ue,addToPath:U})},get isFontSubpixelAAEnabled(){const{context:H}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);H.scale(1.5,1),H.fillText("I",0,10);const N=H.getImageData(0,0,10,10).data;let g=!1;for(let O=3;O<N.length;O+=4)if(N[O]>0&&N[O]<255){g=!0;break}return(0,t.shadow)(this,"isFontSubpixelAAEnabled",g)},showText:function(N){const g=this.current,O=g.font;if(O.isType3Font)return this.showType3Text(N);const D=g.fontSize;if(D===0)return;const z=this.ctx,W=g.fontSizeScale,J=g.charSpacing,ie=g.wordSpacing,ue=g.fontDirection,he=g.textHScale*ue,se=N.length,de=O.vertical,U=de?1:-1,T=O.defaultVMetrics,K=D*g.fontMatrix[0],Y=g.textRenderingMode===t.TextRenderingMode.FILL&&!O.disableFontFace&&!g.patternFill;z.save();let fe;if(g.patternFill){z.save();const k=g.fillColor.getPattern(z,this);fe=z.mozCurrentTransform,z.restore(),z.fillStyle=k}z.transform.apply(z,g.textMatrix),z.translate(g.x,g.y+g.textRise),ue>0?z.scale(he,-1):z.scale(he,1);let we=g.lineWidth,q=!1;const ee=g.textMatrixScale;if(ee===0||we===0){const k=g.textRenderingMode&t.TextRenderingMode.FILL_STROKE_MASK;(k===t.TextRenderingMode.STROKE||k===t.TextRenderingMode.FILL_STROKE)&&(this._cachedGetSinglePixelWidth=null,we=this.getSinglePixelWidth(),q=we<0)}else we/=ee;W!==1&&(z.scale(W,W),we/=W),z.lineWidth=we;let G=0,S;for(S=0;S<se;++S){const k=N[S];if((0,t.isNum)(k)){G+=U*k*D/1e3;continue}let Q=!1;const oe=(k.isSpace?ie:0)+J,pe=k.fontChar,ge=k.accent;let Ae,xe,Se=k.width;if(de){const Ee=k.vmetric||T,Le=-(k.vmetric?Ee[1]:Se*.5)*K,Re=Ee[2]*K;Se=Ee?-Ee[0]:Se,Ae=Le/W,xe=(G+Re)/W}else Ae=G/W,xe=0;if(O.remeasure&&Se>0){const Ee=z.measureText(pe).width*1e3/D*W;if(Se<Ee&&this.isFontSubpixelAAEnabled){const Le=Se/Ee;Q=!0,z.save(),z.scale(Le,1),Ae/=Le}else Se!==Ee&&(Ae+=(Se-Ee)/2e3*D/W)}if(this.contentVisible&&(k.isInFont||O.missingFile)){if(Y&&!ge)z.fillText(pe,Ae,xe);else if(this.paintChar(pe,Ae,xe,fe,q),ge){const Ee=Ae+D*ge.offset.x/W,Le=xe-D*ge.offset.y/W;this.paintChar(ge.fontChar,Ee,Le,fe,q)}}let Ce;de?Ce=Se*K-oe*ue:Ce=Se*K+oe*ue,G+=Ce,Q&&z.restore()}de?g.y-=G:g.x+=G*he,z.restore()},showType3Text:function(N){const g=this.ctx,O=this.current,D=O.font,z=O.fontSize,W=O.fontDirection,J=D.vertical?1:-1,ie=O.charSpacing,ue=O.wordSpacing,he=O.textHScale*W,se=O.fontMatrix||t.FONT_IDENTITY_MATRIX,de=N.length,U=O.textRenderingMode===t.TextRenderingMode.INVISIBLE;let T,K,Y,fe;if(!(U||z===0)){for(this._cachedGetSinglePixelWidth=null,g.save(),g.transform.apply(g,O.textMatrix),g.translate(O.x,O.y),g.scale(he,W),T=0;T<de;++T){if(K=N[T],(0,t.isNum)(K)){fe=J*K*z/1e3,this.ctx.translate(fe,0),O.x+=fe*he;continue}const we=(K.isSpace?ue:0)+ie,q=D.charProcOperatorList[K.operatorListId];if(!q){(0,t.warn)(`Type3 character "${K.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=K,this.save(),g.scale(z,z),g.transform.apply(g,se),this.executeOperatorList(q),this.restore()),Y=t.Util.applyTransform([K.width,0],se)[0]*z+we,g.translate(Y,0),O.x+=Y*he}g.restore(),this.processingType3=null}},setCharWidth:function(N,g){},setCharWidthAndBounds:function(N,g,O,D,z,W){this.ctx.rect(O,D,z-O,W-D),this.clip(),this.endPath()},getColorN_Pattern:function(N){let g;if(N[0]==="TilingPattern"){const O=N[1],D=this.baseTransform||this.ctx.mozCurrentTransform.slice(),z={createCanvasGraphics:W=>new I(W,this.commonObjs,this.objs,this.canvasFactory,this.webGLContext)};g=new i.TilingPattern(N,O,this.ctx,z,D)}else g=(0,i.getShadingPatternFromIR)(N);return g},setStrokeColorN:function(){this.current.strokeColor=this.getColorN_Pattern(arguments)},setFillColorN:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0},setStrokeRGBColor:function(N,g,O){const D=t.Util.makeHexColor(N,g,O);this.ctx.strokeStyle=D,this.current.strokeColor=D},setFillRGBColor:function(N,g,O){const D=t.Util.makeHexColor(N,g,O);this.ctx.fillStyle=D,this.current.fillColor=D,this.current.patternFill=!1},shadingFill:function(N){if(!this.contentVisible)return;const g=this.ctx;this.save();const O=(0,i.getShadingPatternFromIR)(N);g.fillStyle=O.getPattern(g,this,!0);const D=g.mozCurrentTransformInverse;if(D){const z=g.canvas,W=z.width,J=z.height,ie=t.Util.applyTransform([0,0],D),ue=t.Util.applyTransform([0,J],D),he=t.Util.applyTransform([W,0],D),se=t.Util.applyTransform([W,J],D),de=Math.min(ie[0],ue[0],he[0],se[0]),U=Math.min(ie[1],ue[1],he[1],se[1]),T=Math.max(ie[0],ue[0],he[0],se[0]),K=Math.max(ie[1],ue[1],he[1],se[1]);this.ctx.fillRect(de,U,T-de,K-U)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.restore()},beginInlineImage:function(){(0,t.unreachable)("Should not call beginInlineImage")},beginImageData:function(){(0,t.unreachable)("Should not call beginImageData")},paintFormXObjectBegin:function(N,g){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(N)&&N.length===6&&this.transform.apply(this,N),this.baseTransform=this.ctx.mozCurrentTransform,g)){const O=g[2]-g[0],D=g[3]-g[1];this.ctx.rect(g[0],g[1],O,D),this.clip(),this.endPath()}},paintFormXObjectEnd:function(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())},beginGroup:function(N){if(!this.contentVisible)return;this.save();const g=this.ctx;N.isolated||(0,t.info)("TODO: Support non-isolated groups."),N.knockout&&(0,t.warn)("Knockout groups not supported.");const O=g.mozCurrentTransform;if(N.matrix&&g.transform.apply(g,N.matrix),!N.bbox)throw new Error("Bounding box is required.");let D=t.Util.getAxialAlignedBoundingBox(N.bbox,g.mozCurrentTransform);const z=[0,0,g.canvas.width,g.canvas.height];D=t.Util.intersect(D,z)||[0,0,0,0];const W=Math.floor(D[0]),J=Math.floor(D[1]);let ie=Math.max(Math.ceil(D[2])-W,1),ue=Math.max(Math.ceil(D[3])-J,1),he=1,se=1;ie>u&&(he=ie/u,ie=u),ue>u&&(se=ue/u,ue=u);let de="groupAt"+this.groupLevel;N.smask&&(de+="_smask_"+this.smaskCounter++%2);const U=this.cachedCanvases.getCanvas(de,ie,ue,!0),T=U.context;T.scale(1/he,1/se),T.translate(-W,-J),T.transform.apply(T,O),N.smask?this.smaskStack.push({canvas:U.canvas,context:T,offsetX:W,offsetY:J,scaleX:he,scaleY:se,subtype:N.smask.subtype,backdrop:N.smask.backdrop,transferMap:N.smask.transferMap||null,startTransformInverse:null}):(g.setTransform(1,0,0,1,0,0),g.translate(W,J),g.scale(he,se)),c(g,T),this.ctx=T,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(g),this.groupLevel++,this.current.activeSMask=null},endGroup:function(N){if(!this.contentVisible)return;this.groupLevel--;const g=this.ctx;this.ctx=this.groupStack.pop(),this.ctx.imageSmoothingEnabled!==void 0?this.ctx.imageSmoothingEnabled=!1:this.ctx.mozImageSmoothingEnabled=!1,N.smask?this.tempSMask=this.smaskStack.pop():this.ctx.drawImage(g.canvas,0,0),this.restore()},beginAnnotations:function(){this.save(),this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform)},endAnnotations:function(){this.restore()},beginAnnotation:function(N,g,O){if(this.save(),p(this.ctx),this.current=new v,Array.isArray(N)&&N.length===4){const D=N[2]-N[0],z=N[3]-N[1];this.ctx.rect(N[0],N[1],D,z),this.clip(),this.endPath()}this.transform.apply(this,g),this.transform.apply(this,O)},endAnnotation:function(){this.restore()},paintImageMaskXObject:function(N){if(!this.contentVisible)return;const g=this.ctx,O=N.width,D=N.height,z=this.current.fillColor,W=this.current.patternFill,J=this.processingType3;if(J&&J.compiled===void 0&&(O<=h&&D<=h?J.compiled=f({data:N.data,width:O,height:D}):J.compiled=null),J!=null&&J.compiled){J.compiled(g);return}const ie=this.cachedCanvases.getCanvas("maskCanvas",O,D),ue=ie.context;ue.save(),l(ue,N),ue.globalCompositeOperation="source-in",ue.fillStyle=W?z.getPattern(ue,this):z,ue.fillRect(0,0,O,D),ue.restore(),this.paintInlineImageXObject(ie.canvas)},paintImageMaskXObjectRepeat(H,N,g=0,O=0,D,z){if(!this.contentVisible)return;const W=H.width,J=H.height,ie=this.current.fillColor,ue=this.current.patternFill,he=this.cachedCanvases.getCanvas("maskCanvas",W,J),se=he.context;se.save(),l(se,H),se.globalCompositeOperation="source-in",se.fillStyle=ue?ie.getPattern(se,this):ie,se.fillRect(0,0,W,J),se.restore();const de=this.ctx;for(let U=0,T=z.length;U<T;U+=2)de.save(),de.transform(N,g,O,D,z[U],z[U+1]),de.scale(1,-1),de.drawImage(he.canvas,0,0,W,J,0,-1,1,1),de.restore()},paintImageMaskXObjectGroup:function(N){if(!this.contentVisible)return;const g=this.ctx,O=this.current.fillColor,D=this.current.patternFill;for(let z=0,W=N.length;z<W;z++){const J=N[z],ie=J.width,ue=J.height,he=this.cachedCanvases.getCanvas("maskCanvas",ie,ue),se=he.context;se.save(),l(se,J),se.globalCompositeOperation="source-in",se.fillStyle=D?O.getPattern(se,this):O,se.fillRect(0,0,ie,ue),se.restore(),g.save(),g.transform.apply(g,J.transform),g.scale(1,-1),g.drawImage(he.canvas,0,0,ie,ue,0,-1,1,1),g.restore()}},paintImageXObject:function(N){if(!this.contentVisible)return;const g=N.startsWith("g_")?this.commonObjs.get(N):this.objs.get(N);if(!g){(0,t.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(g)},paintImageXObjectRepeat:function(N,g,O,D){if(!this.contentVisible)return;const z=N.startsWith("g_")?this.commonObjs.get(N):this.objs.get(N);if(!z){(0,t.warn)("Dependent image isn't ready yet");return}const W=z.width,J=z.height,ie=[];for(let ue=0,he=D.length;ue<he;ue+=2)ie.push({transform:[g,0,0,O,D[ue],D[ue+1]],x:0,y:0,w:W,h:J});this.paintInlineImageXObjectGroup(z,ie)},paintInlineImageXObject:function(N){if(!this.contentVisible)return;const g=N.width,O=N.height,D=this.ctx;this.save(),D.scale(1/g,-1/O);const z=D.mozCurrentTransformInverse;let W=Math.max(Math.hypot(z[0],z[1]),1),J=Math.max(Math.hypot(z[2],z[3]),1),ie,ue,he;typeof HTMLElement=="function"&&N instanceof HTMLElement||!N.data?ie=N:(ue=this.cachedCanvases.getCanvas("inlineImage",g,O),he=ue.context,w(he,N,this.current.transferMaps),ie=ue.canvas);let se=g,de=O,U="prescale1";for(;W>2&&se>1||J>2&&de>1;){let T=se,K=de;W>2&&se>1&&(T=Math.ceil(se/2),W/=se/T),J>2&&de>1&&(K=Math.ceil(de/2),J/=de/K),ue=this.cachedCanvases.getCanvas(U,T,K),he=ue.context,he.clearRect(0,0,T,K),he.drawImage(ie,0,0,se,de,0,0,T,K),ie=ue.canvas,se=T,de=K,U=U==="prescale1"?"prescale2":"prescale1"}if(D.drawImage(ie,0,0,se,de,0,-O,g,O),this.imageLayer){const T=this.getCanvasPosition(0,-O);this.imageLayer.appendImage({imgData:N,left:T[0],top:T[1],width:g/z[0],height:O/z[3]})}this.restore()},paintInlineImageXObjectGroup:function(N,g){if(!this.contentVisible)return;const O=this.ctx,D=N.width,z=N.height,W=this.cachedCanvases.getCanvas("inlineImage",D,z),J=W.context;w(J,N,this.current.transferMaps);for(let ie=0,ue=g.length;ie<ue;ie++){const he=g[ie];if(O.save(),O.transform.apply(O,he.transform),O.scale(1,-1),O.drawImage(W.canvas,he.x,he.y,he.w,he.h,0,-1,1,1),this.imageLayer){const se=this.getCanvasPosition(he.x,he.y);this.imageLayer.appendImage({imgData:N,left:se[0],top:se[1],width:D,height:z})}O.restore()}},paintSolidColorImageMask:function(){this.contentVisible&&this.ctx.fillRect(0,0,1,1)},markPoint:function(N){},markPointProps:function(N,g){},beginMarkedContent:function(N){this.markedContentStack.push({visible:!0})},beginMarkedContentProps:function(N,g){N==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(g)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()},endMarkedContent:function(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()},beginCompat:function(){},endCompat:function(){},consumePath:function(){const N=this.ctx;this.pendingClip&&(this.pendingClip===ne?N.clip("evenodd"):N.clip(),this.pendingClip=null),N.beginPath()},getSinglePixelWidth(){if(this._cachedGetSinglePixelWidth===null){const H=this.ctx.mozCurrentTransform,N=Math.abs(H[0]*H[3]-H[2]*H[1]),g=H[0]**2+H[2]**2,O=H[1]**2+H[3]**2,D=Math.sqrt(Math.max(g,O))/N;g!==O&&this._combinedScaleFactor*D>1?this._cachedGetSinglePixelWidth=-(this._combinedScaleFactor*D):N>Number.EPSILON?this._cachedGetSinglePixelWidth=D:this._cachedGetSinglePixelWidth=1}return this._cachedGetSinglePixelWidth},getCanvasPosition:function(N,g){const O=this.ctx.mozCurrentTransform;return[O[0]*N+O[2]*g+O[4],O[1]*N+O[3]*g+O[5]]},isContentVisible:function(){for(let N=this.markedContentStack.length-1;N>=0;N--)if(!this.markedContentStack[N].visible)return!1;return!0}};for(const H in t.OPS)I.prototype[t.OPS[H]]=I.prototype[H];return I}();e.CanvasGraphics=A},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getShadingPatternFromIR=u,e.TilingPattern=void 0;var t=a(2);const i={};function s(o,d){if(!d||typeof Path2D>"u")return;const _=d[2]-d[0],b=d[3]-d[1],f=new Path2D;f.rect(d[0],d[1],_,b),o.clip(f)}i.RadialAxial={fromIR:function(d){const _=d[1],b=d[2],f=d[3],v=d[4],A=d[5],x=d[6],C=d[7];return{getPattern:function(I){s(I,b);let w;_==="axial"?w=I.createLinearGradient(v[0],v[1],A[0],A[1]):_==="radial"&&(w=I.createRadialGradient(v[0],v[1],x,A[0],A[1],C));for(let l=0,c=f.length;l<c;++l){const p=f[l];w.addColorStop(p[0],p[1])}return w}}}};const r=function(){function d(f,v,A,x,C,M,I,w){const l=v.coords,c=v.colors,p=f.data,m=f.width*4;let y;l[A+1]>l[x+1]&&(y=A,A=x,x=y,y=M,M=I,I=y),l[x+1]>l[C+1]&&(y=x,x=C,C=y,y=I,I=w,w=y),l[A+1]>l[x+1]&&(y=A,A=x,x=y,y=M,M=I,I=y);const P=(l[A]+v.offsetX)*v.scaleX,F=(l[A+1]+v.offsetY)*v.scaleY,R=(l[x]+v.offsetX)*v.scaleX,B=(l[x+1]+v.offsetY)*v.scaleY,V=(l[C]+v.offsetX)*v.scaleX,Z=(l[C+1]+v.offsetY)*v.scaleY;if(F>=Z)return;const ne=c[M],H=c[M+1],N=c[M+2],g=c[I],O=c[I+1],D=c[I+2],z=c[w],W=c[w+1],J=c[w+2],ie=Math.round(F),ue=Math.round(Z);let he,se,de,U,T,K,Y,fe;for(let we=ie;we<=ue;we++){if(we<B){let k;we<F?k=0:F===B?k=1:k=(F-we)/(F-B),he=P-(P-R)*k,se=ne-(ne-g)*k,de=H-(H-O)*k,U=N-(N-D)*k}else{let k;we>Z?k=1:B===Z?k=0:k=(B-we)/(B-Z),he=R-(R-V)*k,se=g-(g-z)*k,de=O-(O-W)*k,U=D-(D-J)*k}let q;we<F?q=0:we>Z?q=1:q=(F-we)/(F-Z),T=P-(P-V)*q,K=ne-(ne-z)*q,Y=H-(H-W)*q,fe=N-(N-J)*q;const ee=Math.round(Math.min(he,T)),G=Math.round(Math.max(he,T));let S=m*we+ee*4;for(let k=ee;k<=G;k++)q=(he-k)/(he-T),q<0?q=0:q>1&&(q=1),p[S++]=se-(se-K)*q|0,p[S++]=de-(de-Y)*q|0,p[S++]=U-(U-fe)*q|0,p[S++]=255}}function _(f,v,A){const x=v.coords,C=v.colors;let M,I;switch(v.type){case"lattice":const w=v.verticesPerRow,l=Math.floor(x.length/w)-1,c=w-1;for(M=0;M<l;M++){let p=M*w;for(let m=0;m<c;m++,p++)d(f,A,x[p],x[p+1],x[p+w],C[p],C[p+1],C[p+w]),d(f,A,x[p+w+1],x[p+1],x[p+w],C[p+w+1],C[p+1],C[p+w])}break;case"triangles":for(M=0,I=x.length;M<I;M+=3)d(f,A,x[M],x[M+1],x[M+2],C[M],C[M+1],C[M+2]);break;default:throw new Error("illegal figure")}}function b(f,v,A,x,C,M,I,w){const m=Math.floor(f[0]),y=Math.floor(f[1]),P=Math.ceil(f[2])-m,F=Math.ceil(f[3])-y,R=Math.min(Math.ceil(Math.abs(P*v[0]*1.1)),3e3),B=Math.min(Math.ceil(Math.abs(F*v[1]*1.1)),3e3),V=P/R,Z=F/B,ne={coords:A,colors:x,offsetX:-m,offsetY:-y,scaleX:1/V,scaleY:1/Z},H=R+2*2,N=B+2*2;let g,O,D,z;if(w.isEnabled)g=w.drawFigures({width:R,height:B,backgroundColor:M,figures:C,context:ne}),O=I.getCanvas("mesh",H,N,!1),O.context.drawImage(g,2,2),g=O.canvas;else{O=I.getCanvas("mesh",H,N,!1);const W=O.context,J=W.createImageData(R,B);if(M){const ie=J.data;for(D=0,z=ie.length;D<z;D+=4)ie[D]=M[0],ie[D+1]=M[1],ie[D+2]=M[2],ie[D+3]=255}for(D=0;D<C.length;D++)_(J,C[D],ne);W.putImageData(J,2,2),g=O.canvas}return{canvas:g,offsetX:m-2*V,offsetY:y-2*Z,scaleX:V,scaleY:Z}}return b}();i.Mesh={fromIR:function(d){const _=d[2],b=d[3],f=d[4],v=d[5],A=d[6],x=d[7],C=d[8];return{getPattern:function(I,w,l){s(I,x);let c;if(l)c=t.Util.singularValueDecompose2dScale(I.mozCurrentTransform);else if(c=t.Util.singularValueDecompose2dScale(w.baseTransform),A){const m=t.Util.singularValueDecompose2dScale(A);c=[c[0]*m[0],c[1]*m[1]]}const p=r(v,c,_,b,f,l?null:C,w.cachedCanvases,w.webGLContext);return l||(I.setTransform.apply(I,w.baseTransform),A&&I.transform.apply(I,A)),I.translate(p.offsetX,p.offsetY),I.scale(p.scaleX,p.scaleY),I.createPattern(p.canvas,"no-repeat")}}}},i.Dummy={fromIR:function(){return{getPattern:function(){return"hotpink"}}}};function u(o){const d=i[o[0]];if(!d)throw new Error(`Unknown IR type: ${o[0]}`);return d.fromIR(o)}const h=function(){const d={COLORED:1,UNCOLORED:2},_=3e3;function b(f,v,A,x,C){this.operatorList=f[2],this.matrix=f[3]||[1,0,0,1,0,0],this.bbox=f[4],this.xstep=f[5],this.ystep=f[6],this.paintType=f[7],this.tilingType=f[8],this.color=v,this.canvasGraphicsFactory=x,this.baseTransform=C,this.ctx=A}return b.prototype={createPatternCanvas:function(v){const A=this.operatorList,x=this.bbox,C=this.xstep,M=this.ystep,I=this.paintType,w=this.tilingType,l=this.color,c=this.canvasGraphicsFactory;(0,t.info)("TilingType: "+w);const p=x[0],m=x[1],y=x[2],P=x[3],F=t.Util.singularValueDecompose2dScale(this.matrix),R=t.Util.singularValueDecompose2dScale(this.baseTransform),B=[F[0]*R[0],F[1]*R[1]],V=this.getSizeAndScale(C,this.ctx.canvas.width,B[0]),Z=this.getSizeAndScale(M,this.ctx.canvas.height,B[1]),ne=v.cachedCanvases.getCanvas("pattern",V.size,Z.size,!0),H=ne.context,N=c.createCanvasGraphics(H);return N.groupLevel=v.groupLevel,this.setFillAndStrokeStyleToContext(N,I,l),N.transform(V.scale,0,0,Z.scale,0,0),N.transform(1,0,0,1,-p,-m),this.clipBbox(N,x,p,m,y,P),N.executeOperatorList(A),this.ctx.transform(1,0,0,1,p,m),this.ctx.scale(1/V.scale,1/Z.scale),ne.canvas},getSizeAndScale:function(v,A,x){v=Math.abs(v);const C=Math.max(_,A);let M=Math.ceil(v*x);return M>=C?M=C:x=M/v,{scale:x,size:M}},clipBbox:function(v,A,x,C,M,I){if(Array.isArray(A)&&A.length===4){const w=M-x,l=I-C;v.ctx.rect(x,C,w,l),v.clip(),v.endPath()}},setFillAndStrokeStyleToContext:function(v,A,x){const C=v.ctx,M=v.current;switch(A){case d.COLORED:const I=this.ctx;C.fillStyle=I.fillStyle,C.strokeStyle=I.strokeStyle,M.fillColor=I.fillStyle,M.strokeColor=I.strokeStyle;break;case d.UNCOLORED:const w=t.Util.makeHexColor(x[0],x[1],x[2]);C.fillStyle=w,C.strokeStyle=w,M.fillColor=w,M.strokeColor=w;break;default:throw new t.FormatError(`Unsupported paint type: ${A}`)}},getPattern:function(v,A){v=this.ctx,v.setTransform.apply(v,this.baseTransform),v.transform.apply(v,this.matrix);const x=this.createPatternCanvas(A);return v.createPattern(x,"repeat")}},b}();e.TilingPattern=h},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const a=Object.create(null);e.GlobalWorkerOptions=a,a.workerPort=a.workerPort===void 0?null:a.workerPort,a.workerSrc=a.workerSrc===void 0?"":a.workerSrc},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var t=a(2);const i={UNKNOWN:0,DATA:1,ERROR:2},s={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function r(h){if(typeof h!="object"||h===null)return h;switch(h.name){case"AbortException":return new t.AbortException(h.message);case"MissingPDFException":return new t.MissingPDFException(h.message);case"UnexpectedResponseException":return new t.UnexpectedResponseException(h.message,h.status);case"UnknownErrorException":return new t.UnknownErrorException(h.message,h.details);default:return new t.UnknownErrorException(h.message,h.toString())}}class u{constructor(o,d,_){this.sourceName=o,this.targetName=d,this.comObj=_,this.callbackId=1,this.streamId=1,this.postMessageTransfers=!0,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=b=>{const f=b.data;if(f.targetName!==this.sourceName)return;if(f.stream){this._processStreamMessage(f);return}if(f.callback){const A=f.callbackId,x=this.callbackCapabilities[A];if(!x)throw new Error(`Cannot resolve callback ${A}`);if(delete this.callbackCapabilities[A],f.callback===i.DATA)x.resolve(f.data);else if(f.callback===i.ERROR)x.reject(r(f.reason));else throw new Error("Unexpected callback case");return}const v=this.actionHandler[f.action];if(!v)throw new Error(`Unknown action from worker: ${f.action}`);if(f.callbackId){const A=this.sourceName,x=f.sourceName;new Promise(function(C){C(v(f.data))}).then(function(C){_.postMessage({sourceName:A,targetName:x,callback:i.DATA,callbackId:f.callbackId,data:C})},function(C){_.postMessage({sourceName:A,targetName:x,callback:i.ERROR,callbackId:f.callbackId,reason:r(C)})});return}if(f.streamId){this._createStreamSink(f);return}v(f.data)},_.addEventListener("message",this._onComObjOnMessage)}on(o,d){const _=this.actionHandler;if(_[o])throw new Error(`There is already an actionName called "${o}"`);_[o]=d}send(o,d,_){this._postMessage({sourceName:this.sourceName,targetName:this.targetName,action:o,data:d},_)}sendWithPromise(o,d,_){const b=this.callbackId++,f=(0,t.createPromiseCapability)();this.callbackCapabilities[b]=f;try{this._postMessage({sourceName:this.sourceName,targetName:this.targetName,action:o,callbackId:b,data:d},_)}catch(v){f.reject(v)}return f.promise}sendWithStream(o,d,_,b){const f=this.streamId++,v=this.sourceName,A=this.targetName,x=this.comObj;return new ReadableStream({start:C=>{const M=(0,t.createPromiseCapability)();return this.streamControllers[f]={controller:C,startCall:M,pullCall:null,cancelCall:null,isClosed:!1},this._postMessage({sourceName:v,targetName:A,action:o,streamId:f,data:d,desiredSize:C.desiredSize},b),M.promise},pull:C=>{const M=(0,t.createPromiseCapability)();return this.streamControllers[f].pullCall=M,x.postMessage({sourceName:v,targetName:A,stream:s.PULL,streamId:f,desiredSize:C.desiredSize}),M.promise},cancel:C=>{(0,t.assert)(C instanceof Error,"cancel must have a valid reason");const M=(0,t.createPromiseCapability)();return this.streamControllers[f].cancelCall=M,this.streamControllers[f].isClosed=!0,x.postMessage({sourceName:v,targetName:A,stream:s.CANCEL,streamId:f,reason:r(C)}),M.promise}},_)}_createStreamSink(o){const d=this,_=this.actionHandler[o.action],b=o.streamId,f=this.sourceName,v=o.sourceName,A=this.comObj,x={enqueue(C,M=1,I){if(this.isCancelled)return;const w=this.desiredSize;this.desiredSize-=M,w>0&&this.desiredSize<=0&&(this.sinkCapability=(0,t.createPromiseCapability)(),this.ready=this.sinkCapability.promise),d._postMessage({sourceName:f,targetName:v,stream:s.ENQUEUE,streamId:b,chunk:C},I)},close(){this.isCancelled||(this.isCancelled=!0,A.postMessage({sourceName:f,targetName:v,stream:s.CLOSE,streamId:b}),delete d.streamSinks[b])},error(C){(0,t.assert)(C instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,A.postMessage({sourceName:f,targetName:v,stream:s.ERROR,streamId:b,reason:r(C)}))},sinkCapability:(0,t.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:o.desiredSize,ready:null};x.sinkCapability.resolve(),x.ready=x.sinkCapability.promise,this.streamSinks[b]=x,new Promise(function(C){C(_(o.data,x))}).then(function(){A.postMessage({sourceName:f,targetName:v,stream:s.START_COMPLETE,streamId:b,success:!0})},function(C){A.postMessage({sourceName:f,targetName:v,stream:s.START_COMPLETE,streamId:b,reason:r(C)})})}_processStreamMessage(o){const d=o.streamId,_=this.sourceName,b=o.sourceName,f=this.comObj;switch(o.stream){case s.START_COMPLETE:o.success?this.streamControllers[d].startCall.resolve():this.streamControllers[d].startCall.reject(r(o.reason));break;case s.PULL_COMPLETE:o.success?this.streamControllers[d].pullCall.resolve():this.streamControllers[d].pullCall.reject(r(o.reason));break;case s.PULL:if(!this.streamSinks[d]){f.postMessage({sourceName:_,targetName:b,stream:s.PULL_COMPLETE,streamId:d,success:!0});break}this.streamSinks[d].desiredSize<=0&&o.desiredSize>0&&this.streamSinks[d].sinkCapability.resolve(),this.streamSinks[d].desiredSize=o.desiredSize;const{onPull:v}=this.streamSinks[o.streamId];new Promise(function(x){x(v&&v())}).then(function(){f.postMessage({sourceName:_,targetName:b,stream:s.PULL_COMPLETE,streamId:d,success:!0})},function(x){f.postMessage({sourceName:_,targetName:b,stream:s.PULL_COMPLETE,streamId:d,reason:r(x)})});break;case s.ENQUEUE:if((0,t.assert)(this.streamControllers[d],"enqueue should have stream controller"),this.streamControllers[d].isClosed)break;this.streamControllers[d].controller.enqueue(o.chunk);break;case s.CLOSE:if((0,t.assert)(this.streamControllers[d],"close should have stream controller"),this.streamControllers[d].isClosed)break;this.streamControllers[d].isClosed=!0,this.streamControllers[d].controller.close(),this._deleteStreamController(d);break;case s.ERROR:(0,t.assert)(this.streamControllers[d],"error should have stream controller"),this.streamControllers[d].controller.error(r(o.reason)),this._deleteStreamController(d);break;case s.CANCEL_COMPLETE:o.success?this.streamControllers[d].cancelCall.resolve():this.streamControllers[d].cancelCall.reject(r(o.reason)),this._deleteStreamController(d);break;case s.CANCEL:if(!this.streamSinks[d])break;const{onCancel:A}=this.streamSinks[o.streamId];new Promise(function(x){x(A&&A(r(o.reason)))}).then(function(){f.postMessage({sourceName:_,targetName:b,stream:s.CANCEL_COMPLETE,streamId:d,success:!0})},function(x){f.postMessage({sourceName:_,targetName:b,stream:s.CANCEL_COMPLETE,streamId:d,reason:r(x)})}),this.streamSinks[d].sinkCapability.reject(r(o.reason)),this.streamSinks[d].isCancelled=!0,delete this.streamSinks[d];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(o){await Promise.allSettled([this.streamControllers[o].startCall,this.streamControllers[o].pullCall,this.streamControllers[o].cancelCall].map(function(d){return d&&d.promise})),delete this.streamControllers[o]}_postMessage(o,d){d&&this.postMessageTransfers?this.comObj.postMessage(o,d):this.comObj.postMessage(o)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}e.MessageHandler=u},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var t=a(2);class i{constructor({parsedData:r,rawData:u}){this._metadataMap=r,this._data=u}getRaw(){return this._data}get(r){return this._metadataMap.get(r)??null}getAll(){return(0,t.objectFromMap)(this._metadataMap)}has(r){return this._metadataMap.has(r)}}e.Metadata=i},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var t=a(2);class i{constructor(u,h){this.visible=!0,this.name=u,this.intent=h}}class s{constructor(u){if(this.name=null,this.creator=null,this._order=null,this._groups=new Map,u!==null){this.name=u.name,this.creator=u.creator,this._order=u.order;for(const h of u.groups)this._groups.set(h.id,new i(h.name,h.intent));if(u.baseState==="OFF")for(const h of this._groups)h.visible=!1;for(const h of u.on)this._groups.get(h).visible=!0;for(const h of u.off)this._groups.get(h).visible=!1}}isVisible(u){if(u.type==="OCG")return this._groups.has(u.id)?this._groups.get(u.id).visible:((0,t.warn)(`Optional content group not found: ${u.id}`),!0);if(u.type==="OCMD"){if(u.expression&&(0,t.warn)("Visibility expression not supported yet."),!u.policy||u.policy==="AnyOn"){for(const h of u.ids){if(!this._groups.has(h))return(0,t.warn)(`Optional content group not found: ${h}`),!0;if(this._groups.get(h).visible)return!0}return!1}else if(u.policy==="AllOn"){for(const h of u.ids){if(!this._groups.has(h))return(0,t.warn)(`Optional content group not found: ${h}`),!0;if(!this._groups.get(h).visible)return!1}return!0}else if(u.policy==="AnyOff"){for(const h of u.ids){if(!this._groups.has(h))return(0,t.warn)(`Optional content group not found: ${h}`),!0;if(!this._groups.get(h).visible)return!0}return!1}else if(u.policy==="AllOff"){for(const h of u.ids){if(!this._groups.has(h))return(0,t.warn)(`Optional content group not found: ${h}`),!0;if(this._groups.get(h).visible)return!1}return!0}return(0,t.warn)(`Unknown optional content policy ${u.policy}.`),!0}return(0,t.warn)(`Unknown group type ${u.type}.`),!0}setVisibility(u,h=!0){if(!this._groups.has(u)){(0,t.warn)(`Optional content group not found: ${u}`);return}this._groups.get(u).visible=!!h}getOrder(){return this._groups.size?this._order?this._order.slice():Array.from(this._groups.keys()):null}getGroups(){return this._groups.size>0?(0,t.objectFromMap)(this._groups):null}getGroup(u){return this._groups.get(u)||null}}e.OptionalContentConfig=s},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var t=a(2),i=a(1);class s{constructor(o,d){(0,t.assert)(d,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=o.progressiveDone||!1,this._contentDispositionFilename=o.contentDispositionFilename||null;const _=o.initialData;if((_==null?void 0:_.length)>0){const b=new Uint8Array(_).buffer;this._queuedChunks.push(b)}this._pdfDataRangeTransport=d,this._isStreamingSupported=!o.disableStream,this._isRangeSupported=!o.disableRange,this._contentLength=o.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((b,f)=>{this._onReceiveData({begin:b,chunk:f})}),this._pdfDataRangeTransport.addProgressListener((b,f)=>{this._onProgress({loaded:b,total:f})}),this._pdfDataRangeTransport.addProgressiveReadListener(b=>{this._onReceiveData({chunk:b})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(o){const d=new Uint8Array(o.chunk).buffer;if(o.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(d):this._queuedChunks.push(d);else{const _=this._rangeReaders.some(function(b){return b._begin!==o.begin?!1:(b._enqueue(d),!0)});(0,t.assert)(_,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var o;return((o=this._fullRequestReader)==null?void 0:o._loaded)??0}_onProgress(o){if(o.total===void 0){const d=this._rangeReaders[0];d!=null&&d.onProgress&&d.onProgress({loaded:o.loaded})}else{const d=this._fullRequestReader;d!=null&&d.onProgress&&d.onProgress({loaded:o.loaded,total:o.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(o){const d=this._rangeReaders.indexOf(o);d>=0&&this._rangeReaders.splice(d,1)}getFullReader(){(0,t.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const o=this._queuedChunks;return this._queuedChunks=null,new r(this,o,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(o,d){if(d<=this._progressiveDataLength)return null;const _=new u(this,o,d);return this._pdfDataRangeTransport.requestDataRange(o,d),this._rangeReaders.push(_),_}cancelAllRequests(o){this._fullRequestReader&&this._fullRequestReader.cancel(o),this._rangeReaders.slice(0).forEach(function(_){_.cancel(o)}),this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=s;class r{constructor(o,d,_=!1,b=null){this._stream=o,this._done=_||!1,this._filename=(0,i.isPdfFile)(b)?b:null,this._queuedChunks=d||[],this._loaded=0;for(const f of this._queuedChunks)this._loaded+=f.byteLength;this._requests=[],this._headersReady=Promise.resolve(),o._fullRequestReader=this,this.onProgress=null}_enqueue(o){this._done||(this._requests.length>0?this._requests.shift().resolve({value:o,done:!1}):this._queuedChunks.push(o),this._loaded+=o.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const o=(0,t.createPromiseCapability)();return this._requests.push(o),o.promise}cancel(o){this._done=!0,this._requests.forEach(function(d){d.resolve({value:void 0,done:!0})}),this._requests=[]}progressiveDone(){this._done||(this._done=!0)}}class u{constructor(o,d,_){this._stream=o,this._begin=d,this._end=_,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(o){this._done||(this._requests.length===0?this._queuedChunk=o:(this._requests.shift().resolve({value:o,done:!1}),this._requests.forEach(function(_){_.resolve({value:void 0,done:!0})}),this._requests=[]),this._done=!0,this._stream._removeRangeReader(this))}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const d=this._queuedChunk;return this._queuedChunk=null,{value:d,done:!1}}if(this._done)return{value:void 0,done:!0};const o=(0,t.createPromiseCapability)();return this._requests.push(o),o.promise}cancel(o){this._done=!0,this._requests.forEach(function(d){d.resolve({value:void 0,done:!0})}),this._requests=[],this._stream._removeRangeReader(this)}}},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLContext=void 0;var t=a(2);class i{constructor({enable:u=!1}){this._enabled=u===!0}get isEnabled(){let u=this._enabled;return u&&(u=s.tryInitGL()),(0,t.shadow)(this,"isEnabled",u)}composeSMask({layer:u,mask:h,properties:o}){return s.composeSMask(u,h,o)}drawFigures({width:u,height:h,backgroundColor:o,figures:d,context:_}){return s.drawFigures(u,h,o,d,_)}clear(){s.cleanup()}}e.WebGLContext=i;const s=function(){function u(y,P,F){const R=y.createShader(F);if(y.shaderSource(R,P),y.compileShader(R),!y.getShaderParameter(R,y.COMPILE_STATUS)){const V=y.getShaderInfoLog(R);throw new Error("Error during shader compilation: "+V)}return R}function h(y,P){return u(y,P,y.VERTEX_SHADER)}function o(y,P){return u(y,P,y.FRAGMENT_SHADER)}function d(y,P){const F=y.createProgram();for(let B=0,V=P.length;B<V;++B)y.attachShader(F,P[B]);if(y.linkProgram(F),!y.getProgramParameter(F,y.LINK_STATUS)){const B=y.getProgramInfoLog(F);throw new Error("Error during program linking: "+B)}return F}function _(y,P,F){y.activeTexture(F);const R=y.createTexture();return y.bindTexture(y.TEXTURE_2D,R),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,P),R}let b,f;function v(){b||(f=document.createElement("canvas"),b=f.getContext("webgl",{premultipliedalpha:!1}))}const A="  attribute vec2 a_position;                                      attribute vec2 a_texCoord;                                                                                                      uniform vec2 u_resolution;                                                                                                      varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;       gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_texCoord = a_texCoord;                                      }                                                             ",x="  precision mediump float;                                                                                                        uniform vec4 u_backdrop;                                        uniform int u_subtype;                                          uniform sampler2D u_image;                                      uniform sampler2D u_mask;                                                                                                       varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec4 imageColor = texture2D(u_image, v_texCoord);               vec4 maskColor = texture2D(u_mask, v_texCoord);                 if (u_backdrop.a > 0.0) {                                         maskColor.rgb = maskColor.rgb * maskColor.a +                                   u_backdrop.rgb * (1.0 - maskColor.a);         }                                                               float lum;                                                      if (u_subtype == 0) {                                             lum = maskColor.a;                                            } else {                                                          lum = maskColor.r * 0.3 + maskColor.g * 0.59 +                        maskColor.b * 0.11;                                     }                                                               imageColor.a *= lum;                                            imageColor.rgb *= imageColor.a;                                 gl_FragColor = imageColor;                                    }                                                             ";let C=null;function M(){v();const y=f;f=null;const P=b;b=null;const F=h(P,A),R=o(P,x),B=d(P,[F,R]);P.useProgram(B);const V={};V.gl=P,V.canvas=y,V.resolutionLocation=P.getUniformLocation(B,"u_resolution"),V.positionLocation=P.getAttribLocation(B,"a_position"),V.backdropLocation=P.getUniformLocation(B,"u_backdrop"),V.subtypeLocation=P.getUniformLocation(B,"u_subtype");const Z=P.getAttribLocation(B,"a_texCoord"),ne=P.getUniformLocation(B,"u_image"),H=P.getUniformLocation(B,"u_mask"),N=P.createBuffer();P.bindBuffer(P.ARRAY_BUFFER,N),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),P.STATIC_DRAW),P.enableVertexAttribArray(Z),P.vertexAttribPointer(Z,2,P.FLOAT,!1,0,0),P.uniform1i(ne,0),P.uniform1i(H,1),C=V}function I(y,P,F){const R=y.width,B=y.height;C||M();const V=C,Z=V.canvas,ne=V.gl;Z.width=R,Z.height=B,ne.viewport(0,0,ne.drawingBufferWidth,ne.drawingBufferHeight),ne.uniform2f(V.resolutionLocation,R,B),F.backdrop?ne.uniform4f(V.resolutionLocation,F.backdrop[0],F.backdrop[1],F.backdrop[2],1):ne.uniform4f(V.resolutionLocation,0,0,0,0),ne.uniform1i(V.subtypeLocation,F.subtype==="Luminosity"?1:0);const H=_(ne,y,ne.TEXTURE0),N=_(ne,P,ne.TEXTURE1),g=ne.createBuffer();return ne.bindBuffer(ne.ARRAY_BUFFER,g),ne.bufferData(ne.ARRAY_BUFFER,new Float32Array([0,0,R,0,0,B,0,B,R,0,R,B]),ne.STATIC_DRAW),ne.enableVertexAttribArray(V.positionLocation),ne.vertexAttribPointer(V.positionLocation,2,ne.FLOAT,!1,0,0),ne.clearColor(0,0,0,0),ne.enable(ne.BLEND),ne.blendFunc(ne.ONE,ne.ONE_MINUS_SRC_ALPHA),ne.clear(ne.COLOR_BUFFER_BIT),ne.drawArrays(ne.TRIANGLES,0,6),ne.flush(),ne.deleteTexture(H),ne.deleteTexture(N),ne.deleteBuffer(g),Z}const w="  attribute vec2 a_position;                                      attribute vec3 a_color;                                                                                                         uniform vec2 u_resolution;                                      uniform vec2 u_scale;                                           uniform vec2 u_offset;                                                                                                          varying vec4 v_color;                                                                                                           void main() {                                                     vec2 position = (a_position + u_offset) * u_scale;              vec2 clipSpace = (position / u_resolution) * 2.0 - 1.0;         gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_color = vec4(a_color / 255.0, 1.0);                         }                                                             ",l="  precision mediump float;                                                                                                        varying vec4 v_color;                                                                                                           void main() {                                                     gl_FragColor = v_color;                                       }                                                             ";let c=null;function p(){v();const y=f;f=null;const P=b;b=null;const F=h(P,w),R=o(P,l),B=d(P,[F,R]);P.useProgram(B);const V={};V.gl=P,V.canvas=y,V.resolutionLocation=P.getUniformLocation(B,"u_resolution"),V.scaleLocation=P.getUniformLocation(B,"u_scale"),V.offsetLocation=P.getUniformLocation(B,"u_offset"),V.positionLocation=P.getAttribLocation(B,"a_position"),V.colorLocation=P.getAttribLocation(B,"a_color"),c=V}function m(y,P,F,R,B){c||p();const V=c,Z=V.canvas,ne=V.gl;Z.width=y,Z.height=P,ne.viewport(0,0,ne.drawingBufferWidth,ne.drawingBufferHeight),ne.uniform2f(V.resolutionLocation,y,P);let H=0;for(let ue=0,he=R.length;ue<he;ue++)switch(R[ue].type){case"lattice":const se=R[ue].coords.length/R[ue].verticesPerRow|0;H+=(se-1)*(R[ue].verticesPerRow-1)*6;break;case"triangles":H+=R[ue].coords.length;break}const N=new Float32Array(H*2),g=new Uint8Array(H*3),O=B.coords,D=B.colors;let z=0,W=0;for(let ue=0,he=R.length;ue<he;ue++){const se=R[ue],de=se.coords,U=se.colors;switch(se.type){case"lattice":const T=se.verticesPerRow,K=de.length/T|0;for(let Y=1;Y<K;Y++){let fe=Y*T+1;for(let we=1;we<T;we++,fe++)N[z]=O[de[fe-T-1]],N[z+1]=O[de[fe-T-1]+1],N[z+2]=O[de[fe-T]],N[z+3]=O[de[fe-T]+1],N[z+4]=O[de[fe-1]],N[z+5]=O[de[fe-1]+1],g[W]=D[U[fe-T-1]],g[W+1]=D[U[fe-T-1]+1],g[W+2]=D[U[fe-T-1]+2],g[W+3]=D[U[fe-T]],g[W+4]=D[U[fe-T]+1],g[W+5]=D[U[fe-T]+2],g[W+6]=D[U[fe-1]],g[W+7]=D[U[fe-1]+1],g[W+8]=D[U[fe-1]+2],N[z+6]=N[z+2],N[z+7]=N[z+3],N[z+8]=N[z+4],N[z+9]=N[z+5],N[z+10]=O[de[fe]],N[z+11]=O[de[fe]+1],g[W+9]=g[W+3],g[W+10]=g[W+4],g[W+11]=g[W+5],g[W+12]=g[W+6],g[W+13]=g[W+7],g[W+14]=g[W+8],g[W+15]=D[U[fe]],g[W+16]=D[U[fe]+1],g[W+17]=D[U[fe]+2],z+=12,W+=18}break;case"triangles":for(let Y=0,fe=de.length;Y<fe;Y++)N[z]=O[de[Y]],N[z+1]=O[de[Y]+1],g[W]=D[U[Y]],g[W+1]=D[U[Y]+1],g[W+2]=D[U[Y]+2],z+=2,W+=3;break}}F?ne.clearColor(F[0]/255,F[1]/255,F[2]/255,1):ne.clearColor(0,0,0,0),ne.clear(ne.COLOR_BUFFER_BIT);const J=ne.createBuffer();ne.bindBuffer(ne.ARRAY_BUFFER,J),ne.bufferData(ne.ARRAY_BUFFER,N,ne.STATIC_DRAW),ne.enableVertexAttribArray(V.positionLocation),ne.vertexAttribPointer(V.positionLocation,2,ne.FLOAT,!1,0,0);const ie=ne.createBuffer();return ne.bindBuffer(ne.ARRAY_BUFFER,ie),ne.bufferData(ne.ARRAY_BUFFER,g,ne.STATIC_DRAW),ne.enableVertexAttribArray(V.colorLocation),ne.vertexAttribPointer(V.colorLocation,3,ne.UNSIGNED_BYTE,!1,0,0),ne.uniform2f(V.scaleLocation,B.scaleX,B.scaleY),ne.uniform2f(V.offsetLocation,B.offsetX,B.offsetY),ne.drawArrays(ne.TRIANGLES,0,H),ne.flush(),ne.deleteBuffer(J),ne.deleteBuffer(ie),Z}return{tryInitGL(){try{return v(),!!b}catch{}return!1},composeSMask:I,drawFigures:m,cleanup(){C!=null&&C.canvas&&(C.canvas.width=0,C.canvas.height=0),c!=null&&c.canvas&&(c.canvas.width=0,c.canvas.height=0),C=null,c=null}}}()},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var t=a(1),i=a(2),s=a(8),r=a(19);class u{static create(g){switch(g.data.annotationType){case i.AnnotationType.LINK:return new o(g);case i.AnnotationType.TEXT:return new d(g);case i.AnnotationType.WIDGET:switch(g.data.fieldType){case"Tx":return new b(g);case"Btn":return g.data.radioButton?new v(g):g.data.checkBox?new f(g):new A(g);case"Ch":return new x(g)}return new _(g);case i.AnnotationType.POPUP:return new C(g);case i.AnnotationType.FREETEXT:return new I(g);case i.AnnotationType.LINE:return new w(g);case i.AnnotationType.SQUARE:return new l(g);case i.AnnotationType.CIRCLE:return new c(g);case i.AnnotationType.POLYLINE:return new p(g);case i.AnnotationType.CARET:return new y(g);case i.AnnotationType.INK:return new P(g);case i.AnnotationType.POLYGON:return new m(g);case i.AnnotationType.HIGHLIGHT:return new F(g);case i.AnnotationType.UNDERLINE:return new R(g);case i.AnnotationType.SQUIGGLY:return new B(g);case i.AnnotationType.STRIKEOUT:return new V(g);case i.AnnotationType.STAMP:return new Z(g);case i.AnnotationType.FILEATTACHMENT:return new ne(g);default:return new h(g)}}}class h{constructor(g,{isRenderable:O=!1,ignoreBorder:D=!1,createQuadrilaterals:z=!1}={}){this.isRenderable=O,this.data=g.data,this.layer=g.layer,this.page=g.page,this.viewport=g.viewport,this.linkService=g.linkService,this.downloadManager=g.downloadManager,this.imageResourcesPath=g.imageResourcesPath,this.renderInteractiveForms=g.renderInteractiveForms,this.svgFactory=g.svgFactory,this.annotationStorage=g.annotationStorage,this.enableScripting=g.enableScripting,this.hasJSActions=g.hasJSActions,this._mouseState=g.mouseState,O&&(this.container=this._createContainer(D)),z&&(this.quadrilaterals=this._createQuadrilaterals(D))}_createContainer(g=!1){const O=this.data,D=this.page,z=this.viewport,W=document.createElement("section");let J=O.rect[2]-O.rect[0],ie=O.rect[3]-O.rect[1];W.setAttribute("data-annotation-id",O.id);const ue=i.Util.normalizeRect([O.rect[0],D.view[3]-O.rect[1]+D.view[1],O.rect[2],D.view[3]-O.rect[3]+D.view[1]]);if(W.style.transform=`matrix(${z.transform.join(",")})`,W.style.transformOrigin=`${-ue[0]}px ${-ue[1]}px`,!g&&O.borderStyle.width>0){W.style.borderWidth=`${O.borderStyle.width}px`,O.borderStyle.style!==i.AnnotationBorderStyleType.UNDERLINE&&(J=J-2*O.borderStyle.width,ie=ie-2*O.borderStyle.width);const he=O.borderStyle.horizontalCornerRadius,se=O.borderStyle.verticalCornerRadius;if(he>0||se>0){const de=`${he}px / ${se}px`;W.style.borderRadius=de}switch(O.borderStyle.style){case i.AnnotationBorderStyleType.SOLID:W.style.borderStyle="solid";break;case i.AnnotationBorderStyleType.DASHED:W.style.borderStyle="dashed";break;case i.AnnotationBorderStyleType.BEVELED:(0,i.warn)("Unimplemented border style: beveled");break;case i.AnnotationBorderStyleType.INSET:(0,i.warn)("Unimplemented border style: inset");break;case i.AnnotationBorderStyleType.UNDERLINE:W.style.borderBottomStyle="solid";break}O.color?W.style.borderColor=i.Util.makeHexColor(O.color[0]|0,O.color[1]|0,O.color[2]|0):W.style.borderWidth=0}return W.style.left=`${ue[0]}px`,W.style.top=`${ue[1]}px`,W.style.width=`${J}px`,W.style.height=`${ie}px`,W}_createQuadrilaterals(g=!1){if(!this.data.quadPoints)return null;const O=[],D=this.data.rect;for(const z of this.data.quadPoints)this.data.rect=[z[2].x,z[2].y,z[1].x,z[1].y],O.push(this._createContainer(g));return this.data.rect=D,O}_createPopup(g,O){let D=this.container;this.quadrilaterals&&(g=g||this.quadrilaterals,D=this.quadrilaterals[0]),g||(g=document.createElement("div"),g.style.height=D.style.height,g.style.width=D.style.width,D.appendChild(g));const W=new M({container:D,trigger:g,color:O.color,title:O.title,modificationDate:O.modificationDate,contents:O.contents,hideWrapper:!0}).render();W.style.left=D.style.width,D.appendChild(W)}_renderQuadrilaterals(g){return this.quadrilaterals.forEach(O=>{O.className=g}),this.quadrilaterals}render(){(0,i.unreachable)("Abstract method `AnnotationElement.render` called")}}class o extends h{constructor(g){const O=!!(g.data.url||g.data.dest||g.data.action||g.data.isTooltipOnly||g.data.actions&&(g.data.actions.Action||g.data.actions["Mouse Up"]||g.data.actions["Mouse Down"]));super(g,{isRenderable:O,createQuadrilaterals:!0})}render(){const{data:g,linkService:O}=this,D=document.createElement("a");return g.url?(0,t.addLinkAttributes)(D,{url:g.url,target:g.newWindow?t.LinkTarget.BLANK:O.externalLinkTarget,rel:O.externalLinkRel,enabled:O.externalLinkEnabled}):g.action?this._bindNamedAction(D,g.action):g.dest?this._bindLink(D,g.dest):g.actions&&(g.actions.Action||g.actions["Mouse Up"]||g.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions?this._bindJSAction(D,g):this._bindLink(D,""),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((z,W)=>{const J=W===0?D:D.cloneNode();return z.appendChild(J),z}):(this.container.className="linkAnnotation",this.container.appendChild(D),this.container)}_bindLink(g,O){g.href=this.linkService.getDestinationHash(O),g.onclick=()=>(O&&this.linkService.goToDestination(O),!1),(O||O==="")&&(g.className="internalLink")}_bindNamedAction(g,O){g.href=this.linkService.getAnchorUrl(""),g.onclick=()=>(this.linkService.executeNamedAction(O),!1),g.className="internalLink"}_bindJSAction(g,O){g.href=this.linkService.getAnchorUrl("");const D=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const z of Object.keys(O.actions)){const W=D.get(z);W&&(g[W]=()=>{var J;return(J=this.linkService.eventBus)==null||J.dispatch("dispatcheventinsandbox",{source:this,detail:{id:O.id,name:z}}),!1})}g.className="internalLink"}}class d extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O})}render(){this.container.className="textAnnotation";const g=document.createElement("img");return g.style.height=this.container.style.height,g.style.width=this.container.style.width,g.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",g.alt="[{{type}} Annotation]",g.dataset.l10nId="text_annotation_type",g.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(g,this.data),this.container.appendChild(g),this.container}}class _ extends h{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(g){return navigator.platform.includes("Win")&&g.ctrlKey||navigator.platform.includes("Mac")&&g.metaKey}_setEventListener(g,O,D,z){O.includes("mouse")?g.addEventListener(O,W=>{var J;(J=this.linkService.eventBus)==null||J.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:D,value:z(W),shift:W.shiftKey,modifier:this._getKeyModifier(W)}})}):g.addEventListener(O,W=>{var J;(J=this.linkService.eventBus)==null||J.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:D,value:W.target.checked}})})}_setEventListeners(g,O,D){var z;for(const[W,J]of O)(J==="Action"||(z=this.data.actions)!=null&&z[J])&&this._setEventListener(g,W,J,D)}_setColor(g){const{detail:O,target:D}=g,{style:z}=D;for(const W of["bgColor","fillColor","fgColor","textColor","borderColor","strokeColor"]){let J=O[W];if(J)switch(J=r.ColorConverters[`${J[0]}_HTML`](J.slice(1)),W){case"bgColor":case"fillColor":z.backgroundColor=J;break;case"fgColor":case"textColor":z.color=J;break;case"borderColor":case"strokeColor":z.borderColor=J;break}}}}class b extends _{constructor(g){const O=g.renderInteractiveForms||!g.data.hasAppearance&&!!g.data.fieldValue;super(g,{isRenderable:O})}render(){var z;const g=this.annotationStorage,O=this.data.id;this.container.className="textWidgetAnnotation";let D=null;if(this.renderInteractiveForms){const W=g.getValue(O,{value:this.data.fieldValue,valueAsString:this.data.fieldValue}),J=W.valueAsString||W.value||"",ie={userValue:null,formattedValue:null,beforeInputSelectionRange:null,beforeInputValue:null};this.data.multiLine?(D=document.createElement("textarea"),D.textContent=J):(D=document.createElement("input"),D.type="text",D.setAttribute("value",J)),ie.userValue=J,D.setAttribute("id",O),D.addEventListener("input",function(he){g.setValue(O,{value:he.target.value})});let ue=he=>{ie.formattedValue&&(he.target.value=ie.formattedValue),he.target.setSelectionRange(0,0),ie.beforeInputSelectionRange=null};if(this.enableScripting&&this.hasJSActions){D.addEventListener("focus",se=>{ie.userValue&&(se.target.value=ie.userValue)}),D.addEventListener("updatefromsandbox",se=>{const{detail:de}=se,U={value(){ie.userValue=de.value||"",g.setValue(O,{value:ie.userValue.toString()}),ie.formattedValue||(se.target.value=ie.userValue)},valueAsString(){ie.formattedValue=de.valueAsString||"",se.target!==document.activeElement&&(se.target.value=ie.formattedValue),g.setValue(O,{formattedValue:ie.formattedValue})},focus(){setTimeout(()=>se.target.focus({preventScroll:!1}),0)},userName(){se.target.title=de.userName},hidden(){se.target.style.visibility=de.hidden?"hidden":"visible",g.setValue(O,{hidden:de.hidden})},editable(){se.target.disabled=!de.editable},selRange(){const[T,K]=de.selRange;T>=0&&K<se.target.value.length&&se.target.setSelectionRange(T,K)}};Object.keys(de).filter(T=>T in U).forEach(T=>U[T]()),this._setColor(se)}),D.addEventListener("keydown",se=>{var U;ie.beforeInputValue=se.target.value;let de=-1;se.key==="Escape"?de=0:se.key==="Enter"?de=2:se.key==="Tab"&&(de=3),de!==-1&&(ie.userValue=se.target.value,(U=this.linkService.eventBus)==null||U.dispatch("dispatcheventinsandbox",{source:this,detail:{id:O,name:"Keystroke",value:se.target.value,willCommit:!0,commitKey:de,selStart:se.target.selectionStart,selEnd:se.target.selectionEnd}}))});const he=ue;ue=null,D.addEventListener("blur",se=>{var de;this._mouseState.isDown&&(ie.userValue=se.target.value,(de=this.linkService.eventBus)==null||de.dispatch("dispatcheventinsandbox",{source:this,detail:{id:O,name:"Keystroke",value:se.target.value,willCommit:!0,commitKey:1,selStart:se.target.selectionStart,selEnd:se.target.selectionEnd}})),he(se)}),D.addEventListener("mousedown",se=>{ie.beforeInputValue=se.target.value,ie.beforeInputSelectionRange=null}),D.addEventListener("keyup",se=>{se.target.selectionStart===se.target.selectionEnd&&(ie.beforeInputSelectionRange=null)}),D.addEventListener("select",se=>{ie.beforeInputSelectionRange=[se.target.selectionStart,se.target.selectionEnd]}),(z=this.data.actions)!=null&&z.Keystroke&&D.addEventListener("input",se=>{var T;let de=-1,U=-1;ie.beforeInputSelectionRange&&([de,U]=ie.beforeInputSelectionRange),(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:O,name:"Keystroke",value:ie.beforeInputValue,change:se.data,willCommit:!1,selStart:de,selEnd:U}})}),this._setEventListeners(D,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],se=>se.target.value)}if(ue&&D.addEventListener("blur",ue),D.disabled=this.data.readOnly,D.name=this.data.fieldName,this.data.maxLen!==null&&(D.maxLength=this.data.maxLen),this.data.comb){const se=(this.data.rect[2]-this.data.rect[0])/this.data.maxLen;D.classList.add("comb"),D.style.letterSpacing=`calc(${se}px - 1ch)`}}else D=document.createElement("div"),D.textContent=this.data.fieldValue,D.style.verticalAlign="middle",D.style.display="table-cell";return this._setTextStyle(D),this.container.appendChild(D),this.container}_setTextStyle(g){const O=["left","center","right"],{fontSize:D,fontColor:z}=this.data.defaultAppearanceData,W=g.style;D&&(W.fontSize=`${D}px`),W.color=i.Util.makeHexColor(z[0],z[1],z[2]),this.data.textAlignment!==null&&(W.textAlign=O[this.data.textAlignment])}}class f extends _{constructor(g){super(g,{isRenderable:g.renderInteractiveForms})}render(){const g=this.annotationStorage,O=this.data,D=O.id,z=g.getValue(D,{value:O.fieldValue&&(O.exportValue&&O.exportValue===O.fieldValue||!O.exportValue&&O.fieldValue!=="Off")}).value;this.container.className="buttonWidgetAnnotation checkBox";const W=document.createElement("input");return W.disabled=O.readOnly,W.type="checkbox",W.name=this.data.fieldName,z&&W.setAttribute("checked",!0),W.setAttribute("id",D),W.addEventListener("change",function(J){const ie=J.target.name;for(const ue of document.getElementsByName(ie))ue!==J.target&&(ue.checked=!1,g.setValue(ue.parentNode.getAttribute("data-annotation-id"),{value:!1}));g.setValue(D,{value:J.target.checked})}),this.enableScripting&&this.hasJSActions&&(W.addEventListener("updatefromsandbox",J=>{const{detail:ie}=J,ue={value(){J.target.checked=ie.value!=="Off",g.setValue(D,{value:J.target.checked})},focus(){setTimeout(()=>J.target.focus({preventScroll:!1}),0)},hidden(){J.target.style.visibility=ie.hidden?"hidden":"visible",g.setValue(D,{hidden:ie.hidden})},editable(){J.target.disabled=!ie.editable}};Object.keys(ie).filter(he=>he in ue).forEach(he=>ue[he]()),this._setColor(J)}),this._setEventListeners(W,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],J=>J.target.checked)),this.container.appendChild(W),this.container}}class v extends _{constructor(g){super(g,{isRenderable:g.renderInteractiveForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const g=this.annotationStorage,O=this.data,D=O.id,z=g.getValue(D,{value:O.fieldValue===O.buttonValue}).value,W=document.createElement("input");if(W.disabled=O.readOnly,W.type="radio",W.name=O.fieldName,z&&W.setAttribute("checked",!0),W.setAttribute("id",D),W.addEventListener("change",function(J){const{target:ie}=J;for(const ue of document.getElementsByName(ie.name))ue!==ie&&g.setValue(ue.getAttribute("id"),{value:!1});g.setValue(D,{value:ie.checked})}),this.enableScripting&&this.hasJSActions){const J=O.buttonValue;W.addEventListener("updatefromsandbox",ie=>{const{detail:ue}=ie,he={value(){const se=J===ue.value;for(const de of document.getElementsByName(ie.target.name)){const U=de.getAttribute("id");de.checked=U===D&&se,g.setValue(U,{value:de.checked})}},focus(){setTimeout(()=>ie.target.focus({preventScroll:!1}),0)},hidden(){ie.target.style.visibility=ue.hidden?"hidden":"visible",g.setValue(D,{hidden:ue.hidden})},editable(){ie.target.disabled=!ue.editable}};Object.keys(ue).filter(se=>se in he).forEach(se=>he[se]()),this._setColor(ie)}),this._setEventListeners(W,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ie=>ie.target.checked)}return this.container.appendChild(W),this.container}}class A extends o{render(){const g=super.render();return g.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(g.title=this.data.alternativeText),g}}class x extends _{constructor(g){super(g,{isRenderable:g.renderInteractiveForms})}render(){this.container.className="choiceWidgetAnnotation";const g=this.annotationStorage,O=this.data.id;g.getValue(O,{value:this.data.fieldValue.length>0?this.data.fieldValue[0]:void 0});const D=document.createElement("select");D.disabled=this.data.readOnly,D.name=this.data.fieldName,D.setAttribute("id",O),this.data.combo||(D.size=this.data.options.length,this.data.multiSelect&&(D.multiple=!0));for(const J of this.data.options){const ie=document.createElement("option");ie.textContent=J.displayValue,ie.value=J.exportValue,this.data.fieldValue.includes(J.exportValue)&&ie.setAttribute("selected",!0),D.appendChild(ie)}const z=(J,ie)=>{const ue=ie?"value":"textContent",he=J.target.options;return J.target.multiple?Array.prototype.filter.call(he,se=>se.selected).map(se=>se[ue]):he.selectedIndex===-1?null:he[he.selectedIndex][ue]},W=J=>{const ie=J.target.options;return Array.prototype.map.call(ie,ue=>({displayValue:ue.textContent,exportValue:ue.value}))};return this.enableScripting&&this.hasJSActions?(D.addEventListener("updatefromsandbox",J=>{const{detail:ie}=J,ue={value(){const he=D.options,se=ie.value,de=new Set(Array.isArray(se)?se:[se]);Array.prototype.forEach.call(he,U=>{U.selected=de.has(U.value)}),g.setValue(O,{value:z(J,!0)})},multipleSelection(){D.multiple=!0},remove(){const he=D.options,se=ie.remove;he[se].selected=!1,D.remove(se),he.length>0&&Array.prototype.findIndex.call(he,U=>U.selected)===-1&&(he[0].selected=!0),g.setValue(O,{value:z(J,!0),items:W(J)})},clear(){for(;D.length!==0;)D.remove(0);g.setValue(O,{value:null,items:[]})},insert(){const{index:he,displayValue:se,exportValue:de}=ie.insert,U=document.createElement("option");U.textContent=se,U.value=de,D.insertBefore(U,D.children[he]),g.setValue(O,{value:z(J,!0),items:W(J)})},items(){const{items:he}=ie;for(;D.length!==0;)D.remove(0);for(const se of he){const{displayValue:de,exportValue:U}=se,T=document.createElement("option");T.textContent=de,T.value=U,D.appendChild(T)}D.options.length>0&&(D.options[0].selected=!0),g.setValue(O,{value:z(J,!0),items:W(J)})},indices(){const he=new Set(ie.indices),se=J.target.options;Array.prototype.forEach.call(se,(de,U)=>{de.selected=he.has(U)}),g.setValue(O,{value:z(J,!0)})},focus(){setTimeout(()=>J.target.focus({preventScroll:!1}),0)},hidden(){J.target.style.visibility=ie.hidden?"hidden":"visible",g.setValue(O,{hidden:ie.hidden})},editable(){J.target.disabled=!ie.editable}};Object.keys(ie).filter(he=>he in ue).forEach(he=>ue[he]()),this._setColor(J)}),D.addEventListener("input",J=>{var he;const ie=z(J,!0),ue=z(J,!1);g.setValue(O,{value:ie}),(he=this.linkService.eventBus)==null||he.dispatch("dispatcheventinsandbox",{source:this,detail:{id:O,name:"Keystroke",value:ue,changeEx:ie,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(D,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],J=>J.target.checked)):D.addEventListener("input",function(J){g.setValue(O,{value:z(J)})}),this.container.appendChild(D),this.container}}class C extends h{constructor(g){const O=!!(g.data.title||g.data.contents);super(g,{isRenderable:O})}render(){const g=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",g.includes(this.data.parentType))return this.container;const O=`[data-annotation-id="${this.data.parentId}"]`,D=this.layer.querySelectorAll(O);if(D.length===0)return this.container;const z=new M({container:this.container,trigger:Array.from(D),color:this.data.color,title:this.data.title,modificationDate:this.data.modificationDate,contents:this.data.contents}),W=this.page,J=i.Util.normalizeRect([this.data.parentRect[0],W.view[3]-this.data.parentRect[1]+W.view[1],this.data.parentRect[2],W.view[3]-this.data.parentRect[3]+W.view[1]]),ie=J[0]+this.data.parentRect[2]-this.data.parentRect[0],ue=J[1];return this.container.style.transformOrigin=`${-ie}px ${-ue}px`,this.container.style.left=`${ie}px`,this.container.style.top=`${ue}px`,this.container.appendChild(z.render()),this.container}}class M{constructor(g){this.container=g.container,this.trigger=g.trigger,this.color=g.color,this.title=g.title,this.modificationDate=g.modificationDate,this.contents=g.contents,this.hideWrapper=g.hideWrapper||!1,this.pinned=!1}render(){const O=document.createElement("div");O.className="popupWrapper",this.hideElement=this.hideWrapper?O:this.container,this.hideElement.hidden=!0;const D=document.createElement("div");D.className="popup";const z=this.color;if(z){const ue=.7*(255-z[0])+z[0],he=.7*(255-z[1])+z[1],se=.7*(255-z[2])+z[2];D.style.backgroundColor=i.Util.makeHexColor(ue|0,he|0,se|0)}const W=document.createElement("h1");W.textContent=this.title,D.appendChild(W);const J=t.PDFDateString.toDateObject(this.modificationDate);if(J){const ue=document.createElement("span");ue.textContent="{{date}}, {{time}}",ue.dataset.l10nId="annotation_date_string",ue.dataset.l10nArgs=JSON.stringify({date:J.toLocaleDateString(),time:J.toLocaleTimeString()}),D.appendChild(ue)}const ie=this._formatContents(this.contents);return D.appendChild(ie),Array.isArray(this.trigger)||(this.trigger=[this.trigger]),this.trigger.forEach(ue=>{ue.addEventListener("click",this._toggle.bind(this)),ue.addEventListener("mouseover",this._show.bind(this,!1)),ue.addEventListener("mouseout",this._hide.bind(this,!1))}),D.addEventListener("click",this._hide.bind(this,!0)),O.appendChild(D),O}_formatContents(g){const O=document.createElement("p"),D=g.split(/(?:\r\n?|\n)/);for(let z=0,W=D.length;z<W;++z){const J=D[z];O.appendChild(document.createTextNode(J)),z<W-1&&O.appendChild(document.createElement("br"))}return O}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(g=!1){g&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex+=1)}_hide(g=!0){g&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex-=1)}}class I extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0})}render(){return this.container.className="freeTextAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class w extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const g=this.data,O=g.rect[2]-g.rect[0],D=g.rect[3]-g.rect[1],z=this.svgFactory.create(O,D),W=this.svgFactory.createElement("svg:line");return W.setAttribute("x1",g.rect[2]-g.lineCoordinates[0]),W.setAttribute("y1",g.rect[3]-g.lineCoordinates[1]),W.setAttribute("x2",g.rect[2]-g.lineCoordinates[2]),W.setAttribute("y2",g.rect[3]-g.lineCoordinates[3]),W.setAttribute("stroke-width",g.borderStyle.width||1),W.setAttribute("stroke","transparent"),z.appendChild(W),this.container.append(z),this._createPopup(W,g),this.container}}class l extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const g=this.data,O=g.rect[2]-g.rect[0],D=g.rect[3]-g.rect[1],z=this.svgFactory.create(O,D),W=g.borderStyle.width,J=this.svgFactory.createElement("svg:rect");return J.setAttribute("x",W/2),J.setAttribute("y",W/2),J.setAttribute("width",O-W),J.setAttribute("height",D-W),J.setAttribute("stroke-width",W||1),J.setAttribute("stroke","transparent"),J.setAttribute("fill","none"),z.appendChild(J),this.container.append(z),this._createPopup(J,g),this.container}}class c extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const g=this.data,O=g.rect[2]-g.rect[0],D=g.rect[3]-g.rect[1],z=this.svgFactory.create(O,D),W=g.borderStyle.width,J=this.svgFactory.createElement("svg:ellipse");return J.setAttribute("cx",O/2),J.setAttribute("cy",D/2),J.setAttribute("rx",O/2-W/2),J.setAttribute("ry",D/2-W/2),J.setAttribute("stroke-width",W||1),J.setAttribute("stroke","transparent"),J.setAttribute("fill","none"),z.appendChild(J),this.container.append(z),this._createPopup(J,g),this.container}}class p extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const g=this.data,O=g.rect[2]-g.rect[0],D=g.rect[3]-g.rect[1],z=this.svgFactory.create(O,D);let W=[];for(const ie of g.vertices){const ue=ie.x-g.rect[0],he=g.rect[3]-ie.y;W.push(ue+","+he)}W=W.join(" ");const J=this.svgFactory.createElement(this.svgElementName);return J.setAttribute("points",W),J.setAttribute("stroke-width",g.borderStyle.width||1),J.setAttribute("stroke","transparent"),J.setAttribute("fill","none"),z.appendChild(J),this.container.append(z),this._createPopup(J,g),this.container}}class m extends p{constructor(g){super(g),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class y extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class P extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const g=this.data,O=g.rect[2]-g.rect[0],D=g.rect[3]-g.rect[1],z=this.svgFactory.create(O,D);for(const W of g.inkLists){let J=[];for(const ue of W){const he=ue.x-g.rect[0],se=g.rect[3]-ue.y;J.push(`${he},${se}`)}J=J.join(" ");const ie=this.svgFactory.createElement(this.svgElementName);ie.setAttribute("points",J),ie.setAttribute("stroke-width",g.borderStyle.width||1),ie.setAttribute("stroke","transparent"),ie.setAttribute("fill","none"),this._createPopup(ie,g),z.appendChild(ie)}return this.container.append(z),this.container}}class F extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class R extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class B extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class V extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class Z extends h{constructor(g){const O=!!(g.data.hasPopup||g.data.title||g.data.contents);super(g,{isRenderable:O,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class ne extends h{constructor(g){var z;super(g,{isRenderable:!0});const{filename:O,content:D}=this.data.file;this.filename=(0,t.getFilenameFromUrl)(O),this.content=D,(z=this.linkService.eventBus)==null||z.dispatch("fileattachmentannotation",{source:this,id:(0,i.stringToPDFString)(O),filename:O,content:D})}render(){this.container.className="fileAttachmentAnnotation";const g=document.createElement("div");return g.style.height=this.container.style.height,g.style.width=this.container.style.width,g.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.title||this.data.contents)&&this._createPopup(g,this.data),this.container.appendChild(g),this.container}_download(){var g;(g=this.downloadManager)==null||g.openOrDownloadData(this.container,this.content,this.filename)}}class H{static render(g){const O=[],D=[];for(const z of g.annotations)if(z){if(z.annotationType===i.AnnotationType.POPUP){D.push(z);continue}O.push(z)}D.length&&O.push(...D);for(const z of O){const W=u.create({data:z,layer:g.div,page:g.page,viewport:g.viewport,linkService:g.linkService,downloadManager:g.downloadManager,imageResourcesPath:g.imageResourcesPath||"",renderInteractiveForms:g.renderInteractiveForms!==!1,svgFactory:new t.DOMSVGFactory,annotationStorage:g.annotationStorage||new s.AnnotationStorage,enableScripting:g.enableScripting,hasJSActions:g.hasJSActions,mouseState:g.mouseState||{isDown:!1}});if(W.isRenderable){const J=W.render();if(z.hidden&&(J.style.visibility="hidden"),Array.isArray(J))for(const ie of J)g.div.appendChild(ie);else W instanceof C?g.div.prepend(J):g.div.appendChild(J)}}}static update(g){const O=`matrix(${g.viewport.transform.join(",")})`;for(const D of g.annotations){const z=g.div.querySelectorAll(`[data-annotation-id="${D.id}"]`);z&&z.forEach(W=>{W.style.transform=O})}g.div.hidden=!1}}e.AnnotationLayer=H},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function a(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}class t{static CMYK_G([s,r,u,h]){return["G",1-Math.min(1,.3*s+.59*u+.11*r+h)]}static G_CMYK([s]){return["CMYK",0,0,0,1-s]}static G_RGB([s]){return["RGB",s,s,s]}static G_HTML([s]){const r=a(s);return`#${r}${r}${r}`}static RGB_G([s,r,u]){return["G",.3*s+.59*r+.11*u]}static RGB_HTML([s,r,u]){const h=a(s),o=a(r),d=a(u);return`#${h}${o}${d}`}static T_HTML(){return"#00000000"}static CMYK_RGB([s,r,u,h]){return["RGB",1-Math.min(1,s+h),1-Math.min(1,u+h),1-Math.min(1,r+h)]}static CMYK_HTML(s){return this.RGB_HTML(this.CMYK_RGB(s))}static RGB_CMYK([s,r,u]){const h=1-s,o=1-r,d=1-u,_=Math.min(h,o,d);return["CMYK",h,o,d,_]}}e.ColorConverters=t},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.renderTextLayer=void 0;var t=a(2);const i=function(){const o=new Map,d=/\S/;function _(l){return!d.test(l)}function b(l,c){const p=o.get(l);if(p)return p;c.save(),c.font=`30px ${l}`;const m=c.measureText("");let y=m.fontBoundingBoxAscent,P=Math.abs(m.fontBoundingBoxDescent);if(y){c.restore();const R=y/(y+P);return o.set(l,R),R}c.strokeStyle="red",c.clearRect(0,0,30,30),c.strokeText("g",0,0);let F=c.getImageData(0,0,30,30).data;P=0;for(let R=F.length-1-3;R>=0;R-=4)if(F[R]>0){P=Math.ceil(R/4/30);break}c.clearRect(0,0,30,30),c.strokeText("A",0,30),F=c.getImageData(0,0,30,30).data,y=0;for(let R=0,B=F.length;R<B;R+=4)if(F[R]>0){y=30-Math.floor(R/4/30);break}if(c.restore(),y){const R=y/(y+P);return o.set(l,R),R}return o.set(l,.8),.8}function f(l,c,p,m){const y=document.createElement("span"),P={angle:0,canvasWidth:0,isWhitespace:!1,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1};if(l._textDivs.push(y),_(c.str)){P.isWhitespace=!0,l._textDivProperties.set(y,P);return}const F=t.Util.transform(l._viewport.transform,c.transform);let R=Math.atan2(F[1],F[0]);const B=p[c.fontName];B.vertical&&(R+=Math.PI/2);const V=Math.hypot(F[2],F[3]),Z=V*b(B.fontFamily,m);let ne,H;R===0?(ne=F[4],H=F[5]-Z):(ne=F[4]+Z*Math.sin(R),H=F[5]-Z*Math.cos(R)),y.style.left=`${ne}px`,y.style.top=`${H}px`,y.style.fontSize=`${V}px`,y.style.fontFamily=B.fontFamily,y.textContent=c.str,y.dir=c.dir,l._fontInspectorEnabled&&(y.dataset.fontName=c.fontName),R!==0&&(P.angle=R*(180/Math.PI));let N=!1;if(c.str.length>1)N=!0;else if(c.transform[0]!==c.transform[3]){const g=Math.abs(c.transform[0]),O=Math.abs(c.transform[3]);g!==O&&Math.max(g,O)/Math.min(g,O)>1.5&&(N=!0)}if(N&&(B.vertical?P.canvasWidth=c.height*l._viewport.scale:P.canvasWidth=c.width*l._viewport.scale),l._textDivProperties.set(y,P),l._textContentStream&&l._layoutText(y),l._enhanceTextSelection){let g=1,O=0;R!==0&&(g=Math.cos(R),O=Math.sin(R));const D=(B.vertical?c.height:c.width)*l._viewport.scale,z=V;let W,J;R!==0?(W=[g,O,-O,g,ne,H],J=t.Util.getAxialAlignedBoundingBox([0,0,D,z],W)):J=[ne,H,ne+D,H+z],l._bounds.push({left:J[0],top:J[1],right:J[2],bottom:J[3],div:y,size:[D,z],m:W})}}function v(l){if(l._canceled)return;const c=l._textDivs,p=l._capability,m=c.length;if(m>1e5){l._renderingDone=!0,p.resolve();return}if(!l._textContentStream)for(let y=0;y<m;y++)l._layoutText(c[y]);l._renderingDone=!0,p.resolve()}function A(l,c,p){let m=0;for(let y=0;y<p;y++){const P=l[c++];P>0&&(m=m?Math.min(P,m):P)}return m}function x(l){const c=l._bounds,p=l._viewport,m=C(p.width,p.height,c);for(let y=0;y<m.length;y++){const P=c[y].div,F=l._textDivProperties.get(P);if(F.angle===0){F.paddingLeft=c[y].left-m[y].left,F.paddingTop=c[y].top-m[y].top,F.paddingRight=m[y].right-c[y].right,F.paddingBottom=m[y].bottom-c[y].bottom,l._textDivProperties.set(P,F);continue}const R=m[y],B=c[y],V=B.m,Z=V[0],ne=V[1],H=[[0,0],[0,B.size[1]],[B.size[0],0],B.size],N=new Float64Array(64);H.forEach(function(O,D){const z=t.Util.applyTransform(O,V);N[D+0]=Z&&(R.left-z[0])/Z,N[D+4]=ne&&(R.top-z[1])/ne,N[D+8]=Z&&(R.right-z[0])/Z,N[D+12]=ne&&(R.bottom-z[1])/ne,N[D+16]=ne&&(R.left-z[0])/-ne,N[D+20]=Z&&(R.top-z[1])/Z,N[D+24]=ne&&(R.right-z[0])/-ne,N[D+28]=Z&&(R.bottom-z[1])/Z,N[D+32]=Z&&(R.left-z[0])/-Z,N[D+36]=ne&&(R.top-z[1])/-ne,N[D+40]=Z&&(R.right-z[0])/-Z,N[D+44]=ne&&(R.bottom-z[1])/-ne,N[D+48]=ne&&(R.left-z[0])/ne,N[D+52]=Z&&(R.top-z[1])/-Z,N[D+56]=ne&&(R.right-z[0])/ne,N[D+60]=Z&&(R.bottom-z[1])/-Z});const g=1+Math.min(Math.abs(Z),Math.abs(ne));F.paddingLeft=A(N,32,16)/g,F.paddingTop=A(N,48,16)/g,F.paddingRight=A(N,0,16)/g,F.paddingBottom=A(N,16,16)/g,l._textDivProperties.set(P,F)}}function C(l,c,p){const m=p.map(function(P,F){return{x1:P.left,y1:P.top,x2:P.right,y2:P.bottom,index:F,x1New:void 0,x2New:void 0}});M(l,m);const y=new Array(p.length);return m.forEach(function(P){const F=P.index;y[F]={left:P.x1New,top:0,right:P.x2New,bottom:0}}),p.map(function(P,F){const R=y[F],B=m[F];B.x1=P.top,B.y1=l-R.right,B.x2=P.bottom,B.y2=l-R.left,B.index=F,B.x1New=void 0,B.x2New=void 0}),M(c,m),m.forEach(function(P){const F=P.index;y[F].top=P.x1New,y[F].bottom=P.x2New}),y}function M(l,c){c.sort(function(y,P){return y.x1-P.x1||y.index-P.index});const m=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];c.forEach(function(y){let P=0;for(;P<m.length&&m[P].end<=y.y1;)P++;let F=m.length-1;for(;F>=0&&m[F].start>=y.y2;)F--;let R,B,V,Z,ne=-1/0;for(V=P;V<=F;V++){R=m[V],B=R.boundary;let g;B.x2>y.x1?g=B.index>y.index?B.x1New:y.x1:B.x2New===void 0?g=(B.x2+y.x1)/2:g=B.x2New,g>ne&&(ne=g)}for(y.x1New=ne,V=P;V<=F;V++)R=m[V],B=R.boundary,B.x2New===void 0?B.x2>y.x1?B.index>y.index&&(B.x2New=B.x2):B.x2New=ne:B.x2New>ne&&(B.x2New=Math.max(ne,B.x2));const H=[];let N=null;for(V=P;V<=F;V++){R=m[V],B=R.boundary;const g=B.x2>y.x2?B:y;N===g?H[H.length-1].end=R.end:(H.push({start:R.start,end:R.end,boundary:g}),N=g)}for(m[P].start<y.y1&&(H[0].start=y.y1,H.unshift({start:m[P].start,end:y.y1,boundary:m[P].boundary})),y.y2<m[F].end&&(H[H.length-1].end=y.y2,H.push({start:y.y2,end:m[F].end,boundary:m[F].boundary})),V=P;V<=F;V++){if(R=m[V],B=R.boundary,B.x2New!==void 0)continue;let g=!1;for(Z=P-1;!g&&Z>=0&&m[Z].start>=B.y1;Z--)g=m[Z].boundary===B;for(Z=F+1;!g&&Z<m.length&&m[Z].end<=B.y2;Z++)g=m[Z].boundary===B;for(Z=0;!g&&Z<H.length;Z++)g=H[Z].boundary===B;g||(B.x2New=ne)}Array.prototype.splice.apply(m,[P,F-P+1].concat(H))}),m.forEach(function(y){const P=y.boundary;P.x2New===void 0&&(P.x2New=Math.max(l,P.x2))})}function I({textContent:l,textContentStream:c,container:p,viewport:m,textDivs:y,textContentItemsStr:P,enhanceTextSelection:F}){var R;this._textContent=l,this._textContentStream=c,this._container=p,this._document=p.ownerDocument,this._viewport=m,this._textDivs=y||[],this._textContentItemsStr=P||[],this._enhanceTextSelection=!!F,this._fontInspectorEnabled=!!((R=globalThis.FontInspector)!=null&&R.enabled),this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,t.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._capability.promise.finally(()=>{this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}I.prototype={get promise(){return this._capability.promise},cancel:function(){this._canceled=!0,this._reader&&(this._reader.cancel(new t.AbortException("TextLayer task cancelled.")),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))},_processItems(l,c){for(let p=0,m=l.length;p<m;p++)this._textContentItemsStr.push(l[p].str),f(this,l[p],c,this._layoutTextCtx)},_layoutText(l){const c=this._textDivProperties.get(l);if(c.isWhitespace)return;let p="";if(c.canvasWidth!==0){const{fontSize:m,fontFamily:y}=l.style;(m!==this._layoutTextLastFontSize||y!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${m} ${y}`,this._layoutTextLastFontSize=m,this._layoutTextLastFontFamily=y);const{width:P}=this._layoutTextCtx.measureText(l.textContent);P>0&&(c.scale=c.canvasWidth/P,p=`scaleX(${c.scale})`)}c.angle!==0&&(p=`rotate(${c.angle}deg) ${p}`),p.length>0&&(this._enhanceTextSelection&&(c.originalTransform=p),l.style.transform=p),this._textDivProperties.set(l,c),this._container.appendChild(l)},_render:function(c){const p=(0,t.createPromiseCapability)();let m=Object.create(null);const y=this._document.createElement("canvas");if(y.height=y.width=30,y.mozOpaque=!0,this._layoutTextCtx=y.getContext("2d",{alpha:!1}),this._textContent){const P=this._textContent.items,F=this._textContent.styles;this._processItems(P,F),p.resolve()}else if(this._textContentStream){const P=()=>{this._reader.read().then(({value:F,done:R})=>{if(R){p.resolve();return}Object.assign(m,F.styles),this._processItems(F.items,m),P()},p.reject)};this._reader=this._textContentStream.getReader(),P()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');p.promise.then(()=>{m=null,c?this._renderTimer=setTimeout(()=>{v(this),this._renderTimer=null},c):v(this)},this._capability.reject)},expandTextDivs:function(c){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(x(this),this._bounds=null);const p=[],m=[];for(let y=0,P=this._textDivs.length;y<P;y++){const F=this._textDivs[y],R=this._textDivProperties.get(F);R.isWhitespace||(c?(p.length=0,m.length=0,R.originalTransform&&p.push(R.originalTransform),R.paddingTop>0?(m.push(`${R.paddingTop}px`),p.push(`translateY(${-R.paddingTop}px)`)):m.push(0),R.paddingRight>0?m.push(`${R.paddingRight/R.scale}px`):m.push(0),R.paddingBottom>0?m.push(`${R.paddingBottom}px`):m.push(0),R.paddingLeft>0?(m.push(`${R.paddingLeft/R.scale}px`),p.push(`translateX(${-R.paddingLeft/R.scale}px)`)):m.push(0),F.style.padding=m.join(" "),p.length&&(F.style.transform=p.join(" "))):(F.style.padding=null,F.style.transform=R.originalTransform))}}};function w(l){const c=new I({textContent:l.textContent,textContentStream:l.textContentStream,container:l.container,viewport:l.viewport,textDivs:l.textDivs,textContentItemsStr:l.textContentItemsStr,enhanceTextSelection:l.enhanceTextSelection});return c._render(l.timeout),c}return w}();e.renderTextLayer=i},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var t=a(2),i=a(1),s=a(4);let r=function(){throw new Error("Not implemented: SVGGraphics")};e.SVGGraphics=r;{let v=function(w){let l=[];const c=[];for(const p of w){if(p.fn==="save"){l.push({fnId:92,fn:"group",items:[]}),c.push(l),l=l[l.length-1].items;continue}p.fn==="restore"?l=c.pop():l.push(p)}return l},A=function(w){if(Number.isInteger(w))return w.toString();const l=w.toFixed(10);let c=l.length-1;if(l[c]!=="0")return l;do c--;while(l[c]==="0");return l.substring(0,l[c]==="."?c:c+1)},x=function(w){if(w[4]===0&&w[5]===0){if(w[1]===0&&w[2]===0)return w[0]===1&&w[3]===1?"":`scale(${A(w[0])} ${A(w[3])})`;if(w[0]===w[3]&&w[1]===-w[2]){const l=Math.acos(w[0])*180/Math.PI;return`rotate(${A(l)})`}}else if(w[0]===1&&w[1]===0&&w[2]===0&&w[3]===1)return`translate(${A(w[4])} ${A(w[5])})`;return`matrix(${A(w[0])} ${A(w[1])} ${A(w[2])} ${A(w[3])} ${A(w[4])} ${A(w[5])})`};const u={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},h="http://www.w3.org/XML/1998/namespace",o="http://www.w3.org/1999/xlink",d=["butt","round","square"],_=["miter","round","bevel"],b=function(){const w=new Uint8Array([137,80,78,71,13,10,26,10]),l=12,c=new Int32Array(256);for(let B=0;B<256;B++){let V=B;for(let Z=0;Z<8;Z++)V&1?V=3988292384^V>>1&2147483647:V=V>>1&2147483647;c[B]=V}function p(B,V,Z){let ne=-1;for(let H=V;H<Z;H++){const N=(ne^B[H])&255,g=c[N];ne=ne>>>8^g}return ne^-1}function m(B,V,Z,ne){let H=ne;const N=V.length;Z[H]=N>>24&255,Z[H+1]=N>>16&255,Z[H+2]=N>>8&255,Z[H+3]=N&255,H+=4,Z[H]=B.charCodeAt(0)&255,Z[H+1]=B.charCodeAt(1)&255,Z[H+2]=B.charCodeAt(2)&255,Z[H+3]=B.charCodeAt(3)&255,H+=4,Z.set(V,H),H+=V.length;const g=p(Z,ne+4,H);Z[H]=g>>24&255,Z[H+1]=g>>16&255,Z[H+2]=g>>8&255,Z[H+3]=g&255}function y(B,V,Z){let ne=1,H=0;for(let N=V;N<Z;++N)ne=(ne+(B[N]&255))%65521,H=(H+ne)%65521;return H<<16|ne}function P(B){if(!s.isNodeJS)return F(B);try{let V;parseInt(process.versions.node)>=8?V=B:V=Buffer.from(B);const Z=require("zlib").deflateSync(V,{level:9});return Z instanceof Uint8Array?Z:new Uint8Array(Z)}catch(V){(0,t.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+V)}return F(B)}function F(B){let V=B.length;const Z=65535,ne=Math.ceil(V/Z),H=new Uint8Array(2+V+ne*5+4);let N=0;H[N++]=120,H[N++]=156;let g=0;for(;V>Z;)H[N++]=0,H[N++]=255,H[N++]=255,H[N++]=0,H[N++]=0,H.set(B.subarray(g,g+Z),N),N+=Z,g+=Z,V-=Z;H[N++]=1,H[N++]=V&255,H[N++]=V>>8&255,H[N++]=~V&65535&255,H[N++]=(~V&65535)>>8&255,H.set(B.subarray(g),N),N+=B.length-g;const O=y(B,0,B.length);return H[N++]=O>>24&255,H[N++]=O>>16&255,H[N++]=O>>8&255,H[N++]=O&255,H}function R(B,V,Z,ne){const H=B.width,N=B.height;let g,O,D;const z=B.data;switch(V){case t.ImageKind.GRAYSCALE_1BPP:O=0,g=1,D=H+7>>3;break;case t.ImageKind.RGB_24BPP:O=2,g=8,D=H*3;break;case t.ImageKind.RGBA_32BPP:O=6,g=8,D=H*4;break;default:throw new Error("invalid format")}const W=new Uint8Array((1+D)*N);let J=0,ie=0;for(let T=0;T<N;++T)W[J++]=0,W.set(z.subarray(ie,ie+D),J),ie+=D,J+=D;if(V===t.ImageKind.GRAYSCALE_1BPP&&ne){J=0;for(let T=0;T<N;T++){J++;for(let K=0;K<D;K++)W[J++]^=255}}const ue=new Uint8Array([H>>24&255,H>>16&255,H>>8&255,H&255,N>>24&255,N>>16&255,N>>8&255,N&255,g,O,0,0,0]),he=P(W),se=w.length+l*3+ue.length+he.length,de=new Uint8Array(se);let U=0;return de.set(w,U),U+=w.length,m("IHDR",ue,de,U),U+=l+ue.length,m("IDATA",he,de,U),U+=l+he.length,m("IEND",new Uint8Array(0),de,U),(0,t.createObjectURL)(de,"image/png",Z)}return function(V,Z,ne){const H=V.kind===void 0?t.ImageKind.GRAYSCALE_1BPP:V.kind;return R(V,H,Z,ne)}}();class f{constructor(){this.fontSizeScale=1,this.fontWeight=u.fontWeight,this.fontSize=0,this.textMatrix=t.IDENTITY_MATRIX,this.fontMatrix=t.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=t.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=u.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(l,c){this.x=l,this.y=c}}let C=0,M=0,I=0;e.SVGGraphics=r=class{constructor(l,c,p=!1){this.svgFactory=new i.DOMSVGFactory,this.current=new f,this.transformMatrix=t.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=l,this.objs=c,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!p,this._operatorIdMapping=[];for(const m in t.OPS)this._operatorIdMapping[t.OPS[m]]=m}save(){this.transformStack.push(this.transformMatrix);const l=this.current;this.extraStack.push(l),this.current=l.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(l){this.save(),this.executeOpTree(l),this.restore()}loadDependencies(l){const c=l.fnArray,p=l.argsArray;for(let m=0,y=c.length;m<y;m++)if(c[m]===t.OPS.dependency)for(const P of p[m]){const F=P.startsWith("g_")?this.commonObjs:this.objs,R=new Promise(B=>{F.get(P,B)});this.current.dependencies.push(R)}return Promise.all(this.current.dependencies)}transform(l,c,p,m,y,P){const F=[l,c,p,m,y,P];this.transformMatrix=t.Util.transform(this.transformMatrix,F),this.tgrp=null}getSVG(l,c){this.viewport=c;const p=this._initialize(c);return this.loadDependencies(l).then(()=>(this.transformMatrix=t.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(l)),p))}convertOpList(l){const c=this._operatorIdMapping,p=l.argsArray,m=l.fnArray,y=[];for(let P=0,F=m.length;P<F;P++){const R=m[P];y.push({fnId:R,fn:c[R],args:p[P]})}return v(y)}executeOpTree(l){for(const c of l){const p=c.fn,m=c.fnId,y=c.args;switch(m|0){case t.OPS.beginText:this.beginText();break;case t.OPS.dependency:break;case t.OPS.setLeading:this.setLeading(y);break;case t.OPS.setLeadingMoveText:this.setLeadingMoveText(y[0],y[1]);break;case t.OPS.setFont:this.setFont(y);break;case t.OPS.showText:this.showText(y[0]);break;case t.OPS.showSpacedText:this.showText(y[0]);break;case t.OPS.endText:this.endText();break;case t.OPS.moveText:this.moveText(y[0],y[1]);break;case t.OPS.setCharSpacing:this.setCharSpacing(y[0]);break;case t.OPS.setWordSpacing:this.setWordSpacing(y[0]);break;case t.OPS.setHScale:this.setHScale(y[0]);break;case t.OPS.setTextMatrix:this.setTextMatrix(y[0],y[1],y[2],y[3],y[4],y[5]);break;case t.OPS.setTextRise:this.setTextRise(y[0]);break;case t.OPS.setTextRenderingMode:this.setTextRenderingMode(y[0]);break;case t.OPS.setLineWidth:this.setLineWidth(y[0]);break;case t.OPS.setLineJoin:this.setLineJoin(y[0]);break;case t.OPS.setLineCap:this.setLineCap(y[0]);break;case t.OPS.setMiterLimit:this.setMiterLimit(y[0]);break;case t.OPS.setFillRGBColor:this.setFillRGBColor(y[0],y[1],y[2]);break;case t.OPS.setStrokeRGBColor:this.setStrokeRGBColor(y[0],y[1],y[2]);break;case t.OPS.setStrokeColorN:this.setStrokeColorN(y);break;case t.OPS.setFillColorN:this.setFillColorN(y);break;case t.OPS.shadingFill:this.shadingFill(y[0]);break;case t.OPS.setDash:this.setDash(y[0],y[1]);break;case t.OPS.setRenderingIntent:this.setRenderingIntent(y[0]);break;case t.OPS.setFlatness:this.setFlatness(y[0]);break;case t.OPS.setGState:this.setGState(y[0]);break;case t.OPS.fill:this.fill();break;case t.OPS.eoFill:this.eoFill();break;case t.OPS.stroke:this.stroke();break;case t.OPS.fillStroke:this.fillStroke();break;case t.OPS.eoFillStroke:this.eoFillStroke();break;case t.OPS.clip:this.clip("nonzero");break;case t.OPS.eoClip:this.clip("evenodd");break;case t.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case t.OPS.paintImageXObject:this.paintImageXObject(y[0]);break;case t.OPS.paintInlineImageXObject:this.paintInlineImageXObject(y[0]);break;case t.OPS.paintImageMaskXObject:this.paintImageMaskXObject(y[0]);break;case t.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(y[0],y[1]);break;case t.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case t.OPS.closePath:this.closePath();break;case t.OPS.closeStroke:this.closeStroke();break;case t.OPS.closeFillStroke:this.closeFillStroke();break;case t.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case t.OPS.nextLine:this.nextLine();break;case t.OPS.transform:this.transform(y[0],y[1],y[2],y[3],y[4],y[5]);break;case t.OPS.constructPath:this.constructPath(y[0],y[1]);break;case t.OPS.endPath:this.endPath();break;case 92:this.group(c.items);break;default:(0,t.warn)(`Unimplemented operator ${p}`);break}}}setWordSpacing(l){this.current.wordSpacing=l}setCharSpacing(l){this.current.charSpacing=l}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(l,c,p,m,y,P){const F=this.current;F.textMatrix=F.lineMatrix=[l,c,p,m,y,P],F.textMatrixScale=Math.hypot(l,c),F.x=F.lineX=0,F.y=F.lineY=0,F.xcoords=[],F.ycoords=[],F.tspan=this.svgFactory.createElement("svg:tspan"),F.tspan.setAttributeNS(null,"font-family",F.fontFamily),F.tspan.setAttributeNS(null,"font-size",`${A(F.fontSize)}px`),F.tspan.setAttributeNS(null,"y",A(-F.y)),F.txtElement=this.svgFactory.createElement("svg:text"),F.txtElement.appendChild(F.tspan)}beginText(){const l=this.current;l.x=l.lineX=0,l.y=l.lineY=0,l.textMatrix=t.IDENTITY_MATRIX,l.lineMatrix=t.IDENTITY_MATRIX,l.textMatrixScale=1,l.tspan=this.svgFactory.createElement("svg:tspan"),l.txtElement=this.svgFactory.createElement("svg:text"),l.txtgrp=this.svgFactory.createElement("svg:g"),l.xcoords=[],l.ycoords=[]}moveText(l,c){const p=this.current;p.x=p.lineX+=l,p.y=p.lineY+=c,p.xcoords=[],p.ycoords=[],p.tspan=this.svgFactory.createElement("svg:tspan"),p.tspan.setAttributeNS(null,"font-family",p.fontFamily),p.tspan.setAttributeNS(null,"font-size",`${A(p.fontSize)}px`),p.tspan.setAttributeNS(null,"y",A(-p.y))}showText(l){const c=this.current,p=c.font,m=c.fontSize;if(m===0)return;const y=c.fontSizeScale,P=c.charSpacing,F=c.wordSpacing,R=c.fontDirection,B=c.textHScale*R,V=p.vertical,Z=V?1:-1,ne=p.defaultVMetrics,H=m*c.fontMatrix[0];let N=0;for(const D of l){if(D===null){N+=R*F;continue}else if((0,t.isNum)(D)){N+=Z*D*m/1e3;continue}const z=(D.isSpace?F:0)+P,W=D.fontChar;let J,ie,ue=D.width;if(V){let se;const de=D.vmetric||ne;se=D.vmetric?de[1]:ue*.5,se=-se*H;const U=de[2]*H;ue=de?-de[0]:ue,J=se/y,ie=(N+U)/y}else J=N/y,ie=0;(D.isInFont||p.missingFile)&&(c.xcoords.push(c.x+J),V&&c.ycoords.push(-c.y+ie),c.tspan.textContent+=W);let he;V?he=ue*H-z*R:he=ue*H+z*R,N+=he}c.tspan.setAttributeNS(null,"x",c.xcoords.map(A).join(" ")),V?c.tspan.setAttributeNS(null,"y",c.ycoords.map(A).join(" ")):c.tspan.setAttributeNS(null,"y",A(-c.y)),V?c.y-=N:c.x+=N*B,c.tspan.setAttributeNS(null,"font-family",c.fontFamily),c.tspan.setAttributeNS(null,"font-size",`${A(c.fontSize)}px`),c.fontStyle!==u.fontStyle&&c.tspan.setAttributeNS(null,"font-style",c.fontStyle),c.fontWeight!==u.fontWeight&&c.tspan.setAttributeNS(null,"font-weight",c.fontWeight);const g=c.textRenderingMode&t.TextRenderingMode.FILL_STROKE_MASK;if(g===t.TextRenderingMode.FILL||g===t.TextRenderingMode.FILL_STROKE?(c.fillColor!==u.fillColor&&c.tspan.setAttributeNS(null,"fill",c.fillColor),c.fillAlpha<1&&c.tspan.setAttributeNS(null,"fill-opacity",c.fillAlpha)):c.textRenderingMode===t.TextRenderingMode.ADD_TO_PATH?c.tspan.setAttributeNS(null,"fill","transparent"):c.tspan.setAttributeNS(null,"fill","none"),g===t.TextRenderingMode.STROKE||g===t.TextRenderingMode.FILL_STROKE){const D=1/(c.textMatrixScale||1);this._setStrokeAttributes(c.tspan,D)}let O=c.textMatrix;c.textRise!==0&&(O=O.slice(),O[5]+=c.textRise),c.txtElement.setAttributeNS(null,"transform",`${x(O)} scale(${A(B)}, -1)`),c.txtElement.setAttributeNS(h,"xml:space","preserve"),c.txtElement.appendChild(c.tspan),c.txtgrp.appendChild(c.txtElement),this._ensureTransformGroup().appendChild(c.txtElement)}setLeadingMoveText(l,c){this.setLeading(-c),this.moveText(l,c)}addFontStyle(l){if(!l.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));const c=(0,t.createObjectURL)(l.data,l.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${l.loadedName}"; src: url(${c}); }
`}setFont(l){const c=this.current,p=this.commonObjs.get(l[0]);let m=l[1];c.font=p,this.embedFonts&&!p.missingFile&&!this.embeddedFonts[p.loadedName]&&(this.addFontStyle(p),this.embeddedFonts[p.loadedName]=p),c.fontMatrix=p.fontMatrix||t.FONT_IDENTITY_MATRIX;let y="normal";p.black?y="900":p.bold&&(y="bold");const P=p.italic?"italic":"normal";m<0?(m=-m,c.fontDirection=-1):c.fontDirection=1,c.fontSize=m,c.fontFamily=p.loadedName,c.fontWeight=y,c.fontStyle=P,c.tspan=this.svgFactory.createElement("svg:tspan"),c.tspan.setAttributeNS(null,"y",A(-c.y)),c.xcoords=[],c.ycoords=[]}endText(){var c;const l=this.current;l.textRenderingMode&t.TextRenderingMode.ADD_TO_PATH_FLAG&&((c=l.txtElement)!=null&&c.hasChildNodes())&&(l.element=l.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(l){l>0&&(this.current.lineWidth=l)}setLineCap(l){this.current.lineCap=d[l]}setLineJoin(l){this.current.lineJoin=_[l]}setMiterLimit(l){this.current.miterLimit=l}setStrokeAlpha(l){this.current.strokeAlpha=l}setStrokeRGBColor(l,c,p){this.current.strokeColor=t.Util.makeHexColor(l,c,p)}setFillAlpha(l){this.current.fillAlpha=l}setFillRGBColor(l,c,p){this.current.fillColor=t.Util.makeHexColor(l,c,p),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(l){this.current.strokeColor=this._makeColorN_Pattern(l)}setFillColorN(l){this.current.fillColor=this._makeColorN_Pattern(l)}shadingFill(l){const c=this.viewport.width,p=this.viewport.height,m=t.Util.inverseTransform(this.transformMatrix),y=t.Util.applyTransform([0,0],m),P=t.Util.applyTransform([0,p],m),F=t.Util.applyTransform([c,0],m),R=t.Util.applyTransform([c,p],m),B=Math.min(y[0],P[0],F[0],R[0]),V=Math.min(y[1],P[1],F[1],R[1]),Z=Math.max(y[0],P[0],F[0],R[0]),ne=Math.max(y[1],P[1],F[1],R[1]),H=this.svgFactory.createElement("svg:rect");H.setAttributeNS(null,"x",B),H.setAttributeNS(null,"y",V),H.setAttributeNS(null,"width",Z-B),H.setAttributeNS(null,"height",ne-V),H.setAttributeNS(null,"fill",this._makeShadingPattern(l)),this.current.fillAlpha<1&&H.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().appendChild(H)}_makeColorN_Pattern(l){return l[0]==="TilingPattern"?this._makeTilingPattern(l):this._makeShadingPattern(l)}_makeTilingPattern(l){const c=l[1],p=l[2],m=l[3]||t.IDENTITY_MATRIX,[y,P,F,R]=l[4],B=l[5],V=l[6],Z=l[7],ne=`shading${I++}`,[H,N]=t.Util.applyTransform([y,P],m),[g,O]=t.Util.applyTransform([F,R],m),[D,z]=t.Util.singularValueDecompose2dScale(m),W=B*D,J=V*z,ie=this.svgFactory.createElement("svg:pattern");ie.setAttributeNS(null,"id",ne),ie.setAttributeNS(null,"patternUnits","userSpaceOnUse"),ie.setAttributeNS(null,"width",W),ie.setAttributeNS(null,"height",J),ie.setAttributeNS(null,"x",`${H}`),ie.setAttributeNS(null,"y",`${N}`);const ue=this.svg,he=this.transformMatrix,se=this.current.fillColor,de=this.current.strokeColor,U=this.svgFactory.create(g-H,O-N);if(this.svg=U,this.transformMatrix=m,Z===2){const T=t.Util.makeHexColor(...c);this.current.fillColor=T,this.current.strokeColor=T}return this.executeOpTree(this.convertOpList(p)),this.svg=ue,this.transformMatrix=he,this.current.fillColor=se,this.current.strokeColor=de,ie.appendChild(U.childNodes[0]),this.defs.appendChild(ie),`url(#${ne})`}_makeShadingPattern(l){switch(l[0]){case"RadialAxial":const c=`shading${I++}`,p=l[3];let m;switch(l[1]){case"axial":const y=l[4],P=l[5];m=this.svgFactory.createElement("svg:linearGradient"),m.setAttributeNS(null,"id",c),m.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),m.setAttributeNS(null,"x1",y[0]),m.setAttributeNS(null,"y1",y[1]),m.setAttributeNS(null,"x2",P[0]),m.setAttributeNS(null,"y2",P[1]);break;case"radial":const F=l[4],R=l[5],B=l[6],V=l[7];m=this.svgFactory.createElement("svg:radialGradient"),m.setAttributeNS(null,"id",c),m.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),m.setAttributeNS(null,"cx",R[0]),m.setAttributeNS(null,"cy",R[1]),m.setAttributeNS(null,"r",V),m.setAttributeNS(null,"fx",F[0]),m.setAttributeNS(null,"fy",F[1]),m.setAttributeNS(null,"fr",B);break;default:throw new Error(`Unknown RadialAxial type: ${l[1]}`)}for(const y of p){const P=this.svgFactory.createElement("svg:stop");P.setAttributeNS(null,"offset",y[0]),P.setAttributeNS(null,"stop-color",y[1]),m.appendChild(P)}return this.defs.appendChild(m),`url(#${c})`;case"Mesh":return(0,t.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${l[0]}`)}}setDash(l,c){this.current.dashArray=l,this.current.dashPhase=c}constructPath(l,c){const p=this.current;let m=p.x,y=p.y,P=[],F=0;for(const R of l)switch(R|0){case t.OPS.rectangle:m=c[F++],y=c[F++];const B=c[F++],V=c[F++],Z=m+B,ne=y+V;P.push("M",A(m),A(y),"L",A(Z),A(y),"L",A(Z),A(ne),"L",A(m),A(ne),"Z");break;case t.OPS.moveTo:m=c[F++],y=c[F++],P.push("M",A(m),A(y));break;case t.OPS.lineTo:m=c[F++],y=c[F++],P.push("L",A(m),A(y));break;case t.OPS.curveTo:m=c[F+4],y=c[F+5],P.push("C",A(c[F]),A(c[F+1]),A(c[F+2]),A(c[F+3]),A(m),A(y)),F+=6;break;case t.OPS.curveTo2:P.push("C",A(m),A(y),A(c[F]),A(c[F+1]),A(c[F+2]),A(c[F+3])),m=c[F+2],y=c[F+3],F+=4;break;case t.OPS.curveTo3:m=c[F+2],y=c[F+3],P.push("C",A(c[F]),A(c[F+1]),A(m),A(y),A(m),A(y)),F+=4;break;case t.OPS.closePath:P.push("Z");break}P=P.join(" "),p.path&&l.length>0&&l[0]!==t.OPS.rectangle&&l[0]!==t.OPS.moveTo?P=p.path.getAttributeNS(null,"d")+P:(p.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().appendChild(p.path)),p.path.setAttributeNS(null,"d",P),p.path.setAttributeNS(null,"fill","none"),p.element=p.path,p.setCurrentPoint(m,y)}endPath(){const l=this.current;if(l.path=null,!this.pendingClip)return;if(!l.element){this.pendingClip=null;return}const c=`clippath${C++}`,p=this.svgFactory.createElement("svg:clipPath");p.setAttributeNS(null,"id",c),p.setAttributeNS(null,"transform",x(this.transformMatrix));const m=l.element.cloneNode(!0);this.pendingClip==="evenodd"?m.setAttributeNS(null,"clip-rule","evenodd"):m.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,p.appendChild(m),this.defs.appendChild(p),l.activeClipUrl&&(l.clipGroup=null,this.extraStack.forEach(function(y){y.clipGroup=null}),p.setAttributeNS(null,"clip-path",l.activeClipUrl)),l.activeClipUrl=`url(#${c})`,this.tgrp=null}clip(l){this.pendingClip=l}closePath(){const l=this.current;if(l.path){const c=`${l.path.getAttributeNS(null,"d")}Z`;l.path.setAttributeNS(null,"d",c)}}setLeading(l){this.current.leading=-l}setTextRise(l){this.current.textRise=l}setTextRenderingMode(l){this.current.textRenderingMode=l}setHScale(l){this.current.textHScale=l/100}setRenderingIntent(l){}setFlatness(l){}setGState(l){for(const[c,p]of l)switch(c){case"LW":this.setLineWidth(p);break;case"LC":this.setLineCap(p);break;case"LJ":this.setLineJoin(p);break;case"ML":this.setMiterLimit(p);break;case"D":this.setDash(p[0],p[1]);break;case"RI":this.setRenderingIntent(p);break;case"FL":this.setFlatness(p);break;case"Font":this.setFont(p);break;case"CA":this.setStrokeAlpha(p);break;case"ca":this.setFillAlpha(p);break;default:(0,t.warn)(`Unimplemented graphic state operator ${c}`);break}}fill(){const l=this.current;l.element&&(l.element.setAttributeNS(null,"fill",l.fillColor),l.element.setAttributeNS(null,"fill-opacity",l.fillAlpha),this.endPath())}stroke(){const l=this.current;l.element&&(this._setStrokeAttributes(l.element),l.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(l,c=1){const p=this.current;let m=p.dashArray;c!==1&&m.length>0&&(m=m.map(function(y){return c*y})),l.setAttributeNS(null,"stroke",p.strokeColor),l.setAttributeNS(null,"stroke-opacity",p.strokeAlpha),l.setAttributeNS(null,"stroke-miterlimit",A(p.miterLimit)),l.setAttributeNS(null,"stroke-linecap",p.lineCap),l.setAttributeNS(null,"stroke-linejoin",p.lineJoin),l.setAttributeNS(null,"stroke-width",A(c*p.lineWidth)+"px"),l.setAttributeNS(null,"stroke-dasharray",m.map(A).join(" ")),l.setAttributeNS(null,"stroke-dashoffset",A(c*p.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width","1px"),l.setAttributeNS(null,"height","1px"),l.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().appendChild(l)}paintImageXObject(l){const c=l.startsWith("g_")?this.commonObjs.get(l):this.objs.get(l);if(!c){(0,t.warn)(`Dependent image with object ID ${l} is not ready yet`);return}this.paintInlineImageXObject(c)}paintInlineImageXObject(l,c){const p=l.width,m=l.height,y=b(l,this.forceDataSchema,!!c),P=this.svgFactory.createElement("svg:rect");P.setAttributeNS(null,"x","0"),P.setAttributeNS(null,"y","0"),P.setAttributeNS(null,"width",A(p)),P.setAttributeNS(null,"height",A(m)),this.current.element=P,this.clip("nonzero");const F=this.svgFactory.createElement("svg:image");F.setAttributeNS(o,"xlink:href",y),F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y",A(-m)),F.setAttributeNS(null,"width",A(p)+"px"),F.setAttributeNS(null,"height",A(m)+"px"),F.setAttributeNS(null,"transform",`scale(${A(1/p)} ${A(-1/m)})`),c?c.appendChild(F):this._ensureTransformGroup().appendChild(F)}paintImageMaskXObject(l){const c=this.current,p=l.width,m=l.height,y=c.fillColor;c.maskId=`mask${M++}`;const P=this.svgFactory.createElement("svg:mask");P.setAttributeNS(null,"id",c.maskId);const F=this.svgFactory.createElement("svg:rect");F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y","0"),F.setAttributeNS(null,"width",A(p)),F.setAttributeNS(null,"height",A(m)),F.setAttributeNS(null,"fill",y),F.setAttributeNS(null,"mask",`url(#${c.maskId})`),this.defs.appendChild(P),this._ensureTransformGroup().appendChild(F),this.paintInlineImageXObject(l,P)}paintFormXObjectBegin(l,c){if(Array.isArray(l)&&l.length===6&&this.transform(l[0],l[1],l[2],l[3],l[4],l[5]),c){const p=c[2]-c[0],m=c[3]-c[1],y=this.svgFactory.createElement("svg:rect");y.setAttributeNS(null,"x",c[0]),y.setAttributeNS(null,"y",c[1]),y.setAttributeNS(null,"width",A(p)),y.setAttributeNS(null,"height",A(m)),this.current.element=y,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(l){const c=this.svgFactory.create(l.width,l.height),p=this.svgFactory.createElement("svg:defs");c.appendChild(p),this.defs=p;const m=this.svgFactory.createElement("svg:g");return m.setAttributeNS(null,"transform",x(l.transform)),c.appendChild(m),this.svg=m,c}_ensureClipGroup(){if(!this.current.clipGroup){const l=this.svgFactory.createElement("svg:g");l.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(l),this.current.clipGroup=l}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",x(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}}}},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;class a{static setAttributes(i,s){for(const[r,u]of Object.entries(s))u!=null&&(r!=="style"?i.setAttribute(r,u):Object.assign(i.style,u))}static render(i){const s=i.xfa,r=document.createElement(s.name);s.attributes&&a.setAttributes(r,s.attributes);const u=[[s,-1,r]],h=i.div;h.appendChild(r);const o=i.viewport.transform.join(",");for(h.style.transform=`matrix(${o})`,h.setAttribute("class","xfaLayer xfaFont");u.length>0;){const[d,_,b]=u[u.length-1];if(_+1===d.children.length){u.pop();continue}const f=d.children[++u[u.length-1][1]];if(f===null)continue;const{name:v}=f;if(v==="#text"){b.appendChild(document.createTextNode(f.value));continue}const A=document.createElement(v);b.appendChild(A),f.attributes&&a.setAttributes(A,f.attributes),f.children&&f.children.length>0?u.push([f,-1,A]):f.value&&A.appendChild(document.createTextNode(f.value))}}static update(i){const s=`matrix(${i.viewport.transform.join(",")})`;i.div.style.transform=s,i.div.hidden=!1}}e.XfaLayer=a},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var t=a(2),i=a(24);const s=require("fs"),r=require("http"),u=require("https"),h=require("url"),o=/^file:\/\/\/[a-zA-Z]:\//;function d(I){const w=h.parse(I);return w.protocol==="file:"||w.host?w:/^[a-z]:[/\\]/i.test(I)?h.parse(`file:///${I}`):(w.host||(w.protocol="file:"),w)}class _{constructor(w){this.source=w,this.url=d(w.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&w.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var w;return((w=this._fullRequestReader)==null?void 0:w._loaded)??0}getFullReader(){return(0,t.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new C(this):new A(this),this._fullRequestReader}getRangeReader(w,l){if(l<=this._progressiveDataLength)return null;const c=this.isFsUrl?new M(this,w,l):new x(this,w,l);return this._rangeRequestReaders.push(c),c}cancelAllRequests(w){this._fullRequestReader&&this._fullRequestReader.cancel(w),this._rangeRequestReaders.slice(0).forEach(function(c){c.cancel(w)})}}e.PDFNodeStream=_;class b{constructor(w){this._url=w.url,this._done=!1,this._storedError=null,this.onProgress=null;const l=w.source;this._contentLength=l.length,this._loaded=0,this._filename=null,this._disableRange=l.disableRange||!1,this._rangeChunkSize=l.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!l.disableStream,this._isRangeSupported=!l.disableRange,this._readableStream=null,this._readCapability=(0,t.createPromiseCapability)(),this._headersCapability=(0,t.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const w=this._readableStream.read();return w===null?(this._readCapability=(0,t.createPromiseCapability)(),this.read()):(this._loaded+=w.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(w).buffer,done:!1})}cancel(w){if(!this._readableStream){this._error(w);return}this._readableStream.destroy(w)}_error(w){this._storedError=w,this._readCapability.resolve()}_setReadableStream(w){this._readableStream=w,w.on("readable",()=>{this._readCapability.resolve()}),w.on("end",()=>{w.destroy(),this._done=!0,this._readCapability.resolve()}),w.on("error",l=>{this._error(l)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new t.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class f{constructor(w){this._url=w.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,t.createPromiseCapability)();const l=w.source;this._isStreamingSupported=!l.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const w=this._readableStream.read();return w===null?(this._readCapability=(0,t.createPromiseCapability)(),this.read()):(this._loaded+=w.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(w).buffer,done:!1})}cancel(w){if(!this._readableStream){this._error(w);return}this._readableStream.destroy(w)}_error(w){this._storedError=w,this._readCapability.resolve()}_setReadableStream(w){this._readableStream=w,w.on("readable",()=>{this._readCapability.resolve()}),w.on("end",()=>{w.destroy(),this._done=!0,this._readCapability.resolve()}),w.on("error",l=>{this._error(l)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function v(I,w){return{protocol:I.protocol,auth:I.auth,host:I.hostname,port:I.port,path:I.path,method:"GET",headers:w}}class A extends b{constructor(w){super(w);const l=c=>{if(c.statusCode===404){const P=new t.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=P,this._headersCapability.reject(P);return}this._headersCapability.resolve(),this._setReadableStream(c);const p=P=>this._readableStream.headers[P.toLowerCase()],{allowRangeRequests:m,suggestedLength:y}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:p,isHttp:w.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=m,this._contentLength=y||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(p)};this._request=null,this._url.protocol==="http:"?this._request=r.request(v(this._url,w.httpHeaders),l):this._request=u.request(v(this._url,w.httpHeaders),l),this._request.on("error",c=>{this._storedError=c,this._headersCapability.reject(c)}),this._request.end()}}class x extends f{constructor(w,l,c){super(w),this._httpHeaders={};for(const m in w.httpHeaders){const y=w.httpHeaders[m];typeof y>"u"||(this._httpHeaders[m]=y)}this._httpHeaders.Range=`bytes=${l}-${c-1}`;const p=m=>{if(m.statusCode===404){const y=new t.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=y;return}this._setReadableStream(m)};this._request=null,this._url.protocol==="http:"?this._request=r.request(v(this._url,this._httpHeaders),p):this._request=u.request(v(this._url,this._httpHeaders),p),this._request.on("error",m=>{this._storedError=m}),this._request.end()}}class C extends b{constructor(w){super(w);let l=decodeURIComponent(this._url.path);o.test(this._url.href)&&(l=l.replace(/^\//,"")),s.lstat(l,(c,p)=>{if(c){c.code==="ENOENT"&&(c=new t.MissingPDFException(`Missing PDF "${l}".`)),this._storedError=c,this._headersCapability.reject(c);return}this._contentLength=p.size,this._setReadableStream(s.createReadStream(l)),this._headersCapability.resolve()})}}class M extends f{constructor(w,l,c){super(w);let p=decodeURIComponent(this._url.path);o.test(this._url.href)&&(p=p.replace(/^\//,"")),this._setReadableStream(s.createReadStream(p,{start:l,end:c-1}))}}},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=h,e.extractFilenameFromHeader=u,e.validateRangeRequestCapabilities=r,e.validateResponseStatus=o;var t=a(2),i=a(25),s=a(1);function r({getResponseHeader:d,isHttp:_,rangeChunkSize:b,disableRange:f}){(0,t.assert)(b>0,"Range chunk size must be larger than zero");const v={allowRangeRequests:!1,suggestedLength:void 0},A=parseInt(d("Content-Length"),10);return!Number.isInteger(A)||(v.suggestedLength=A,A<=2*b)||f||!_||d("Accept-Ranges")!=="bytes"||(d("Content-Encoding")||"identity")!=="identity"||(v.allowRangeRequests=!0),v}function u(d){const _=d("Content-Disposition");if(_){let b=(0,i.getFilenameFromContentDispositionHeader)(_);if(b.includes("%"))try{b=decodeURIComponent(b)}catch{}if((0,s.isPdfFile)(b))return b}return null}function h(d,_){return d===404||d===0&&_.startsWith("file:")?new t.MissingPDFException('Missing PDF "'+_+'".'):new t.UnexpectedResponseException(`Unexpected server response (${d}) while retrieving PDF "${_}".`,d)}function o(d){return d===200||d===206}},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=a;function a(t){let i=!0,s=r("filename\\*","i").exec(t);if(s){s=s[1];let f=d(s);return f=unescape(f),f=_(f),f=b(f),h(f)}if(s=o(t),s){const f=b(s);return h(f)}if(s=r("filename","i").exec(t),s){s=s[1];let f=d(s);return f=b(f),h(f)}function r(f,v){return new RegExp("(?:^|;)\\s*"+f+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',v)}function u(f,v){if(f){if(!/^[\x00-\xFF]+$/.test(v))return v;try{const A=new TextDecoder(f,{fatal:!0}),x=Array.from(v,function(C){return C.charCodeAt(0)&255});v=A.decode(new Uint8Array(x)),i=!1}catch{if(/^utf-?8$/i.test(f))try{v=decodeURIComponent(escape(v)),i=!1}catch{}}}return v}function h(f){return i&&/[\x80-\xff]/.test(f)&&(f=u("utf-8",f),i&&(f=u("iso-8859-1",f))),f}function o(f){const v=[];let A;const x=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(A=x.exec(f))!==null;){let[,M,I,w]=A;if(M=parseInt(M,10),M in v){if(M===0)break;continue}v[M]=[I,w]}const C=[];for(let M=0;M<v.length&&M in v;++M){let[I,w]=v[M];w=d(w),I&&(w=unescape(w),M===0&&(w=_(w))),C.push(w)}return C.join("")}function d(f){if(f.startsWith('"')){const v=f.slice(1).split('\\"');for(let A=0;A<v.length;++A){const x=v[A].indexOf('"');x!==-1&&(v[A]=v[A].slice(0,x),v.length=A+1),v[A]=v[A].replace(/\\(.)/g,"$1")}f=v.join('"')}return f}function _(f){const v=f.indexOf("'");if(v===-1)return f;const A=f.slice(0,v),C=f.slice(v+1).replace(/^[^']*'/,"");return u(A,C)}function b(f){return!f.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(f)?f:f.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(v,A,x,C){if(x==="q"||x==="Q")return C=C.replace(/_/g," "),C=C.replace(/=([0-9a-fA-F]{2})/g,function(M,I){return String.fromCharCode(parseInt(I,16))}),u(A,C);try{C=atob(C)}catch{}return u(A,C)})}return""}},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var t=a(2),i=a(24);const s=200,r=206;function u(b){const f=b.response;return typeof f!="string"?f:(0,t.stringToBytes)(f).buffer}class h{constructor(f,v){this.url=f,v=v||{},this.isHttp=/^https?:/i.test(f),this.httpHeaders=this.isHttp&&v.httpHeaders||{},this.withCredentials=v.withCredentials||!1,this.getXhr=v.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(f,v,A){const x={begin:f,end:v};for(const C in A)x[C]=A[C];return this.request(x)}requestFull(f){return this.request(f)}request(f){const v=this.getXhr(),A=this.currXhrId++,x=this.pendingRequests[A]={xhr:v};v.open("GET",this.url),v.withCredentials=this.withCredentials;for(const C in this.httpHeaders){const M=this.httpHeaders[C];typeof M>"u"||v.setRequestHeader(C,M)}return this.isHttp&&"begin"in f&&"end"in f?(v.setRequestHeader("Range",`bytes=${f.begin}-${f.end-1}`),x.expectedStatus=r):x.expectedStatus=s,v.responseType="arraybuffer",f.onError&&(v.onerror=function(C){f.onError(v.status)}),v.onreadystatechange=this.onStateChange.bind(this,A),v.onprogress=this.onProgress.bind(this,A),x.onHeadersReceived=f.onHeadersReceived,x.onDone=f.onDone,x.onError=f.onError,x.onProgress=f.onProgress,v.send(null),A}onProgress(f,v){const A=this.pendingRequests[f];A&&A.onProgress&&A.onProgress(v)}onStateChange(f,v){const A=this.pendingRequests[f];if(!A)return;const x=A.xhr;if(x.readyState>=2&&A.onHeadersReceived&&(A.onHeadersReceived(),delete A.onHeadersReceived),x.readyState!==4||!(f in this.pendingRequests))return;if(delete this.pendingRequests[f],x.status===0&&this.isHttp){A.onError&&A.onError(x.status);return}const C=x.status||s;if(!(C===s&&A.expectedStatus===r)&&C!==A.expectedStatus){A.onError&&A.onError(x.status);return}const I=u(x);if(C===r){const w=x.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(w);A.onDone({begin:parseInt(l[1],10),chunk:I})}else I?A.onDone({begin:0,chunk:I}):A.onError&&A.onError(x.status)}getRequestXhr(f){return this.pendingRequests[f].xhr}isPendingRequest(f){return f in this.pendingRequests}abortRequest(f){const v=this.pendingRequests[f].xhr;delete this.pendingRequests[f],v.abort()}}class o{constructor(f){this._source=f,this._manager=new h(f.url,{httpHeaders:f.httpHeaders,withCredentials:f.withCredentials}),this._rangeChunkSize=f.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(f){const v=this._rangeRequestReaders.indexOf(f);v>=0&&this._rangeRequestReaders.splice(v,1)}getFullReader(){return(0,t.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new d(this._manager,this._source),this._fullRequestReader}getRangeReader(f,v){const A=new _(this._manager,f,v);return A.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(A),A}cancelAllRequests(f){this._fullRequestReader&&this._fullRequestReader.cancel(f),this._rangeRequestReaders.slice(0).forEach(function(A){A.cancel(f)})}}e.PDFNetworkStream=o;class d{constructor(f,v){this._manager=f;const A={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=v.url,this._fullRequestId=f.requestFull(A),this._headersReceivedCapability=(0,t.createPromiseCapability)(),this._disableRange=v.disableRange||!1,this._contentLength=v.length,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const f=this._fullRequestId,v=this._manager.getRequestXhr(f),A=M=>v.getResponseHeader(M),{allowRangeRequests:x,suggestedLength:C}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:A,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});x&&(this._isRangeSupported=!0),this._contentLength=C||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(A),this._isRangeSupported&&this._manager.abortRequest(f),this._headersReceivedCapability.resolve()}_onDone(f){f&&(this._requests.length>0?this._requests.shift().resolve({value:f.chunk,done:!1}):this._cachedChunks.push(f.chunk)),this._done=!0,!(this._cachedChunks.length>0)&&(this._requests.forEach(function(v){v.resolve({value:void 0,done:!0})}),this._requests=[])}_onError(f){const v=this._url,A=(0,i.createResponseStatusError)(f,v);this._storedError=A,this._headersReceivedCapability.reject(A),this._requests.forEach(function(x){x.reject(A)}),this._requests=[],this._cachedChunks=[]}_onProgress(f){this.onProgress&&this.onProgress({loaded:f.loaded,total:f.lengthComputable?f.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const f=(0,t.createPromiseCapability)();return this._requests.push(f),f.promise}cancel(f){this._done=!0,this._headersReceivedCapability.reject(f),this._requests.forEach(function(v){v.resolve({value:void 0,done:!0})}),this._requests=[],this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class _{constructor(f,v,A){this._manager=f;const x={onDone:this._onDone.bind(this),onProgress:this._onProgress.bind(this)};this._requestId=f.requestRange(v,A,x),this._requests=[],this._queuedChunk=null,this._done=!1,this.onProgress=null,this.onClosed=null}_close(){this.onClosed&&this.onClosed(this)}_onDone(f){const v=f.chunk;this._requests.length>0?this._requests.shift().resolve({value:v,done:!1}):this._queuedChunk=v,this._done=!0,this._requests.forEach(function(A){A.resolve({value:void 0,done:!0})}),this._requests=[],this._close()}_onProgress(f){!this.isStreamingSupported&&this.onProgress&&this.onProgress({loaded:f.loaded})}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk!==null){const v=this._queuedChunk;return this._queuedChunk=null,{value:v,done:!1}}if(this._done)return{value:void 0,done:!0};const f=(0,t.createPromiseCapability)();return this._requests.push(f),f.promise}cancel(f){this._done=!0,this._requests.forEach(function(v){v.resolve({value:void 0,done:!0})}),this._requests=[],this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(n,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var t=a(2),i=a(24);function s(d,_,b){return{method:"GET",headers:d,signal:b==null?void 0:b.signal,mode:"cors",credentials:_?"include":"same-origin",redirect:"follow"}}function r(d){const _=new Headers;for(const b in d){const f=d[b];typeof f>"u"||_.append(b,f)}return _}class u{constructor(_){this.source=_,this.isHttp=/^https?:/i.test(_.url),this.httpHeaders=this.isHttp&&_.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var _;return((_=this._fullRequestReader)==null?void 0:_._loaded)??0}getFullReader(){return(0,t.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new h(this),this._fullRequestReader}getRangeReader(_,b){if(b<=this._progressiveDataLength)return null;const f=new o(this,_,b);return this._rangeRequestReaders.push(f),f}cancelAllRequests(_){this._fullRequestReader&&this._fullRequestReader.cancel(_),this._rangeRequestReaders.slice(0).forEach(function(f){f.cancel(_)})}}e.PDFFetchStream=u;class h{constructor(_){this._stream=_,this._reader=null,this._loaded=0,this._filename=null;const b=_.source;this._withCredentials=b.withCredentials||!1,this._contentLength=b.length,this._headersCapability=(0,t.createPromiseCapability)(),this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),typeof AbortController<"u"&&(this._abortController=new AbortController),this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._headers=r(this._stream.httpHeaders);const f=b.url;fetch(f,s(this._headers,this._withCredentials,this._abortController)).then(v=>{if(!(0,i.validateResponseStatus)(v.status))throw(0,i.createResponseStatusError)(v.status,f);this._reader=v.body.getReader(),this._headersCapability.resolve();const A=M=>v.headers.get(M),{allowRangeRequests:x,suggestedLength:C}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:A,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=x,this._contentLength=C||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(A),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new t.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:_,done:b}=await this._reader.read();return b?{value:_,done:b}:(this._loaded+=_.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(_).buffer,done:!1})}cancel(_){this._reader&&this._reader.cancel(_),this._abortController&&this._abortController.abort()}}class o{constructor(_,b,f){this._stream=_,this._reader=null,this._loaded=0;const v=_.source;this._withCredentials=v.withCredentials||!1,this._readCapability=(0,t.createPromiseCapability)(),this._isStreamingSupported=!v.disableStream,typeof AbortController<"u"&&(this._abortController=new AbortController),this._headers=r(this._stream.httpHeaders),this._headers.append("Range",`bytes=${b}-${f-1}`);const A=v.url;fetch(A,s(this._headers,this._withCredentials,this._abortController)).then(x=>{if(!(0,i.validateResponseStatus)(x.status))throw(0,i.createResponseStatusError)(x.status,A);this._readCapability.resolve(),this._reader=x.body.getReader()}).catch(x=>{if((x==null?void 0:x.name)!=="AbortError")throw x}),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:_,done:b}=await this._reader.read();return b?{value:_,done:b}:(this._loaded+=_.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(_).buffer,done:!1})}cancel(_){this._reader&&this._reader.cancel(_),this._abortController&&this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(n){var e=__webpack_module_cache__[n];if(e!==void 0)return e.exports;var a=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](a,a.exports,__w_pdfjs_require__),a.exports}var __webpack_exports__={};return(()=>{var n=__webpack_exports__;Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"addLinkAttributes",{enumerable:!0,get:function(){return e.addLinkAttributes}}),Object.defineProperty(n,"getFilenameFromUrl",{enumerable:!0,get:function(){return e.getFilenameFromUrl}}),Object.defineProperty(n,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return e.getPdfFilenameFromUrl}}),Object.defineProperty(n,"isPdfFile",{enumerable:!0,get:function(){return e.isPdfFile}}),Object.defineProperty(n,"LinkTarget",{enumerable:!0,get:function(){return e.LinkTarget}}),Object.defineProperty(n,"loadScript",{enumerable:!0,get:function(){return e.loadScript}}),Object.defineProperty(n,"PDFDateString",{enumerable:!0,get:function(){return e.PDFDateString}}),Object.defineProperty(n,"RenderingCancelledException",{enumerable:!0,get:function(){return e.RenderingCancelledException}}),Object.defineProperty(n,"build",{enumerable:!0,get:function(){return a.build}}),Object.defineProperty(n,"getDocument",{enumerable:!0,get:function(){return a.getDocument}}),Object.defineProperty(n,"LoopbackPort",{enumerable:!0,get:function(){return a.LoopbackPort}}),Object.defineProperty(n,"PDFDataRangeTransport",{enumerable:!0,get:function(){return a.PDFDataRangeTransport}}),Object.defineProperty(n,"PDFWorker",{enumerable:!0,get:function(){return a.PDFWorker}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return a.version}}),Object.defineProperty(n,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(n,"createObjectURL",{enumerable:!0,get:function(){return t.createObjectURL}}),Object.defineProperty(n,"createPromiseCapability",{enumerable:!0,get:function(){return t.createPromiseCapability}}),Object.defineProperty(n,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(n,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(n,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(n,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(n,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(n,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(n,"removeNullCharacters",{enumerable:!0,get:function(){return t.removeNullCharacters}}),Object.defineProperty(n,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(n,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(n,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return t.UNSUPPORTED_FEATURES}}),Object.defineProperty(n,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(n,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(n,"AnnotationLayer",{enumerable:!0,get:function(){return i.AnnotationLayer}}),Object.defineProperty(n,"apiCompatibilityParams",{enumerable:!0,get:function(){return s.apiCompatibilityParams}}),Object.defineProperty(n,"GlobalWorkerOptions",{enumerable:!0,get:function(){return r.GlobalWorkerOptions}}),Object.defineProperty(n,"renderTextLayer",{enumerable:!0,get:function(){return u.renderTextLayer}}),Object.defineProperty(n,"SVGGraphics",{enumerable:!0,get:function(){return h.SVGGraphics}}),Object.defineProperty(n,"XfaLayer",{enumerable:!0,get:function(){return o.XfaLayer}});var e=__w_pdfjs_require__(1),a=__w_pdfjs_require__(5),t=__w_pdfjs_require__(2),i=__w_pdfjs_require__(18),s=__w_pdfjs_require__(9),r=__w_pdfjs_require__(12),u=__w_pdfjs_require__(20),h=__w_pdfjs_require__(21),o=__w_pdfjs_require__(22);{const{isNodeJS:d}=__w_pdfjs_require__(4);if(d){const _=__w_pdfjs_require__(23).PDFNodeStream;(0,a.setPDFNetworkStreamFactory)(b=>new _(b))}else{const _=__w_pdfjs_require__(26).PDFNetworkStream;let b;(0,e.isFetchSupported)()&&(b=__w_pdfjs_require__(27).PDFFetchStream),(0,a.setPDFNetworkStreamFactory)(f=>b&&(0,e.isValidFetchUrl)(f.url)?new b(f):new _(f))}}})(),__webpack_exports__})()});let exportAnyPalette;/**
 * Modules in this bundle
 * @license
 *
 * anypalette:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Isaiah Odhner <isaiahodhner@gmail.com>
 *   homepage: https://1j01.github.io/anypalette.js/
 *   version: 0.6.0
 *
 * base64-js:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: T. Jameson Little <t.jameson.little@gmail.com>
 *   homepage: https://github.com/beatgammit/base64-js
 *   version: 1.5.1
 *
 * browser-resolve:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Roman Shtylman <shtylman@gmail.com>
 *   homepage: https://github.com/browserify/browser-resolve#readme
 *   version: 2.0.0
 *
 * buffer:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Feross Aboukhadijeh <feross@feross.org>
 *   contributors: Romain Beauxis <toots@rastageeks.org>, James Halliday <mail@substack.net>
 *   homepage: https://github.com/feross/buffer
 *   version: 5.2.1
 *
 * css.escape:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Mathias Bynens
 *   homepage: https://mths.be/cssescape
 *   version: 1.5.1
 *
 * events:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Irakli Gozalishvili <rfobic@gmail.com>
 *   homepage: https://github.com/Gozala/events#readme
 *   version: 3.2.0
 *
 * ieee754:
 *   license: BSD-3-Clause (http://opensource.org/licenses/BSD-3-Clause)
 *   author: Feross Aboukhadijeh <feross@feross.org>
 *   contributors: Romain Beauxis <toots@rastageeks.org>
 *   homepage: https://github.com/feross/ieee754#readme
 *   version: 1.2.1
 *
 * inherits:
 *   license: ISC (http://opensource.org/licenses/ISC)
 *   homepage: https://github.com/isaacs/inherits#readme
 *   version: 2.0.4
 *
 * jdataview:
 *   licenses: WTFPL (http://www.wtfpl.net/about/)
 *   author: Vjeux <vjeuxx@gmail.com>
 *   contributors: Vjeux <vjeuxx@gmail.com>, RReverser <me@rreverser.com>
 *   homepage: http://jDataView.github.io/
 *   version: 2.5.0
 *
 * process:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Roman Shtylman <shtylman@gmail.com>
 *   homepage: https://github.com/shtylman/node-process#readme
 *   version: 0.11.10
 *
 * readable-stream:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   homepage: https://github.com/nodejs/readable-stream#readme
 *   version: 3.6.0
 *
 * safe-buffer:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Feross Aboukhadijeh <feross@feross.org>
 *   homepage: https://github.com/feross/safe-buffer
 *   version: 5.1.2
 *
 * sax:
 *   license: ISC (http://opensource.org/licenses/ISC)
 *   author: Isaac Z. Schlueter <i@izs.me>
 *   homepage: https://github.com/isaacs/sax-js#readme
 *   version: 1.2.4
 *
 * stream-browserify:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: James Halliday <mail@substack.net>
 *   homepage: https://github.com/browserify/stream-browserify
 *   version: 3.0.0
 *
 * string_decoder:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   homepage: https://github.com/nodejs/string_decoder
 *   version: 1.1.1
 *
 * util-deprecate:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Nathan Rajlich <nathan@tootallnate.net>
 *   homepage: https://github.com/TooTallNate/util-deprecate
 *   version: 1.0.2
 *
 * xml-js:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Yousuf Almarzooqi <ysf953@gmail.com>
 *   homepage: https://github.com/nashwaan/xml-js#readme
 *   version: 1.6.11
 *
 * This header is generated by licensify (https://github.com/twada/licensify)
 */(function(n){if(typeof exports=="object"&&typeof module<"u")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.AnyPalette=n()}})(function(){return function(){function n(e,a,t){function i(u,h){if(!a[u]){if(!e[u]){var o=typeof require=="function"&&require;if(!h&&o)return o(u,!0);if(s)return s(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var _=a[u]={exports:{}};e[u][0].call(_.exports,function(b){var f=e[u][1][b];return i(f||b)},_,_.exports,n,e,a,t)}return a[u].exports}for(var s=typeof require=="function"&&require,r=0;r<t.length;r++)i(t[r]);return i}return n}()({1:[function(n,e,a){a.byteLength=d,a.toByteArray=b,a.fromByteArray=A;for(var t=[],i=[],s=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,h=r.length;u<h;++u)t[u]=r[u],i[r.charCodeAt(u)]=u;i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63;function o(x){var C=x.length;if(C%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var M=x.indexOf("=");M===-1&&(M=C);var I=M===C?0:4-M%4;return[M,I]}function d(x){var C=o(x),M=C[0],I=C[1];return(M+I)*3/4-I}function _(x,C,M){return(C+M)*3/4-M}function b(x){var C,M=o(x),I=M[0],w=M[1],l=new s(_(x,I,w)),c=0,p=w>0?I-4:I,m;for(m=0;m<p;m+=4)C=i[x.charCodeAt(m)]<<18|i[x.charCodeAt(m+1)]<<12|i[x.charCodeAt(m+2)]<<6|i[x.charCodeAt(m+3)],l[c++]=C>>16&255,l[c++]=C>>8&255,l[c++]=C&255;return w===2&&(C=i[x.charCodeAt(m)]<<2|i[x.charCodeAt(m+1)]>>4,l[c++]=C&255),w===1&&(C=i[x.charCodeAt(m)]<<10|i[x.charCodeAt(m+1)]<<4|i[x.charCodeAt(m+2)]>>2,l[c++]=C>>8&255,l[c++]=C&255),l}function f(x){return t[x>>18&63]+t[x>>12&63]+t[x>>6&63]+t[x&63]}function v(x,C,M){for(var I,w=[],l=C;l<M;l+=3)I=(x[l]<<16&16711680)+(x[l+1]<<8&65280)+(x[l+2]&255),w.push(f(I));return w.join("")}function A(x){for(var C,M=x.length,I=M%3,w=[],l=16383,c=0,p=M-I;c<p;c+=l)w.push(v(x,c,c+l>p?p:c+l));return I===1?(C=x[M-1],w.push(t[C>>2]+t[C<<4&63]+"==")):I===2&&(C=(x[M-2]<<8)+x[M-1],w.push(t[C>>10]+t[C>>4&63]+t[C<<2&63]+"=")),w.join("")}},{}],2:[function(n,e,a){},{}],3:[function(n,e,a){(function(t){(function(){var i=n("base64-js"),s=n("ieee754");a.Buffer=o,a.SlowBuffer=I,a.INSPECT_MAX_BYTES=50;var r=2147483647;a.kMaxLength=r,o.TYPED_ARRAY_SUPPORT=u(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{var G=new Uint8Array(1);return G.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},G.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function h(G){if(G>r)throw new RangeError('The value "'+G+'" is invalid for option "size"');var S=new Uint8Array(G);return S.__proto__=o.prototype,S}function o(G,S,k){if(typeof G=="number"){if(typeof S=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(G)}return d(G,S,k)}typeof Symbol<"u"&&Symbol.species!=null&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.poolSize=8192;function d(G,S,k){if(typeof G=="string")return v(G,S);if(ArrayBuffer.isView(G))return A(G);if(G==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof G);if(q(G,ArrayBuffer)||G&&q(G.buffer,ArrayBuffer))return x(G,S,k);if(typeof G=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Q=G.valueOf&&G.valueOf();if(Q!=null&&Q!==G)return o.from(Q,S,k);var oe=C(G);if(oe)return oe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof G[Symbol.toPrimitive]=="function")return o.from(G[Symbol.toPrimitive]("string"),S,k);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof G)}o.from=function(G,S,k){return d(G,S,k)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array;function _(G){if(typeof G!="number")throw new TypeError('"size" argument must be of type number');if(G<0)throw new RangeError('The value "'+G+'" is invalid for option "size"')}function b(G,S,k){return _(G),G<=0?h(G):S!==void 0?typeof k=="string"?h(G).fill(S,k):h(G).fill(S):h(G)}o.alloc=function(G,S,k){return b(G,S,k)};function f(G){return _(G),h(G<0?0:M(G)|0)}o.allocUnsafe=function(G){return f(G)},o.allocUnsafeSlow=function(G){return f(G)};function v(G,S){if((typeof S!="string"||S==="")&&(S="utf8"),!o.isEncoding(S))throw new TypeError("Unknown encoding: "+S);var k=w(G,S)|0,Q=h(k),oe=Q.write(G,S);return oe!==k&&(Q=Q.slice(0,oe)),Q}function A(G){for(var S=G.length<0?0:M(G.length)|0,k=h(S),Q=0;Q<S;Q+=1)k[Q]=G[Q]&255;return k}function x(G,S,k){if(S<0||G.byteLength<S)throw new RangeError('"offset" is outside of buffer bounds');if(G.byteLength<S+(k||0))throw new RangeError('"length" is outside of buffer bounds');var Q;return S===void 0&&k===void 0?Q=new Uint8Array(G):k===void 0?Q=new Uint8Array(G,S):Q=new Uint8Array(G,S,k),Q.__proto__=o.prototype,Q}function C(G){if(o.isBuffer(G)){var S=M(G.length)|0,k=h(S);return k.length===0||G.copy(k,0,0,S),k}if(G.length!==void 0)return typeof G.length!="number"||ee(G.length)?h(0):A(G);if(G.type==="Buffer"&&Array.isArray(G.data))return A(G.data)}function M(G){if(G>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return G|0}function I(G){return+G!=G&&(G=0),o.alloc(+G)}o.isBuffer=function(S){return S!=null&&S._isBuffer===!0&&S!==o.prototype},o.compare=function(S,k){if(q(S,Uint8Array)&&(S=o.from(S,S.offset,S.byteLength)),q(k,Uint8Array)&&(k=o.from(k,k.offset,k.byteLength)),!o.isBuffer(S)||!o.isBuffer(k))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(S===k)return 0;for(var Q=S.length,oe=k.length,pe=0,ge=Math.min(Q,oe);pe<ge;++pe)if(S[pe]!==k[pe]){Q=S[pe],oe=k[pe];break}return Q<oe?-1:oe<Q?1:0},o.isEncoding=function(S){switch(String(S).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(S,k){if(!Array.isArray(S))throw new TypeError('"list" argument must be an Array of Buffers');if(S.length===0)return o.alloc(0);var Q;if(k===void 0)for(k=0,Q=0;Q<S.length;++Q)k+=S[Q].length;var oe=o.allocUnsafe(k),pe=0;for(Q=0;Q<S.length;++Q){var ge=S[Q];if(q(ge,Uint8Array)&&(ge=o.from(ge)),!o.isBuffer(ge))throw new TypeError('"list" argument must be an Array of Buffers');ge.copy(oe,pe),pe+=ge.length}return oe};function w(G,S){if(o.isBuffer(G))return G.length;if(ArrayBuffer.isView(G)||q(G,ArrayBuffer))return G.byteLength;if(typeof G!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof G);var k=G.length,Q=arguments.length>2&&arguments[2]===!0;if(!Q&&k===0)return 0;for(var oe=!1;;)switch(S){case"ascii":case"latin1":case"binary":return k;case"utf8":case"utf-8":return T(G).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k*2;case"hex":return k>>>1;case"base64":return fe(G).length;default:if(oe)return Q?-1:T(G).length;S=(""+S).toLowerCase(),oe=!0}}o.byteLength=w;function l(G,S,k){var Q=!1;if((S===void 0||S<0)&&(S=0),S>this.length||((k===void 0||k>this.length)&&(k=this.length),k<=0)||(k>>>=0,S>>>=0,k<=S))return"";for(G||(G="utf8");;)switch(G){case"hex":return D(this,S,k);case"utf8":case"utf-8":return ne(this,S,k);case"ascii":return g(this,S,k);case"latin1":case"binary":return O(this,S,k);case"base64":return Z(this,S,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,S,k);default:if(Q)throw new TypeError("Unknown encoding: "+G);G=(G+"").toLowerCase(),Q=!0}}o.prototype._isBuffer=!0;function c(G,S,k){var Q=G[S];G[S]=G[k],G[k]=Q}o.prototype.swap16=function(){var S=this.length;if(S%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var k=0;k<S;k+=2)c(this,k,k+1);return this},o.prototype.swap32=function(){var S=this.length;if(S%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var k=0;k<S;k+=4)c(this,k,k+3),c(this,k+1,k+2);return this},o.prototype.swap64=function(){var S=this.length;if(S%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var k=0;k<S;k+=8)c(this,k,k+7),c(this,k+1,k+6),c(this,k+2,k+5),c(this,k+3,k+4);return this},o.prototype.toString=function(){var S=this.length;return S===0?"":arguments.length===0?ne(this,0,S):l.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(S){if(!o.isBuffer(S))throw new TypeError("Argument must be a Buffer");return this===S?!0:o.compare(this,S)===0},o.prototype.inspect=function(){var S="",k=a.INSPECT_MAX_BYTES;return S=this.toString("hex",0,k).replace(/(.{2})/g,"$1 ").trim(),this.length>k&&(S+=" ... "),"<Buffer "+S+">"},o.prototype.compare=function(S,k,Q,oe,pe){if(q(S,Uint8Array)&&(S=o.from(S,S.offset,S.byteLength)),!o.isBuffer(S))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof S);if(k===void 0&&(k=0),Q===void 0&&(Q=S?S.length:0),oe===void 0&&(oe=0),pe===void 0&&(pe=this.length),k<0||Q>S.length||oe<0||pe>this.length)throw new RangeError("out of range index");if(oe>=pe&&k>=Q)return 0;if(oe>=pe)return-1;if(k>=Q)return 1;if(k>>>=0,Q>>>=0,oe>>>=0,pe>>>=0,this===S)return 0;for(var ge=pe-oe,Ae=Q-k,xe=Math.min(ge,Ae),Se=this.slice(oe,pe),Ce=S.slice(k,Q),Ee=0;Ee<xe;++Ee)if(Se[Ee]!==Ce[Ee]){ge=Se[Ee],Ae=Ce[Ee];break}return ge<Ae?-1:Ae<ge?1:0};function p(G,S,k,Q,oe){if(G.length===0)return-1;if(typeof k=="string"?(Q=k,k=0):k>2147483647?k=2147483647:k<-2147483648&&(k=-2147483648),k=+k,ee(k)&&(k=oe?0:G.length-1),k<0&&(k=G.length+k),k>=G.length){if(oe)return-1;k=G.length-1}else if(k<0)if(oe)k=0;else return-1;if(typeof S=="string"&&(S=o.from(S,Q)),o.isBuffer(S))return S.length===0?-1:m(G,S,k,Q,oe);if(typeof S=="number")return S=S&255,typeof Uint8Array.prototype.indexOf=="function"?oe?Uint8Array.prototype.indexOf.call(G,S,k):Uint8Array.prototype.lastIndexOf.call(G,S,k):m(G,[S],k,Q,oe);throw new TypeError("val must be string, number or Buffer")}function m(G,S,k,Q,oe){var pe=1,ge=G.length,Ae=S.length;if(Q!==void 0&&(Q=String(Q).toLowerCase(),Q==="ucs2"||Q==="ucs-2"||Q==="utf16le"||Q==="utf-16le")){if(G.length<2||S.length<2)return-1;pe=2,ge/=2,Ae/=2,k/=2}function xe(Re,Fe){return pe===1?Re[Fe]:Re.readUInt16BE(Fe*pe)}var Se;if(oe){var Ce=-1;for(Se=k;Se<ge;Se++)if(xe(G,Se)===xe(S,Ce===-1?0:Se-Ce)){if(Ce===-1&&(Ce=Se),Se-Ce+1===Ae)return Ce*pe}else Ce!==-1&&(Se-=Se-Ce),Ce=-1}else for(k+Ae>ge&&(k=ge-Ae),Se=k;Se>=0;Se--){for(var Ee=!0,Le=0;Le<Ae;Le++)if(xe(G,Se+Le)!==xe(S,Le)){Ee=!1;break}if(Ee)return Se}return-1}o.prototype.includes=function(S,k,Q){return this.indexOf(S,k,Q)!==-1},o.prototype.indexOf=function(S,k,Q){return p(this,S,k,Q,!0)},o.prototype.lastIndexOf=function(S,k,Q){return p(this,S,k,Q,!1)};function y(G,S,k,Q){k=Number(k)||0;var oe=G.length-k;Q?(Q=Number(Q),Q>oe&&(Q=oe)):Q=oe;var pe=S.length;Q>pe/2&&(Q=pe/2);for(var ge=0;ge<Q;++ge){var Ae=parseInt(S.substr(ge*2,2),16);if(ee(Ae))return ge;G[k+ge]=Ae}return ge}function P(G,S,k,Q){return we(T(S,G.length-k),G,k,Q)}function F(G,S,k,Q){return we(K(S),G,k,Q)}function R(G,S,k,Q){return F(G,S,k,Q)}function B(G,S,k,Q){return we(fe(S),G,k,Q)}function V(G,S,k,Q){return we(Y(S,G.length-k),G,k,Q)}o.prototype.write=function(S,k,Q,oe){if(k===void 0)oe="utf8",Q=this.length,k=0;else if(Q===void 0&&typeof k=="string")oe=k,Q=this.length,k=0;else if(isFinite(k))k=k>>>0,isFinite(Q)?(Q=Q>>>0,oe===void 0&&(oe="utf8")):(oe=Q,Q=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var pe=this.length-k;if((Q===void 0||Q>pe)&&(Q=pe),S.length>0&&(Q<0||k<0)||k>this.length)throw new RangeError("Attempt to write outside buffer bounds");oe||(oe="utf8");for(var ge=!1;;)switch(oe){case"hex":return y(this,S,k,Q);case"utf8":case"utf-8":return P(this,S,k,Q);case"ascii":return F(this,S,k,Q);case"latin1":case"binary":return R(this,S,k,Q);case"base64":return B(this,S,k,Q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,S,k,Q);default:if(ge)throw new TypeError("Unknown encoding: "+oe);oe=(""+oe).toLowerCase(),ge=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(G,S,k){return S===0&&k===G.length?i.fromByteArray(G):i.fromByteArray(G.slice(S,k))}function ne(G,S,k){k=Math.min(G.length,k);for(var Q=[],oe=S;oe<k;){var pe=G[oe],ge=null,Ae=pe>239?4:pe>223?3:pe>191?2:1;if(oe+Ae<=k){var xe,Se,Ce,Ee;switch(Ae){case 1:pe<128&&(ge=pe);break;case 2:xe=G[oe+1],(xe&192)===128&&(Ee=(pe&31)<<6|xe&63,Ee>127&&(ge=Ee));break;case 3:xe=G[oe+1],Se=G[oe+2],(xe&192)===128&&(Se&192)===128&&(Ee=(pe&15)<<12|(xe&63)<<6|Se&63,Ee>2047&&(Ee<55296||Ee>57343)&&(ge=Ee));break;case 4:xe=G[oe+1],Se=G[oe+2],Ce=G[oe+3],(xe&192)===128&&(Se&192)===128&&(Ce&192)===128&&(Ee=(pe&15)<<18|(xe&63)<<12|(Se&63)<<6|Ce&63,Ee>65535&&Ee<1114112&&(ge=Ee))}}ge===null?(ge=65533,Ae=1):ge>65535&&(ge-=65536,Q.push(ge>>>10&1023|55296),ge=56320|ge&1023),Q.push(ge),oe+=Ae}return N(Q)}var H=4096;function N(G){var S=G.length;if(S<=H)return String.fromCharCode.apply(String,G);for(var k="",Q=0;Q<S;)k+=String.fromCharCode.apply(String,G.slice(Q,Q+=H));return k}function g(G,S,k){var Q="";k=Math.min(G.length,k);for(var oe=S;oe<k;++oe)Q+=String.fromCharCode(G[oe]&127);return Q}function O(G,S,k){var Q="";k=Math.min(G.length,k);for(var oe=S;oe<k;++oe)Q+=String.fromCharCode(G[oe]);return Q}function D(G,S,k){var Q=G.length;(!S||S<0)&&(S=0),(!k||k<0||k>Q)&&(k=Q);for(var oe="",pe=S;pe<k;++pe)oe+=U(G[pe]);return oe}function z(G,S,k){for(var Q=G.slice(S,k),oe="",pe=0;pe<Q.length;pe+=2)oe+=String.fromCharCode(Q[pe]+Q[pe+1]*256);return oe}o.prototype.slice=function(S,k){var Q=this.length;S=~~S,k=k===void 0?Q:~~k,S<0?(S+=Q,S<0&&(S=0)):S>Q&&(S=Q),k<0?(k+=Q,k<0&&(k=0)):k>Q&&(k=Q),k<S&&(k=S);var oe=this.subarray(S,k);return oe.__proto__=o.prototype,oe};function W(G,S,k){if(G%1!==0||G<0)throw new RangeError("offset is not uint");if(G+S>k)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUIntLE=function(S,k,Q){S=S>>>0,k=k>>>0,Q||W(S,k,this.length);for(var oe=this[S],pe=1,ge=0;++ge<k&&(pe*=256);)oe+=this[S+ge]*pe;return oe},o.prototype.readUIntBE=function(S,k,Q){S=S>>>0,k=k>>>0,Q||W(S,k,this.length);for(var oe=this[S+--k],pe=1;k>0&&(pe*=256);)oe+=this[S+--k]*pe;return oe},o.prototype.readUInt8=function(S,k){return S=S>>>0,k||W(S,1,this.length),this[S]},o.prototype.readUInt16LE=function(S,k){return S=S>>>0,k||W(S,2,this.length),this[S]|this[S+1]<<8},o.prototype.readUInt16BE=function(S,k){return S=S>>>0,k||W(S,2,this.length),this[S]<<8|this[S+1]},o.prototype.readUInt32LE=function(S,k){return S=S>>>0,k||W(S,4,this.length),(this[S]|this[S+1]<<8|this[S+2]<<16)+this[S+3]*16777216},o.prototype.readUInt32BE=function(S,k){return S=S>>>0,k||W(S,4,this.length),this[S]*16777216+(this[S+1]<<16|this[S+2]<<8|this[S+3])},o.prototype.readIntLE=function(S,k,Q){S=S>>>0,k=k>>>0,Q||W(S,k,this.length);for(var oe=this[S],pe=1,ge=0;++ge<k&&(pe*=256);)oe+=this[S+ge]*pe;return pe*=128,oe>=pe&&(oe-=Math.pow(2,8*k)),oe},o.prototype.readIntBE=function(S,k,Q){S=S>>>0,k=k>>>0,Q||W(S,k,this.length);for(var oe=k,pe=1,ge=this[S+--oe];oe>0&&(pe*=256);)ge+=this[S+--oe]*pe;return pe*=128,ge>=pe&&(ge-=Math.pow(2,8*k)),ge},o.prototype.readInt8=function(S,k){return S=S>>>0,k||W(S,1,this.length),this[S]&128?(255-this[S]+1)*-1:this[S]},o.prototype.readInt16LE=function(S,k){S=S>>>0,k||W(S,2,this.length);var Q=this[S]|this[S+1]<<8;return Q&32768?Q|4294901760:Q},o.prototype.readInt16BE=function(S,k){S=S>>>0,k||W(S,2,this.length);var Q=this[S+1]|this[S]<<8;return Q&32768?Q|4294901760:Q},o.prototype.readInt32LE=function(S,k){return S=S>>>0,k||W(S,4,this.length),this[S]|this[S+1]<<8|this[S+2]<<16|this[S+3]<<24},o.prototype.readInt32BE=function(S,k){return S=S>>>0,k||W(S,4,this.length),this[S]<<24|this[S+1]<<16|this[S+2]<<8|this[S+3]},o.prototype.readFloatLE=function(S,k){return S=S>>>0,k||W(S,4,this.length),s.read(this,S,!0,23,4)},o.prototype.readFloatBE=function(S,k){return S=S>>>0,k||W(S,4,this.length),s.read(this,S,!1,23,4)},o.prototype.readDoubleLE=function(S,k){return S=S>>>0,k||W(S,8,this.length),s.read(this,S,!0,52,8)},o.prototype.readDoubleBE=function(S,k){return S=S>>>0,k||W(S,8,this.length),s.read(this,S,!1,52,8)};function J(G,S,k,Q,oe,pe){if(!o.isBuffer(G))throw new TypeError('"buffer" argument must be a Buffer instance');if(S>oe||S<pe)throw new RangeError('"value" argument is out of bounds');if(k+Q>G.length)throw new RangeError("Index out of range")}o.prototype.writeUIntLE=function(S,k,Q,oe){if(S=+S,k=k>>>0,Q=Q>>>0,!oe){var pe=Math.pow(2,8*Q)-1;J(this,S,k,Q,pe,0)}var ge=1,Ae=0;for(this[k]=S&255;++Ae<Q&&(ge*=256);)this[k+Ae]=S/ge&255;return k+Q},o.prototype.writeUIntBE=function(S,k,Q,oe){if(S=+S,k=k>>>0,Q=Q>>>0,!oe){var pe=Math.pow(2,8*Q)-1;J(this,S,k,Q,pe,0)}var ge=Q-1,Ae=1;for(this[k+ge]=S&255;--ge>=0&&(Ae*=256);)this[k+ge]=S/Ae&255;return k+Q},o.prototype.writeUInt8=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,1,255,0),this[k]=S&255,k+1},o.prototype.writeUInt16LE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,2,65535,0),this[k]=S&255,this[k+1]=S>>>8,k+2},o.prototype.writeUInt16BE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,2,65535,0),this[k]=S>>>8,this[k+1]=S&255,k+2},o.prototype.writeUInt32LE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,4,4294967295,0),this[k+3]=S>>>24,this[k+2]=S>>>16,this[k+1]=S>>>8,this[k]=S&255,k+4},o.prototype.writeUInt32BE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,4,4294967295,0),this[k]=S>>>24,this[k+1]=S>>>16,this[k+2]=S>>>8,this[k+3]=S&255,k+4},o.prototype.writeIntLE=function(S,k,Q,oe){if(S=+S,k=k>>>0,!oe){var pe=Math.pow(2,8*Q-1);J(this,S,k,Q,pe-1,-pe)}var ge=0,Ae=1,xe=0;for(this[k]=S&255;++ge<Q&&(Ae*=256);)S<0&&xe===0&&this[k+ge-1]!==0&&(xe=1),this[k+ge]=(S/Ae>>0)-xe&255;return k+Q},o.prototype.writeIntBE=function(S,k,Q,oe){if(S=+S,k=k>>>0,!oe){var pe=Math.pow(2,8*Q-1);J(this,S,k,Q,pe-1,-pe)}var ge=Q-1,Ae=1,xe=0;for(this[k+ge]=S&255;--ge>=0&&(Ae*=256);)S<0&&xe===0&&this[k+ge+1]!==0&&(xe=1),this[k+ge]=(S/Ae>>0)-xe&255;return k+Q},o.prototype.writeInt8=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,1,127,-128),S<0&&(S=255+S+1),this[k]=S&255,k+1},o.prototype.writeInt16LE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,2,32767,-32768),this[k]=S&255,this[k+1]=S>>>8,k+2},o.prototype.writeInt16BE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,2,32767,-32768),this[k]=S>>>8,this[k+1]=S&255,k+2},o.prototype.writeInt32LE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,4,2147483647,-2147483648),this[k]=S&255,this[k+1]=S>>>8,this[k+2]=S>>>16,this[k+3]=S>>>24,k+4},o.prototype.writeInt32BE=function(S,k,Q){return S=+S,k=k>>>0,Q||J(this,S,k,4,2147483647,-2147483648),S<0&&(S=4294967295+S+1),this[k]=S>>>24,this[k+1]=S>>>16,this[k+2]=S>>>8,this[k+3]=S&255,k+4};function ie(G,S,k,Q,oe,pe){if(k+Q>G.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("Index out of range")}function ue(G,S,k,Q,oe){return S=+S,k=k>>>0,oe||ie(G,S,k,4),s.write(G,S,k,Q,23,4),k+4}o.prototype.writeFloatLE=function(S,k,Q){return ue(this,S,k,!0,Q)},o.prototype.writeFloatBE=function(S,k,Q){return ue(this,S,k,!1,Q)};function he(G,S,k,Q,oe){return S=+S,k=k>>>0,oe||ie(G,S,k,8),s.write(G,S,k,Q,52,8),k+8}o.prototype.writeDoubleLE=function(S,k,Q){return he(this,S,k,!0,Q)},o.prototype.writeDoubleBE=function(S,k,Q){return he(this,S,k,!1,Q)},o.prototype.copy=function(S,k,Q,oe){if(!o.isBuffer(S))throw new TypeError("argument should be a Buffer");if(Q||(Q=0),!oe&&oe!==0&&(oe=this.length),k>=S.length&&(k=S.length),k||(k=0),oe>0&&oe<Q&&(oe=Q),oe===Q||S.length===0||this.length===0)return 0;if(k<0)throw new RangeError("targetStart out of bounds");if(Q<0||Q>=this.length)throw new RangeError("Index out of range");if(oe<0)throw new RangeError("sourceEnd out of bounds");oe>this.length&&(oe=this.length),S.length-k<oe-Q&&(oe=S.length-k+Q);var pe=oe-Q;if(this===S&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(k,Q,oe);else if(this===S&&Q<k&&k<oe)for(var ge=pe-1;ge>=0;--ge)S[ge+k]=this[ge+Q];else Uint8Array.prototype.set.call(S,this.subarray(Q,oe),k);return pe},o.prototype.fill=function(S,k,Q,oe){if(typeof S=="string"){if(typeof k=="string"?(oe=k,k=0,Q=this.length):typeof Q=="string"&&(oe=Q,Q=this.length),oe!==void 0&&typeof oe!="string")throw new TypeError("encoding must be a string");if(typeof oe=="string"&&!o.isEncoding(oe))throw new TypeError("Unknown encoding: "+oe);if(S.length===1){var pe=S.charCodeAt(0);(oe==="utf8"&&pe<128||oe==="latin1")&&(S=pe)}}else typeof S=="number"&&(S=S&255);if(k<0||this.length<k||this.length<Q)throw new RangeError("Out of range index");if(Q<=k)return this;k=k>>>0,Q=Q===void 0?this.length:Q>>>0,S||(S=0);var ge;if(typeof S=="number")for(ge=k;ge<Q;++ge)this[ge]=S;else{var Ae=o.isBuffer(S)?S:o.from(S,oe),xe=Ae.length;if(xe===0)throw new TypeError('The value "'+S+'" is invalid for argument "value"');for(ge=0;ge<Q-k;++ge)this[ge+k]=Ae[ge%xe]}return this};var se=/[^+/0-9A-Za-z-_]/g;function de(G){if(G=G.split("=")[0],G=G.trim().replace(se,""),G.length<2)return"";for(;G.length%4!==0;)G=G+"=";return G}function U(G){return G<16?"0"+G.toString(16):G.toString(16)}function T(G,S){S=S||1/0;for(var k,Q=G.length,oe=null,pe=[],ge=0;ge<Q;++ge){if(k=G.charCodeAt(ge),k>55295&&k<57344){if(!oe){if(k>56319){(S-=3)>-1&&pe.push(239,191,189);continue}else if(ge+1===Q){(S-=3)>-1&&pe.push(239,191,189);continue}oe=k;continue}if(k<56320){(S-=3)>-1&&pe.push(239,191,189),oe=k;continue}k=(oe-55296<<10|k-56320)+65536}else oe&&(S-=3)>-1&&pe.push(239,191,189);if(oe=null,k<128){if((S-=1)<0)break;pe.push(k)}else if(k<2048){if((S-=2)<0)break;pe.push(k>>6|192,k&63|128)}else if(k<65536){if((S-=3)<0)break;pe.push(k>>12|224,k>>6&63|128,k&63|128)}else if(k<1114112){if((S-=4)<0)break;pe.push(k>>18|240,k>>12&63|128,k>>6&63|128,k&63|128)}else throw new Error("Invalid code point")}return pe}function K(G){for(var S=[],k=0;k<G.length;++k)S.push(G.charCodeAt(k)&255);return S}function Y(G,S){for(var k,Q,oe,pe=[],ge=0;ge<G.length&&!((S-=2)<0);++ge)k=G.charCodeAt(ge),Q=k>>8,oe=k%256,pe.push(oe),pe.push(Q);return pe}function fe(G){return i.toByteArray(de(G))}function we(G,S,k,Q){for(var oe=0;oe<Q&&!(oe+k>=S.length||oe>=G.length);++oe)S[oe+k]=G[oe];return oe}function q(G,S){return G instanceof S||G!=null&&G.constructor!=null&&G.constructor.name!=null&&G.constructor.name===S.name}function ee(G){return G!==G}}).call(this)}).call(this,n("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:6}],4:[function(n,e,a){(function(t){(function(){(function(i,s){typeof a=="object"?e.exports=s(i):s(i)})(typeof t<"u"?t:this,function(i){if(i.CSS&&i.CSS.escape)return i.CSS.escape;var s=function(r){if(arguments.length==0)throw new TypeError("`CSS.escape` requires an argument.");for(var u=String(r),h=u.length,o=-1,d,_="",b=u.charCodeAt(0);++o<h;){if(d=u.charCodeAt(o),d==0){_+="�";continue}if(d>=1&&d<=31||d==127||o==0&&d>=48&&d<=57||o==1&&d>=48&&d<=57&&b==45){_+="\\"+d.toString(16)+" ";continue}if(o==0&&h==1&&d==45){_+="\\"+u.charAt(o);continue}if(d>=128||d==45||d==95||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122){_+=u.charAt(o);continue}_+="\\"+u.charAt(o)}return _};return i.CSS||(i.CSS={}),i.CSS.escape=s,s})}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],5:[function(n,e,a){var t=typeof Reflect=="object"?Reflect:null,i=t&&typeof t.apply=="function"?t.apply:function(c,p,m){return Function.prototype.apply.call(c,p,m)},s;t&&typeof t.ownKeys=="function"?s=t.ownKeys:Object.getOwnPropertySymbols?s=function(c){return Object.getOwnPropertyNames(c).concat(Object.getOwnPropertySymbols(c))}:s=function(c){return Object.getOwnPropertyNames(c)};function r(l){console&&console.warn&&console.warn(l)}var u=Number.isNaN||function(c){return c!==c};function h(){h.init.call(this)}e.exports=h,e.exports.once=w,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var o=10;function d(l){if(typeof l!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(l){if(typeof l!="number"||l<0||u(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");o=l}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(c){if(typeof c!="number"||c<0||u(c))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+c+".");return this._maxListeners=c,this};function _(l){return l._maxListeners===void 0?h.defaultMaxListeners:l._maxListeners}h.prototype.getMaxListeners=function(){return _(this)},h.prototype.emit=function(c){for(var p=[],m=1;m<arguments.length;m++)p.push(arguments[m]);var y=c==="error",P=this._events;if(P!==void 0)y=y&&P.error===void 0;else if(!y)return!1;if(y){var F;if(p.length>0&&(F=p[0]),F instanceof Error)throw F;var R=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw R.context=F,R}var B=P[c];if(B===void 0)return!1;if(typeof B=="function")i(B,this,p);else for(var V=B.length,Z=C(B,V),m=0;m<V;++m)i(Z[m],this,p);return!0};function b(l,c,p,m){var y,P,F;if(d(p),P=l._events,P===void 0?(P=l._events=Object.create(null),l._eventsCount=0):(P.newListener!==void 0&&(l.emit("newListener",c,p.listener?p.listener:p),P=l._events),F=P[c]),F===void 0)F=P[c]=p,++l._eventsCount;else if(typeof F=="function"?F=P[c]=m?[p,F]:[F,p]:m?F.unshift(p):F.push(p),y=_(l),y>0&&F.length>y&&!F.warned){F.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.emitter=l,R.type=c,R.count=F.length,r(R)}return l}h.prototype.addListener=function(c,p){return b(this,c,p,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(c,p){return b(this,c,p,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(l,c,p){var m={fired:!1,wrapFn:void 0,target:l,type:c,listener:p},y=f.bind(m);return y.listener=p,m.wrapFn=y,y}h.prototype.once=function(c,p){return d(p),this.on(c,v(this,c,p)),this},h.prototype.prependOnceListener=function(c,p){return d(p),this.prependListener(c,v(this,c,p)),this},h.prototype.removeListener=function(c,p){var m,y,P,F,R;if(d(p),y=this._events,y===void 0)return this;if(m=y[c],m===void 0)return this;if(m===p||m.listener===p)--this._eventsCount===0?this._events=Object.create(null):(delete y[c],y.removeListener&&this.emit("removeListener",c,m.listener||p));else if(typeof m!="function"){for(P=-1,F=m.length-1;F>=0;F--)if(m[F]===p||m[F].listener===p){R=m[F].listener,P=F;break}if(P<0)return this;P===0?m.shift():M(m,P),m.length===1&&(y[c]=m[0]),y.removeListener!==void 0&&this.emit("removeListener",c,R||p)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(c){var p,m,y;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[c]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[c]),this;if(arguments.length===0){var P=Object.keys(m),F;for(y=0;y<P.length;++y)F=P[y],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(p=m[c],typeof p=="function")this.removeListener(c,p);else if(p!==void 0)for(y=p.length-1;y>=0;y--)this.removeListener(c,p[y]);return this};function A(l,c,p){var m=l._events;if(m===void 0)return[];var y=m[c];return y===void 0?[]:typeof y=="function"?p?[y.listener||y]:[y]:p?I(y):C(y,y.length)}h.prototype.listeners=function(c){return A(this,c,!0)},h.prototype.rawListeners=function(c){return A(this,c,!1)},h.listenerCount=function(l,c){return typeof l.listenerCount=="function"?l.listenerCount(c):x.call(l,c)},h.prototype.listenerCount=x;function x(l){var c=this._events;if(c!==void 0){var p=c[l];if(typeof p=="function")return 1;if(p!==void 0)return p.length}return 0}h.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]};function C(l,c){for(var p=new Array(c),m=0;m<c;++m)p[m]=l[m];return p}function M(l,c){for(;c+1<l.length;c++)l[c]=l[c+1];l.pop()}function I(l){for(var c=new Array(l.length),p=0;p<c.length;++p)c[p]=l[p].listener||l[p];return c}function w(l,c){return new Promise(function(p,m){function y(){P!==void 0&&l.removeListener("error",P),p([].slice.call(arguments))}var P;c!=="error"&&(P=function(R){l.removeListener(c,y),m(R)},l.once("error",P)),l.once(c,y)})}},{}],6:[function(n,e,a){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */a.read=function(t,i,s,r,u){var h,o,d=u*8-r-1,_=(1<<d)-1,b=_>>1,f=-7,v=s?u-1:0,A=s?-1:1,x=t[i+v];for(v+=A,h=x&(1<<-f)-1,x>>=-f,f+=d;f>0;h=h*256+t[i+v],v+=A,f-=8);for(o=h&(1<<-f)-1,h>>=-f,f+=r;f>0;o=o*256+t[i+v],v+=A,f-=8);if(h===0)h=1-b;else{if(h===_)return o?NaN:(x?-1:1)*(1/0);o=o+Math.pow(2,r),h=h-b}return(x?-1:1)*o*Math.pow(2,h-r)},a.write=function(t,i,s,r,u,h){var o,d,_,b=h*8-u-1,f=(1<<b)-1,v=f>>1,A=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=r?0:h-1,C=r?1:-1,M=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(d=isNaN(i)?1:0,o=f):(o=Math.floor(Math.log(i)/Math.LN2),i*(_=Math.pow(2,-o))<1&&(o--,_*=2),o+v>=1?i+=A/_:i+=A*Math.pow(2,1-v),i*_>=2&&(o++,_/=2),o+v>=f?(d=0,o=f):o+v>=1?(d=(i*_-1)*Math.pow(2,u),o=o+v):(d=i*Math.pow(2,v-1)*Math.pow(2,u),o=0));u>=8;t[s+x]=d&255,x+=C,d/=256,u-=8);for(o=o<<u|d,b+=u;b>0;t[s+x]=o&255,x+=C,o/=256,b-=8);t[s+x-C]|=M*128}},{}],7:[function(n,e,a){(function(t){(function(){(function(i){var s=this;e.exports=i(s)})(function(i){function s(l,c){return typeof l!="object"||l===null?!1:l.constructor===c||Object.prototype.toString.call(l)==="[object "+c.name+"]"}function r(l,c){return!c&&s(l,Array)?l:Array.prototype.slice.call(l)}function u(l,c){return l!==void 0?l:c}function h(l,c,p,m){if(h.is(l)){var y=l.slice(c,c+p);return y._littleEndian=u(m,y._littleEndian),y}if(!h.is(this))return new h(l,c,p,m);if(this.buffer=l=h.wrapBuffer(l),this._isArrayBuffer=f.ArrayBuffer&&s(l,ArrayBuffer),this._isPixelData=!1,this._isDataView=f.DataView&&this._isArrayBuffer,this._isNodeBuffer=f.NodeBuffer&&s(l,t),!this._isNodeBuffer&&!this._isArrayBuffer&&!s(l,Array))throw new TypeError("jDataView buffer has an incompatible type");this._littleEndian=!!m;var P="byteLength"in l?l.byteLength:l.length;this.byteOffset=c=u(c,0),this.byteLength=p=u(p,P-c),this._offset=this._bitOffset=0,this._isDataView?this._view=new DataView(l,c,p):this._checkBounds(c,p,P),this._engineAction=this._isDataView?this._dataViewAction:this._isNodeBuffer?this._nodeBufferAction:this._isArrayBuffer?this._arrayBufferAction:this._arrayAction}function o(l){if(f.NodeBuffer)return new t(l,"binary");for(var c=f.ArrayBuffer?Uint8Array:Array,p=new c(l.length),m=0,y=l.length;y>m;m++)p[m]=255&l.charCodeAt(m);return p}function d(l){return l>=0&&31>l?1<<l:d[l]||(d[l]=Math.pow(2,l))}function _(l,c){this.lo=l,this.hi=c}function b(){_.apply(this,arguments)}var f={NodeBuffer:"Buffer"in window,DataView:"DataView"in window,ArrayBuffer:"ArrayBuffer"in window,PixelData:!1},v=window.TextEncoder,A=window.TextDecoder;f.NodeBuffer&&function(l){try{l.writeFloatLE(1/0,0)}catch{f.NodeBuffer=!1}}(new t(4));var x={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8};h.wrapBuffer=function(l){switch(typeof l){case"number":if(f.NodeBuffer)l=new t(l),l.fill(0);else if(f.ArrayBuffer)l=new Uint8Array(l).buffer;else{l=new Array(l);for(var c=0;c<l.length;c++)l[c]=0}return l;case"string":l=o(l);default:return"length"in l&&!(f.NodeBuffer&&s(l,t)||f.ArrayBuffer&&s(l,ArrayBuffer))&&(f.NodeBuffer?l=new t(l):f.ArrayBuffer?s(l,ArrayBuffer)||(l=new Uint8Array(l).buffer,s(l,ArrayBuffer)||(l=new Uint8Array(r(l,!0)).buffer)):l=r(l)),l}},h.is=function(l){return l&&l.jDataView},h.from=function(){return new h(arguments)},h.Uint64=_,_.prototype={valueOf:function(){return this.lo+d(32)*this.hi},toString:function(){return Number.prototype.toString.apply(this.valueOf(),arguments)}},_.fromNumber=function(l){var c=Math.floor(l/d(32)),p=l-c*d(32);return new _(p,c)},h.Int64=b,b.prototype="create"in Object?Object.create(_.prototype):new _,b.prototype.valueOf=function(){return this.hi<d(31)?_.prototype.valueOf.apply(this,arguments):-(d(32)-this.lo+d(32)*(d(32)-1-this.hi))},b.fromNumber=function(l){var c,p;if(l>=0){var m=_.fromNumber(l);c=m.lo,p=m.hi}else p=Math.floor(l/d(32)),c=l-p*d(32),p+=d(32);return new b(c,p)};var C=h.prototype={compatibility:f,jDataView:!0,_checkBounds:function(l,c,p){if(typeof l!="number")throw new TypeError("Offset is not a number.");if(typeof c!="number")throw new TypeError("Size is not a number.");if(0>c)throw new RangeError("Length is negative.");if(0>l||l+c>u(p,this.byteLength))throw new RangeError("Offsets are out of bounds.")},_action:function(l,c,p,m,y){return this._engineAction(l,c,u(p,this._offset),u(m,this._littleEndian),y)},_dataViewAction:function(l,c,p,m,y){return this._offset=p+x[l],c?this._view["get"+l](p,m):this._view["set"+l](p,y,m)},_arrayBufferAction:function(l,c,p,m,y){var P,F=x[l],R=i[l+"Array"];if(m=u(m,this._littleEndian),F===1||(this.byteOffset+p)%F===0&&m)return P=new R(this.buffer,this.byteOffset+p,1),this._offset=p+F,c?P[0]:P[0]=y;var B=new Uint8Array(c?this.getBytes(F,p,m,!0):F);return P=new R(B.buffer,0,1),c?P[0]:(P[0]=y,void this._setBytes(p,B,m))},_arrayAction:function(l,c,p,m,y){return c?this["_get"+l](p,m):this["_set"+l](p,y,m)},_getBytes:function(l,c,p){p=u(p,this._littleEndian),c=u(c,this._offset),l=u(l,this.byteLength-c),this._checkBounds(c,l),c+=this.byteOffset,this._offset=c-this.byteOffset+l;var m=this._isArrayBuffer?new Uint8Array(this.buffer,c,l):(this.buffer.slice||Array.prototype.slice).call(this.buffer,c,c+l);return p||1>=l?m:r(m).reverse()},getBytes:function(l,c,p,m){var y=this._getBytes(l,c,u(p,!0));return m?r(y):y},_setBytes:function(l,c,p){var m=c.length;if(m!==0){if(p=u(p,this._littleEndian),l=u(l,this._offset),this._checkBounds(l,m),!p&&m>1&&(c=r(c,!0).reverse()),l+=this.byteOffset,this._isArrayBuffer)new Uint8Array(this.buffer,l,m).set(c);else if(this._isNodeBuffer)new t(c).copy(this.buffer,l);else for(var y=0;m>y;y++)this.buffer[l+y]=c[y];this._offset=l-this.byteOffset+m}},setBytes:function(l,c,p){this._setBytes(l,c,u(p,!0))},getString:function(l,c,p){if(this._isNodeBuffer)return c=u(c,this._offset),l=u(l,this.byteLength-c),this._checkBounds(c,l),this._offset=c+l,this.buffer.toString(p||"binary",this.byteOffset+c,this.byteOffset+this._offset);var m=this._getBytes(l,c,!0);if(p=p==="utf8"?"utf-8":p||"binary",A&&p!=="binary")return new A(p).decode(this._isArrayBuffer?m:new Uint8Array(m));var y="";l=m.length;for(var P=0;l>P;P++)y+=String.fromCharCode(m[P]);return p==="utf-8"&&(y=decodeURIComponent(escape(y))),y},setString:function(l,c,p){if(this._isNodeBuffer)return l=u(l,this._offset),this._checkBounds(l,c.length),void(this._offset=l+this.buffer.write(c,this.byteOffset+l,p||"binary"));p=p==="utf8"?"utf-8":p||"binary";var m;v&&p!=="binary"?m=new v(p).encode(c):(p==="utf-8"&&(c=unescape(encodeURIComponent(c))),m=o(c)),this._setBytes(l,m,!0)},getChar:function(l){return this.getString(1,l)},setChar:function(l,c){this.setString(l,c)},tell:function(){return this._offset},seek:function(l){return this._checkBounds(l,0),this._offset=l},skip:function(l){return this.seek(this._offset+l)},slice:function(l,c,p){function m(y,P){return 0>y?y+P:y}return l=m(l,this.byteLength),c=m(u(c,this.byteLength),this.byteLength),p?new h(this.getBytes(c-l,l,!0,!0),void 0,void 0,this._littleEndian):new h(this.buffer,this.byteOffset+l,c-l,this._littleEndian)},alignBy:function(l){return this._bitOffset=0,u(l,1)!==1?this.skip(l-(this._offset%l||l)):this._offset},_getFloat64:function(l,c){var p=this._getBytes(8,l,c),m=1-2*(p[7]>>7),y=((p[7]<<1&255)<<3|p[6]>>4)-1023,P=(15&p[6])*d(48)+p[5]*d(40)+p[4]*d(32)+p[3]*d(24)+p[2]*d(16)+p[1]*d(8)+p[0];return y===1024?P!==0?0/0:1/0*m:y===-1023?m*P*d(-1074):m*(1+P*d(-52))*d(y)},_getFloat32:function(l,c){var p=this._getBytes(4,l,c),m=1-2*(p[3]>>7),y=(p[3]<<1&255|p[2]>>7)-127,P=(127&p[2])<<16|p[1]<<8|p[0];return y===128?P!==0?0/0:1/0*m:y===-127?m*P*d(-149):m*(1+P*d(-23))*d(y)},_get64:function(l,c,p){p=u(p,this._littleEndian),c=u(c,this._offset);for(var m=p?[0,4]:[4,0],y=0;2>y;y++)m[y]=this.getUint32(c+m[y],p);return this._offset=c+8,new l(m[0],m[1])},getInt64:function(l,c){return this._get64(b,l,c)},getUint64:function(l,c){return this._get64(_,l,c)},_getInt32:function(l,c){var p=this._getBytes(4,l,c);return p[3]<<24|p[2]<<16|p[1]<<8|p[0]},_getUint32:function(l,c){return this._getInt32(l,c)>>>0},_getInt16:function(l,c){return this._getUint16(l,c)<<16>>16},_getUint16:function(l,c){var p=this._getBytes(2,l,c);return p[1]<<8|p[0]},_getInt8:function(l){return this._getUint8(l)<<24>>24},_getUint8:function(l){return this._getBytes(1,l)[0]},_getBitRangeData:function(l,c){var p=(u(c,this._offset)<<3)+this._bitOffset,m=p+l,y=p>>>3,P=m+7>>>3,F=this._getBytes(P-y,y,!0),R=0;(this._bitOffset=7&m)&&(this._bitOffset-=8);for(var B=0,V=F.length;V>B;B++)R=R<<8|F[B];return{start:y,bytes:F,wideValue:R}},getSigned:function(l,c){var p=32-l;return this.getUnsigned(l,c)<<p>>p},getUnsigned:function(l,c){var p=this._getBitRangeData(l,c).wideValue>>>-this._bitOffset;return 32>l?p&~(-1<<l):p},_setBinaryFloat:function(l,c,p,m,y){var P,F,R=0>c?1:0,B=~(-1<<m-1),V=1-B;0>c&&(c=-c),c===0?(P=0,F=0):isNaN(c)?(P=2*B+1,F=1):1/0===c?(P=2*B+1,F=0):(P=Math.floor(Math.log(c)/Math.LN2),P>=V&&B>=P?(F=Math.floor((c*d(-P)-1)*d(p)),P+=B):(F=Math.floor(c/d(V-p)),P=0));for(var Z=[];p>=8;)Z.push(F%256),F=Math.floor(F/256),p-=8;for(P=P<<p|F,m+=p;m>=8;)Z.push(255&P),P>>>=8,m-=8;Z.push(R<<m|P),this._setBytes(l,Z,y)},_setFloat32:function(l,c,p){this._setBinaryFloat(l,c,23,8,p)},_setFloat64:function(l,c,p){this._setBinaryFloat(l,c,52,11,p)},_set64:function(l,c,p,m){typeof p!="object"&&(p=l.fromNumber(p)),m=u(m,this._littleEndian),c=u(c,this._offset);var y=m?{lo:0,hi:4}:{lo:4,hi:0};for(var P in y)this.setUint32(c+y[P],p[P],m);this._offset=c+8},setInt64:function(l,c,p){this._set64(b,l,c,p)},setUint64:function(l,c,p){this._set64(_,l,c,p)},_setUint32:function(l,c,p){this._setBytes(l,[255&c,c>>>8&255,c>>>16&255,c>>>24],p)},_setUint16:function(l,c,p){this._setBytes(l,[255&c,c>>>8&255],p)},_setUint8:function(l,c){this._setBytes(l,[255&c])},setUnsigned:function(l,c,p){var m=this._getBitRangeData(p,l),y=m.wideValue,P=m.bytes;y&=~(~(-1<<p)<<-this._bitOffset),y|=(32>p?c&~(-1<<p):c)<<-this._bitOffset;for(var F=P.length-1;F>=0;F--)P[F]=255&y,y>>>=8;this._setBytes(m.start,P,!0)}},M={Int8:"Int8",Int16:"Int16",Int32:"Int32",Uint8:"UInt8",Uint16:"UInt16",Uint32:"UInt32",Float32:"Float",Float64:"Double"};C._nodeBufferAction=function(l,c,p,m,y){this._offset=p+x[l];var P=M[l]+(l==="Int8"||l==="Uint8"?"":m?"LE":"BE");return p+=this.byteOffset,c?this.buffer["read"+P](p):this.buffer["write"+P](y,p)};for(var I in x)(function(l){C["get"+l]=function(c,p){return this._action(l,!0,c,p)},C["set"+l]=function(c,p,m){this._action(l,!1,c,m,p)}})(I);C._setInt32=C._setUint32,C._setInt16=C._setUint16,C._setInt8=C._setUint8,C.setSigned=C.setUnsigned;for(var w in C)w.slice(0,3)==="set"&&function(l){C["write"+l]=function(){Array.prototype.unshift.call(arguments,void 0),this["set"+l].apply(this,arguments)}}(w.slice(3));return h})}).call(this)}).call(this,n("buffer").Buffer)},{buffer:3}],8:[function(n,e,a){var t=e.exports={},i,s;function r(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?i=setTimeout:i=r}catch{i=r}try{typeof clearTimeout=="function"?s=clearTimeout:s=u}catch{s=u}})();function h(M){if(i===setTimeout)return setTimeout(M,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(M,0);try{return i(M,0)}catch{try{return i.call(null,M,0)}catch{return i.call(this,M,0)}}}function o(M){if(s===clearTimeout)return clearTimeout(M);if((s===u||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(M);try{return s(M)}catch{try{return s.call(null,M)}catch{return s.call(this,M)}}}var d=[],_=!1,b,f=-1;function v(){!_||!b||(_=!1,b.length?d=b.concat(d):f=-1,d.length&&A())}function A(){if(!_){var M=h(v);_=!0;for(var I=d.length;I;){for(b=d,d=[];++f<I;)b&&b[f].run();f=-1,I=d.length}b=null,_=!1,o(M)}}t.nextTick=function(M){var I=new Array(arguments.length-1);if(arguments.length>1)for(var w=1;w<arguments.length;w++)I[w-1]=arguments[w];d.push(new x(M,I)),d.length===1&&!_&&h(A)};function x(M,I){this.fun=M,this.array=I}x.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={};function C(){}t.on=C,t.addListener=C,t.once=C,t.off=C,t.removeListener=C,t.removeAllListeners=C,t.emit=C,t.prependListener=C,t.prependOnceListener=C,t.listeners=function(M){return[]},t.binding=function(M){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(M){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],9:[function(n,e,a){var t=n("buffer"),i=t.Buffer;function s(u,h){for(var o in u)h[o]=u[o]}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=t:(s(t,a),a.Buffer=r);function r(u,h,o){return i(u,h,o)}s(i,r),r.from=function(u,h,o){if(typeof u=="number")throw new TypeError("Argument must not be a number");return i(u,h,o)},r.alloc=function(u,h,o){if(typeof u!="number")throw new TypeError("Argument must be a number");var d=i(u);return h!==void 0?typeof o=="string"?d.fill(h,o):d.fill(h):d.fill(0),d},r.allocUnsafe=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return i(u)},r.allocUnsafeSlow=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(u)}},{buffer:3}],10:[function(n,e,a){(function(t){(function(){(function(i){i.parser=function(U,T){return new r(U,T)},i.SAXParser=r,i.SAXStream=f,i.createStream=b,i.MAX_BUFFER_LENGTH=64*1024;var s=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];i.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function r(U,T){if(!(this instanceof r))return new r(U,T);var K=this;h(K),K.q=K.c="",K.bufferCheckPosition=i.MAX_BUFFER_LENGTH,K.opt=T||{},K.opt.lowercase=K.opt.lowercase||K.opt.lowercasetags,K.looseCase=K.opt.lowercase?"toLowerCase":"toUpperCase",K.tags=[],K.closed=K.closedRoot=K.sawRoot=!1,K.tag=K.error=null,K.strict=!!U,K.noscript=!!(U||K.opt.noscript),K.state=R.BEGIN,K.strictEntities=K.opt.strictEntities,K.ENTITIES=K.strictEntities?Object.create(i.XML_ENTITIES):Object.create(i.ENTITIES),K.attribList=[],K.opt.xmlns&&(K.ns=Object.create(M)),K.trackPosition=K.opt.position!==!1,K.trackPosition&&(K.position=K.line=K.column=0),V(K,"onready")}Object.create||(Object.create=function(U){function T(){}T.prototype=U;var K=new T;return K}),Object.keys||(Object.keys=function(U){var T=[];for(var K in U)U.hasOwnProperty(K)&&T.push(K);return T});function u(U){for(var T=Math.max(i.MAX_BUFFER_LENGTH,10),K=0,Y=0,fe=s.length;Y<fe;Y++){var we=U[s[Y]].length;if(we>T)switch(s[Y]){case"textNode":ne(U);break;case"cdata":Z(U,"oncdata",U.cdata),U.cdata="";break;case"script":Z(U,"onscript",U.script),U.script="";break;default:N(U,"Max buffer length exceeded: "+s[Y])}K=Math.max(K,we)}var q=i.MAX_BUFFER_LENGTH-K;U.bufferCheckPosition=q+U.position}function h(U){for(var T=0,K=s.length;T<K;T++)U[s[T]]=""}function o(U){ne(U),U.cdata!==""&&(Z(U,"oncdata",U.cdata),U.cdata=""),U.script!==""&&(Z(U,"onscript",U.script),U.script="")}r.prototype={end:function(){g(this)},write:de,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){o(this)}};var d;try{d=n("stream").Stream}catch{d=function(){}}var _=i.EVENTS.filter(function(U){return U!=="error"&&U!=="end"});function b(U,T){return new f(U,T)}function f(U,T){if(!(this instanceof f))return new f(U,T);d.apply(this),this._parser=new r(U,T),this.writable=!0,this.readable=!0;var K=this;this._parser.onend=function(){K.emit("end")},this._parser.onerror=function(Y){K.emit("error",Y),K._parser.error=null},this._decoder=null,_.forEach(function(Y){Object.defineProperty(K,"on"+Y,{get:function(){return K._parser["on"+Y]},set:function(fe){if(!fe)return K.removeAllListeners(Y),K._parser["on"+Y]=fe,fe;K.on(Y,fe)},enumerable:!0,configurable:!1})})}f.prototype=Object.create(d.prototype,{constructor:{value:f}}),f.prototype.write=function(U){if(typeof t=="function"&&typeof t.isBuffer=="function"&&t.isBuffer(U)){if(!this._decoder){var T=n("string_decoder").StringDecoder;this._decoder=new T("utf8")}U=this._decoder.write(U)}return this._parser.write(U.toString()),this.emit("data",U),!0},f.prototype.end=function(U){return U&&U.length&&this.write(U),this._parser.end(),!0},f.prototype.on=function(U,T){var K=this;return!K._parser["on"+U]&&_.indexOf(U)!==-1&&(K._parser["on"+U]=function(){var Y=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);Y.splice(0,0,U),K.emit.apply(K,Y)}),d.prototype.on.call(K,U,T)};var v="[CDATA[",A="DOCTYPE",x="http://www.w3.org/XML/1998/namespace",C="http://www.w3.org/2000/xmlns/",M={xml:x,xmlns:C},I=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,w=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,l=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,c=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function p(U){return U===" "||U===`
`||U==="\r"||U==="	"}function m(U){return U==='"'||U==="'"}function y(U){return U===">"||p(U)}function P(U,T){return U.test(T)}function F(U,T){return!P(U,T)}var R=0;i.STATE={BEGIN:R++,BEGIN_WHITESPACE:R++,TEXT:R++,TEXT_ENTITY:R++,OPEN_WAKA:R++,SGML_DECL:R++,SGML_DECL_QUOTED:R++,DOCTYPE:R++,DOCTYPE_QUOTED:R++,DOCTYPE_DTD:R++,DOCTYPE_DTD_QUOTED:R++,COMMENT_STARTING:R++,COMMENT:R++,COMMENT_ENDING:R++,COMMENT_ENDED:R++,CDATA:R++,CDATA_ENDING:R++,CDATA_ENDING_2:R++,PROC_INST:R++,PROC_INST_BODY:R++,PROC_INST_ENDING:R++,OPEN_TAG:R++,OPEN_TAG_SLASH:R++,ATTRIB:R++,ATTRIB_NAME:R++,ATTRIB_NAME_SAW_WHITE:R++,ATTRIB_VALUE:R++,ATTRIB_VALUE_QUOTED:R++,ATTRIB_VALUE_CLOSED:R++,ATTRIB_VALUE_UNQUOTED:R++,ATTRIB_VALUE_ENTITY_Q:R++,ATTRIB_VALUE_ENTITY_U:R++,CLOSE_TAG:R++,CLOSE_TAG_SAW_WHITE:R++,SCRIPT:R++,SCRIPT_ENDING:R++},i.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},i.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(i.ENTITIES).forEach(function(U){var T=i.ENTITIES[U],K=typeof T=="number"?String.fromCharCode(T):T;i.ENTITIES[U]=K});for(var B in i.STATE)i.STATE[i.STATE[B]]=B;R=i.STATE;function V(U,T,K){U[T]&&U[T](K)}function Z(U,T,K){U.textNode&&ne(U),V(U,T,K)}function ne(U){U.textNode=H(U.opt,U.textNode),U.textNode&&V(U,"ontext",U.textNode),U.textNode=""}function H(U,T){return U.trim&&(T=T.trim()),U.normalize&&(T=T.replace(/\s+/g," ")),T}function N(U,T){return ne(U),U.trackPosition&&(T+=`
Line: `+U.line+`
Column: `+U.column+`
Char: `+U.c),T=new Error(T),U.error=T,V(U,"onerror",T),U}function g(U){return U.sawRoot&&!U.closedRoot&&O(U,"Unclosed root tag"),U.state!==R.BEGIN&&U.state!==R.BEGIN_WHITESPACE&&U.state!==R.TEXT&&N(U,"Unexpected end"),ne(U),U.c="",U.closed=!0,V(U,"onend"),r.call(U,U.strict,U.opt),U}function O(U,T){if(typeof U!="object"||!(U instanceof r))throw new Error("bad call to strictFail");U.strict&&N(U,T)}function D(U){U.strict||(U.tagName=U.tagName[U.looseCase]());var T=U.tags[U.tags.length-1]||U,K=U.tag={name:U.tagName,attributes:{}};U.opt.xmlns&&(K.ns=T.ns),U.attribList.length=0,Z(U,"onopentagstart",K)}function z(U,T){var K=U.indexOf(":"),Y=K<0?["",U]:U.split(":"),fe=Y[0],we=Y[1];return T&&U==="xmlns"&&(fe="xmlns",we=""),{prefix:fe,local:we}}function W(U){if(U.strict||(U.attribName=U.attribName[U.looseCase]()),U.attribList.indexOf(U.attribName)!==-1||U.tag.attributes.hasOwnProperty(U.attribName)){U.attribName=U.attribValue="";return}if(U.opt.xmlns){var T=z(U.attribName,!0),K=T.prefix,Y=T.local;if(K==="xmlns")if(Y==="xml"&&U.attribValue!==x)O(U,"xml: prefix must be bound to "+x+`
Actual: `+U.attribValue);else if(Y==="xmlns"&&U.attribValue!==C)O(U,"xmlns: prefix must be bound to "+C+`
Actual: `+U.attribValue);else{var fe=U.tag,we=U.tags[U.tags.length-1]||U;fe.ns===we.ns&&(fe.ns=Object.create(we.ns)),fe.ns[Y]=U.attribValue}U.attribList.push([U.attribName,U.attribValue])}else U.tag.attributes[U.attribName]=U.attribValue,Z(U,"onattribute",{name:U.attribName,value:U.attribValue});U.attribName=U.attribValue=""}function J(U,T){if(U.opt.xmlns){var K=U.tag,Y=z(U.tagName);K.prefix=Y.prefix,K.local=Y.local,K.uri=K.ns[Y.prefix]||"",K.prefix&&!K.uri&&(O(U,"Unbound namespace prefix: "+JSON.stringify(U.tagName)),K.uri=Y.prefix);var fe=U.tags[U.tags.length-1]||U;K.ns&&fe.ns!==K.ns&&Object.keys(K.ns).forEach(function(Ae){Z(U,"onopennamespace",{prefix:Ae,uri:K.ns[Ae]})});for(var we=0,q=U.attribList.length;we<q;we++){var ee=U.attribList[we],G=ee[0],S=ee[1],k=z(G,!0),Q=k.prefix,oe=k.local,pe=Q===""?"":K.ns[Q]||"",ge={name:G,value:S,prefix:Q,local:oe,uri:pe};Q&&Q!=="xmlns"&&!pe&&(O(U,"Unbound namespace prefix: "+JSON.stringify(Q)),ge.uri=Q),U.tag.attributes[G]=ge,Z(U,"onattribute",ge)}U.attribList.length=0}U.tag.isSelfClosing=!!T,U.sawRoot=!0,U.tags.push(U.tag),Z(U,"onopentag",U.tag),T||(!U.noscript&&U.tagName.toLowerCase()==="script"?U.state=R.SCRIPT:U.state=R.TEXT,U.tag=null,U.tagName=""),U.attribName=U.attribValue="",U.attribList.length=0}function ie(U){if(!U.tagName){O(U,"Weird empty close tag."),U.textNode+="</>",U.state=R.TEXT;return}if(U.script){if(U.tagName!=="script"){U.script+="</"+U.tagName+">",U.tagName="",U.state=R.SCRIPT;return}Z(U,"onscript",U.script),U.script=""}var T=U.tags.length,K=U.tagName;U.strict||(K=K[U.looseCase]());for(var Y=K;T--;){var fe=U.tags[T];if(fe.name!==Y)O(U,"Unexpected close tag");else break}if(T<0){O(U,"Unmatched closing tag: "+U.tagName),U.textNode+="</"+U.tagName+">",U.state=R.TEXT;return}U.tagName=K;for(var we=U.tags.length;we-- >T;){var q=U.tag=U.tags.pop();U.tagName=U.tag.name,Z(U,"onclosetag",U.tagName);var ee={};for(var G in q.ns)ee[G]=q.ns[G];var S=U.tags[U.tags.length-1]||U;U.opt.xmlns&&q.ns!==S.ns&&Object.keys(q.ns).forEach(function(k){var Q=q.ns[k];Z(U,"onclosenamespace",{prefix:k,uri:Q})})}T===0&&(U.closedRoot=!0),U.tagName=U.attribValue=U.attribName="",U.attribList.length=0,U.state=R.TEXT}function ue(U){var T=U.entity,K=T.toLowerCase(),Y,fe="";return U.ENTITIES[T]?U.ENTITIES[T]:U.ENTITIES[K]?U.ENTITIES[K]:(T=K,T.charAt(0)==="#"&&(T.charAt(1)==="x"?(T=T.slice(2),Y=parseInt(T,16),fe=Y.toString(16)):(T=T.slice(1),Y=parseInt(T,10),fe=Y.toString(10))),T=T.replace(/^0+/,""),isNaN(Y)||fe.toLowerCase()!==T?(O(U,"Invalid character entity"),"&"+U.entity+";"):String.fromCodePoint(Y))}function he(U,T){T==="<"?(U.state=R.OPEN_WAKA,U.startTagPosition=U.position):p(T)||(O(U,"Non-whitespace before first tag."),U.textNode=T,U.state=R.TEXT)}function se(U,T){var K="";return T<U.length&&(K=U.charAt(T)),K}function de(U){var T=this;if(this.error)throw this.error;if(T.closed)return N(T,"Cannot write after close. Assign an onready handler.");if(U===null)return g(T);typeof U=="object"&&(U=U.toString());for(var K=0,Y="";Y=se(U,K++),T.c=Y,!!Y;)switch(T.trackPosition&&(T.position++,Y===`
`?(T.line++,T.column=0):T.column++),T.state){case R.BEGIN:if(T.state=R.BEGIN_WHITESPACE,Y==="\uFEFF")continue;he(T,Y);continue;case R.BEGIN_WHITESPACE:he(T,Y);continue;case R.TEXT:if(T.sawRoot&&!T.closedRoot){for(var fe=K-1;Y&&Y!=="<"&&Y!=="&";)Y=se(U,K++),Y&&T.trackPosition&&(T.position++,Y===`
`?(T.line++,T.column=0):T.column++);T.textNode+=U.substring(fe,K-1)}Y==="<"&&!(T.sawRoot&&T.closedRoot&&!T.strict)?(T.state=R.OPEN_WAKA,T.startTagPosition=T.position):(!p(Y)&&(!T.sawRoot||T.closedRoot)&&O(T,"Text data outside of root node."),Y==="&"?T.state=R.TEXT_ENTITY:T.textNode+=Y);continue;case R.SCRIPT:Y==="<"?T.state=R.SCRIPT_ENDING:T.script+=Y;continue;case R.SCRIPT_ENDING:Y==="/"?T.state=R.CLOSE_TAG:(T.script+="<"+Y,T.state=R.SCRIPT);continue;case R.OPEN_WAKA:if(Y==="!")T.state=R.SGML_DECL,T.sgmlDecl="";else if(!p(Y))if(P(I,Y))T.state=R.OPEN_TAG,T.tagName=Y;else if(Y==="/")T.state=R.CLOSE_TAG,T.tagName="";else if(Y==="?")T.state=R.PROC_INST,T.procInstName=T.procInstBody="";else{if(O(T,"Unencoded <"),T.startTagPosition+1<T.position){var we=T.position-T.startTagPosition;Y=new Array(we).join(" ")+Y}T.textNode+="<"+Y,T.state=R.TEXT}continue;case R.SGML_DECL:(T.sgmlDecl+Y).toUpperCase()===v?(Z(T,"onopencdata"),T.state=R.CDATA,T.sgmlDecl="",T.cdata=""):T.sgmlDecl+Y==="--"?(T.state=R.COMMENT,T.comment="",T.sgmlDecl=""):(T.sgmlDecl+Y).toUpperCase()===A?(T.state=R.DOCTYPE,(T.doctype||T.sawRoot)&&O(T,"Inappropriately located doctype declaration"),T.doctype="",T.sgmlDecl=""):Y===">"?(Z(T,"onsgmldeclaration",T.sgmlDecl),T.sgmlDecl="",T.state=R.TEXT):(m(Y)&&(T.state=R.SGML_DECL_QUOTED),T.sgmlDecl+=Y);continue;case R.SGML_DECL_QUOTED:Y===T.q&&(T.state=R.SGML_DECL,T.q=""),T.sgmlDecl+=Y;continue;case R.DOCTYPE:Y===">"?(T.state=R.TEXT,Z(T,"ondoctype",T.doctype),T.doctype=!0):(T.doctype+=Y,Y==="["?T.state=R.DOCTYPE_DTD:m(Y)&&(T.state=R.DOCTYPE_QUOTED,T.q=Y));continue;case R.DOCTYPE_QUOTED:T.doctype+=Y,Y===T.q&&(T.q="",T.state=R.DOCTYPE);continue;case R.DOCTYPE_DTD:T.doctype+=Y,Y==="]"?T.state=R.DOCTYPE:m(Y)&&(T.state=R.DOCTYPE_DTD_QUOTED,T.q=Y);continue;case R.DOCTYPE_DTD_QUOTED:T.doctype+=Y,Y===T.q&&(T.state=R.DOCTYPE_DTD,T.q="");continue;case R.COMMENT:Y==="-"?T.state=R.COMMENT_ENDING:T.comment+=Y;continue;case R.COMMENT_ENDING:Y==="-"?(T.state=R.COMMENT_ENDED,T.comment=H(T.opt,T.comment),T.comment&&Z(T,"oncomment",T.comment),T.comment=""):(T.comment+="-"+Y,T.state=R.COMMENT);continue;case R.COMMENT_ENDED:Y!==">"?(O(T,"Malformed comment"),T.comment+="--"+Y,T.state=R.COMMENT):T.state=R.TEXT;continue;case R.CDATA:Y==="]"?T.state=R.CDATA_ENDING:T.cdata+=Y;continue;case R.CDATA_ENDING:Y==="]"?T.state=R.CDATA_ENDING_2:(T.cdata+="]"+Y,T.state=R.CDATA);continue;case R.CDATA_ENDING_2:Y===">"?(T.cdata&&Z(T,"oncdata",T.cdata),Z(T,"onclosecdata"),T.cdata="",T.state=R.TEXT):Y==="]"?T.cdata+="]":(T.cdata+="]]"+Y,T.state=R.CDATA);continue;case R.PROC_INST:Y==="?"?T.state=R.PROC_INST_ENDING:p(Y)?T.state=R.PROC_INST_BODY:T.procInstName+=Y;continue;case R.PROC_INST_BODY:if(!T.procInstBody&&p(Y))continue;Y==="?"?T.state=R.PROC_INST_ENDING:T.procInstBody+=Y;continue;case R.PROC_INST_ENDING:Y===">"?(Z(T,"onprocessinginstruction",{name:T.procInstName,body:T.procInstBody}),T.procInstName=T.procInstBody="",T.state=R.TEXT):(T.procInstBody+="?"+Y,T.state=R.PROC_INST_BODY);continue;case R.OPEN_TAG:P(w,Y)?T.tagName+=Y:(D(T),Y===">"?J(T):Y==="/"?T.state=R.OPEN_TAG_SLASH:(p(Y)||O(T,"Invalid character in tag name"),T.state=R.ATTRIB));continue;case R.OPEN_TAG_SLASH:Y===">"?(J(T,!0),ie(T)):(O(T,"Forward-slash in opening tag not followed by >"),T.state=R.ATTRIB);continue;case R.ATTRIB:if(p(Y))continue;Y===">"?J(T):Y==="/"?T.state=R.OPEN_TAG_SLASH:P(I,Y)?(T.attribName=Y,T.attribValue="",T.state=R.ATTRIB_NAME):O(T,"Invalid attribute name");continue;case R.ATTRIB_NAME:Y==="="?T.state=R.ATTRIB_VALUE:Y===">"?(O(T,"Attribute without value"),T.attribValue=T.attribName,W(T),J(T)):p(Y)?T.state=R.ATTRIB_NAME_SAW_WHITE:P(w,Y)?T.attribName+=Y:O(T,"Invalid attribute name");continue;case R.ATTRIB_NAME_SAW_WHITE:if(Y==="=")T.state=R.ATTRIB_VALUE;else{if(p(Y))continue;O(T,"Attribute without value"),T.tag.attributes[T.attribName]="",T.attribValue="",Z(T,"onattribute",{name:T.attribName,value:""}),T.attribName="",Y===">"?J(T):P(I,Y)?(T.attribName=Y,T.state=R.ATTRIB_NAME):(O(T,"Invalid attribute name"),T.state=R.ATTRIB)}continue;case R.ATTRIB_VALUE:if(p(Y))continue;m(Y)?(T.q=Y,T.state=R.ATTRIB_VALUE_QUOTED):(O(T,"Unquoted attribute value"),T.state=R.ATTRIB_VALUE_UNQUOTED,T.attribValue=Y);continue;case R.ATTRIB_VALUE_QUOTED:if(Y!==T.q){Y==="&"?T.state=R.ATTRIB_VALUE_ENTITY_Q:T.attribValue+=Y;continue}W(T),T.q="",T.state=R.ATTRIB_VALUE_CLOSED;continue;case R.ATTRIB_VALUE_CLOSED:p(Y)?T.state=R.ATTRIB:Y===">"?J(T):Y==="/"?T.state=R.OPEN_TAG_SLASH:P(I,Y)?(O(T,"No whitespace between attributes"),T.attribName=Y,T.attribValue="",T.state=R.ATTRIB_NAME):O(T,"Invalid attribute name");continue;case R.ATTRIB_VALUE_UNQUOTED:if(!y(Y)){Y==="&"?T.state=R.ATTRIB_VALUE_ENTITY_U:T.attribValue+=Y;continue}W(T),Y===">"?J(T):T.state=R.ATTRIB;continue;case R.CLOSE_TAG:if(T.tagName)Y===">"?ie(T):P(w,Y)?T.tagName+=Y:T.script?(T.script+="</"+T.tagName,T.tagName="",T.state=R.SCRIPT):(p(Y)||O(T,"Invalid tagname in closing tag"),T.state=R.CLOSE_TAG_SAW_WHITE);else{if(p(Y))continue;F(I,Y)?T.script?(T.script+="</"+Y,T.state=R.SCRIPT):O(T,"Invalid tagname in closing tag."):T.tagName=Y}continue;case R.CLOSE_TAG_SAW_WHITE:if(p(Y))continue;Y===">"?ie(T):O(T,"Invalid characters in closing tag");continue;case R.TEXT_ENTITY:case R.ATTRIB_VALUE_ENTITY_Q:case R.ATTRIB_VALUE_ENTITY_U:var q,ee;switch(T.state){case R.TEXT_ENTITY:q=R.TEXT,ee="textNode";break;case R.ATTRIB_VALUE_ENTITY_Q:q=R.ATTRIB_VALUE_QUOTED,ee="attribValue";break;case R.ATTRIB_VALUE_ENTITY_U:q=R.ATTRIB_VALUE_UNQUOTED,ee="attribValue";break}Y===";"?(T[ee]+=ue(T),T.entity="",T.state=q):P(T.entity.length?c:l,Y)?T.entity+=Y:(O(T,"Invalid character in entity name"),T[ee]+="&"+T.entity+Y,T.entity="",T.state=q);continue;default:throw new Error(T,"Unknown state: "+T.state)}return T.position>=T.bufferCheckPosition&&u(T),T}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */String.fromCodePoint||function(){var U=String.fromCharCode,T=Math.floor,K=function(){var Y=16384,fe=[],we,q,ee=-1,G=arguments.length;if(!G)return"";for(var S="";++ee<G;){var k=Number(arguments[ee]);if(!isFinite(k)||k<0||k>1114111||T(k)!==k)throw RangeError("Invalid code point: "+k);k<=65535?fe.push(k):(k-=65536,we=(k>>10)+55296,q=k%1024+56320,fe.push(we,q)),(ee+1===G||fe.length>Y)&&(S+=U.apply(null,fe),fe.length=0)}return S};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:K,configurable:!0,writable:!0}):String.fromCodePoint=K}()})(typeof a>"u"?this.sax={}:a)}).call(this)}).call(this,n("buffer").Buffer)},{buffer:3,stream:11,string_decoder:27}],11:[function(n,e,a){e.exports=s;var t=n("events").EventEmitter,i=n("inherits");i(s,t),s.Readable=n("readable-stream/lib/_stream_readable.js"),s.Writable=n("readable-stream/lib/_stream_writable.js"),s.Duplex=n("readable-stream/lib/_stream_duplex.js"),s.Transform=n("readable-stream/lib/_stream_transform.js"),s.PassThrough=n("readable-stream/lib/_stream_passthrough.js"),s.finished=n("readable-stream/lib/internal/streams/end-of-stream.js"),s.pipeline=n("readable-stream/lib/internal/streams/pipeline.js"),s.Stream=s;function s(){t.call(this)}s.prototype.pipe=function(r,u){var h=this;function o(x){r.writable&&r.write(x)===!1&&h.pause&&h.pause()}h.on("data",o);function d(){h.readable&&h.resume&&h.resume()}r.on("drain",d),!r._isStdio&&(!u||u.end!==!1)&&(h.on("end",b),h.on("close",f));var _=!1;function b(){_||(_=!0,r.end())}function f(){_||(_=!0,typeof r.destroy=="function"&&r.destroy())}function v(x){if(A(),t.listenerCount(this,"error")===0)throw x}h.on("error",v),r.on("error",v);function A(){h.removeListener("data",o),r.removeListener("drain",d),h.removeListener("end",b),h.removeListener("close",f),h.removeListener("error",v),r.removeListener("error",v),h.removeListener("end",A),h.removeListener("close",A),r.removeListener("close",A)}return h.on("end",A),h.on("close",A),r.on("close",A),r.emit("pipe",h),r}},{events:5,inherits:12,"readable-stream/lib/_stream_duplex.js":14,"readable-stream/lib/_stream_passthrough.js":15,"readable-stream/lib/_stream_readable.js":16,"readable-stream/lib/_stream_transform.js":17,"readable-stream/lib/_stream_writable.js":18,"readable-stream/lib/internal/streams/end-of-stream.js":22,"readable-stream/lib/internal/streams/pipeline.js":24}],12:[function(n,e,a){typeof Object.create=="function"?e.exports=function(i,s){s&&(i.super_=s,i.prototype=Object.create(s.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(i,s){if(s){i.super_=s;var r=function(){};r.prototype=s.prototype,i.prototype=new r,i.prototype.constructor=i}}},{}],13:[function(n,e,a){function t(d,_){d.prototype=Object.create(_.prototype),d.prototype.constructor=d,d.__proto__=_}var i={};function s(d,_,b){b||(b=Error);function f(A,x,C){return typeof _=="string"?_:_(A,x,C)}var v=function(A){t(x,A);function x(C,M,I){return A.call(this,f(C,M,I))||this}return x}(b);v.prototype.name=b.name,v.prototype.code=d,i[d]=v}function r(d,_){if(Array.isArray(d)){var b=d.length;return d=d.map(function(f){return String(f)}),b>2?"one of ".concat(_," ").concat(d.slice(0,b-1).join(", "),", or ")+d[b-1]:b===2?"one of ".concat(_," ").concat(d[0]," or ").concat(d[1]):"of ".concat(_," ").concat(d[0])}else return"of ".concat(_," ").concat(String(d))}function u(d,_,b){return d.substr(!b||b<0?0:+b,_.length)===_}function h(d,_,b){return(b===void 0||b>d.length)&&(b=d.length),d.substring(b-_.length,b)===_}function o(d,_,b){return typeof b!="number"&&(b=0),b+_.length>d.length?!1:d.indexOf(_,b)!==-1}s("ERR_INVALID_OPT_VALUE",function(d,_){return'The value "'+_+'" is invalid for option "'+d+'"'},TypeError),s("ERR_INVALID_ARG_TYPE",function(d,_,b){var f;typeof _=="string"&&u(_,"not ")?(f="must not be",_=_.replace(/^not /,"")):f="must be";var v;if(h(d," argument"))v="The ".concat(d," ").concat(f," ").concat(r(_,"type"));else{var A=o(d,".")?"property":"argument";v='The "'.concat(d,'" ').concat(A," ").concat(f," ").concat(r(_,"type"))}return v+=". Received type ".concat(typeof b),v},TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",function(d){return"The "+d+" method is not implemented"}),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",function(d){return"Cannot call "+d+" after a stream was destroyed"}),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",function(d){return"Unknown encoding: "+d},TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=i},{}],14:[function(n,e,a){(function(t){(function(){var i=Object.keys||function(f){var v=[];for(var A in f)v.push(A);return v};e.exports=d;var s=n("./_stream_readable"),r=n("./_stream_writable");n("inherits")(d,s);for(var u=i(r.prototype),h=0;h<u.length;h++){var o=u[h];d.prototype[o]||(d.prototype[o]=r.prototype[o])}function d(f){if(!(this instanceof d))return new d(f);s.call(this,f),r.call(this,f),this.allowHalfOpen=!0,f&&(f.readable===!1&&(this.readable=!1),f.writable===!1&&(this.writable=!1),f.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",_)))}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function _(){this._writableState.ended||t.nextTick(b,this)}function b(f){f.end()}Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(v){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=v,this._writableState.destroyed=v)}})}).call(this)}).call(this,n("_process"))},{"./_stream_readable":16,"./_stream_writable":18,_process:8,inherits:12}],15:[function(n,e,a){e.exports=i;var t=n("./_stream_transform");n("inherits")(i,t);function i(s){if(!(this instanceof i))return new i(s);t.call(this,s)}i.prototype._transform=function(s,r,u){u(null,s)}},{"./_stream_transform":17,inherits:12}],16:[function(n,e,a){(function(t,i){(function(){e.exports=V;var s;V.ReadableState=B,n("events").EventEmitter;var r=function(ee,G){return ee.listeners(G).length},u=n("./internal/streams/stream"),h=n("buffer").Buffer,o=i.Uint8Array||function(){};function d(q){return h.from(q)}function _(q){return h.isBuffer(q)||q instanceof o}var b=n("util"),f;b&&b.debuglog?f=b.debuglog("stream"):f=function(){};var v=n("./internal/streams/buffer_list"),A=n("./internal/streams/destroy"),x=n("./internal/streams/state"),C=x.getHighWaterMark,M=n("../errors").codes,I=M.ERR_INVALID_ARG_TYPE,w=M.ERR_STREAM_PUSH_AFTER_EOF,l=M.ERR_METHOD_NOT_IMPLEMENTED,c=M.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,p,m,y;n("inherits")(V,u);var P=A.errorOrDestroy,F=["error","close","destroy","pause","resume"];function R(q,ee,G){if(typeof q.prependListener=="function")return q.prependListener(ee,G);!q._events||!q._events[ee]?q.on(ee,G):Array.isArray(q._events[ee])?q._events[ee].unshift(G):q._events[ee]=[G,q._events[ee]]}function B(q,ee,G){s=s||n("./_stream_duplex"),q=q||{},typeof G!="boolean"&&(G=ee instanceof s),this.objectMode=!!q.objectMode,G&&(this.objectMode=this.objectMode||!!q.readableObjectMode),this.highWaterMark=C(this,q,"readableHighWaterMark",G),this.buffer=new v,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=q.emitClose!==!1,this.autoDestroy=!!q.autoDestroy,this.destroyed=!1,this.defaultEncoding=q.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,q.encoding&&(p||(p=n("string_decoder/").StringDecoder),this.decoder=new p(q.encoding),this.encoding=q.encoding)}function V(q){if(s=s||n("./_stream_duplex"),!(this instanceof V))return new V(q);var ee=this instanceof s;this._readableState=new B(q,this,ee),this.readable=!0,q&&(typeof q.read=="function"&&(this._read=q.read),typeof q.destroy=="function"&&(this._destroy=q.destroy)),u.call(this)}Object.defineProperty(V.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(ee){this._readableState&&(this._readableState.destroyed=ee)}}),V.prototype.destroy=A.destroy,V.prototype._undestroy=A.undestroy,V.prototype._destroy=function(q,ee){ee(q)},V.prototype.push=function(q,ee){var G=this._readableState,S;return G.objectMode?S=!0:typeof q=="string"&&(ee=ee||G.defaultEncoding,ee!==G.encoding&&(q=h.from(q,ee),ee=""),S=!0),Z(this,q,ee,!1,S)},V.prototype.unshift=function(q){return Z(this,q,null,!0,!1)};function Z(q,ee,G,S,k){f("readableAddChunk",ee);var Q=q._readableState;if(ee===null)Q.reading=!1,D(q,Q);else{var oe;if(k||(oe=H(Q,ee)),oe)P(q,oe);else if(Q.objectMode||ee&&ee.length>0)if(typeof ee!="string"&&!Q.objectMode&&Object.getPrototypeOf(ee)!==h.prototype&&(ee=d(ee)),S)Q.endEmitted?P(q,new c):ne(q,Q,ee,!0);else if(Q.ended)P(q,new w);else{if(Q.destroyed)return!1;Q.reading=!1,Q.decoder&&!G?(ee=Q.decoder.write(ee),Q.objectMode||ee.length!==0?ne(q,Q,ee,!1):J(q,Q)):ne(q,Q,ee,!1)}else S||(Q.reading=!1,J(q,Q))}return!Q.ended&&(Q.length<Q.highWaterMark||Q.length===0)}function ne(q,ee,G,S){ee.flowing&&ee.length===0&&!ee.sync?(ee.awaitDrain=0,q.emit("data",G)):(ee.length+=ee.objectMode?1:G.length,S?ee.buffer.unshift(G):ee.buffer.push(G),ee.needReadable&&z(q)),J(q,ee)}function H(q,ee){var G;return!_(ee)&&typeof ee!="string"&&ee!==void 0&&!q.objectMode&&(G=new I("chunk",["string","Buffer","Uint8Array"],ee)),G}V.prototype.isPaused=function(){return this._readableState.flowing===!1},V.prototype.setEncoding=function(q){p||(p=n("string_decoder/").StringDecoder);var ee=new p(q);this._readableState.decoder=ee,this._readableState.encoding=this._readableState.decoder.encoding;for(var G=this._readableState.buffer.head,S="";G!==null;)S+=ee.write(G.data),G=G.next;return this._readableState.buffer.clear(),S!==""&&this._readableState.buffer.push(S),this._readableState.length=S.length,this};var N=1073741824;function g(q){return q>=N?q=N:(q--,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,q|=q>>>16,q++),q}function O(q,ee){return q<=0||ee.length===0&&ee.ended?0:ee.objectMode?1:q!==q?ee.flowing&&ee.length?ee.buffer.head.data.length:ee.length:(q>ee.highWaterMark&&(ee.highWaterMark=g(q)),q<=ee.length?q:ee.ended?ee.length:(ee.needReadable=!0,0))}V.prototype.read=function(q){f("read",q),q=parseInt(q,10);var ee=this._readableState,G=q;if(q!==0&&(ee.emittedReadable=!1),q===0&&ee.needReadable&&((ee.highWaterMark!==0?ee.length>=ee.highWaterMark:ee.length>0)||ee.ended))return f("read: emitReadable",ee.length,ee.ended),ee.length===0&&ee.ended?Y(this):z(this),null;if(q=O(q,ee),q===0&&ee.ended)return ee.length===0&&Y(this),null;var S=ee.needReadable;f("need readable",S),(ee.length===0||ee.length-q<ee.highWaterMark)&&(S=!0,f("length less than watermark",S)),ee.ended||ee.reading?(S=!1,f("reading or ended",S)):S&&(f("do read"),ee.reading=!0,ee.sync=!0,ee.length===0&&(ee.needReadable=!0),this._read(ee.highWaterMark),ee.sync=!1,ee.reading||(q=O(G,ee)));var k;return q>0?k=K(q,ee):k=null,k===null?(ee.needReadable=ee.length<=ee.highWaterMark,q=0):(ee.length-=q,ee.awaitDrain=0),ee.length===0&&(ee.ended||(ee.needReadable=!0),G!==q&&ee.ended&&Y(this)),k!==null&&this.emit("data",k),k};function D(q,ee){if(f("onEofChunk"),!ee.ended){if(ee.decoder){var G=ee.decoder.end();G&&G.length&&(ee.buffer.push(G),ee.length+=ee.objectMode?1:G.length)}ee.ended=!0,ee.sync?z(q):(ee.needReadable=!1,ee.emittedReadable||(ee.emittedReadable=!0,W(q)))}}function z(q){var ee=q._readableState;f("emitReadable",ee.needReadable,ee.emittedReadable),ee.needReadable=!1,ee.emittedReadable||(f("emitReadable",ee.flowing),ee.emittedReadable=!0,t.nextTick(W,q))}function W(q){var ee=q._readableState;f("emitReadable_",ee.destroyed,ee.length,ee.ended),!ee.destroyed&&(ee.length||ee.ended)&&(q.emit("readable"),ee.emittedReadable=!1),ee.needReadable=!ee.flowing&&!ee.ended&&ee.length<=ee.highWaterMark,T(q)}function J(q,ee){ee.readingMore||(ee.readingMore=!0,t.nextTick(ie,q,ee))}function ie(q,ee){for(;!ee.reading&&!ee.ended&&(ee.length<ee.highWaterMark||ee.flowing&&ee.length===0);){var G=ee.length;if(f("maybeReadMore read 0"),q.read(0),G===ee.length)break}ee.readingMore=!1}V.prototype._read=function(q){P(this,new l("_read()"))},V.prototype.pipe=function(q,ee){var G=this,S=this._readableState;switch(S.pipesCount){case 0:S.pipes=q;break;case 1:S.pipes=[S.pipes,q];break;default:S.pipes.push(q);break}S.pipesCount+=1,f("pipe count=%d opts=%j",S.pipesCount,ee);var k=(!ee||ee.end!==!1)&&q!==t.stdout&&q!==t.stderr,Q=k?pe:Re;S.endEmitted?t.nextTick(Q):G.once("end",Q),q.on("unpipe",oe);function oe(Fe,L){f("onunpipe"),Fe===G&&L&&L.hasUnpiped===!1&&(L.hasUnpiped=!0,xe())}function pe(){f("onend"),q.end()}var ge=ue(G);q.on("drain",ge);var Ae=!1;function xe(){f("cleanup"),q.removeListener("close",Ee),q.removeListener("finish",Le),q.removeListener("drain",ge),q.removeListener("error",Ce),q.removeListener("unpipe",oe),G.removeListener("end",pe),G.removeListener("end",Re),G.removeListener("data",Se),Ae=!0,S.awaitDrain&&(!q._writableState||q._writableState.needDrain)&&ge()}G.on("data",Se);function Se(Fe){f("ondata");var L=q.write(Fe);f("dest.write",L),L===!1&&((S.pipesCount===1&&S.pipes===q||S.pipesCount>1&&we(S.pipes,q)!==-1)&&!Ae&&(f("false write response, pause",S.awaitDrain),S.awaitDrain++),G.pause())}function Ce(Fe){f("onerror",Fe),Re(),q.removeListener("error",Ce),r(q,"error")===0&&P(q,Fe)}R(q,"error",Ce);function Ee(){q.removeListener("finish",Le),Re()}q.once("close",Ee);function Le(){f("onfinish"),q.removeListener("close",Ee),Re()}q.once("finish",Le);function Re(){f("unpipe"),G.unpipe(q)}return q.emit("pipe",G),S.flowing||(f("pipe resume"),G.resume()),q};function ue(q){return function(){var G=q._readableState;f("pipeOnDrain",G.awaitDrain),G.awaitDrain&&G.awaitDrain--,G.awaitDrain===0&&r(q,"data")&&(G.flowing=!0,T(q))}}V.prototype.unpipe=function(q){var ee=this._readableState,G={hasUnpiped:!1};if(ee.pipesCount===0)return this;if(ee.pipesCount===1)return q&&q!==ee.pipes?this:(q||(q=ee.pipes),ee.pipes=null,ee.pipesCount=0,ee.flowing=!1,q&&q.emit("unpipe",this,G),this);if(!q){var S=ee.pipes,k=ee.pipesCount;ee.pipes=null,ee.pipesCount=0,ee.flowing=!1;for(var Q=0;Q<k;Q++)S[Q].emit("unpipe",this,{hasUnpiped:!1});return this}var oe=we(ee.pipes,q);return oe===-1?this:(ee.pipes.splice(oe,1),ee.pipesCount-=1,ee.pipesCount===1&&(ee.pipes=ee.pipes[0]),q.emit("unpipe",this,G),this)},V.prototype.on=function(q,ee){var G=u.prototype.on.call(this,q,ee),S=this._readableState;return q==="data"?(S.readableListening=this.listenerCount("readable")>0,S.flowing!==!1&&this.resume()):q==="readable"&&!S.endEmitted&&!S.readableListening&&(S.readableListening=S.needReadable=!0,S.flowing=!1,S.emittedReadable=!1,f("on readable",S.length,S.reading),S.length?z(this):S.reading||t.nextTick(se,this)),G},V.prototype.addListener=V.prototype.on,V.prototype.removeListener=function(q,ee){var G=u.prototype.removeListener.call(this,q,ee);return q==="readable"&&t.nextTick(he,this),G},V.prototype.removeAllListeners=function(q){var ee=u.prototype.removeAllListeners.apply(this,arguments);return(q==="readable"||q===void 0)&&t.nextTick(he,this),ee};function he(q){var ee=q._readableState;ee.readableListening=q.listenerCount("readable")>0,ee.resumeScheduled&&!ee.paused?ee.flowing=!0:q.listenerCount("data")>0&&q.resume()}function se(q){f("readable nexttick read 0"),q.read(0)}V.prototype.resume=function(){var q=this._readableState;return q.flowing||(f("resume"),q.flowing=!q.readableListening,de(this,q)),q.paused=!1,this};function de(q,ee){ee.resumeScheduled||(ee.resumeScheduled=!0,t.nextTick(U,q,ee))}function U(q,ee){f("resume",ee.reading),ee.reading||q.read(0),ee.resumeScheduled=!1,q.emit("resume"),T(q),ee.flowing&&!ee.reading&&q.read(0)}V.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function T(q){var ee=q._readableState;for(f("flow",ee.flowing);ee.flowing&&q.read()!==null;);}V.prototype.wrap=function(q){var ee=this,G=this._readableState,S=!1;q.on("end",function(){if(f("wrapped end"),G.decoder&&!G.ended){var oe=G.decoder.end();oe&&oe.length&&ee.push(oe)}ee.push(null)}),q.on("data",function(oe){if(f("wrapped data"),G.decoder&&(oe=G.decoder.write(oe)),!(G.objectMode&&oe==null)&&!(!G.objectMode&&(!oe||!oe.length))){var pe=ee.push(oe);pe||(S=!0,q.pause())}});for(var k in q)this[k]===void 0&&typeof q[k]=="function"&&(this[k]=function(pe){return function(){return q[pe].apply(q,arguments)}}(k));for(var Q=0;Q<F.length;Q++)q.on(F[Q],this.emit.bind(this,F[Q]));return this._read=function(oe){f("wrapped _read",oe),S&&(S=!1,q.resume())},this},typeof Symbol=="function"&&(V.prototype[Symbol.asyncIterator]=function(){return m===void 0&&(m=n("./internal/streams/async_iterator")),m(this)}),Object.defineProperty(V.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(V.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(V.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(ee){this._readableState&&(this._readableState.flowing=ee)}}),V._fromList=K,Object.defineProperty(V.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function K(q,ee){if(ee.length===0)return null;var G;return ee.objectMode?G=ee.buffer.shift():!q||q>=ee.length?(ee.decoder?G=ee.buffer.join(""):ee.buffer.length===1?G=ee.buffer.first():G=ee.buffer.concat(ee.length),ee.buffer.clear()):G=ee.buffer.consume(q,ee.decoder),G}function Y(q){var ee=q._readableState;f("endReadable",ee.endEmitted),ee.endEmitted||(ee.ended=!0,t.nextTick(fe,ee,q))}function fe(q,ee){if(f("endReadableNT",q.endEmitted,q.length),!q.endEmitted&&q.length===0&&(q.endEmitted=!0,ee.readable=!1,ee.emit("end"),q.autoDestroy)){var G=ee._writableState;(!G||G.autoDestroy&&G.finished)&&ee.destroy()}}typeof Symbol=="function"&&(V.from=function(q,ee){return y===void 0&&(y=n("./internal/streams/from")),y(V,q,ee)});function we(q,ee){for(var G=0,S=q.length;G<S;G++)if(q[G]===ee)return G;return-1}}).call(this)}).call(this,n("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":13,"./_stream_duplex":14,"./internal/streams/async_iterator":19,"./internal/streams/buffer_list":20,"./internal/streams/destroy":21,"./internal/streams/from":23,"./internal/streams/state":25,"./internal/streams/stream":26,_process:8,buffer:3,events:5,inherits:12,"string_decoder/":27,util:2}],17:[function(n,e,a){e.exports=d;var t=n("../errors").codes,i=t.ERR_METHOD_NOT_IMPLEMENTED,s=t.ERR_MULTIPLE_CALLBACK,r=t.ERR_TRANSFORM_ALREADY_TRANSFORMING,u=t.ERR_TRANSFORM_WITH_LENGTH_0,h=n("./_stream_duplex");n("inherits")(d,h);function o(f,v){var A=this._transformState;A.transforming=!1;var x=A.writecb;if(x===null)return this.emit("error",new s);A.writechunk=null,A.writecb=null,v!=null&&this.push(v),x(f);var C=this._readableState;C.reading=!1,(C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}function d(f){if(!(this instanceof d))return new d(f);h.call(this,f),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,f&&(typeof f.transform=="function"&&(this._transform=f.transform),typeof f.flush=="function"&&(this._flush=f.flush)),this.on("prefinish",_)}function _(){var f=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(v,A){b(f,v,A)}):b(this,null,null)}d.prototype.push=function(f,v){return this._transformState.needTransform=!1,h.prototype.push.call(this,f,v)},d.prototype._transform=function(f,v,A){A(new i("_transform()"))},d.prototype._write=function(f,v,A){var x=this._transformState;if(x.writecb=A,x.writechunk=f,x.writeencoding=v,!x.transforming){var C=this._readableState;(x.needTransform||C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}},d.prototype._read=function(f){var v=this._transformState;v.writechunk!==null&&!v.transforming?(v.transforming=!0,this._transform(v.writechunk,v.writeencoding,v.afterTransform)):v.needTransform=!0},d.prototype._destroy=function(f,v){h.prototype._destroy.call(this,f,function(A){v(A)})};function b(f,v,A){if(v)return f.emit("error",v);if(A!=null&&f.push(A),f._writableState.length)throw new u;if(f._transformState.transforming)throw new r;return f.push(null)}},{"../errors":13,"./_stream_duplex":14,inherits:12}],18:[function(n,e,a){(function(t,i){(function(){e.exports=B;function s(T){var K=this;this.next=null,this.entry=null,this.finish=function(){U(K,T)}}var r;B.WritableState=F;var u={deprecate:n("util-deprecate")},h=n("./internal/streams/stream"),o=n("buffer").Buffer,d=i.Uint8Array||function(){};function _(T){return o.from(T)}function b(T){return o.isBuffer(T)||T instanceof d}var f=n("./internal/streams/destroy"),v=n("./internal/streams/state"),A=v.getHighWaterMark,x=n("../errors").codes,C=x.ERR_INVALID_ARG_TYPE,M=x.ERR_METHOD_NOT_IMPLEMENTED,I=x.ERR_MULTIPLE_CALLBACK,w=x.ERR_STREAM_CANNOT_PIPE,l=x.ERR_STREAM_DESTROYED,c=x.ERR_STREAM_NULL_VALUES,p=x.ERR_STREAM_WRITE_AFTER_END,m=x.ERR_UNKNOWN_ENCODING,y=f.errorOrDestroy;n("inherits")(B,h);function P(){}function F(T,K,Y){r=r||n("./_stream_duplex"),T=T||{},typeof Y!="boolean"&&(Y=K instanceof r),this.objectMode=!!T.objectMode,Y&&(this.objectMode=this.objectMode||!!T.writableObjectMode),this.highWaterMark=A(this,T,"writableHighWaterMark",Y),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var fe=T.decodeStrings===!1;this.decodeStrings=!fe,this.defaultEncoding=T.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(we){D(K,we)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=T.emitClose!==!1,this.autoDestroy=!!T.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}F.prototype.getBuffer=function(){for(var K=this.bufferedRequest,Y=[];K;)Y.push(K),K=K.next;return Y},function(){try{Object.defineProperty(F.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var R;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(R=Function.prototype[Symbol.hasInstance],Object.defineProperty(B,Symbol.hasInstance,{value:function(K){return R.call(this,K)?!0:this!==B?!1:K&&K._writableState instanceof F}})):R=function(K){return K instanceof this};function B(T){r=r||n("./_stream_duplex");var K=this instanceof r;if(!K&&!R.call(B,this))return new B(T);this._writableState=new F(T,this,K),this.writable=!0,T&&(typeof T.write=="function"&&(this._write=T.write),typeof T.writev=="function"&&(this._writev=T.writev),typeof T.destroy=="function"&&(this._destroy=T.destroy),typeof T.final=="function"&&(this._final=T.final)),h.call(this)}B.prototype.pipe=function(){y(this,new w)};function V(T,K){var Y=new p;y(T,Y),t.nextTick(K,Y)}function Z(T,K,Y,fe){var we;return Y===null?we=new c:typeof Y!="string"&&!K.objectMode&&(we=new C("chunk",["string","Buffer"],Y)),we?(y(T,we),t.nextTick(fe,we),!1):!0}B.prototype.write=function(T,K,Y){var fe=this._writableState,we=!1,q=!fe.objectMode&&b(T);return q&&!o.isBuffer(T)&&(T=_(T)),typeof K=="function"&&(Y=K,K=null),q?K="buffer":K||(K=fe.defaultEncoding),typeof Y!="function"&&(Y=P),fe.ending?V(this,Y):(q||Z(this,fe,T,Y))&&(fe.pendingcb++,we=H(this,fe,q,T,K,Y)),we},B.prototype.cork=function(){this._writableState.corked++},B.prototype.uncork=function(){var T=this._writableState;T.corked&&(T.corked--,!T.writing&&!T.corked&&!T.bufferProcessing&&T.bufferedRequest&&J(this,T))},B.prototype.setDefaultEncoding=function(K){if(typeof K=="string"&&(K=K.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((K+"").toLowerCase())>-1))throw new m(K);return this._writableState.defaultEncoding=K,this},Object.defineProperty(B.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function ne(T,K,Y){return!T.objectMode&&T.decodeStrings!==!1&&typeof K=="string"&&(K=o.from(K,Y)),K}Object.defineProperty(B.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function H(T,K,Y,fe,we,q){if(!Y){var ee=ne(K,fe,we);fe!==ee&&(Y=!0,we="buffer",fe=ee)}var G=K.objectMode?1:fe.length;K.length+=G;var S=K.length<K.highWaterMark;if(S||(K.needDrain=!0),K.writing||K.corked){var k=K.lastBufferedRequest;K.lastBufferedRequest={chunk:fe,encoding:we,isBuf:Y,callback:q,next:null},k?k.next=K.lastBufferedRequest:K.bufferedRequest=K.lastBufferedRequest,K.bufferedRequestCount+=1}else N(T,K,!1,G,fe,we,q);return S}function N(T,K,Y,fe,we,q,ee){K.writelen=fe,K.writecb=ee,K.writing=!0,K.sync=!0,K.destroyed?K.onwrite(new l("write")):Y?T._writev(we,K.onwrite):T._write(we,q,K.onwrite),K.sync=!1}function g(T,K,Y,fe,we){--K.pendingcb,Y?(t.nextTick(we,fe),t.nextTick(se,T,K),T._writableState.errorEmitted=!0,y(T,fe)):(we(fe),T._writableState.errorEmitted=!0,y(T,fe),se(T,K))}function O(T){T.writing=!1,T.writecb=null,T.length-=T.writelen,T.writelen=0}function D(T,K){var Y=T._writableState,fe=Y.sync,we=Y.writecb;if(typeof we!="function")throw new I;if(O(Y),K)g(T,Y,fe,K,we);else{var q=ie(Y)||T.destroyed;!q&&!Y.corked&&!Y.bufferProcessing&&Y.bufferedRequest&&J(T,Y),fe?t.nextTick(z,T,Y,q,we):z(T,Y,q,we)}}function z(T,K,Y,fe){Y||W(T,K),K.pendingcb--,fe(),se(T,K)}function W(T,K){K.length===0&&K.needDrain&&(K.needDrain=!1,T.emit("drain"))}function J(T,K){K.bufferProcessing=!0;var Y=K.bufferedRequest;if(T._writev&&Y&&Y.next){var fe=K.bufferedRequestCount,we=new Array(fe),q=K.corkedRequestsFree;q.entry=Y;for(var ee=0,G=!0;Y;)we[ee]=Y,Y.isBuf||(G=!1),Y=Y.next,ee+=1;we.allBuffers=G,N(T,K,!0,K.length,we,"",q.finish),K.pendingcb++,K.lastBufferedRequest=null,q.next?(K.corkedRequestsFree=q.next,q.next=null):K.corkedRequestsFree=new s(K),K.bufferedRequestCount=0}else{for(;Y;){var S=Y.chunk,k=Y.encoding,Q=Y.callback,oe=K.objectMode?1:S.length;if(N(T,K,!1,oe,S,k,Q),Y=Y.next,K.bufferedRequestCount--,K.writing)break}Y===null&&(K.lastBufferedRequest=null)}K.bufferedRequest=Y,K.bufferProcessing=!1}B.prototype._write=function(T,K,Y){Y(new M("_write()"))},B.prototype._writev=null,B.prototype.end=function(T,K,Y){var fe=this._writableState;return typeof T=="function"?(Y=T,T=null,K=null):typeof K=="function"&&(Y=K,K=null),T!=null&&this.write(T,K),fe.corked&&(fe.corked=1,this.uncork()),fe.ending||de(this,fe,Y),this},Object.defineProperty(B.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ie(T){return T.ending&&T.length===0&&T.bufferedRequest===null&&!T.finished&&!T.writing}function ue(T,K){T._final(function(Y){K.pendingcb--,Y&&y(T,Y),K.prefinished=!0,T.emit("prefinish"),se(T,K)})}function he(T,K){!K.prefinished&&!K.finalCalled&&(typeof T._final=="function"&&!K.destroyed?(K.pendingcb++,K.finalCalled=!0,t.nextTick(ue,T,K)):(K.prefinished=!0,T.emit("prefinish")))}function se(T,K){var Y=ie(K);if(Y&&(he(T,K),K.pendingcb===0&&(K.finished=!0,T.emit("finish"),K.autoDestroy))){var fe=T._readableState;(!fe||fe.autoDestroy&&fe.endEmitted)&&T.destroy()}return Y}function de(T,K,Y){K.ending=!0,se(T,K),Y&&(K.finished?t.nextTick(Y):T.once("finish",Y)),K.ended=!0,T.writable=!1}function U(T,K,Y){var fe=T.entry;for(T.entry=null;fe;){var we=fe.callback;K.pendingcb--,we(Y),fe=fe.next}K.corkedRequestsFree.next=T}Object.defineProperty(B.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(K){this._writableState&&(this._writableState.destroyed=K)}}),B.prototype.destroy=f.destroy,B.prototype._undestroy=f.undestroy,B.prototype._destroy=function(T,K){K(T)}}).call(this)}).call(this,n("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":13,"./_stream_duplex":14,"./internal/streams/destroy":21,"./internal/streams/state":25,"./internal/streams/stream":26,_process:8,buffer:3,inherits:12,"util-deprecate":28}],19:[function(n,e,a){(function(t){(function(){var i;function s(l,c,p){return c in l?Object.defineProperty(l,c,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[c]=p,l}var r=n("./end-of-stream"),u=Symbol("lastResolve"),h=Symbol("lastReject"),o=Symbol("error"),d=Symbol("ended"),_=Symbol("lastPromise"),b=Symbol("handlePromise"),f=Symbol("stream");function v(l,c){return{value:l,done:c}}function A(l){var c=l[u];if(c!==null){var p=l[f].read();p!==null&&(l[_]=null,l[u]=null,l[h]=null,c(v(p,!1)))}}function x(l){t.nextTick(A,l)}function C(l,c){return function(p,m){l.then(function(){if(c[d]){p(v(void 0,!0));return}c[b](p,m)},m)}}var M=Object.getPrototypeOf(function(){}),I=Object.setPrototypeOf((i={get stream(){return this[f]},next:function(){var c=this,p=this[o];if(p!==null)return Promise.reject(p);if(this[d])return Promise.resolve(v(void 0,!0));if(this[f].destroyed)return new Promise(function(F,R){t.nextTick(function(){c[o]?R(c[o]):F(v(void 0,!0))})});var m=this[_],y;if(m)y=new Promise(C(m,this));else{var P=this[f].read();if(P!==null)return Promise.resolve(v(P,!1));y=new Promise(this[b])}return this[_]=y,y}},s(i,Symbol.asyncIterator,function(){return this}),s(i,"return",function(){var c=this;return new Promise(function(p,m){c[f].destroy(null,function(y){if(y){m(y);return}p(v(void 0,!0))})})}),i),M),w=function(c){var p,m=Object.create(I,(p={},s(p,f,{value:c,writable:!0}),s(p,u,{value:null,writable:!0}),s(p,h,{value:null,writable:!0}),s(p,o,{value:null,writable:!0}),s(p,d,{value:c._readableState.endEmitted,writable:!0}),s(p,b,{value:function(P,F){var R=m[f].read();R?(m[_]=null,m[u]=null,m[h]=null,P(v(R,!1))):(m[u]=P,m[h]=F)},writable:!0}),p));return m[_]=null,r(c,function(y){if(y&&y.code!=="ERR_STREAM_PREMATURE_CLOSE"){var P=m[h];P!==null&&(m[_]=null,m[u]=null,m[h]=null,P(y)),m[o]=y;return}var F=m[u];F!==null&&(m[_]=null,m[u]=null,m[h]=null,F(v(void 0,!0))),m[d]=!0}),c.on("readable",x.bind(null,m)),m};e.exports=w}).call(this)}).call(this,n("_process"))},{"./end-of-stream":22,_process:8}],20:[function(n,e,a){function t(A,x){var C=Object.keys(A);if(Object.getOwnPropertySymbols){var M=Object.getOwnPropertySymbols(A);x&&(M=M.filter(function(I){return Object.getOwnPropertyDescriptor(A,I).enumerable})),C.push.apply(C,M)}return C}function i(A){for(var x=1;x<arguments.length;x++){var C=arguments[x]!=null?arguments[x]:{};x%2?t(Object(C),!0).forEach(function(M){s(A,M,C[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(C)):t(Object(C)).forEach(function(M){Object.defineProperty(A,M,Object.getOwnPropertyDescriptor(C,M))})}return A}function s(A,x,C){return x in A?Object.defineProperty(A,x,{value:C,enumerable:!0,configurable:!0,writable:!0}):A[x]=C,A}function r(A,x){if(!(A instanceof x))throw new TypeError("Cannot call a class as a function")}function u(A,x){for(var C=0;C<x.length;C++){var M=x[C];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(A,M.key,M)}}function h(A,x,C){return x&&u(A.prototype,x),C&&u(A,C),A}var o=n("buffer"),d=o.Buffer,_=n("util"),b=_.inspect,f=b&&b.custom||"inspect";function v(A,x,C){d.prototype.copy.call(A,x,C)}e.exports=function(){function A(){r(this,A),this.head=null,this.tail=null,this.length=0}return h(A,[{key:"push",value:function(C){var M={data:C,next:null};this.length>0?this.tail.next=M:this.head=M,this.tail=M,++this.length}},{key:"unshift",value:function(C){var M={data:C,next:this.head};this.length===0&&(this.tail=M),this.head=M,++this.length}},{key:"shift",value:function(){if(this.length!==0){var C=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,C}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(C){if(this.length===0)return"";for(var M=this.head,I=""+M.data;M=M.next;)I+=C+M.data;return I}},{key:"concat",value:function(C){if(this.length===0)return d.alloc(0);for(var M=d.allocUnsafe(C>>>0),I=this.head,w=0;I;)v(I.data,M,w),w+=I.data.length,I=I.next;return M}},{key:"consume",value:function(C,M){var I;return C<this.head.data.length?(I=this.head.data.slice(0,C),this.head.data=this.head.data.slice(C)):C===this.head.data.length?I=this.shift():I=M?this._getString(C):this._getBuffer(C),I}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(C){var M=this.head,I=1,w=M.data;for(C-=w.length;M=M.next;){var l=M.data,c=C>l.length?l.length:C;if(c===l.length?w+=l:w+=l.slice(0,C),C-=c,C===0){c===l.length?(++I,M.next?this.head=M.next:this.head=this.tail=null):(this.head=M,M.data=l.slice(c));break}++I}return this.length-=I,w}},{key:"_getBuffer",value:function(C){var M=d.allocUnsafe(C),I=this.head,w=1;for(I.data.copy(M),C-=I.data.length;I=I.next;){var l=I.data,c=C>l.length?l.length:C;if(l.copy(M,M.length-C,0,c),C-=c,C===0){c===l.length?(++w,I.next?this.head=I.next:this.head=this.tail=null):(this.head=I,I.data=l.slice(c));break}++w}return this.length-=w,M}},{key:f,value:function(C,M){return b(this,i({},M,{depth:0,customInspect:!1}))}}]),A}()},{buffer:3,util:2}],21:[function(n,e,a){(function(t){(function(){function i(d,_){var b=this,f=this._readableState&&this._readableState.destroyed,v=this._writableState&&this._writableState.destroyed;return f||v?(_?_(d):d&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,t.nextTick(h,this,d)):t.nextTick(h,this,d)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(d||null,function(A){!_&&A?b._writableState?b._writableState.errorEmitted?t.nextTick(r,b):(b._writableState.errorEmitted=!0,t.nextTick(s,b,A)):t.nextTick(s,b,A):_?(t.nextTick(r,b),_(A)):t.nextTick(r,b)}),this)}function s(d,_){h(d,_),r(d)}function r(d){d._writableState&&!d._writableState.emitClose||d._readableState&&!d._readableState.emitClose||d.emit("close")}function u(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function h(d,_){d.emit("error",_)}function o(d,_){var b=d._readableState,f=d._writableState;b&&b.autoDestroy||f&&f.autoDestroy?d.destroy(_):d.emit("error",_)}e.exports={destroy:i,undestroy:u,errorOrDestroy:o}}).call(this)}).call(this,n("_process"))},{_process:8}],22:[function(n,e,a){var t=n("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function i(h){var o=!1;return function(){if(!o){o=!0;for(var d=arguments.length,_=new Array(d),b=0;b<d;b++)_[b]=arguments[b];h.apply(this,_)}}}function s(){}function r(h){return h.setHeader&&typeof h.abort=="function"}function u(h,o,d){if(typeof o=="function")return u(h,null,o);o||(o={}),d=i(d||s);var _=o.readable||o.readable!==!1&&h.readable,b=o.writable||o.writable!==!1&&h.writable,f=function(){h.writable||A()},v=h._writableState&&h._writableState.finished,A=function(){b=!1,v=!0,_||d.call(h)},x=h._readableState&&h._readableState.endEmitted,C=function(){_=!1,x=!0,b||d.call(h)},M=function(c){d.call(h,c)},I=function(){var c;if(_&&!x)return(!h._readableState||!h._readableState.ended)&&(c=new t),d.call(h,c);if(b&&!v)return(!h._writableState||!h._writableState.ended)&&(c=new t),d.call(h,c)},w=function(){h.req.on("finish",A)};return r(h)?(h.on("complete",A),h.on("abort",I),h.req?w():h.on("request",w)):b&&!h._writableState&&(h.on("end",f),h.on("close",f)),h.on("end",C),h.on("finish",A),o.error!==!1&&h.on("error",M),h.on("close",I),function(){h.removeListener("complete",A),h.removeListener("abort",I),h.removeListener("request",w),h.req&&h.req.removeListener("finish",A),h.removeListener("end",f),h.removeListener("close",f),h.removeListener("finish",A),h.removeListener("end",C),h.removeListener("error",M),h.removeListener("close",I)}}e.exports=u},{"../../../errors":13}],23:[function(n,e,a){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],24:[function(n,e,a){var t;function i(A){var x=!1;return function(){x||(x=!0,A.apply(void 0,arguments))}}var s=n("../../../errors").codes,r=s.ERR_MISSING_ARGS,u=s.ERR_STREAM_DESTROYED;function h(A){if(A)throw A}function o(A){return A.setHeader&&typeof A.abort=="function"}function d(A,x,C,M){M=i(M);var I=!1;A.on("close",function(){I=!0}),t===void 0&&(t=n("./end-of-stream")),t(A,{readable:x,writable:C},function(l){if(l)return M(l);I=!0,M()});var w=!1;return function(l){if(!I&&!w){if(w=!0,o(A))return A.abort();if(typeof A.destroy=="function")return A.destroy();M(l||new u("pipe"))}}}function _(A){A()}function b(A,x){return A.pipe(x)}function f(A){return!A.length||typeof A[A.length-1]!="function"?h:A.pop()}function v(){for(var A=arguments.length,x=new Array(A),C=0;C<A;C++)x[C]=arguments[C];var M=f(x);if(Array.isArray(x[0])&&(x=x[0]),x.length<2)throw new r("streams");var I,w=x.map(function(l,c){var p=c<x.length-1,m=c>0;return d(l,p,m,function(y){I||(I=y),y&&w.forEach(_),!p&&(w.forEach(_),M(I))})});return x.reduce(b)}e.exports=v},{"../../../errors":13,"./end-of-stream":22}],25:[function(n,e,a){var t=n("../../../errors").codes.ERR_INVALID_OPT_VALUE;function i(r,u,h){return r.highWaterMark!=null?r.highWaterMark:u?r[h]:null}function s(r,u,h,o){var d=i(u,o,h);if(d!=null){if(!(isFinite(d)&&Math.floor(d)===d)||d<0){var _=o?h:"highWaterMark";throw new t(_,d)}return Math.floor(d)}return r.objectMode?16:16*1024}e.exports={getHighWaterMark:s}},{"../../../errors":13}],26:[function(n,e,a){e.exports=n("events").EventEmitter},{events:5}],27:[function(n,e,a){var t=n("safe-buffer").Buffer,i=t.isEncoding||function(w){switch(w=""+w,w&&w.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(w){if(!w)return"utf8";for(var l;;)switch(w){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return w;default:if(l)return;w=(""+w).toLowerCase(),l=!0}}function r(w){var l=s(w);if(typeof l!="string"&&(t.isEncoding===i||!i(w)))throw new Error("Unknown encoding: "+w);return l||w}a.StringDecoder=u;function u(w){this.encoding=r(w);var l;switch(this.encoding){case"utf16le":this.text=v,this.end=A,l=4;break;case"utf8":this.fillLast=_,l=4;break;case"base64":this.text=x,this.end=C,l=3;break;default:this.write=M,this.end=I;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(l)}u.prototype.write=function(w){if(w.length===0)return"";var l,c;if(this.lastNeed){if(l=this.fillLast(w),l===void 0)return"";c=this.lastNeed,this.lastNeed=0}else c=0;return c<w.length?l?l+this.text(w,c):this.text(w,c):l||""},u.prototype.end=f,u.prototype.text=b,u.prototype.fillLast=function(w){if(this.lastNeed<=w.length)return w.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);w.copy(this.lastChar,this.lastTotal-this.lastNeed,0,w.length),this.lastNeed-=w.length};function h(w){return w<=127?0:w>>5===6?2:w>>4===14?3:w>>3===30?4:w>>6===2?-1:-2}function o(w,l,c){var p=l.length-1;if(p<c)return 0;var m=h(l[p]);return m>=0?(m>0&&(w.lastNeed=m-1),m):--p<c||m===-2?0:(m=h(l[p]),m>=0?(m>0&&(w.lastNeed=m-2),m):--p<c||m===-2?0:(m=h(l[p]),m>=0?(m>0&&(m===2?m=0:w.lastNeed=m-3),m):0))}function d(w,l,c){if((l[0]&192)!==128)return w.lastNeed=0,"�";if(w.lastNeed>1&&l.length>1){if((l[1]&192)!==128)return w.lastNeed=1,"�";if(w.lastNeed>2&&l.length>2&&(l[2]&192)!==128)return w.lastNeed=2,"�"}}function _(w){var l=this.lastTotal-this.lastNeed,c=d(this,w);if(c!==void 0)return c;if(this.lastNeed<=w.length)return w.copy(this.lastChar,l,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);w.copy(this.lastChar,l,0,w.length),this.lastNeed-=w.length}function b(w,l){var c=o(this,w,l);if(!this.lastNeed)return w.toString("utf8",l);this.lastTotal=c;var p=w.length-(c-this.lastNeed);return w.copy(this.lastChar,0,p),w.toString("utf8",l,p)}function f(w){var l=w&&w.length?this.write(w):"";return this.lastNeed?l+"�":l}function v(w,l){if((w.length-l)%2===0){var c=w.toString("utf16le",l);if(c){var p=c.charCodeAt(c.length-1);if(p>=55296&&p<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=w[w.length-2],this.lastChar[1]=w[w.length-1],c.slice(0,-1)}return c}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=w[w.length-1],w.toString("utf16le",l,w.length-1)}function A(w){var l=w&&w.length?this.write(w):"";if(this.lastNeed){var c=this.lastTotal-this.lastNeed;return l+this.lastChar.toString("utf16le",0,c)}return l}function x(w,l){var c=(w.length-l)%3;return c===0?w.toString("base64",l):(this.lastNeed=3-c,this.lastTotal=3,c===1?this.lastChar[0]=w[w.length-1]:(this.lastChar[0]=w[w.length-2],this.lastChar[1]=w[w.length-1]),w.toString("base64",l,w.length-c))}function C(w){var l=w&&w.length?this.write(w):"";return this.lastNeed?l+this.lastChar.toString("base64",0,3-this.lastNeed):l}function M(w){return w.toString(this.encoding)}function I(w){return w&&w.length?this.write(w):""}},{"safe-buffer":9}],28:[function(n,e,a){(function(t){(function(){e.exports=i;function i(r,u){if(s("noDeprecation"))return r;var h=!1;function o(){if(!h){if(s("throwDeprecation"))throw new Error(u);s("traceDeprecation")?console.trace(u):console.warn(u),h=!0}return r.apply(this,arguments)}return o}function s(r){try{if(!t.localStorage)return!1}catch{return!1}var u=t.localStorage[r];return u==null?!1:String(u).toLowerCase()==="true"}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],29:[function(n,e,a){e.exports={isArray:function(t){return Array.isArray?Array.isArray(t):Object.prototype.toString.call(t)==="[object Array]"}}},{}],30:[function(n,e,a){var t=n("./xml2js"),i=n("./xml2json"),s=n("./js2xml"),r=n("./json2xml");e.exports={xml2js:t,xml2json:i,js2xml:s,json2xml:r}},{"./js2xml":31,"./json2xml":32,"./xml2js":34,"./xml2json":35}],31:[function(n,e,a){var t=n("./options-helper"),i=n("./array-helper").isArray,s,r;function u(c){var p=t.copyOptions(c);return t.ensureFlagExists("ignoreDeclaration",p),t.ensureFlagExists("ignoreInstruction",p),t.ensureFlagExists("ignoreAttributes",p),t.ensureFlagExists("ignoreText",p),t.ensureFlagExists("ignoreComment",p),t.ensureFlagExists("ignoreCdata",p),t.ensureFlagExists("ignoreDoctype",p),t.ensureFlagExists("compact",p),t.ensureFlagExists("indentText",p),t.ensureFlagExists("indentCdata",p),t.ensureFlagExists("indentAttributes",p),t.ensureFlagExists("indentInstruction",p),t.ensureFlagExists("fullTagEmptyElement",p),t.ensureFlagExists("noQuotesForNativeAttributes",p),t.ensureSpacesExists(p),typeof p.spaces=="number"&&(p.spaces=Array(p.spaces+1).join(" ")),t.ensureKeyExists("declaration",p),t.ensureKeyExists("instruction",p),t.ensureKeyExists("attributes",p),t.ensureKeyExists("text",p),t.ensureKeyExists("comment",p),t.ensureKeyExists("cdata",p),t.ensureKeyExists("doctype",p),t.ensureKeyExists("type",p),t.ensureKeyExists("name",p),t.ensureKeyExists("elements",p),t.checkFnExists("doctype",p),t.checkFnExists("instruction",p),t.checkFnExists("cdata",p),t.checkFnExists("comment",p),t.checkFnExists("text",p),t.checkFnExists("instructionName",p),t.checkFnExists("elementName",p),t.checkFnExists("attributeName",p),t.checkFnExists("attributeValue",p),t.checkFnExists("attributes",p),t.checkFnExists("fullTagEmptyElement",p),p}function h(c,p,m){return(!m&&c.spaces?`
`:"")+Array(p+1).join(c.spaces)}function o(c,p,m){if(p.ignoreAttributes)return"";"attributesFn"in p&&(c=p.attributesFn(c,r,s));var y,P,F,R,B=[];for(y in c)c.hasOwnProperty(y)&&c[y]!==null&&c[y]!==void 0&&(R=p.noQuotesForNativeAttributes&&typeof c[y]!="string"?"":'"',P=""+c[y],P=P.replace(/"/g,"&quot;"),F="attributeNameFn"in p?p.attributeNameFn(y,P,r,s):y,B.push(p.spaces&&p.indentAttributes?h(p,m+1,!1):" "),B.push(F+"="+R+("attributeValueFn"in p?p.attributeValueFn(P,y,r,s):P)+R));return c&&Object.keys(c).length&&p.spaces&&p.indentAttributes&&B.push(h(p,m,!1)),B.join("")}function d(c,p,m){return s=c,r="xml",p.ignoreDeclaration?"":"<?xml"+o(c[p.attributesKey],p,m)+"?>"}function _(c,p,m){if(p.ignoreInstruction)return"";var y;for(y in c)if(c.hasOwnProperty(y))break;var P="instructionNameFn"in p?p.instructionNameFn(y,c[y],r,s):y;if(typeof c[y]=="object")return s=c,r=P,"<?"+P+o(c[y][p.attributesKey],p,m)+"?>";var F=c[y]?c[y]:"";return"instructionFn"in p&&(F=p.instructionFn(F,y,r,s)),"<?"+P+(F?" "+F:"")+"?>"}function b(c,p){return p.ignoreComment?"":"<!--"+("commentFn"in p?p.commentFn(c,r,s):c)+"-->"}function f(c,p){return p.ignoreCdata?"":"<![CDATA["+("cdataFn"in p?p.cdataFn(c,r,s):c.replace("]]>","]]]]><![CDATA[>"))+"]]>"}function v(c,p){return p.ignoreDoctype?"":"<!DOCTYPE "+("doctypeFn"in p?p.doctypeFn(c,r,s):c)+">"}function A(c,p){return p.ignoreText?"":(c=""+c,c=c.replace(/&amp;/g,"&"),c=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"textFn"in p?p.textFn(c,r,s):c)}function x(c,p){var m;if(c.elements&&c.elements.length)for(m=0;m<c.elements.length;++m)switch(c.elements[m][p.typeKey]){case"text":if(p.indentText)return!0;break;case"cdata":if(p.indentCdata)return!0;break;case"instruction":if(p.indentInstruction)return!0;break;case"doctype":case"comment":case"element":return!0;default:return!0}return!1}function C(c,p,m){s=c,r=c.name;var y=[],P="elementNameFn"in p?p.elementNameFn(c.name,c):c.name;y.push("<"+P),c[p.attributesKey]&&y.push(o(c[p.attributesKey],p,m));var F=c[p.elementsKey]&&c[p.elementsKey].length||c[p.attributesKey]&&c[p.attributesKey]["xml:space"]==="preserve";return F||("fullTagEmptyElementFn"in p?F=p.fullTagEmptyElementFn(c.name,c):F=p.fullTagEmptyElement),F?(y.push(">"),c[p.elementsKey]&&c[p.elementsKey].length&&(y.push(M(c[p.elementsKey],p,m+1)),s=c,r=c.name),y.push(p.spaces&&x(c,p)?`
`+Array(m+1).join(p.spaces):""),y.push("</"+P+">")):y.push("/>"),y.join("")}function M(c,p,m,y){return c.reduce(function(P,F){var R=h(p,m,y&&!P);switch(F.type){case"element":return P+R+C(F,p,m);case"comment":return P+R+b(F[p.commentKey],p);case"doctype":return P+R+v(F[p.doctypeKey],p);case"cdata":return P+(p.indentCdata?R:"")+f(F[p.cdataKey],p);case"text":return P+(p.indentText?R:"")+A(F[p.textKey],p);case"instruction":var B={};return B[F[p.nameKey]]=F[p.attributesKey]?F:F[p.instructionKey],P+(p.indentInstruction?R:"")+_(B,p,m)}},"")}function I(c,p,m){var y;for(y in c)if(c.hasOwnProperty(y))switch(y){case p.parentKey:case p.attributesKey:break;case p.textKey:if(p.indentText||m)return!0;break;case p.cdataKey:if(p.indentCdata||m)return!0;break;case p.instructionKey:if(p.indentInstruction||m)return!0;break;case p.doctypeKey:case p.commentKey:return!0;default:return!0}return!1}function w(c,p,m,y,P){s=c,r=p;var F="elementNameFn"in m?m.elementNameFn(p,c):p;if(typeof c>"u"||c===null||c==="")return"fullTagEmptyElementFn"in m&&m.fullTagEmptyElementFn(p,c)||m.fullTagEmptyElement?"<"+F+"></"+F+">":"<"+F+"/>";var R=[];if(p){if(R.push("<"+F),typeof c!="object")return R.push(">"+A(c,m)+"</"+F+">"),R.join("");c[m.attributesKey]&&R.push(o(c[m.attributesKey],m,y));var B=I(c,m,!0)||c[m.attributesKey]&&c[m.attributesKey]["xml:space"]==="preserve";if(B||("fullTagEmptyElementFn"in m?B=m.fullTagEmptyElementFn(p,c):B=m.fullTagEmptyElement),B)R.push(">");else return R.push("/>"),R.join("")}return R.push(l(c,m,y+1,!1)),s=c,r=p,p&&R.push((P?h(m,y,!1):"")+"</"+F+">"),R.join("")}function l(c,p,m,y){var P,F,R,B=[];for(F in c)if(c.hasOwnProperty(F))for(R=i(c[F])?c[F]:[c[F]],P=0;P<R.length;++P){switch(F){case p.declarationKey:B.push(d(R[P],p,m));break;case p.instructionKey:B.push((p.indentInstruction?h(p,m,y):"")+_(R[P],p,m));break;case p.attributesKey:case p.parentKey:break;case p.textKey:B.push((p.indentText?h(p,m,y):"")+A(R[P],p));break;case p.cdataKey:B.push((p.indentCdata?h(p,m,y):"")+f(R[P],p));break;case p.doctypeKey:B.push(h(p,m,y)+v(R[P],p));break;case p.commentKey:B.push(h(p,m,y)+b(R[P],p));break;default:B.push(h(p,m,y)+w(R[P],F,p,m,I(R[P],p)))}y=y&&!B.length}return B.join("")}e.exports=function(c,p){p=u(p);var m=[];return s=c,r="_root_",p.compact?m.push(l(c,p,0,!0)):(c[p.declarationKey]&&m.push(d(c[p.declarationKey],p,0)),c[p.elementsKey]&&c[p.elementsKey].length&&m.push(M(c[p.elementsKey],p,0,!m.length))),m.join("")}},{"./array-helper":29,"./options-helper":33}],32:[function(n,e,a){(function(t){(function(){var i=n("./js2xml.js");e.exports=function(s,r){s instanceof t&&(s=s.toString());var u=null;if(typeof s=="string")try{u=JSON.parse(s)}catch{throw new Error("The JSON structure is invalid")}else u=s;return i(u,r)}}).call(this)}).call(this,n("buffer").Buffer)},{"./js2xml.js":31,buffer:3}],33:[function(n,e,a){var t=n("./array-helper").isArray;e.exports={copyOptions:function(i){var s,r={};for(s in i)i.hasOwnProperty(s)&&(r[s]=i[s]);return r},ensureFlagExists:function(i,s){(!(i in s)||typeof s[i]!="boolean")&&(s[i]=!1)},ensureSpacesExists:function(i){(!("spaces"in i)||typeof i.spaces!="number"&&typeof i.spaces!="string")&&(i.spaces=0)},ensureAlwaysArrayExists:function(i){(!("alwaysArray"in i)||typeof i.alwaysArray!="boolean"&&!t(i.alwaysArray))&&(i.alwaysArray=!1)},ensureKeyExists:function(i,s){(!(i+"Key"in s)||typeof s[i+"Key"]!="string")&&(s[i+"Key"]=s.compact?"_"+i:i)},checkFnExists:function(i,s){return i+"Fn"in s}}},{"./array-helper":29}],34:[function(n,e,a){var t=n("sax"),i=n("./options-helper"),s=n("./array-helper").isArray,r,u;function h(w){return r=i.copyOptions(w),i.ensureFlagExists("ignoreDeclaration",r),i.ensureFlagExists("ignoreInstruction",r),i.ensureFlagExists("ignoreAttributes",r),i.ensureFlagExists("ignoreText",r),i.ensureFlagExists("ignoreComment",r),i.ensureFlagExists("ignoreCdata",r),i.ensureFlagExists("ignoreDoctype",r),i.ensureFlagExists("compact",r),i.ensureFlagExists("alwaysChildren",r),i.ensureFlagExists("addParent",r),i.ensureFlagExists("trim",r),i.ensureFlagExists("nativeType",r),i.ensureFlagExists("nativeTypeAttributes",r),i.ensureFlagExists("sanitize",r),i.ensureFlagExists("instructionHasAttributes",r),i.ensureFlagExists("captureSpacesBetweenElements",r),i.ensureAlwaysArrayExists(r),i.ensureKeyExists("declaration",r),i.ensureKeyExists("instruction",r),i.ensureKeyExists("attributes",r),i.ensureKeyExists("text",r),i.ensureKeyExists("comment",r),i.ensureKeyExists("cdata",r),i.ensureKeyExists("doctype",r),i.ensureKeyExists("type",r),i.ensureKeyExists("name",r),i.ensureKeyExists("elements",r),i.ensureKeyExists("parent",r),i.checkFnExists("doctype",r),i.checkFnExists("instruction",r),i.checkFnExists("cdata",r),i.checkFnExists("comment",r),i.checkFnExists("text",r),i.checkFnExists("instructionName",r),i.checkFnExists("elementName",r),i.checkFnExists("attributeName",r),i.checkFnExists("attributeValue",r),i.checkFnExists("attributes",r),r}function o(w){var l=Number(w);if(!isNaN(l))return l;var c=w.toLowerCase();return c==="true"?!0:c==="false"?!1:w}function d(w,l){var c;if(r.compact){if(!u[r[w+"Key"]]&&(s(r.alwaysArray)?r.alwaysArray.indexOf(r[w+"Key"])!==-1:r.alwaysArray)&&(u[r[w+"Key"]]=[]),u[r[w+"Key"]]&&!s(u[r[w+"Key"]])&&(u[r[w+"Key"]]=[u[r[w+"Key"]]]),w+"Fn"in r&&typeof l=="string"&&(l=r[w+"Fn"](l,u)),w==="instruction"&&("instructionFn"in r||"instructionNameFn"in r)){for(c in l)if(l.hasOwnProperty(c))if("instructionFn"in r)l[c]=r.instructionFn(l[c],c,u);else{var p=l[c];delete l[c],l[r.instructionNameFn(c,p,u)]=p}}s(u[r[w+"Key"]])?u[r[w+"Key"]].push(l):u[r[w+"Key"]]=l}else{u[r.elementsKey]||(u[r.elementsKey]=[]);var m={};if(m[r.typeKey]=w,w==="instruction"){for(c in l)if(l.hasOwnProperty(c))break;m[r.nameKey]="instructionNameFn"in r?r.instructionNameFn(c,l,u):c,r.instructionHasAttributes?(m[r.attributesKey]=l[c][r.attributesKey],"instructionFn"in r&&(m[r.attributesKey]=r.instructionFn(m[r.attributesKey],c,u))):("instructionFn"in r&&(l[c]=r.instructionFn(l[c],c,u)),m[r.instructionKey]=l[c])}else w+"Fn"in r&&(l=r[w+"Fn"](l,u)),m[r[w+"Key"]]=l;r.addParent&&(m[r.parentKey]=u),u[r.elementsKey].push(m)}}function _(w){if("attributesFn"in r&&w&&(w=r.attributesFn(w,u)),(r.trim||"attributeValueFn"in r||"attributeNameFn"in r||r.nativeTypeAttributes)&&w){var l;for(l in w)if(w.hasOwnProperty(l)&&(r.trim&&(w[l]=w[l].trim()),r.nativeTypeAttributes&&(w[l]=o(w[l])),"attributeValueFn"in r&&(w[l]=r.attributeValueFn(w[l],l,u)),"attributeNameFn"in r)){var c=w[l];delete w[l],w[r.attributeNameFn(l,w[l],u)]=c}}return w}function b(w){var l={};if(w.body&&(w.name.toLowerCase()==="xml"||r.instructionHasAttributes)){for(var c=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g,p;(p=c.exec(w.body))!==null;)l[p[1]]=p[2]||p[3]||p[4];l=_(l)}if(w.name.toLowerCase()==="xml"){if(r.ignoreDeclaration)return;u[r.declarationKey]={},Object.keys(l).length&&(u[r.declarationKey][r.attributesKey]=l),r.addParent&&(u[r.declarationKey][r.parentKey]=u)}else{if(r.ignoreInstruction)return;r.trim&&(w.body=w.body.trim());var m={};r.instructionHasAttributes&&Object.keys(l).length?(m[w.name]={},m[w.name][r.attributesKey]=l):m[w.name]=w.body,d("instruction",m)}}function f(w,l){var c;if(typeof w=="object"&&(l=w.attributes,w=w.name),l=_(l),"elementNameFn"in r&&(w=r.elementNameFn(w,u)),r.compact){if(c={},!r.ignoreAttributes&&l&&Object.keys(l).length){c[r.attributesKey]={};var p;for(p in l)l.hasOwnProperty(p)&&(c[r.attributesKey][p]=l[p])}!(w in u)&&(s(r.alwaysArray)?r.alwaysArray.indexOf(w)!==-1:r.alwaysArray)&&(u[w]=[]),u[w]&&!s(u[w])&&(u[w]=[u[w]]),s(u[w])?u[w].push(c):u[w]=c}else u[r.elementsKey]||(u[r.elementsKey]=[]),c={},c[r.typeKey]="element",c[r.nameKey]=w,!r.ignoreAttributes&&l&&Object.keys(l).length&&(c[r.attributesKey]=l),r.alwaysChildren&&(c[r.elementsKey]=[]),u[r.elementsKey].push(c);c[r.parentKey]=u,u=c}function v(w){r.ignoreText||!w.trim()&&!r.captureSpacesBetweenElements||(r.trim&&(w=w.trim()),r.nativeType&&(w=o(w)),r.sanitize&&(w=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),d("text",w))}function A(w){r.ignoreComment||(r.trim&&(w=w.trim()),d("comment",w))}function x(w){var l=u[r.parentKey];r.addParent||delete u[r.parentKey],u=l}function C(w){r.ignoreCdata||(r.trim&&(w=w.trim()),d("cdata",w))}function M(w){r.ignoreDoctype||(w=w.replace(/^ /,""),r.trim&&(w=w.trim()),d("doctype",w))}function I(w){w.note=w}e.exports=function(w,l){var c=t.parser(!0,{}),p={};if(u=p,r=h(l),c.opt={strictEntities:!0},c.onopentag=f,c.ontext=v,c.oncomment=A,c.onclosetag=x,c.onerror=I,c.oncdata=C,c.ondoctype=M,c.onprocessinginstruction=b,c.write(w).close(),p[r.elementsKey]){var m=p[r.elementsKey];delete p[r.elementsKey],p[r.elementsKey]=m,delete p.text}return p}},{"./array-helper":29,"./options-helper":33,sax:10}],35:[function(n,e,a){var t=n("./options-helper"),i=n("./xml2js");function s(r){var u=t.copyOptions(r);return t.ensureSpacesExists(u),u}e.exports=function(r,u){var h,o,d,_;return h=s(u),o=i(r,h),_="compact"in h&&h.compact?"_parent":"parent","addParent"in h&&h.addParent?d=JSON.stringify(o,function(b,f){return b===_?"_":f},h.spaces):d=JSON.stringify(o,null,h.spaces),d.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}},{"./options-helper":33,"./xml2js":34}],36:[function(n,e,a){var t,i;i=function(s,r,u){var h,o;return h=r*Math.min(u,1-u),o=function(d,_=(d+s*12)%12){return u-h*Math.max(Math.min(_-3,9-_,1),-1)},[o(0),o(8),o(4)].map(function(d){return d})},t=["red","green","blue","hue","saturation","lightness","value","cyan","magenta","yellow","key","alpha","x","y","z","l","a","b"],e.exports=class{constructor(r){var u,h,o,d,_,b,f,v;for({red:this.red,green:this.green,blue:this.blue,hue:this.hue,saturation:this.saturation,value:this.value,lightness:this.lightness,cyan:h,magenta:b,yellow:v,key:d,alpha:this.alpha,name:this.name}=r,o=0,_=t.length;o<_;o++)if(u=t[o],r[u]!=null){if(!isFinite(r[u])||typeof r[u]!="number")throw new TypeError(`Color component option ${u} is not a finite number: ${JSON.stringify(r[u])}`);if(r[u]<0||r[u]>1)throw new TypeError(`Color component option ${u} outside range of [0,1]: ${r[u]}`)}if(f=function(){throw new TypeError(`Color constructor must be called with {red,green,blue} or {hue,saturation,value} or {hue,saturation,lightness} or {cyan,magenta,yellow,key} or {x,y,z} or {l,a,b}, ${function(){try{return`got ${JSON.stringify(r)}`}catch{return"got something that couldn't be displayed with JSON.stringify for this error message"}}()}`)},!(this.red!=null&&this.green!=null&&this.blue!=null))if(this.hue!=null&&this.saturation!=null){if(this.value!=null)this.lightness=(2-this.saturation)*this.value/2,this.saturation=this.saturation*this.value/(this.lightness<.5?this.lightness*2:2-this.lightness*2),isNaN(this.saturation)&&(this.saturation=0);else if(this.lightness==null){if(r.brightness!=null)throw new TypeError("{hue, saturation, brightness} not supported. Use {hue, saturation, value} instead for an equivalent color space");f()}[this.red,this.green,this.blue]=i(this.hue,this.saturation,this.lightness)}else{if(h!=null&&b!=null&&v!=null&&d!=null)throw new Error("CMYK color space is not currently supported");if(r.l!=null&&r.a!=null&&r.b!=null)throw new Error("L*a*b* color space is not currently supported");if(r.x!=null&&r.y!=null&&r.z!=null)throw new Error("XYZ color space is not currently supported");f()}}toString(){if(this.hue!=null)return this.alpha!=null?`hsla(${this.hue*360}, ${this.saturation*100}%, ${this.lightness*100}%, ${this.alpha})`:`hsl(${this.hue*360}, ${this.saturation*100}%, ${this.lightness*100}%)`;if(this.red!=null)return this.alpha!=null?`rgba(${this.red*255}, ${this.green*255}, ${this.blue*255}, ${this.alpha})`:`rgb(${this.red*255}, ${this.green*255}, ${this.blue*255})`}static is(r,u,h=1e-4){var o,d;return Math.abs(r.red-u.red)<h&&Math.abs(r.green-u.green)<h&&Math.abs(r.blue-u.blue)<h&&Math.abs(((o=r.alpha)!=null?o:1)-((d=u.alpha)!=null?d:1))<h}}},{}],37:[function(n,e,a){var t,i;t=n("./Color"),i=["r","g","b","h","s","l","v","x","y","z","a","b","c","m","y","k","red","green","blue","hue","saturation","lightness","value","cyan","magenta","yellow","key","alpha"],e.exports=class extends Array{constructor(...r){super(...r),this.name=void 0,this.description=void 0,this.numberOfColumns=void 0,this.geometrySpecifiedByFile=void 0}add(r){var u,h,o,d;for(h=0,o=i.length;h<o;h++)if(u=i[h],r[u]!=null){if(!isFinite(r[u])||typeof r[u]!="number")throw new TypeError(`palette.add() component option ${u} is not a finite number: ${JSON.stringify(r[u])}`);if(r[u]<0||r[u]>1)throw new TypeError(`palette.add() component option ${u} outside range of [0,1]: ${r[u]}`)}return d=r instanceof t?r:new t(r),this.push(d)}}},{"./Color":36}],38:[function(n,e,a){var t,i,s,r,u;u=n("jdataview"),i=n("../Palette"),t=2**16-1,s=Object.freeze({RGB:0,HSB:1,CMYK:2,PANTONE:3,FOCOLTONE:4,TRUMATCH:5,TOYO:6,LAB:7,GRAYSCALE:8,WIDE_CMYK:9,HKS:10,DIC:11,TOTAL_INK:12,MONITOR_RGB:13,DUOTONE:14,OPACITY:15,WEB:16,GRAY_FLOAT:17,RGB_FLOAT:18,OPACITY_FLOAT:19,0:"RGB",1:"HSB",2:"CMYK",3:"PANTONE",4:"FOCOLTONE",5:"TRUMATCH",6:"TOYO",7:"LAB",8:"GRAYSCALE",9:"WIDE_CMYK",10:"HKS",11:"DIC",12:"TOTAL_INK",13:"MONITOR_RGB",14:"DUOTONE",15:"OPACITY",16:"WEB",17:"GRAY_FLOAT",18:"RGB_FLOAT",19:"OPACITY_FLOAT"}),r=function(h,o,d){var _,b,f;for(d&&(o-=1),f="",_=0,b=o;0<=b?_<b:_>b;0<=b?_++:_--)f+=String.fromCharCode(h.getUint16());return d&&h.getUint16(),f},e.exports.read_adobe_color_swatch=function({data:h}){var o,d,_,b,f,v,A,x,C,M,I,w,l;if(C=new i,l=new u(h),M=function(c){var p,m,y,P,F,R,B;switch(p=l.getUint16(),P=l.getUint16()/t,F=l.getUint16()/t,R=l.getUint16()/t,B=l.getUint16()/t,c?(l.getUint16(),m=l.getUint16(),y=r(l,m,!0)):y=void 0,p){case s.RGB:return C.add({red:P,green:F,blue:R,name:y});case s.HSB:return C.add({hue:P,saturation:F,value:R,name:y});case s.CMYK:case s.WIDE_CMYK:return C.add({cyan:P,magenta:F,yellow:R,key:B,name:y});case s.LAB:return C.add({l:P,a:F,b:R,name:y});case s.GRAYSCALE:return C.add({red:P,green:P,blue:P,name:y})}},o=l.getUint16(),x=l.getUint16(),o!==1)throw new Error("Not an Adobe Color Swatch file");if(f=4,_=f+x*(5*2),l.byteLength<=_){for(v=0,I=x;0<=I?v<I:v>I;0<=I?v++:v--)M(!1);return C}if(l.seek(_),b=l.getUint16(),d=l.getUint16(),b!==2)throw new Error("Not an Adobe Color Swatch file v2");if(d!==x)throw new Error("Number of colors mismatch between ACO v1 and v2 sections");for(A=0,w=x;0<=w?A<w:A>w;0<=w?A++:A--)M(!0);return C},e.exports.write_adobe_color_swatch=function(h){var o,d,_,b,f,v,A,x,C,M,I;for(I=function(w,l){var c,p,m,y,P,F,R,B,V,Z,ne,H;for(Z=(ne=w.name)!=null?ne:w.toString(),p=s.RGB,P=[w.red,w.green,w.blue,0],H=2+P.length*2,l&&(H+=2+2+(Z.length+1)*2),m=new u(H),m.writeUint16(p),F=0,B=P.length;F<B;F++)y=P[F],m.writeUint16(y*t);if(l){for(m.writeUint16(0),m.writeUint16(Z.length+1),R=0,V=Z.length;R<V;R++)c=Z[R],m.writeUint16(c.charCodeAt(0));m.writeUint16(0)}return m.buffer},o=function(){var w,l,c;for(c=[],w=0,l=h.length;w<l;w++)b=h[w],c.push(I(b,!1));return c}(),d=function(){var w,l,c;for(c=[],w=0,l=h.length;w<l;w++)b=h[w],c.push(I(b,!0));return c}(),f=2+2+o.reduce(function(w,l){return w+l.byteLength},0)+2+2+d.reduce(function(w,l){return w+l.byteLength},0),v=new u(f),v.writeUint16(1),v.writeUint16(h.length),A=0,C=o.length;A<C;A++)_=o[A],v.writeBytes(new Uint8Array(_));for(v.writeUint16(2),v.writeUint16(h.length),x=0,M=d.length;x<M;x++)_=d[x],v.writeBytes(new Uint8Array(_));return v.buffer},e.exports.read_adobe_swatch_exchange=function({data:h}){var o,d,_,b,f,v,A,x,C,M,I,w,l,c,p,m,y,P,F;if(m=new i,P=new u(h),P.getString(4)!=="ASEF")throw new Error("Not an Adobe Swatch Exchange file");for(P.getUint32(),p=P.getUint32(),_=49153,d=49154,o=1,b="CMYK",v="RGB ",f="GRAY",F=[],w=0,y=p;0<=y?w<y:w>y;0<=y?w++:w--){switch(C=P.getUint16(),x=P.getUint32(),A=P.tell()+x,C){case _:c=P.getUint16(),l=r(P,c,!0),F.push({name:l});break;case d:F.pop();break;case o:switch(c=P.getUint16(),l=r(P,c,!0),M=P.getString(4),M){case b:m.add({cyan:P.getFloat32(),magenta:P.getFloat32(),yellow:P.getFloat32(),key:P.getFloat32(),name:l});break;case v:m.add({red:P.getFloat32(),green:P.getFloat32(),blue:P.getFloat32(),name:l});break;case f:I=P.getFloat32(),m.add({red:I,green:I,blue:I,name:l})}P.getUint16()}P.seek(A)}return m},e.exports.write_adobe_swatch_exchange=function(h){var o,d,_,b,f,v,A,x,C,M,I,w,l,c,p,m,y,P,F,R,B,V,Z;for(o=1,_="RGB ",d=0,x=[],B=0,l=0,m=h.length;l<m;l++){for(I=h[l],F=(R=I.name)!=null?R:I.toString(),v=o,C=2+(F.length+1)*2+4+3*4+2,f=2+4+C,A=u(f),A.writeUint16(v),A.writeUint32(C),A.writeUint16(F.length+1),c=0,y=F.length;c<y;c++)M=F[c],A.writeUint16(M.charCodeAt(0));A.writeUint16(0),A.writeString(_),A.writeFloat32(I.red),A.writeFloat32(I.green),A.writeFloat32(I.blue),A.writeUint16(d),x.push(A.buffer),B+=f}for(w=4+4+4+B,Z=new u(w),Z.writeString("ASEF"),V=1,Z.writeUint32(V),Z.writeUint32(x.length),p=0,P=x.length;p<P;p++)b=x[p],Z.writeBytes(new Uint8Array(b));return Z.buffer},e.exports.read_adobe_color_book=function({data:h}){var o,d,_,b,f,v,A,x,C,M,I,w,l,c,p,m,y,P;if(l=new i,P=new u(h),m=P.getString(4),m!=="8BCB")throw new Error("Not an Adobe Color Book");if(y=P.getUint16(),y!==1)throw new Error(`Unknown Adobe Color Book version: ${y}?`);for(I=function(F){var R;return R=F.replace(/^"(.*)"$/,"$1"),R.startsWith("$$$")&&(R=R.split("=")[1]),R=R.replace("^R","®"),R=R.replace("^C","©"),R},P.getUint16(),b=I(r(P,P.getUint32(),!1)),x=I(r(P,P.getUint32(),!1)),C=I(r(P,P.getUint32(),!1)),_=I(r(P,P.getUint32())),v=P.getUint16(),P.getUint16(),P.getUint16(),M=P.getUint16(),w=0,p=v;0<=p?w<p:w>p;0<=p?w++:w--)switch(A=I(r(P,P.getUint32(),!1)),f=P.getString(6).trim(),f=f.replace(/^0*(\d+)$/,"$1"),f=f.replace("X","-"),f&&!A&&(c=f.lastIndexOf(C.trim()),A=c>=0?f.slice(0,c):f),o=function(F){if(!(!A.trim()&&!f.trim()))return F.name=x+A+C,l.add(F)},d=function(){throw new Error(`Color space #${M} (${s[M]}) not supported.`)},M){case 0:o({red:P.getUint8()/255,green:P.getUint8()/255,blue:P.getUint8()/255});break;case 1:o({hue:P.getUint8()/255,saturation:P.getUint8()/255,value:P.getUint8()/255});break;case 2:o({cyan:1-P.getUint8()/255,magenta:1-P.getUint8()/255,yellow:1-P.getUint8()/255,key:1-P.getUint8()/255});break;case 3:d();break;case 4:d();break;case 5:d();break;case 6:d();break;case 7:o({l:P.getUint8()/255,a:P.getUint8()/255,b:P.getUint8()/255});break;case 8:d();break;case 9:d();break;case 10:d();break;default:d()}return l.name=b,l.description=_,l}},{"../Palette":37,jdataview:7}],39:[function(n,e,a){var t,i;i=n("jdataview"),t=n("../Palette"),e.exports=function({data:s,fileExt:r}){var u,h,o,d;if(h=new t,d=new i(s),!((o=d.byteLength)===768||o===772||r==="act"))throw new Error(`file size must be 768 or 772 bytes (saw ${d.byteLength}), OR file extension must be '.act' (saw '.${r}')`);for(var u=0;u<256;u++)h.add({red:d.getUint8()/255,green:d.getUint8()/255,blue:d.getUint8()/255});return h.numberOfColumns=16,h},e.exports.write=function(s){var r,u,h;for(h=new i(256*3),r=u=0;u<256;r=++u)h.writeUint8(s[r]?Math.round(s[r].red*255):0),h.writeUint8(s[r]?Math.round(s[r].green*255):0),h.writeUint8(s[r]?Math.round(s[r].blue*255):0);return h.buffer}},{"../Palette":37,jdataview:7}],40:[function(n,e,a){var t,i;i=n("css.escape"),t=n("../Palette"),e.exports=function({fileContentString:s}){var r,u,h,o,d,_,b,f,v,A,x,C,M,I,w,l,c;for(v=0,h=0,d=s.length;h<d;h++)r=s[h],(r==="\0"||r===""||r===""||r===""||r===""||r===""||r===""||r==="\x07"||r==="\b"||r==="\v"||r==="\f"||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r==="\x1B"||r===""||r===""||r===""||r===""||r==="")&&v++;if(v>5)throw new Error("looks like a binary file");for(c=[x=new t,C=new t,w=new t,M=new t,I=new t,l=new t],u=function(p){return parseInt(p,16)},s.replace(/\#([0-9A-F]{3}|[0-9A-F]{6}|[0-9A-F]{4}|[0-9A-F]{8})(?![0-9A-F])/gim,function(p,m){return m.length>4?x.add({red:u(m[0]+m[1])/255,green:u(m[2]+m[3])/255,blue:u(m[4]+m[5])/255,alpha:m.length===8?u(m[6]+m[7])/255:void 0}):C.add({red:u(m[0]+m[0])/255,green:u(m[1]+m[1])/255,blue:u(m[2]+m[2])/255,alpha:m.length===4?u(m[3]+m[3])/255:void 0})}),s.replace(/rgb\(\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*\)/gim,function(p,m,y,P,F,R,B){return w.add({red:Number(m)/(y==="%"?100:255),green:Number(P)/(F==="%"?100:255),blue:Number(R)/(B==="%"?100:255)})}),s.replace(/rgba?\(\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\/)\s*([0-9]*\.?[0-9]+)(%?)\s*\)/gim,function(p,m,y,P,F,R,B,V,Z){return l.add({red:Number(m)/(y==="%"?100:255),green:Number(P)/(F==="%"?100:255),blue:Number(R)/(B==="%"?100:255),alpha:Number(V)/(Z==="%"?100:1)})}),s.replace(/hsl\(\s*([0-9]*\.?[0-9]+)(deg|rad|turn|)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*\)/gim,function(p,m,y,P,F,R,B){return M.add({hue:Number(m)/(y==="rad"?2*Math.PI:y==="turn"?1:360),saturation:Number(P)/(F==="%"?100:1),lightness:Number(R)/(B==="%"?100:1)})}),s.replace(/hsla?\(\s*([0-9]*\.?[0-9]+)(deg|rad|turn|)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\s)\s*([0-9]*\.?[0-9]+)(%?)\s*(?:,|\/)\s*([0-9]*\.?[0-9]+)(%?)\s*\)/gim,function(p,m,y,P,F,R,B,V,Z){return I.add({hue:Number(m)/(y==="rad"?2*Math.PI:y==="turn"?1:360),saturation:Number(P)/(F==="%"?100:1),lightness:Number(R)/(B==="%"?100:1),alpha:Number(V)/(Z==="%"?100:1)})}),b=[],o=0,_=c.length;o<_;o++)A=c[o],A.length>=b.length&&(b=A);if(f=b.length,f<4)throw new Error(["No colors found","Only one color found","Only a couple colors found","Only a few colors found"][f]+` (${f})`);return b},e.exports.write_css=function(s){return`:root {
	${s.map(function(r,u){return`--${r.name?i(r.name.replace(/\s/g,"-")):`color-${u+1}`}: ${r};`}).join(`
	`)}
}`},e.exports.write_styl=function(s){return s.map(function(r,u){return`${r.name?i(r.name.replace(/\s/g,"-")):`color-${u+1}`} = ${r};`}).join(`
`)},e.exports.write_less=function(s){return s.map(function(r,u){return`@${r.name?i(r.name.replace(/\s/g,"-")):`color-${u+1}`}: ${r};`}).join(`
`)},e.exports.write_scss=function(s){return s.map(function(r,u){return`$${r.name?i(r.name.replace(/\s/g,"-")):`color-${u+1}`}: ${r};`}).join(`
`)},e.exports.write_sass=function(s){return s.map(function(r,u){return`$${r.name?i(r.name.replace(/\s/g,"-")):`color-${u+1}`}: ${r}`}).join(`
`)}},{"../Palette":37,"css.escape":4}],41:[function(n,e,a){var t,i;i=n("jdataview"),t=n("../Palette"),e.exports=function({data:s,fileExt:r}){var u,h,o,d,_,b,f;if(r!=="cs")throw new Error(`ColorSchemer loader is only enabled when file extension is '.cs' (saw '.${r}' instead)`);for(_=new t,d=!0,f=new i(s,0,void 0,d),f.getUint16(),u=f.getUint16(),h=o=0,b=u;0<=b?o<b:o>b;h=0<=b?++o:--o)f.seek(8+h*26),_.add({red:f.getUint8()/255,green:f.getUint8()/255,blue:f.getUint8()/255});return _}},{"../Palette":37,jdataview:7}],42:[function(n,e,a){var t,i,s;t=n("../Palette"),i=function(r,u){var h,o,d,_,b,f;if(d=r.split(/\r?\n/),d[0]!==u)throw new Error(`Not a ${u}`);for(b=new t,o=0;(o+=1)<d.length;)if(h=d[o],!(h[0]==="#"||h==="")){if(_=h.match(/Name:\s*(.*)/),_){b.name=_[1];continue}if(_=h.match(/Columns:\s*(.*)/),_){b.numberOfColumns=Number(_[1]),b.geometrySpecifiedByFile=!0;continue}if(f=h.match(/^\s*([0-9]+)\s+([0-9]+)\s+([0-9]+)(?:\s+(.*))?$/),!f)throw new Error(`Line ${o+1} doesn't match pattern of red green blue name`);b.add({red:Number(f[1])/255,green:Number(f[2])/255,blue:Number(f[3])/255,name:f[4]})}return b},e.exports=function({fileContentString:r}){return i(r,"GIMP Palette")},s=function(r,u){return`${u||"GIMP Palette"}
Name: ${r.name||"Saved Colors"}
Columns: ${r.numberOfColumns||8}
#
${r.map(h=>{var o,d,_;return{red:_,green:d,blue:o}=h,`${[_,d,o].map(b=>`${Math.round(b*255)}`.padEnd(3," ")).join(" ")}   ${h.name||h}`}).join(`
`)}`},e.exports.write=function(r){return s(r,"GIMP Palette")},e.exports.extension="gpl",e.exports.write_gimp_or_kde_rgb_palette=s,e.exports.parse_gimp_or_kde_rgb_palette=i},{"../Palette":37}],43:[function(n,e,a){var t;t=n("../Palette"),e.exports=function({fileContentString:i}){var s,r,u,h,o,d;if(h=i.split(/\r?\n/),h[0]!=="Palette")throw new Error("Not a Homesite palette");if(!h[1].match(/Version [34]\.0/))throw new Error("Unsupported Homesite palette version");for(d=new t,s=0,r=h.length;s<r;s++)u=h[s],o=u.match(/(\d+)\s+(\d+)\s+(\d+)/),o&&d.add({red:Number(o[1])/255,green:Number(o[2])/255,blue:Number(o[3])/255});return d},e.exports.write=function(i){return`Palette
Version 4.0
-----------
${i.map(function(s){return`${Math.round(s.red*255)} ${Math.round(s.green*255)} ${Math.round(s.blue*255)}`}).join(`
`)}`}},{"../Palette":37}],44:[function(n,e,a){var t,i;({parse_gimp_or_kde_rgb_palette:t,write_gimp_or_kde_rgb_palette:i}=n("./GIMP")),e.exports=function({fileContentString:s}){return t(s,"KDE RGB Palette")},e.exports.write=function(s){return i(s,"KDE RGB Palette")},e.exports.extension="colors"},{"./GIMP":42}],45:[function(n,e,a){var t;t=n("../Palette"),e.exports=function({fileContentString:i}){var s,r,u,h,o,d,_;for(d=new t,s=function(b){return parseInt(b,16)},_=i.split(/\r?\n/),r=0,u=_.length;r<u;r++)h=_[r],o=h.match(/^([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i),o&&d.add({alpha:s(o[1])/255,red:s(o[2])/255,green:s(o[3])/255,blue:s(o[4])/255});return d},e.exports.write=function(i){var s,r,u;return r=function(h){var o;return o=Math.round(h*255).toString(16),o.length===1?`0${o}`:o},u=function(h){var o,d,_,b;return{alpha:o,red:b,green:_,blue:d}=h,o==null&&(o=1),[o,b,_,d].map(r).join("")},s=`Paint.NET Palette File
Lines that start with a semicolon are comments
Colors are written as 8-digit hexadecimal numbers: aarrggbb
For example, this would specify green: FF00FF00
The alpha ('aa') value specifies how transparent a color is. FF is fully opaque, 00 is fully transparent.
A palette must consist of ninety six (96) colors. If there are less than this, the remaining color
slots will be set to white (FFFFFFFF). If there are more, then the remaining colors will be ignored.

`,i.name&&(s+=`Palette Name: ${i.name}
`),i.description&&(s+=`Description: ${i.description}
`),s+=`Colors: ${i.length}
`,i.numberOfColumns&&(s+=`Columns: ${i.numberOfColumns}
`),s=`; ${s}`.replace(/\n/g,`
; `).replace(/\s*\n/g,`
`),`${s}
${i.map(u).join(`
`)}`}},{"../Palette":37}],46:[function(n,e,a){var t;t=n("../Palette"),e.exports=function({fileContentString:i}){var s,r,u,h,o,d,_;if(o=i.split(/[\n\r]+/m),o[0]!=="JASC-PAL")throw new Error("Not a JASC-PAL");if(o[1]!=="0100")throw new Error("Unknown JASC-PAL version");for(d=new t,s=r=0,u=o.length;r<u;s=++r)h=o[s],h!==""&&s>2&&(_=h.split(" "),d.add({red:Number(_[0])/255,green:Number(_[1])/255,blue:Number(_[2])/255}));return d},e.exports.write=function(i){return`JASC-PAL
0100
${i.length}
${i.map(function(s){return`${Math.round(s.red*255)} ${Math.round(s.green*255)} ${Math.round(s.blue*255)}`}).join(`
`)}`}},{"../Palette":37}],47:[function(n,e,a){var t,i;i=n("jdataview"),t=n("../Palette"),e.exports=function({data:s}){var r,u,h,o,d,_,b,f,v,A;if(o=!0,A=new i(s,0,void 0,o),f=A.getString(4),A.getUint32(),v=A.getString(4),f!=="RIFF")throw new Error("RIFF header not found; not a RIFF PAL file");if(v!=="PAL ")throw new Error(`RIFF header says this isn't a PAL file,
more of a sort of ${(v+"").trim()} file`);if(r=A.getString(4),A.getUint32(),d=A.getUint16(),u=A.getUint16(),r!=="data")throw new Error(`Data chunk not found (...'${r}'?)`);if(d!==768)throw new Error(`Unsupported PAL file format version: 0x${d.toString(16)}`);for(_=new t,h=0,b=u;0<=b?h<b:h>b;0<=b?h++:h--)_.add({red:A.getUint8()/255,green:A.getUint8()/255,blue:A.getUint8()/255}),A.getUint8();return _},e.exports.write=function(s){var r,u,h,o,d,_,b,f;for(u=2+2+4*s.length,h=4+4+u,o=4+4+4+h,f=!0,d=new i(o,0,void 0,f),d.writeString("RIFF"),d.writeUint32(h+4),d.writeString("PAL "),d.writeString("data"),d.writeUint32(u),d.writeUint16(768),d.writeUint16(s.length),_=0,b=s.length;_<b;_++)r=s[_],d.writeUint8(Math.round(r.red*255)),d.writeUint8(Math.round(r.green*255)),d.writeUint8(Math.round(r.blue*255)),d.writeUint8(0);return d.buffer}},{"../Palette":37,jdataview:7}],48:[function(n,e,a){var t,i;t=n("../Palette"),{parse_css_hex_color:i}=n("../helpers"),e.exports=function({fileContentString:s}){var r,u,h,o,d,_,b,f,v,A,x,C,M,I,w;for(x=s.split(/[\n\r]+/m),I=new t,_={set_name:function(l){return I.name=l},add_comments:function(l){return I.description==null&&(I.description=""),I.description.length>0&&(I.description+=`
`),I.description+=l},set_columns:function(l){return I.numberOfColumns=l,I.geometrySpecifiedByFile=!0},hexcolor:function(l,c){var p;return p=i("#"+l),p.name=c,I.add(p)},rgbcolor:function(l,c,p,m){return I.add({red:l/255,green:c/255,blue:p/255,name:m})},color:function([l,c,p,m]){switch(l){case"RGB":return I.add({red:c[0],green:c[1],blue:c[2],alpha:p,name:m});case"Grayscale":return I.add({red:c[0],green:c[0],blue:c[0],alpha:p,name:m});case"CMYK":return I.add({cyan:c[0],magenta:c[1],yellow:c[2],key:c[3],alpha:p,name:m});case"HSL":return I.add({hue:c[0],saturation:c[1],lightness:c[2],alpha:p,name:m})}}},w=function(l,c){var p,m,y,P,F,R,B;for(p=[],m=0,F=function(){var V,Z;if(Z="",V=l[m],V!=="'"&&V!=='"')throw new Error("Expected to start parsing string on a quote character");for(m+=1;m<l.length;){if(l[m]==="\\")m+=1,l[m]==="\\"?Z+="\\":l[m]==="r"?Z+="\r":l[m]==="n"?Z+=`
`:l[m]==="t"?Z+="	":l[m]==="v"?Z+="\v":l[m]==="a"?Z+="a":l[m]==="b"?Z+="\b":l[m]==="'"?Z+="'":l[m]==='"'?Z+='"':l[m].match(/\d/)||l[m]==="x"||l[m]==="N"||l[m]==="u"||l[m]==="U"||(console.log(`Warning: unecessary escape in python string: \\${l[m]}`),Z+=l[m]);else{if(l[m]===V)return Z;Z+=l[m]}m+=1}throw new SyntaxError(`Expected end of string on line ${c}`)},P=function(){var V;for(V="";m<l.length&&l[m].match(/[\d\.]/);){V+=l[m];m+=1}return m-=1,parseFloat(V)},y=function(){var V,Z,ne;for(m+=1,ne=[];m<l.length;){if(l[m]==="u")if(m+=1,(V=l[m])==="'"||V==='"')ne.push(F());else throw new SyntaxError(`Unexpected 'u${l.slice(m)}' on line ${c}`);else if((Z=l[m])==="'"||Z==='"')ne.push(F());else if(l[m]==="[")ne.push(y());else if(l[m].match(/\d/))ne.push(P());else{if(l[m]==="]")return ne;if(l[m]!==","){if(l[m].match(/\S/))throw new SyntaxError(`Unexpected '${l.slice(m)}' on line ${c}`)}}m+=1}throw new SyntaxError(`Expected end of array on line ${c}`)};m<l.length;){if(l[m]==="u")if(m+=1,(R=l[m])==="'"||R==='"')p.push(F());else throw new SyntaxError(`Unexpected 'u${l.slice(m)}' on line ${c}`);else if((B=l[m])==="'"||B==='"')p.push(F());else if(l[m]==="[")p.push(y());else if(l[m].match(/\d/))p.push(P());else if(l[m]!==","){if(l[m].match(/\S/))throw new SyntaxError(`Unexpected '${l.slice(m)}' on line ${c}`)}m+=1}return p},A=b=0,f=x.length;b<f;A=++b)v=x[A],C=v.match(/([\w_]+)\((.*)\)/),C&&([r,d,h]=C,o=_[d],o&&(u=w(h,A+1),o(...u)));if(M=I.length,M<2)throw new Error(["No colors found","Only one color found"][M]+` (${M})`);return I},e.exports.write=function(s){var r,u,h,o,d,_,b,f,v,A,x,C,M,I,w;if(I=function(l){return`'${l.replace(/[\r\n]+/g," ").replace(/'/g,"\\'")}'`},w=`##sK1 palette
`,w+=`palette()
`,s.name&&(w+=`set_name(${I(s.name)})
`),s.source&&(w+=`set_source(${I(s.source)})
`),s.description)for(x=s.description.split(/\r?\n/g),d=0,f=x.length;d<f;d++)_=x[d],w+=`add_comments(${I(_)})
`;for(s.numberOfColumns&&(w+=`set_columns(${s.numberOfColumns})
`),b=0,v=s.length;b<v;b++)u=s[b],u.hue!=null?(h="HSL",o=[u.hue,u.saturation,u.lightness]):(h="RGB",o=[u.red,u.green,u.blue]),r=(C=u.alpha)!=null?C:1,A=(M=u.name)!=null?M:u.toString(),w+=`color([${I(h)}, [${o.join(", ")}], ${r}, ${I(A)}])
`;return w+=`palette_end()
`,w}},{"../Palette":37,"../helpers":56}],49:[function(n,e,a){var t;t=n("../Palette"),e.exports=function({fileContentString:i}){var s,r,u,h,o,d,_;if(o=i.split(/[\n\r]+/m),o[0]!=="##Sketch RGBPalette 0")throw new Error("Not a Skencil palette");for(d=new t,h=s=0,r=o.length;s<r;h=++s)if(u=o[h],!(u[0]==="#"||u==="")){if(_=u.match(/^\s*([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)(?:\s+(.*))?$/),!_)throw new Error(`Line ${h+1} doesn't match pattern of red green blue name`);d.add({red:Number(_[1]),green:Number(_[2]),blue:Number(_[3]),name:_[4]})}return d},e.exports.write=function(i){return`##Sketch RGBPalette 0
${i.map(function(s){var r;return`${s.red.toFixed(6)} ${s.green.toFixed(6)} ${s.blue.toFixed(6)} ${(r=s.name)!=null?r:s}`}).join(`
`)}`}},{"../Palette":37}],50:[function(n,e,a){var t,i;i=n("jdataview"),t=n("../Palette"),e.exports=function({data:s}){var r,u,h;if(u=new t,h=new i(s),h.byteLength!==768)throw new Error(`Wrong file size, must be 768 bytes long (not ${h.byteLength})`);for(var r=0;r<256;r++)u.add({red:h.getUint8()/255,green:h.getUint8()/255,blue:h.getUint8()/255});return u},e.exports.write=function(s){var r,u,h;for(h=new i(256*3),r=u=0;u<256;r=++u)h.writeUint8(s[r]?Math.round(s[r].red*255):0),h.writeUint8(s[r]?Math.round(s[r].green*255):0),h.writeUint8(s[r]?Math.round(s[r].blue*255):0);return h.buffer}},{"../Palette":37,jdataview:7}],51:[function(n,e,a){var t,i;i=n("jdataview"),t=n("../Palette"),e.exports=function({data:s}){var r,u,h;if(u=new t,h=new i(s),h.byteLength!==1024)throw new Error(`Wrong file size, must be 1024 bytes long (not ${h.byteLength})`);for(var r=0;r<256;r++)u.add({red:h.getUint8()/255,green:h.getUint8()/255,blue:h.getUint8()/255}),h.getUint8();return u.numberOfColumns=16,u},e.exports.write=function(s){var r,u,h;for(h=new i(256*4),r=u=0;u<256;r=++u)h.writeUint8(s[r]?Math.round(s[r].red*255):0),h.writeUint8(s[r]?Math.round(s[r].green*255):0),h.writeUint8(s[r]?Math.round(s[r].blue*255):0),h.writeUint8(0);return h.buffer}},{"../Palette":37,jdataview:7}],52:[function(n,e,a){var t,i,s,r;i=n("xml-js"),t=n("../Palette"),{parse_css_hex_color:s}=n("../helpers"),e.exports.read_soc=function({fileContentString:u}){var h,o,d,_,b,f,v,A,x,C,M,I,w,l;if(!u.match(/^\s*<\?\s*xml/i))throw new Error("not a StarOffice palette (no <?xml...?> declaration)");if(A=new t,x=i.xml2js(u,{compact:!1}),!((C=x.elements)!=null&&C.length))throw new Error("No XML elements found");for(M=x.elements,_=0,f=M.length;_<f;_++)if(d=M[_],(I=d.name)!=null&&I.match(/:color-table$/)&&d.elements)for(w=d.elements,b=0,v=w.length;b<v;b++)h=w[b],h.name==="draw:color"&&((l=h.attributes["draw:color"])!=null&&l.match(/#/))&&(o=s(h.attributes["draw:color"]),o.name=h.attributes["draw:name"],A.add(o));return A},r=function(u,h){var o,d,_;return d=function(b){var f;return f=Math.round(b*255).toString(16),f.length===1?`0${f}`:f},_=function(b){var f,v,A;return{red:A,green:v,blue:f}=b,"#"+[A,v,f].map(d).join("")},i.js2xml({declaration:{attributes:{version:"1.0",encoding:"UTF-8"}},elements:[{type:"element",name:h?"ooo:color-table":"office:color-table",attributes:h?{"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:svg":"http://www.w3.org/2000/svg","xmlns:ooo":"http://openoffice.org/2004/office"}:{"xmlns:form":"http://openoffice.org/2000/form","xmlns:number":"http://openoffice.org/2000/datastyle","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:office":"http://openoffice.org/2000/office","xmlns:meta":"http://openoffice.org/2000/meta","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:svg":"http://www.w3.org/2000/svg","xmlns:dr3d":"http://openoffice.org/2000/dr3d","xmlns:text":"http://openoffice.org/2000/text","xmlns:style":"http://openoffice.org/2000/style","xmlns:script":"http://openoffice.org/2000/script","xmlns:chart":"http://openoffice.org/2000/chart","xmlns:draw":"http://openoffice.org/2000/drawing","xmlns:table":"http://openoffice.org/2000/table","xmlns:fo":"http://www.w3.org/1999/XSL/Format","xmlns:config":"http://openoffice.org/2001/config","xmlns:dc":"http://purl.org/dc/elements/1.1/"},elements:function(){var b,f,v;for(v=[],b=0,f=u.length;b<f;b++)o=u[b],v.push({type:"element",name:"draw:color",attributes:{"draw:name":o.name||o.toString(),"draw:color":_(o)}});return v}()}]},{spaces:"	"})},e.exports.write_staroffice_soc=function(u){return r(u,!1)},e.exports.write_libreoffice_soc=function(u){return r(u,!0)}},{"../Palette":37,"../helpers":56,"xml-js":30}],53:[function(n,e,a){var t,i,s;t=n("../Palette"),{parse_css_hex_color:i}=n("../helpers"),s=1.4,e.exports=function({fileContentString:r}){var u,h,o,d,_,b,f,v,A,x,C;if(!r.match(/^\s*{/))throw new Error("not sketchpalette JSON");if(x=JSON.parse(r),o=x.compatibleVersion,u=(C=x.colors)!=null?C:[],A=new t,o&&o>s)throw new Error(`Can't handle compatibleVersion of ${o}.`);if(!o||o<1.4)for(_=0,f=u.length;_<f;_++)d=u[_],A.add(i(d));else if(u.length>0)for(b=0,v=u.length;b<v;b++)h=u[b],A.add(h);return A},e.exports.write=function(r){return JSON.stringify({compatibleVersion:"1.4",pluginVersion:"1.4",colors:r.map(function(u){var h,o,d,_;return{red:_,green:d,blue:o,alpha:h}=u,h==null&&(h=1),{red:_,green:d,blue:o,alpha:h}})},null,"	")},e.exports.extension="sketchpalette"},{"../Palette":37,"../helpers":56}],54:[function(n,e,a){var t;t=n("../Palette"),e.exports=function({fileContentString:i}){var s,r,u,h,o,d,_,b,f,v,A,x,C;for(_=i.split(/[\n\r]+/m),A=[s=new t,x=new t],C=function(M,I,w){var l;if(l=M.match(w),l)return I.add({red:Number(l[1])/255,green:Number(l[2])/255,blue:Number(l[3])/255})},r=0,h=_.length;r<h;r++)d=_[r],C(d,s,/([0-9]*\.?[0-9]+),\s*([0-9]*\.?[0-9]+),\s*([0-9]*\.?[0-9]+)/),C(d,x,/([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)/);for(b=[],u=0,o=A.length;u<o;u++)v=A[u],v.length>=b.length&&(b=v);if(f=b.length,f<4)throw new Error(["No colors found","Only one color found","Only a couple colors found","Only a few colors found"][f]+` (${f})`);return b.every(function(M){return M.red<=1/255&&M.green<=1/255&&M.blue<=1/255})&&b.forEach(function(M){return M.red*=255,M.green*=255,M.blue*=255}),b}},{"../Palette":37}],55:[function(n,e,a){var t,i,s;t=n("../Palette"),i=function(r){var u,h,o,d;return h={section:/^\s*\[\s*([^\]]*)\s*\]\s*$/,param:/^\s*([^=]+?)\s*=\s*(.*?)\s*$/,comment:/^\s*;.*$/},d={},u=r.split(/[\r\n]+/),o=null,u.forEach(function(_){var b;h.comment.test(_)||(h.param.test(_)?(b=_.match(h.param),o?d[o][b[1]]=b[2]:d[b[1]]=b[2]):h.section.test(_)?(b=_.match(h.section),d[b[1]]={},o=b[1]):_.length===0&&o&&(o=null))}),d},s=function(r){var u,h,o,d,_,b,f,v,A,x;if(x=i(r),u=x["Control Panel\\Colors"],!u)throw new Error("Invalid theme file, no [Control Panel\\Colors] section");v=new t;for(b in u)if(!b.match(/\W/)&&(o=u[b].split(" "),o.length===3)){for(d=_=0,f=o.length;_<f;d=++_)h=o[d],o[d]=parseInt(h,10);o.every(function(C){return isFinite(C)})&&v.add({red:o[0]/255,green:o[1]/255,blue:o[2]/255,name:b})}return v.name=(A=x.Theme)!=null?A.DisplayName:void 0,v},e.exports=function({fileContentString:r}){return s(r)}},{"../Palette":37}],56:[function(n,e,a){e.exports.parse_css_hex_color=function(t){var i,s,r,u;return r=function(h){return parseInt(h,16)},u=t.match(/\#([0-9A-F]{3}|[0-9A-F]{6}|[0-9A-F]{4}|[0-9A-F]{8})(?![0-9A-F])/im),[i,s]=u,s.length>4?{red:r(s[0]+s[1])/255,green:r(s[2]+s[3])/255,blue:r(s[4]+s[5])/255,alpha:s.length===8?r(s[6]+s[7])/255:void 0}:{red:r(s[0]+s[0])/255,green:r(s[1]+s[1])/255,blue:r(s[2]+s[2])/255,alpha:s.length===4?r(s[3]+s[3])/255:void 0}}},{}],57:[function(n,e,a){var t,i,s,r,u,h,o,d,_,b,f,v,A=[].splice;for(r=n("./Palette"),i=n("./Color"),s=class extends Error{constructor(C){var M;super(),this.errors=C,this.message="Some errors were encountered when loading:"+(function(){var I,w,l,c;for(l=this.errors,c=[],I=0,w=l.length;I<w;I++)M=l[I],c.push(`
	`+M.message);return c}).call(this)}},o={PAINT_SHOP_PRO_PALETTE:{name:"Paint Shop Pro palette",fileExtensions:["psppalette","pal"],readFromText:n("./formats/PaintShopPro"),write:n("./formats/PaintShopPro").write},RIFF_PALETTE:{name:"RIFF PAL",fileExtensions:["pal"],read:n("./formats/RIFF"),write:n("./formats/RIFF").write},COLORSCHEMER_PALETTE:{name:"ColorSchemer palette",fileExtensions:["cs"],read:n("./formats/ColorSchemer")},PAINTDOTNET_PALETTE:{name:"Paint.NET palette",fileExtensions:["txt"],readFromText:n("./formats/Paint.NET"),write:n("./formats/Paint.NET").write},GIMP_PALETTE:{name:"GIMP palette",fileExtensions:["gpl","gimp","colors"],readFromText:n("./formats/GIMP"),write:n("./formats/GIMP").write},KDE_RGB_PALETTE:{name:"KolourPaint palette",fileExtensions:["colors"],readFromText:n("./formats/KolourPaint"),write:n("./formats/KolourPaint").write},SKENCIL_PALETTE:{name:"Skencil palette",fileExtensions:["spl"],readFromText:n("./formats/SPL"),write:n("./formats/SPL").write},SKETCH_JSON_PALETTE:{name:"Sketch palette",fileExtensions:["sketchpalette"],readFromText:n("./formats/sketchpalette"),write:n("./formats/sketchpalette").write},SK1_PALETTE:{name:"sK1 palette",fileExtensions:["skp"],readFromText:n("./formats/SKP"),write:n("./formats/SKP").write},WINDOWS_THEME_COLORS:{name:"Windows desktop theme",fileExtensions:["theme","themepack"],readFromText:n("./formats/theme")},ADOBE_SWATCH_EXCHANGE_PALETTE:{name:"Adobe Swatch Exchange",fileExtensions:["ase"],read:n("./formats/Adobe").read_adobe_swatch_exchange,write:n("./formats/Adobe").write_adobe_swatch_exchange},ADOBE_COLOR_BOOK_PALETTE:{name:"Adobe Color Book",fileExtensions:["acb"],read:n("./formats/Adobe").read_adobe_color_book},STAROFFICE_PALETTE:{name:"StarOffice Colors",fileExtensions:["soc"],readFromText:n("./formats/StarOffice").read_soc,write:n("./formats/StarOffice").write_libreoffice_soc},CSS_VARIABLES:{name:"CSS variables",fileExtensions:["css"],write:n("./formats/CSS").write_css},SCSS_VARIABLES:{name:"SCSS variables",fileExtensions:["scss"],write:n("./formats/CSS").write_scss},SASS_VARIABLES:{name:"SASS variables",fileExtensions:["sass"],write:n("./formats/CSS").write_sass},LESS_VARIABLES:{name:"LESS variables",fileExtensions:["less"],write:n("./formats/CSS").write_less},STYLUS_VARIABLES:{name:"Stylus variables",fileExtensions:["styl"],write:n("./formats/CSS").write_styl},CSS_COLORS:{name:"CSS colors",fileExtensions:["css","scss","sass","less","styl","html","htm","svg","js","ts","xml","txt"],readFromText:n("./formats/CSS")},HOMESITE_PALETTE:{name:"Homesite palette",fileExtensions:["hpl"],readFromText:n("./formats/Homesite"),write:n("./formats/Homesite").write},ADOBE_COLOR_SWATCH_PALETTE:{name:"Adobe Color Swatch",fileExtensions:["aco"],read:n("./formats/Adobe").read_adobe_color_swatch,write:n("./formats/Adobe").write_adobe_color_swatch},ADOBE_COLOR_TABLE_PALETTE:{name:"Adobe Color Table",fileExtensions:["act"],read:n("./formats/AdobeColorTable"),write:n("./formats/AdobeColorTable").write},STARCRAFT_PALETTE:{name:"StarCraft palette",fileExtensions:["pal"],read:n("./formats/StarCraft"),write:n("./formats/StarCraft").write},STARCRAFT_PADDED:{name:"StarCraft terrain palette",fileExtensions:["wpe"],read:n("./formats/StarCraftPadded"),write:n("./formats/StarCraftPadded").write},TABULAR:{name:"tabular colors",fileExtensions:["csv","tsv","txt"],readFromText:n("./formats/tabular")}},v=Object.keys(o),d=0,_=v.length;d<_;d++)h=v[d],u=o[h],u.fileExtensionsPretty=`.${u.fileExtensions.join(", .")}`;f=function(x,C){var M,I,w,l,c,p,m,y,P,F,R,B;for(x.fileContentString=typeof x.data=="string"?x.data:new TextDecoder().decode(x.data),P={},B=Object.keys(o),c=0,p=B.length;c<p;c++)h=B[c],o[h].fileExtensions.indexOf(x.fileExt)>-1&&(P[h]=!0);for(l=Object.keys(o),l.sort(function(V,Z){return(P[Z]!=null)-(P[V]!=null)}),w=[],y=0,m=l.length;y<m;y++)if(h=l[y],u=o[h],!!(u.read||u.readFromText)){try{if(u.readFromText?R=u.readFromText(x):R=u.read(x),R.length===0)throw R=null,new Error("no colors returned")}catch(V){M=V,F=`failed to load ${x.fileName} as ${u.name}: ${M.message}`,I=new Error(F),I.error=M,I.__PATCHED_LIB_TO_ADD_THIS__format=u,w.push(I)}if(R){R.confidence=P[h]!=null?.9:.01,C(null,R,u,P[h]!=null,{__errors_before_success:w});return}}C(new s(w))},b=function(x={}){var C,M;return(typeof x=="string"||x instanceof String)&&(x={filePath:x}),typeof File<"u"&&File!==null&&x instanceof File&&(x={file:x}),x.fileName==null&&(x.fileName=(C=(M=x.file)!=null?M.name:void 0)!=null?C:x.filePath?n("path").basename(x.filePath):void 0),x.fileExt==null&&(x.fileExt=`${x.fileName}`.split(".").pop()),x.fileExt=`${x.fileExt}`.toLowerCase(),x},t={Color:i,Palette:r,formats:o},t.loadPalette=function(x,C){var M,I;if(!x)throw new TypeError("parameters required: AnyPalette.loadPalette(options, function callback(error, palette){})");if(!C)throw new TypeError("callback required: AnyPalette.loadPalette(options, function callback(error, palette){})");if(x=b(x),x.data)return f(x,C);if(x.file){if(!(x.file instanceof File))throw new TypeError("options.file was passed but it is not a File");return M=new FileReader,M.onerror=function(){return C(M.error)},M.onload=function(){return x.data=M.result,f(x,C)},M.readAsArrayBuffer(x.file)}else{if(x.filePath!=null)return I=n("fs"),I.readFile(x.filePath,function(w,l){return w?C(w):(x.data=l,f(x,C))});throw new TypeError("either options.data or options.file or options.filePath must be passed")}},t.writePalette=function(x,C){return C==null&&(C=t.formats.GIMP_PALETTE),C.write(x)},t.uniqueColors=function(x,C){var M,I,w,l,c;for(c=new r,c.name=this.name,c.description=this.description,A.apply(c,[0,9e9].concat(x.slice(0))),M=0;M<c.length;){for(I=c[M],w=M+1;w<c.length;)l=c[w],i.is(I,l,C)&&(c.splice(w,1),w-=1),w+=1;M+=1}return c},e.exports=t,exportAnyPalette=t},{"./Color":36,"./Palette":37,"./formats/Adobe":38,"./formats/AdobeColorTable":39,"./formats/CSS":40,"./formats/ColorSchemer":41,"./formats/GIMP":42,"./formats/Homesite":43,"./formats/KolourPaint":44,"./formats/Paint.NET":45,"./formats/PaintShopPro":46,"./formats/RIFF":47,"./formats/SKP":48,"./formats/SPL":49,"./formats/StarCraft":50,"./formats/StarCraftPadded":51,"./formats/StarOffice":52,"./formats/sketchpalette":53,"./formats/tabular":54,"./formats/theme":55,fs:"fs",path:"path"}]},{},[57])(57)});const AnyPalette=exportAnyPalette;console.log("AnyPlatteLib",AnyPalette);console.log("JS 실행:","helpers.js");const TAU=- - - - - - - -Math.PI+Math.PI-0,is_pride_month=new Date().getMonth()===5,$G=$(window);function render_access_key(n){return'<span style="white-space: pre">???</span>'}function make_css_cursor(n,e,a){return`url(images/cursors/${n}.png) ${e.join(" ")}, ${a}`}const E=function n(e){return document.createElement(e)};function debounce(n,e,a){let t;const i=function(){const s=this,r=arguments,u=()=>{t=null,a||n.apply(s,r)},h=a&&!t;clearTimeout(t),t=setTimeout(u,e),h&&n.apply(s,r)};return i.cancel=()=>{clearTimeout(t)},i}function memoize_synchronous_function(n,e=5e4){const a={},t=[],i=(...s)=>{if(s.some(u=>u instanceof CanvasPattern))return n.apply(null,s);const r=JSON.stringify(s);if(a[r])return a[r];{const u=n.apply(null,s);if(a[r]=u,t.push(r),t.length>e){const h=t.shift();delete a[h]}return u}};return i.clear_memo_cache=()=>{for(const s of t)delete a[s];t.length=0},i}const get_rgba_from_color_implementation=n=>{const e=make_canvas(1,1);e.ctx.fillStyle=n,e.ctx.fillRect(0,0,1,1);const a=e.ctx.getImageData(0,0,1,1);return Array.from(a.data)},get_rgba_from_color=memoize_synchronous_function(get_rgba_from_color_implementation);function image_data_match(n,e,a){const t=n.data,i=e.data;if(t.length!==i.length)return!1;for(let s=t.length,r=0;r<s;r++)if(t[r]!==i[r]&&Math.abs(t[r]-i[r])>a)return!1;return!0}function make_canvas(n,e){const a=n,t=E("canvas"),i=t.getContext("2d");return t.ctx=i,i.disable_image_smoothing=()=>{i.imageSmoothingEnabled=!1,i.imageSmoothingEnabled!==!1&&(i.mozImageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1)},i.enable_image_smoothing=()=>{i.imageSmoothingEnabled=!0,i.imageSmoothingEnabled!==!0&&(i.mozImageSmoothingEnabled=!0,i.webkitImageSmoothingEnabled=!0,i.msImageSmoothingEnabled=!0)},i.copy=s=>{t.width=s.naturalWidth||s.width,t.height=s.naturalHeight||s.height,i.disable_image_smoothing(),s instanceof ImageData?i.putImageData(s,0,0):i.drawImage(s,0,0)},n&&e?(t.width=n,t.height=e,i.disable_image_smoothing()):a&&i.copy(a),t}function get_help_folder_icon(n){const e=new Image;return e.src=`help/${n}`,e}function get_icon_for_tool(n){return get_help_folder_icon(n.help_icon)}function load_image_simple(n){return new Promise((e,a)=>{const t=new Image;t.onload=()=>{e(t)},t.onerror=()=>{a(new Error(`failed to load image from ${n}`))},t.src=n})}function get_icon_for_tools(n){if(n.length===1)return get_icon_for_tool(n[0]);const e=make_canvas(16,16);return Promise.all(n.map(a=>load_image_simple(`help/${a.help_icon}`))).then(a=>{a.forEach((t,i)=>{const s=e.width/a.length,r=i*s,u=e.height,h=0;e.ctx.drawImage(t,r,h,s,u,r,h,s,u)})}),e}function to_canvas_coords(n){let e,a;if(n.type=="touchmove"?(e=n.touches[0].clientX,a=n.touches[0].clientY):(e=n.clientX,a=n.clientY),e===void 0||a===void 0)throw new TypeError("clientX and clientY must be defined (not {x, y} or x, y or [x, y])");const t=window.globApp.canvas_bounding_client_rect;return{x:~~((e-t.left)/t.width*window.globAppstate.main_canvas.width),y:~~((a-t.top)/t.height*window.globAppstate.main_canvas.height)}}function from_canvas_coords({x:n,y:e}){const a=window.globApp.canvas_bounding_client_rect;return{clientX:~~(n/window.globAppstate.main_canvas.width*a.width+a.left),clientY:~~(e/window.globAppstate.main_canvas.height*a.height+a.top)}}console.log("JS 실행:","$ToolWindow.js");function $DialogWindow(n){const e=make_window_supporting_scale({title:n,resizable:!1,maximizeButton:!1,minimizeButton:!1});e.addClass("dialog-window"),e.$form=$(E("form")).appendTo(e.$content),e.$main=$(E("div")).appendTo(e.$form),e.$buttons=$(E("div")).appendTo(e.$form).addClass("button-group"),e.$Button=(t,i,s={type:"button"})=>{const r=$(E("button")).appendTo(e.$buttons);return r[0].append(t),r.on("click",()=>{i()}),r.on("pointerdown",()=>{r.focus()}),r.attr({type:s.type}),r},e.$form.on("submit",t=>{t.preventDefault()});function a(){e.find("button, input").removeClass("default");let t=$(document.activeElement).closest("button, input[type='submit'], input[type='button'], textarea, select");t.length===0&&(t=e.$form.find('button[type="submit"], input[type="submit"], button:not([type])').first()),t.is("button, input[type='submit'], input[type='button']")&&t.addClass("default")}return e.on("focusin",a),e.on("focusout",()=>{e.find("button, input").removeClass("default")}),setTimeout(()=>{a()},0),e}console.log("JS 실행:","OnCanvasObject.js");function roundDPR$2(n){const e=[.25,.5,1,2,4,8,16];let a=e[0];for(let t=1;t<e.length;t++)Math.abs(n-e[t])<Math.abs(n-a)&&(a=e[t]);return a}class OnCanvasObject{constructor(e,a,t,i,s){this.x=e,this.y=a,this.width=t,this.height=i,this.initwidth=t,this.initheight=i,this.hideMainCanvasHandles=s,this.$el=$(E("div")).addClass("on-canvas-object").appendTo(window.globApp.$canvas_area),this.hideMainCanvasHandles&&window.globApp.canvas_handles.hide(),$G.on("resize theme-load",this._global_resize_handler=()=>{this.position()})}position(e){const a=parseFloat(window.globApp.$canvas_area.css("padding-left")),t=parseFloat(window.globApp.$canvas_area.css("padding-top")),i=window.devicePixelRatio,r=roundDPR$2(i)/i,u=window.globAppstate.magnification*r;this.$el.css({position:"absolute",left:u*this.x+a,top:u*this.y+t,width:u*this.width,height:u*this.height}),e&&(window.globApp.$status_position.text(`${this.x}, ${this.y}px`),window.globApp.$status_size.text(`${this.width} x ${this.height}px`))}destroy(){this.$el.remove(),this.hideMainCanvasHandles&&window.globApp.canvas_handles.show(),$G.off("resize theme-load",this._global_resize_handler)}}console.log("JS 실행:","OnCanvasHelpLayer.js");class OnCanvasHelperLayer extends OnCanvasObject{constructor(e,a,t,i,s,r=1){super(e,a,t,i,s),this.$el.addClass("helper-layer"),this.$el.css({pointerEvents:"none"}),this.position(),this.canvas=make_canvas(this.width*r,this.height*r),this.$el.append(this.canvas)}}console.log("JS 실행:","Hendles.js");function roundDPR$1(n){const e=[.25,.5,1,2,4,8,16];let a=e[0];for(let t=1;t<e.length;t++)Math.abs(n-e[t])<Math.abs(n-a)&&(a=e[t]);return a}function Handles(n){const{$handles_container:e,$object_container:a}=n,t=n.outset||0,i=n.get_handles_offset_left||(()=>0),s=n.get_handles_offset_top||(()=>0),r=n.get_ghost_offset_left||(()=>0),u=n.get_ghost_offset_top||(()=>0),h=n.size_only||!1,o=0,d=-1,_=1,b=d,f=_,v=d,A=_,x=$(E("div")).addClass("resize-ghost");n.thick&&x.addClass("thick");const C=[];[[v,f],[v,o],[v,b],[o,b],[A,b],[A,o],[A,f],[o,f]].forEach(([M,I])=>{const w=$(E("div")).addClass("handle");w.appendTo(e);const l=$(E("div")).addClass("grab-region").appendTo(e);(M===o||I===o)&&l.addClass("is-middle"),l.attr("draggable","false"),w.css("touch-action","none");let c,p=!1;const m=M!==o,y=I!==o;h&&(M===v||I===b)&&(w.addClass("useless-handle"),l.remove());let P;I===b&&M===v||I===f&&M===A?P="nwse-resize":I===f&&M===v||I===b&&M===A?P="nesw-resize":y?P="ew-resize":m&&(P="ns-resize");let F="";M===v&&(F+="n"),M===A&&(F+="s"),I===b&&(F+="w"),I===f&&(F+="e"),F+="-resize";const R=make_css_cursor(P,[16,16],F);w.add(l).css({cursor:R});const B=Z=>{x.appendTo(a),p=!0,c=n.get_rect();const ne=to_canvas_coords(Z);let H=0,N=0,g,O;I===f?(H=0,g=~~(ne.x-c.x)):I===b?(H=~~(ne.x-c.x),g=~~(c.x+c.width-ne.x)):g=~~c.width,M===A?(N=0,O=~~(ne.y-c.y)):M===v?(N=~~(ne.y-c.y),O=~~(c.y+c.height-ne.y)):O=~~c.height;let D={x:c.x+H,y:c.y+N,width:g,height:O};D.width=Math.max(1,D.width),D.height=Math.max(1,D.height),n.constrain_rect?D=n.constrain_rect(D,I,M):(D.x=Math.min(D.x,c.x+c.width),D.y=Math.min(D.y,c.y+c.height));const z=window.devicePixelRatio,J=roundDPR$1(z)/z,ie=window.globAppstate.magnification*J;x.css({position:"absolute",left:ie*D.x+r(),top:ie*D.y+u(),width:ie*D.width-2,height:ie*D.height-2}),c=D};w.add(l).on("pointerdown touchstart",Z=>{p=!1,$G.on("pointermove touchmove",B),$("body").css({cursor:R}).addClass("cursor-bully"),$G.one("pointerup touchend touchcancel",()=>{$G.off("pointermove touchmove",B),$("body").css({cursor:""}).removeClass("cursor-bully"),x.remove(),p&&n.set_rect(c),e.trigger("update")})}),w.add(l).on("mousedown selectstart",Z=>{Z.preventDefault()});const V=()=>{const Z=window.devicePixelRatio,H=roundDPR$1(Z)/Z,N=n.get_rect();N.width*=H,N.height*=H;const g=w.width(),O=i(),D=s(),z=32;for(const{len_key:W,pos_key:J,region:ie,offset:ue}of[{len_key:"width",pos_key:"left",region:I,offset:O},{len_key:"height",pos_key:"top",region:M,offset:D}]){let he=Math.max(N[W]*window.globAppstate.magnification/2-z/2,Math.min(z/2,N[W]*window.globAppstate.magnification/3)),se=N[W]*window.globAppstate.magnification-he;se-he<window.globAppstate.magnification&&(he=0,se=window.globAppstate.magnification);const de=-z/2,U=Math.min(z/2,he),T=N[W]*window.globAppstate.magnification-U,K=N[W]*window.globAppstate.magnification-de;h&&(he=Math.max(-ue,Math.min(he,se-z))),ie===d?(w.css({[J]:ue-t}),l.css({[J]:ue+de,[W]:U-de})):ie===o?(w.css({[J]:ue+(N[W]*window.globAppstate.magnification-g)/2}),l.css({[J]:ue+he,[W]:se-he})):ie===_&&(w.css({[J]:ue+(N[W]*window.globAppstate.magnification-g/2)}),l.css({[J]:ue+T,[W]:K-T}))}};e.on("update resize scroll",V),$G.on("resize theme-load",V),setTimeout(V,50),C.push(w[0],l[0])}),this.handles=C,this.hide=()=>{$(C).css({opacity:0,pointerEvents:"none"})},this.show=()=>{$(C).css({opacity:"",pointerEvents:""})}}const libtess=(function(){var n;function e(L,j){return L.b===j.b&&L.a===j.a}function a(L,j){return L.b<j.b||L.b===j.b&&L.a<=j.a}function t(L,j,X){var te=j.b-L.b,le=X.b-j.b;return 0<te+le?te<le?j.a-L.a+te/(te+le)*(L.a-X.a):j.a-X.a+le/(te+le)*(X.a-L.a):0}function i(L,j,X){var te=j.b-L.b,le=X.b-j.b;return 0<te+le?(j.a-X.a)*te+(j.a-L.a)*le:0}function s(L,j){return L.a<j.a||L.a===j.a&&L.b<=j.b}function r(L,j,X){var te=j.a-L.a,le=X.a-j.a;return 0<te+le?te<le?j.b-L.b+te/(te+le)*(L.b-X.b):j.b-X.b+le/(te+le)*(X.b-L.b):0}function u(L,j,X){var te=j.a-L.a,le=X.a-j.a;return 0<te+le?(j.b-X.b)*te+(j.b-L.b)*le:0}function h(L){return a(L.b.a,L.a)}function o(L){return a(L.a,L.b.a)}function d(L,j,X,te){return L=0>L?0:L,X=0>X?0:X,L<=X?X===0?(j+te)/2:j+L/(L+X)*(te-j):te+X/(L+X)*(j-te)}function _(L){var j=x(L.b);return M(j,L.c),M(j.b,L.c),I(j,L.a),j}function b(L,j){var X=!1,te=!1;L!==j&&(j.a!==L.a&&(te=!0,l(j.a,L.a)),j.d!==L.d&&(X=!0,c(j.d,L.d)),C(j,L),te||(M(j,L.a),L.a.c=L),X||(I(j,L.d),L.d.a=L))}function f(L){var j=L.b,X=!1;L.d!==L.b.d&&(X=!0,c(L.d,L.b.d)),L.c===L?l(L.a,null):(L.b.d.a=q(L),L.a.c=L.c,C(L,q(L)),X||I(L,L.d)),j.c===j?(l(j.a,null),c(j.d,null)):(L.d.a=q(j),j.a.c=j.c,C(j,q(j))),w(L)}function v(L){var j=x(L),X=j.b;return C(j,L.e),j.a=L.b.a,M(X,j.a),j.d=X.d=L.d,j=j.b,C(L.b,q(L.b)),C(L.b,j),L.b.a=j.a,j.b.a.c=j.b,j.b.d=L.b.d,j.f=L.f,j.b.f=L.b.f,j}function A(L,j){var X=!1,te=x(L),le=te.b;return j.d!==L.d&&(X=!0,c(j.d,L.d)),C(te,L.e),C(le,j),te.a=L.b.a,le.a=j.a,te.d=le.d=L.d,L.d.a=le,X||I(te,L.d),te}function x(L){var j=new we,X=new we,te=L.b.h;return X.h=te,te.b.h=j,j.h=L,L.b.h=X,j.b=X,j.c=j,j.e=X,X.b=j,X.c=X,X.e=j}function C(L,j){var X=L.c,te=j.c;X.b.e=j,te.b.e=L,L.c=te,j.c=X}function M(L,j){var X=j.f,te=new G(j,X);X.e=te,j.f=te,X=te.c=L;do X.a=te,X=X.c;while(X!==L)}function I(L,j){var X=j.d,te=new fe(j,X);X.b=te,j.d=te,te.a=L,te.c=j.c,X=L;do X.d=te,X=X.e;while(X!==L)}function w(L){var j=L.h;L=L.b.h,j.b.h=L,L.b.h=j}function l(L,j){var X=L.c,te=X;do te.a=j,te=te.c;while(te!==X);X=L.f,te=L.e,te.f=X,X.e=te}function c(L,j){var X=L.a,te=X;do te.d=j,te=te.e;while(te!==X);X=L.d,te=L.b,te.d=X,X.b=te}function p(L){var j=0;return Math.abs(L[1])>Math.abs(L[0])&&(j=1),Math.abs(L[2])>Math.abs(L[j])&&(j=2),j}var m=4*1e150;function y(L,j){L.f+=j.f,L.b.f+=j.b.f}function P(L,j,X){return L=L.a,j=j.a,X=X.a,j.b.a===L?X.b.a===L?a(j.a,X.a)?0>=i(X.b.a,j.a,X.a):0<=i(j.b.a,X.a,j.a):0>=i(X.b.a,L,X.a):X.b.a===L?0<=i(j.b.a,L,j.a):(j=t(j.b.a,L,j.a),L=t(X.b.a,L,X.a),j>=L)}function F(L){L.a.i=null;var j=L.e;j.a.c=j.c,j.c.a=j.a,L.e=null}function R(L,j){f(L.a),L.c=!1,L.a=j,j.i=L}function B(L){var j=L.a.a;do L=Fe(L);while(L.a.a===j);return L.c&&(j=A(Re(L).a.b,L.a.e),R(L,j),L=Fe(L)),L}function V(L,j,X){var te=new Le;return te.a=X,te.e=se(L.f,j.e,te),X.i=te}function Z(L,j){switch(L.s){case 100130:return(j&1)!==0;case 100131:return j!==0;case 100132:return 0<j;case 100133:return 0>j;case 100134:return 2<=j||-2>=j}return!1}function ne(L){var j=L.a,X=j.d;X.c=L.d,X.a=j,F(L)}function H(L,j,X){for(L=j,j=j.a;L!==X;){L.c=!1;var te=Re(L),le=te.a;if(le.a!==j.a){if(!te.c){ne(L);break}le=A(j.c.b,le.b),R(te,le)}j.c!==le&&(b(q(le),le),b(j,le)),ne(L),j=te.a,L=te}return j}function N(L,j,X,te,le,_e){var re=!0;do V(L,j,X.b),X=X.c;while(X!==te);for(le===null&&(le=Re(j).a.b.c);te=Re(j),X=te.a.b,X.a===le.a;)X.c!==le&&(b(q(X),X),b(q(le),X)),te.f=j.f-X.f,te.d=Z(L,te.f),j.b=!0,!re&&z(L,j)&&(y(X,le),F(j),f(le)),re=!1,j=te,le=X;j.b=!0,_e&&J(L,j)}function g(L,j,X,te,le){var _e=[j.g[0],j.g[1],j.g[2]];j.d=null,j.d=L.o&&L.o(_e,X,te,L.c)||null,j.d===null&&(le?L.n||(Y(L,100156),L.n=!0):j.d=X[0])}function O(L,j,X){var te=[null,null,null,null];te[0]=j.a.d,te[1]=X.a.d,g(L,j.a,te,[.5,.5,0,0],!1),b(j,X)}function D(L,j,X,te,le){var _e=Math.abs(j.b-L.b)+Math.abs(j.a-L.a),re=Math.abs(X.b-L.b)+Math.abs(X.a-L.a),ae=le+1;te[le]=.5*re/(_e+re),te[ae]=.5*_e/(_e+re),L.g[0]+=te[le]*j.g[0]+te[ae]*X.g[0],L.g[1]+=te[le]*j.g[1]+te[ae]*X.g[1],L.g[2]+=te[le]*j.g[2]+te[ae]*X.g[2]}function z(L,j){var X=Re(j),te=j.a,le=X.a;if(a(te.a,le.a)){if(0<i(le.b.a,te.a,le.a))return!1;if(!e(te.a,le.a))v(le.b),b(te,q(le)),j.b=X.b=!0;else if(te.a!==le.a){var X=L.e,_e=te.a.h;if(0<=_e){var X=X.b,re=X.d,ae=X.e,ce=X.c,me=ce[_e];re[me]=re[X.a],ce[re[me]]=me,me<=--X.a&&(1>=me||a(ae[re[me>>1]],ae[re[me]])?Ce(X,me):Ee(X,me)),ae[_e]=null,ce[_e]=X.b,X.b=_e}else for(X.c[-(_e+1)]=null;0<X.a&&X.c[X.d[X.a-1]]===null;)--X.a;O(L,q(le),te)}}else{if(0>i(te.b.a,le.a,te.a))return!1;Fe(j).b=j.b=!0,v(te.b),b(q(le),te)}return!0}function W(L,j){var X=Re(j),te=j.a,le=X.a,_e=te.a,re=le.a,ae=te.b.a,ce=le.b.a,me=new G;if(i(ae,L.a,_e),i(ce,L.a,re),_e===re||Math.min(_e.a,ae.a)>Math.max(re.a,ce.a))return!1;if(a(_e,re)){if(0<i(ce,_e,re))return!1}else if(0>i(ae,re,_e))return!1;var be=ae,ve=_e,ye=ce,Pe=re,Te,ke;if(a(be,ve)||(Te=be,be=ve,ve=Te),a(ye,Pe)||(Te=ye,ye=Pe,Pe=Te),a(be,ye)||(Te=be,be=ye,ye=Te,Te=ve,ve=Pe,Pe=Te),a(ye,ve)?a(ve,Pe)?(Te=t(be,ye,ve),ke=t(ye,ve,Pe),0>Te+ke&&(Te=-Te,ke=-ke),me.b=d(Te,ye.b,ke,ve.b)):(Te=i(be,ye,ve),ke=-i(be,Pe,ve),0>Te+ke&&(Te=-Te,ke=-ke),me.b=d(Te,ye.b,ke,Pe.b)):me.b=(ye.b+ve.b)/2,s(be,ve)||(Te=be,be=ve,ve=Te),s(ye,Pe)||(Te=ye,ye=Pe,Pe=Te),s(be,ye)||(Te=be,be=ye,ye=Te,Te=ve,ve=Pe,Pe=Te),s(ye,ve)?s(ve,Pe)?(Te=r(be,ye,ve),ke=r(ye,ve,Pe),0>Te+ke&&(Te=-Te,ke=-ke),me.a=d(Te,ye.a,ke,ve.a)):(Te=u(be,ye,ve),ke=-u(be,Pe,ve),0>Te+ke&&(Te=-Te,ke=-ke),me.a=d(Te,ye.a,ke,Pe.a)):me.a=(ye.a+ve.a)/2,a(me,L.a)&&(me.b=L.a.b,me.a=L.a.a),be=a(_e,re)?_e:re,a(be,me)&&(me.b=be.b,me.a=be.a),e(me,_e)||e(me,re))return z(L,j),!1;if(!e(ae,L.a)&&0<=i(ae,L.a,me)||!e(ce,L.a)&&0>=i(ce,L.a,me)){if(ce===L.a)return v(te.b),b(le.b,te),j=B(j),te=Re(j).a,H(L,Re(j),X),N(L,j,q(te),te,te,!0),!0;if(ae===L.a){v(le.b),b(te.e,q(le)),_e=X=j,re=_e.a.b.a;do _e=Fe(_e);while(_e.a.b.a===re);return j=_e,_e=Re(j).a.b.c,X.a=q(le),le=H(L,X,null),N(L,j,le.c,te.b.c,_e,!0),!0}return 0<=i(ae,L.a,me)&&(Fe(j).b=j.b=!0,v(te.b),te.a.b=L.a.b,te.a.a=L.a.a),0>=i(ce,L.a,me)&&(j.b=X.b=!0,v(le.b),le.a.b=L.a.b,le.a.a=L.a.a),!1}return v(te.b),v(le.b),b(q(le),te),te.a.b=me.b,te.a.a=me.a,te.a.h=Q(L.e,te.a),te=te.a,le=[0,0,0,0],me=[_e.d,ae.d,re.d,ce.d],te.g[0]=te.g[1]=te.g[2]=0,D(te,_e,ae,le,0),D(te,re,ce,le,2),g(L,te,me,le,!0),Fe(j).b=j.b=X.b=!0,!1}function J(L,j){for(var X=Re(j);;){for(;X.b;)j=X,X=Re(X);if(!j.b&&(X=j,j=Fe(j),j===null||!j.b))break;j.b=!1;var te=j.a,le=X.a,_e;if(_e=te.b.a!==le.b.a)e:{_e=j;var re=Re(_e),ae=_e.a,ce=re.a,me=void 0;if(a(ae.b.a,ce.b.a)){if(0>i(ae.b.a,ce.b.a,ae.a)){_e=!1;break e}Fe(_e).b=_e.b=!0,me=v(ae),b(ce.b,me),me.d.c=_e.d}else{if(0<i(ce.b.a,ae.b.a,ce.a)){_e=!1;break e}_e.b=re.b=!0,me=v(ce),b(ae.e,ce.b),me.b.d.c=_e.d}_e=!0}if(_e&&(X.c?(F(X),f(le),X=Re(j),le=X.a):j.c&&(F(j),f(te),j=Fe(X),te=j.a)),te.a!==le.a){if(te.b.a===le.b.a||j.c||X.c||te.b.a!==L.a&&le.b.a!==L.a)z(L,j);else if(W(L,j))break}te.a===le.a&&te.b.a===le.b.a&&(y(le,te),F(j),f(te),j=Fe(X))}}function ie(L,j){L.a=j;for(var X=j.c;X.i===null;)if(X=X.c,X===j.c){var X=L,te=j,re=new Le;re.a=te.c.b;var le=X.f,ae=le.a;do ae=ae.a;while(ae.b!==null&&!le.c(le.b,re,ae.b));var le=ae.b,_e=Re(le),re=le.a,ae=_e.a;if(i(re.b.a,te,re.a)===0)re=le.a,e(re.a,te)||e(re.b.a,te)||(v(re.b),le.c&&(f(re.c),le.c=!1),b(te.c,re),ie(X,te));else{var ce=a(ae.b.a,re.b.a)?le:_e,_e=void 0;le.d||ce.c?(ce===le?_e=A(te.c.b,re.e):_e=A(ae.b.c.b,te.c).b,ce.c?R(ce,_e):(re=X,le=V(X,le,_e),le.f=Fe(le).f+le.a.f,le.d=Z(re,le.f)),ie(X,te)):N(X,le,te.c,te.c,null,!0)}return}if(X=B(X.i),re=Re(X),le=re.a,re=H(L,re,null),re.c===le){var le=re,re=le.c,ae=Re(X),_e=X.a,ce=ae.a,me=!1;_e.b.a!==ce.b.a&&W(L,X),e(_e.a,L.a)&&(b(q(re),_e),X=B(X),re=Re(X).a,H(L,Re(X),ae),me=!0),e(ce.a,L.a)&&(b(le,q(ce)),le=H(L,ae,null),me=!0),me?N(L,X,le.c,re,re,!0):(a(ce.a,_e.a)?te=q(ce):te=_e,te=A(le.c.b,te),N(L,X,te,te.c,te.c,!1),te.b.i.c=!0,J(L,X))}else N(L,X,re.c,le,le,!0)}function ue(L,j){var X=new Le,te=_(L.b);te.a.b=m,te.a.a=j,te.b.a.b=-m,te.b.a.a=j,L.a=te.b.a,X.a=te,X.f=0,X.d=!1,X.c=!1,X.h=!0,X.b=!1,te=L.f,te=se(te,te.a,X),X.e=te}function he(L){this.a=new de,this.b=L,this.c=P}function se(L,j,X){do j=j.c;while(j.b!==null&&!L.c(L.b,j.b,X));return L=new de(X,j.a,j),j.a.c=L,j.a=L}function de(L,j,X){this.b=L||null,this.a=j||this,this.c=X||this}function U(){this.d=T,this.p=this.b=this.q=null,this.j=[0,0,0],this.s=100130,this.n=!1,this.o=this.a=this.e=this.f=null,this.m=!1,this.c=this.r=this.i=this.k=this.l=this.h=null}var T=0;n=U.prototype,n.x=function(){K(this,T)},n.B=function(L,j){switch(L){case 100142:return;case 100140:switch(j){case 100130:case 100131:case 100132:case 100133:case 100134:this.s=j;return}break;case 100141:this.m=!!j;return;default:Y(this,100900);return}Y(this,100901)},n.y=function(L){switch(L){case 100142:return 0;case 100140:return this.s;case 100141:return this.m;default:Y(this,100900)}return!1},n.A=function(L,j,X){this.j[0]=L,this.j[1]=j,this.j[2]=X},n.z=function(L,j){var X=j||null;switch(L){case 100100:case 100106:this.h=X;break;case 100104:case 100110:this.l=X;break;case 100101:case 100107:this.k=X;break;case 100102:case 100108:this.i=X;break;case 100103:case 100109:this.p=X;break;case 100105:case 100111:this.o=X;break;case 100112:this.r=X;break;default:Y(this,100900)}},n.C=function(L,j){var X=!1,te=[0,0,0];K(this,2);for(var le=0;3>le;++le){var _e=L[le];-1e150>_e&&(_e=-1e150,X=!0),1e150<_e&&(_e=1e150,X=!0),te[le]=_e}X&&Y(this,100155),X=this.q,X===null?(X=_(this.b),b(X,X.b)):(v(X),X=X.e),X.a.d=j,X.a.g[0]=te[0],X.a.g[1]=te[1],X.a.g[2]=te[2],X.f=1,X.b.f=-1,this.q=X},n.u=function(L){K(this,T),this.d=1,this.b=new ee,this.c=L},n.t=function(){K(this,1),this.d=2,this.q=null},n.v=function(){K(this,2),this.d=1},n.w=function(){K(this,1),this.d=T;var L=this.j[0],j=this.j[1],X=this.j[2],te=!1,le=[L,j,X];if(L===0&&j===0&&X===0){for(var j=[-2*1e150,-2*1e150,-2*1e150],_e=[2*1e150,2*1e150,2*1e150],X=[],re=[],te=this.b.c,L=te.e;L!==te;L=L.e)for(var ae=0;3>ae;++ae){var ce=L.g[ae];ce<_e[ae]&&(_e[ae]=ce,re[ae]=L),ce>j[ae]&&(j[ae]=ce,X[ae]=L)}if(L=0,j[1]-_e[1]>j[0]-_e[0]&&(L=1),j[2]-_e[2]>j[L]-_e[L]&&(L=2),_e[L]>=j[L])le[0]=0,le[1]=0,le[2]=1;else{for(j=0,_e=re[L],X=X[L],re=[0,0,0],_e=[_e.g[0]-X.g[0],_e.g[1]-X.g[1],_e.g[2]-X.g[2]],ae=[0,0,0],L=te.e;L!==te;L=L.e)ae[0]=L.g[0]-X.g[0],ae[1]=L.g[1]-X.g[1],ae[2]=L.g[2]-X.g[2],re[0]=_e[1]*ae[2]-_e[2]*ae[1],re[1]=_e[2]*ae[0]-_e[0]*ae[2],re[2]=_e[0]*ae[1]-_e[1]*ae[0],ce=re[0]*re[0]+re[1]*re[1]+re[2]*re[2],ce>j&&(j=ce,le[0]=re[0],le[1]=re[1],le[2]=re[2]);0>=j&&(le[0]=le[1]=le[2]=0,le[p(_e)]=1)}te=!0}for(re=p(le),L=this.b.c,j=(re+1)%3,X=(re+2)%3,re=0<le[re]?1:-1,le=L.e;le!==L;le=le.e)le.b=le.g[j],le.a=re*le.g[X];if(te){for(le=0,te=this.b.a,L=te.b;L!==te;L=L.b)if(j=L.a,!(0>=j.f))do le+=(j.a.b-j.b.a.b)*(j.a.a+j.b.a.a),j=j.e;while(j!==L.a);if(0>le)for(le=this.b.c,te=le.e;te!==le;te=te.e)te.a=-te.a}for(this.n=!1,le=this.b.b,L=le.h;L!==le;L=te)te=L.h,j=L.e,e(L.a,L.b.a)&&L.e.e!==L&&(O(this,j,L),f(L),L=j,j=L.e),j.e===L&&(j!==L&&((j===te||j===te.b)&&(te=te.h),f(j)),(L===te||L===te.b)&&(te=te.h),f(L));for(this.e=le=new S,te=this.b.c,L=te.e;L!==te;L=L.e)L.h=Q(le,L);for(k(le),this.f=new he(this),ue(this,-m),ue(this,m);(le=oe(this.e))!==null;){for(;;){e:if(L=this.e,L.a===0)te=xe(L.b);else if(te=L.c[L.d[L.a-1]],L.b.a!==0&&(L=xe(L.b),a(L,te))){te=L;break e}if(te===null||!e(te,le))break;te=oe(this.e),O(this,le.c,te.c)}ie(this,le)}for(this.a=this.f.a.a.b.a.a,le=0;(te=this.f.a.a.b)!==null;)te.h||++le,F(te);for(this.f=null,le=this.e,le.b=null,le.d=null,this.e=le.c=null,le=this.b,L=le.a.b;L!==le.a;L=te)te=L.b,L=L.a,L.e.e===L&&(y(L.c,L),f(L));if(!this.n){if(le=this.b,this.m)for(L=le.b.h;L!==le.b;L=te)te=L.h,L.b.d.c!==L.d.c?L.f=L.d.c?1:-1:f(L);else for(L=le.a.b;L!==le.a;L=te)if(te=L.b,L.c){for(L=L.a;a(L.b.a,L.a);L=L.c.b);for(;a(L.a,L.b.a);L=L.e);for(j=L.c.b,X=void 0;L.e!==j;)if(a(L.b.a,j.a)){for(;j.e!==L&&(h(j.e)||0>=i(j.a,j.b.a,j.e.b.a));)X=A(j.e,j),j=X.b;j=j.c.b}else{for(;j.e!==L&&(o(L.c.b)||0<=i(L.b.a,L.a,L.c.b.a));)X=A(L,L.c.b),L=X.b;L=L.e}for(;j.e.e!==L;)X=A(j.e,j),j=X.b}if(this.h||this.i||this.k||this.l)if(this.m){for(le=this.b,te=le.a.b;te!==le.a;te=te.b)if(te.c){this.h&&this.h(2,this.c),L=te.a;do this.k&&this.k(L.a.d,this.c),L=L.e;while(L!==te.a);this.i&&this.i(this.c)}}else{for(le=this.b,te=!!this.l,L=!1,j=-1,X=le.a.d;X!==le.a;X=X.d)if(X.c){L||(this.h&&this.h(4,this.c),L=!0),re=X.a;do te&&(_e=re.b.d.c?0:1,j!==_e&&(j=_e,this.l&&this.l(!!j,this.c))),this.k&&this.k(re.a.d,this.c),re=re.e;while(re!==X.a)}L&&this.i&&this.i(this.c)}if(this.r){for(le=this.b,L=le.a.b;L!==le.a;L=te)if(te=L.b,!L.c){j=L.a,X=j.e,re=void 0;do re=X,X=re.e,re.d=null,re.b.d===null&&(re.c===re?l(re.a,null):(re.a.c=re.c,C(re,q(re))),_e=re.b,_e.c===_e?l(_e.a,null):(_e.a.c=_e.c,C(_e,q(_e))),w(re));while(re!==j);j=L.d,L=L.b,L.d=j,j.b=L}this.r(this.b),this.c=this.b=null;return}}this.b=this.c=null};function K(L,j){if(L.d!==j)for(;L.d!==j;)if(L.d<j)switch(L.d){case T:Y(L,100151),L.u(null);break;case 1:Y(L,100152),L.t()}else switch(L.d){case 2:Y(L,100154),L.v();break;case 1:Y(L,100153),L.w()}}function Y(L,j){L.p&&L.p(j,L.c)}function fe(L,j){this.b=L||this,this.d=j||this,this.a=null,this.c=!1}function we(){this.h=this,this.i=this.d=this.a=this.e=this.c=this.b=null,this.f=0}function q(L){return L.b.e}function ee(){this.c=new G,this.a=new fe,this.b=new we,this.d=new we,this.b.b=this.d,this.d.b=this.b}function G(L,j){this.e=L||this,this.f=j||this,this.d=this.c=null,this.g=[0,0,0],this.h=this.a=this.b=0}function S(){this.c=[],this.d=null,this.a=0,this.e=!1,this.b=new pe}function k(L){L.d=[];for(var j=0;j<L.a;j++)L.d[j]=j;L.d.sort(function(X){return function(te,le){return a(X[te],X[le])?1:-1}}(L.c)),L.e=!0,Ae(L.b)}function Q(L,j){if(L.e){var X=L.b,te=++X.a;2*te>X.f&&(X.f*=2,X.c=ge(X.c,X.f+1));var le;return X.b===0?le=te:(le=X.b,X.b=X.c[X.b]),X.e[le]=j,X.c[le]=te,X.d[te]=le,X.h&&Ee(X,te),le}return X=L.a++,L.c[X]=j,-(X+1)}function oe(L){if(L.a===0)return Se(L.b);var j=L.c[L.d[L.a-1]];if(L.b.a!==0&&a(xe(L.b),j))return Se(L.b);do--L.a;while(0<L.a&&L.c[L.d[L.a-1]]===null);return j}function pe(){this.d=ge([0],33),this.e=[null,null],this.c=[0,0],this.a=0,this.f=32,this.b=0,this.h=!1,this.d[1]=1}function ge(L,j){for(var X=Array(j),te=0;te<L.length;te++)X[te]=L[te];for(;te<j;te++)X[te]=0;return X}function Ae(L){for(var j=L.a;1<=j;--j)Ce(L,j);L.h=!0}function xe(L){return L.e[L.d[1]]}function Se(L){var j=L.d,X=L.e,te=L.c,le=j[1],_e=X[le];return 0<L.a&&(j[1]=j[L.a],te[j[1]]=1,X[le]=null,te[le]=L.b,L.b=le,0<--L.a&&Ce(L,1)),_e}function Ce(L,j){for(var X=L.d,te=L.e,le=L.c,_e=j,re=X[_e];;){var ae=_e<<1;ae<L.a&&a(te[X[ae+1]],te[X[ae]])&&(ae+=1);var ce=X[ae];if(ae>L.a||a(te[re],te[ce])){X[_e]=re,le[re]=_e;break}X[_e]=ce,le[ce]=_e,_e=ae}}function Ee(L,j){for(var X=L.d,te=L.e,le=L.c,_e=j,re=X[_e];;){var ae=_e>>1,ce=X[ae];if(ae===0||a(te[ce],te[re])){X[_e]=re,le[re]=_e;break}X[_e]=ce,le[ce]=_e,_e=ae}}function Le(){this.e=this.a=null,this.f=0,this.c=this.b=this.h=this.d=!1}function Re(L){return L.e.c.b}function Fe(L){return L.e.a.b}return this.libtess={GluTesselator:U,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901,GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111}},U.prototype.gluDeleteTess=U.prototype.x,U.prototype.gluTessProperty=U.prototype.B,U.prototype.gluGetTessProperty=U.prototype.y,U.prototype.gluTessNormal=U.prototype.A,U.prototype.gluTessCallback=U.prototype.z,U.prototype.gluTessVertex=U.prototype.C,U.prototype.gluTessBeginPolygon=U.prototype.u,U.prototype.gluTessBeginContour=U.prototype.t,U.prototype.gluTessEndContour=U.prototype.v,U.prototype.gluTessEndPolygon=U.prototype.w,typeof module<"u"&&(module.exports=this.libtess),this.libtess}).apply(new Object);console.log("JS 실행:","image-manipulation.js");const fill_threshold=1;function get_brush_canvas_size(n,e){return Math.ceil(n*(e==="circle"?2.1:1)/2)*2}function render_brush(n,e,a){e.match(/diagonal/)&&(a-=.4);const t=Math.round(n.canvas.width/2),i=Math.round(t-a/2),s=Math.round(t+a/2),r=Math.round(n.canvas.height/2),u=Math.round(r-a/2),h=Math.round(r+a/2);e==="circle"?draw_ellipse(n,i,u,a,a,!1,!0):e==="square"?n.fillRect(i,u,~~a,~~a):e==="diagonal"?draw_line_without_pattern_support(n,i,u,s,h):e==="reverse_diagonal"?draw_line_without_pattern_support(n,i,h,s,u):e==="horizontal"?draw_line_without_pattern_support(n,i,r,a,r):e==="vertical"&&draw_line_without_pattern_support(n,t,u,t,a)}function draw_ellipse(n,e,a,t,i,s,r){const u=e+t/2,h=a+i/2;if(window.globAppstate.aliasing){const o=[];for(let _=0;_<TAU;_+=.05)o.push({x:u+Math.cos(_)*t/2,y:h+Math.sin(_)*i/2});draw_polygon(n,o,s,r)}else n.beginPath(),n.ellipse(u,h,Math.abs(t/2),Math.abs(i/2),0,0,TAU,!1),n.stroke(),n.fill()}function draw_rounded_rectangle(n,e,a,t,i,s,r,u,h){if(window.globAppstate.aliasing){const o=[],d=(v,A)=>{o.push({x:v,y:A})},_=(v,A,x,C,M,I)=>{for(let l=M;l<I;l+=.05)o.push({x:v+Math.cos(l)*x,y:A+Math.sin(l)*C});o.push({x:v+Math.cos(I)*x,y:A+Math.sin(I)*C})},b=e+t,f=a+i;_(b-s,a+r,s,r,TAU*3/4,TAU),d(b,f-r),_(b-s,f-r,s,r,0,TAU*1/4),d(e+s,f),_(e+s,f-r,s,r,TAU*1/4,TAU*1/2),d(e,a+r),_(e+s,a+r,s,r,TAU/2,TAU*3/4),draw_polygon(n,o,u,h)}else n.beginPath(),n.moveTo(e+s,a),n.lineTo(e+t-s,a),n.quadraticCurveTo(e+t,a,e+t,a+r),n.lineTo(e+t,a+i-r),n.quadraticCurveTo(e+t,a+i,e+t-s,a+i),n.lineTo(e+s,a+i),n.quadraticCurveTo(e,a+i,e,a+i-r),n.lineTo(e,a+r),n.quadraticCurveTo(e,a,e+s,a),n.closePath(),u&&n.stroke(),h&&n.fill()}const get_brush_canvas_implementation=(n,e)=>{const a=get_brush_canvas_size(e,n),t=make_canvas(a,a);return render_brush(t.ctx,n,e),t},get_brush_canvas=memoize_synchronous_function(get_brush_canvas_implementation,20);$G.on("invalidate-brush-canvases",()=>{get_brush_canvas.clear_memo_cache()});const stamp_brush_canvas=(n,e,a,t,i)=>{const s=get_brush_canvas(t,i),r=-Math.ceil(s.width/2),u=-Math.ceil(s.height/2);n.drawImage(s,e+r,a+u)},get_circumference_points_for_brush_implementation=(n,e)=>{const a=get_brush_canvas(n,e),t=a.ctx.getImageData(0,0,a.width,a.height),i=(h,o)=>h>=0&&o>=0&&h<t.width&&o<t.height&&t.data[(o*t.width+h)*4+3]>127,s=-Math.ceil(a.width/2),r=-Math.ceil(a.height/2),u=[];for(let h=0;h<t.width;h+=1)for(let o=0;o<t.height;o+=1)i(h,o)&&(!i(h,o-1)||!i(h,o+1)||!i(h-1,o)||!i(h+1,o))&&u.push({x:h+s,y:o+r});return u},get_circumference_points_for_brush=memoize_synchronous_function(get_circumference_points_for_brush_implementation);$G.on("invalidate-brush-canvases",()=>{get_circumference_points_for_brush.clear_memo_cache()});let line_brush_canvas;function update_brush_for_drawing_lines(n){window.globAppstate.aliasing&&n>1&&(line_brush_canvas=get_brush_canvas("circle",n))}function draw_line_without_pattern_support(n,e,a,t,i,s=1){window.globAppstate.aliasing?s>1?bresenham_line(e,a,t,i,(r,u)=>{n.drawImage(line_brush_canvas,~~(r-line_brush_canvas.width/2),~~(u-line_brush_canvas.height/2))}):bresenham_line(e,a,t,i,(r,u)=>{n.fillRect(r,u,1,1)}):(n.beginPath(),n.moveTo(e,a),n.lineTo(t,i),n.lineWidth=s,n.lineCap="round",n.stroke(),n.lineCap="butt")}function bresenham_line(n,e,a,t,i){n=~~n,a=~~a,e=~~e,t=~~t;const s=Math.abs(a-n),r=Math.abs(t-e),u=n<a?1:-1,h=e<t?1:-1;let o=s-r;for(;i(n,e),!(n===a&&e===t);){const d=o*2;d>-r&&(o-=r,n+=u),d<s&&(o+=s,e+=h)}}function bresenham_dense_line(n,e,a,t,i){n=~~n,a=~~a,e=~~e,t=~~t;const s=Math.abs(a-n),r=Math.abs(t-e),u=n<a?1:-1,h=e<t?1:-1;let o=s-r;for(;i(n,e),!(n===a&&e===t);){const d=o*2;d>-r&&(o-=r,n+=u),i(n,e),d<s&&(o+=s,e+=h)}}function draw_fill_without_pattern_support(n,e,a,t,i,s,r){const u=window.globAppstate.main_canvas.width,h=window.globAppstate.main_canvas.height;e=Math.max(0,Math.min(Math.floor(e),u)),a=Math.max(0,Math.min(Math.floor(a),h));const o=[[e,a]],d=n.getImageData(0,0,u,h);let _=(a*u+e)*4;const b=d.data[_+0],f=d.data[_+1],v=d.data[_+2],A=d.data[_+3];if(Math.abs(t-b)<=fill_threshold&&Math.abs(i-f)<=fill_threshold&&Math.abs(s-v)<=fill_threshold&&Math.abs(r-A)<=fill_threshold)return;for(;o.length;){let M,I,w,l,c;for(M=o.pop(),I=M[0],w=M[1],_=(w*u+I)*4;x(_);)w--,_=(w*u+I)*4;for(l=!1,c=!1;w++,_=(w*u+I)*4,!!(w<h&&x(_));)C(_),I>0&&(x(_-4)?l||(o.push([I-1,w]),l=!0):l&&(l=!1)),I<u-1&&(x(_+4)?c||(o.push([I+1,w]),c=!0):c&&(c=!1)),_+=u*4}n.putImageData(d,0,0);function x(M){return Math.abs(d.data[M+0]-b)<=fill_threshold&&Math.abs(d.data[M+1]-f)<=fill_threshold&&Math.abs(d.data[M+2]-v)<=fill_threshold&&Math.abs(d.data[M+3]-A)<=fill_threshold}function C(M){d.data[M+0]=t,d.data[M+1]=i,d.data[M+2]=s,d.data[M+3]=r}}function draw_fill(n,e,a,t){if(typeof t=="string"){const i=get_rgba_from_color(t);draw_fill_without_pattern_support(n,e,a,i[0],i[1],i[2],i[3])}else{const i=n.canvas,s=make_canvas(i.width,i.height);draw_fill_separately(n,s.ctx,e,a,255,255,255,255),replace_colors_with_swatch(s.ctx,t,0,0),n.drawImage(s,0,0)}}function draw_fill_separately(n,e,a,t,i,s,r,u){if(u===0)throw new Error("Filling with alpha of zero is not supported. Zero alpha is used for detecting whether a pixel has been visited.");const h=window.globAppstate.main_canvas.width,o=window.globAppstate.main_canvas.height;a=Math.max(0,Math.min(Math.floor(a),h)),t=Math.max(0,Math.min(Math.floor(t),o));const d=[[a,t]],_=n.getImageData(0,0,h,o),b=e.getImageData(0,0,h,o);let f=(t*h+a)*4;const v=_.data[f+0],A=_.data[f+1],x=_.data[f+2],C=_.data[f+3];for(;d.length;){let w,l,c,p,m;for(w=d.pop(),l=w[0],c=w[1],f=(c*h+l)*4;M(f);)c--,f=(c*h+l)*4;for(p=!1,m=!1;c++,f=(c*h+l)*4,!!(c<o&&M(f));)I(f),l>0&&(M(f-4)?p||(d.push([l-1,c]),p=!0):p&&(p=!1)),l<h-1&&(M(f+4)?m||(d.push([l+1,c]),m=!0):m&&(m=!1)),f+=h*4}e.putImageData(b,0,0);function M(w){return b.data[w+3]===0&&Math.abs(_.data[w+0]-v)<=fill_threshold&&Math.abs(_.data[w+1]-A)<=fill_threshold&&Math.abs(_.data[w+2]-x)<=fill_threshold&&Math.abs(_.data[w+3]-C)<=fill_threshold}function I(w){b.data[w+0]=i,b.data[w+1]=s,b.data[w+2]=r,b.data[w+3]=u}}function replace_color_globally(n,e,a,t,i,s,r,u,h){if(e===s&&a===r&&t===u&&i===h)return;const{data:o}=n;for(let d=0;d<o.length;d+=4)Math.abs(o[d+0]-e)<=fill_threshold&&Math.abs(o[d+1]-a)<=fill_threshold&&Math.abs(o[d+2]-t)<=fill_threshold&&Math.abs(o[d+3]-i)<=fill_threshold&&(o[d+0]=s,o[d+1]=r,o[d+2]=u,o[d+3]=h)}function find_color_globally(n,e,a,t,i,s){const r=n.data,u=e.data;for(let h=0;h<r.length;h+=4)Math.abs(r[h+0]-a)<=fill_threshold&&Math.abs(r[h+1]-t)<=fill_threshold&&Math.abs(r[h+2]-i)<=fill_threshold&&Math.abs(r[h+3]-s)<=fill_threshold&&(u[h+0]=255,u[h+1]=255,u[h+2]=255,u[h+3]=255)}function draw_noncontiguous_fill_without_pattern_support(n,e,a,t,i,s,r){e=Math.max(0,Math.min(Math.floor(e),n.canvas.width)),a=Math.max(0,Math.min(Math.floor(a),n.canvas.height));const u=n.getImageData(0,0,n.canvas.width,n.canvas.height),h=(a*u.width+e)*4,o=u.data[h+0],d=u.data[h+1],_=u.data[h+2],b=u.data[h+3];replace_color_globally(u,o,d,_,b,t,i,s,r),n.putImageData(u,0,0)}function draw_noncontiguous_fill(n,e,a,t){if(typeof t=="string"){const i=get_rgba_from_color(t);draw_noncontiguous_fill_without_pattern_support(n,e,a,i[0],i[1],i[2],i[3])}else{const i=n.canvas,s=make_canvas(i.width,i.height);draw_noncontiguous_fill_separately(n,s.ctx,e,a),replace_colors_with_swatch(s.ctx,t,0,0),n.drawImage(s,0,0)}}function draw_noncontiguous_fill_separately(n,e,a,t){a=Math.max(0,Math.min(Math.floor(a),n.canvas.width)),t=Math.max(0,Math.min(Math.floor(t),n.canvas.height));const i=n.getImageData(0,0,n.canvas.width,n.canvas.height),s=e.getImageData(0,0,e.canvas.width,e.canvas.height),r=(t*i.width+a)*4,u=i.data[r+0],h=i.data[r+1],o=i.data[r+2],d=i.data[r+3];find_color_globally(i,s,u,h,o,d),e.putImageData(s,0,0)}function apply_image_transformation(n,e){const a=window.globAppstate.selection?window.globAppstate.selection.source_canvas:window.globAppstate.main_canvas,t=make_canvas(a.width,a.height),i=a.ctx,s=t.ctx;e(a,i,t,s),window.globAppstate.selection?undoable({name:`${n.name} (${localize("Selection")})`,icon:n.icon,soft:!0},()=>{window.globAppstate.selection.replace_source_canvas(t)}):(deselect(),cancel(),undoable({name:n.name,icon:n.icon},()=>{window.globAppstate.saved=!1,update_title(),window.globAppstate.main_ctx.copy(t),window.globApp.$canvas_area.trigger("resize")}))}function rotate(n){apply_image_transformation({name:`${localize("Rotate by angle")} ${n/TAU*360} ${localize("Degrees")}`,icon:get_help_folder_icon(`p_rotate_${n>=0?"cw":"ccw"}.png`)},(e,a,t,i)=>{switch(i.save(),n){case TAU/4:case TAU*-3/4:t.width=e.height,t.height=e.width,i.disable_image_smoothing(),i.translate(t.width,0),i.rotate(TAU/4);break;case TAU/2:case TAU/-2:i.translate(t.width,t.height),i.rotate(TAU/2);break;case TAU*3/4:case TAU/-4:t.width=e.height,t.height=e.width,i.disable_image_smoothing(),i.translate(0,t.height),i.rotate(TAU/-4);break;default:{const s=e.width,r=e.height;let u=1/0,h=-1/0,o=1/0,d=-1/0;const _=(x,C)=>{const M=Math.sin(-n)*r*x+Math.cos(+n)*s*C,I=Math.sin(+n)*s*C+Math.cos(-n)*r*x;u=Math.min(u,M),h=Math.max(h,M),o=Math.min(o,I),d=Math.max(d,I)};_(0,0),_(0,1),_(1,0),_(1,1);const b=u,f=o,v=h-u,A=d-o;t.width=v,t.height=A,i.disable_image_smoothing(),window.globAppstate.transparency||(i.fillStyle=window.globAppstate.selected_colors.background,i.fillRect(0,0,t.width,t.height)),i.translate(-b,-f),i.rotate(n),i.drawImage(e,0,0,s,r);break}}i.drawImage(e,0,0),i.restore()})}function invert_rgb(n,e=n){const a=n.getImageData(0,0,n.canvas.width,n.canvas.height);for(let t=0;t<a.data.length;t+=4)a.data[t+0]=255-a.data[t+0],a.data[t+1]=255-a.data[t+1],a.data[t+2]=255-a.data[t+2];e.putImageData(a,0,0)}function replace_colors_with_swatch(n,e,a=0,t=0){n.globalCompositeOperation="source-in",n.fillStyle=e,n.beginPath(),n.rect(0,0,n.canvas.width,n.canvas.height),n.save(),n.translate(-a,-t),n.fill(),n.restore()}function compute_bezier(n,e,a,t,i,s,r,u,h){const o=1-n,d=o*o,_=n*n;let b,f,v,A=0;return b=d*o,f=d*n*3,v=o*_*3,A=n*_,{x:b*e+f*t+v*s+A*u,y:b*a+f*i+v*r+A*h}}function draw_bezier_curve_without_pattern_support(n,e,a,t,i,s,r,u,h,o){let _={x:e,y:a};for(let b=0;b<1;b+=1/100){const f=compute_bezier(b,e,a,t,i,s,r,u,h);draw_line_without_pattern_support(n,_.x,_.y,f.x,f.y,o),_=f}}function draw_quadratic_curve(n,e,a,t,i,s,r,u){draw_bezier_curve(n,e,a,t,i,t,i,s,r,u)}function draw_bezier_curve(n,e,a,t,i,s,r,u,h,o){const d=Math.min(e,t,s,u),_=Math.min(a,i,r,h),b=Math.max(e,t,s,u),f=Math.max(a,i,r,h);draw_with_swatch(n,d,_,b,f,window.globAppstate.stroke_color,v=>{draw_bezier_curve_without_pattern_support(v,e,a,t,i,s,r,u,h,o)})}function draw_line(n,e,a,t,i,s){const r=Math.min(e,t),u=Math.min(a,i),h=Math.max(e,t),o=Math.max(a,i);draw_with_swatch(n,r,u,h,o,window.globAppstate.stroke_color,d=>{draw_line_without_pattern_support(d,e,a,t,i,s)})}let grid_pattern,grid_pattern_size=-1;function draw_grid(n,e){const a=Math.floor(e);if(!grid_pattern||grid_pattern_size!==a){grid_pattern_size=a;const t=make_canvas(a,a),i="#808080",s="#c0c0c0";t.ctx.fillStyle=i,t.ctx.fillRect(0,0,1,a),t.ctx.fillStyle=i,t.ctx.fillRect(0,0,a,1),t.ctx.fillStyle=s;for(let r=1;r<a;r+=2)t.ctx.fillRect(r,0,1,1),t.ctx.fillRect(0,r,1,1);grid_pattern=n.createPattern(t,"repeat")}n.save(),n.rect(0,0,n.canvas.width,n.canvas.height),e!==a&&n.translate(-.5,-.75),n.scale(e/a,e/a),n.enable_image_smoothing(),n.fillStyle=grid_pattern,n.fill(),n.restore()}const svg_for_creating_matrices=document.createElementNS("http://www.w3.org/2000/svg","svg"),horizontal_pattern_canvas=make_canvas(8,4),vertical_pattern_canvas=make_canvas(4,8);let horizontal_pattern,vertical_pattern;function draw_dashes(n,e,a,t,i,s,r,u){vertical_pattern||(horizontal_pattern_canvas.ctx.fillStyle="white",horizontal_pattern_canvas.ctx.fillRect(4,0,4,4),vertical_pattern_canvas.ctx.fillStyle="white",vertical_pattern_canvas.ctx.fillRect(0,4,4,4),horizontal_pattern=n.createPattern(horizontal_pattern_canvas,"repeat"),vertical_pattern=n.createPattern(vertical_pattern_canvas,"repeat"));const h=1,o=1/s;if(n.save(),n.scale(s,s),n.translate(r,u),n.translate(e,a),n.globalCompositeOperation="difference",t>0){const d=svg_for_creating_matrices.createSVGMatrix();horizontal_pattern.setTransform&&horizontal_pattern.setTransform(d.translate(-e,-a).translate(o,0).scale(1/s)),n.fillStyle=horizontal_pattern,n.fillRect(0,0,t,h)}else if(i>0){const d=svg_for_creating_matrices.createSVGMatrix();vertical_pattern.setTransform&&vertical_pattern.setTransform(d.translate(-e,-a).translate(0,o).scale(1/s)),n.fillStyle=vertical_pattern,n.fillRect(0,0,h,i)}n.restore()}function draw_selection_box(n,e,a,t,i,s,r,u){draw_dashes(n,e,a,t-1,0,s,r,u),i===1?draw_dashes(n,e,a,0,1,s,r,u):draw_dashes(n,e,a+1,0,i-2,s,r,u),draw_dashes(n,e+t-1,a,0,i,s,r,u),draw_dashes(n,e,a+i-1,t-1,0,s,r,u),draw_dashes(n,e,a+1,0,1,s,r,u)}let tessy,gl,positionLoc,op_canvas_webgl,op_canvas_2d,op_ctx_2d;function initTesselator(){function n(r,u){u[u.length]=r[0],u[u.length]=r[1]}function e(r){var u;r!==libtess.primitiveType.GL_TRIANGLES&&((u=window.console)==null||u.log(`Expected TRIANGLES but got type: ${r}`))}function a(r){var u,h;(u=window.console)==null||u.log("error callback"),(h=window.console)==null||h.log(`error number: ${r}`)}function t(r,u,h){return[r[0],r[1],r[2]]}function i(r){}const s=new libtess.GluTesselator;return s.gluTessCallback(libtess.gluEnum.GLU_TESS_VERTEX_DATA,n),s.gluTessCallback(libtess.gluEnum.GLU_TESS_BEGIN,e),s.gluTessCallback(libtess.gluEnum.GLU_TESS_ERROR,a),s.gluTessCallback(libtess.gluEnum.GLU_TESS_COMBINE,t),s.gluTessCallback(libtess.gluEnum.GLU_TESS_EDGE_FLAG,i),s}function triangulate(n){tessy.gluTessNormal(0,0,1);const e=[];tessy.gluTessBeginPolygon(e);for(let a=0;a<n.length;a++){tessy.gluTessBeginContour();const t=n[a];for(let i=0;i<t.length;i+=2){const s=[t[i],t[i+1],0];tessy.gluTessVertex(s,s)}tessy.gluTessEndContour()}return tessy.gluTessEndPolygon(),e}function initWebGL(n){try{gl=n.getContext("webgl",{antialias:!1})}catch(a){show_error_message("Failed to get WebGL context. You may need to refresh the web page, or restart your computer.",a);return}if(!gl){show_error_message("Failed to get WebGL context. You may need to refresh the web page, or restart your computer.");return}window.WEBGL_lose_context=gl.getExtension("WEBGL_lose_context");const e=createShaderProgram();positionLoc=gl.getAttribLocation(e,"position"),gl.enableVertexAttribArray(positionLoc)}function initArrayBuffer(n){const e=new Float32Array(n),a=gl.createBuffer();return gl.bindBuffer(gl.ARRAY_BUFFER,a),gl.bufferData(gl.ARRAY_BUFFER,e,gl.STATIC_DRAW),gl.vertexAttribPointer(positionLoc,2,gl.FLOAT,!1,0,0),n.length/2}function createShaderProgram(){var s,r;const n=["attribute vec4 position;","void main() {","	/* already in normalized coordinates, so just pass through */","	gl_Position = position;","}"].join(""),e=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(e,n),gl.compileShader(e),gl.getShaderParameter(e,gl.COMPILE_STATUS)||(s=window.console)==null||s.log(`Vertex shader failed to compile. Log: ${gl.getShaderInfoLog(e)}`);const a=["precision mediump float;","void main() {","	gl_FragColor = vec4(0, 0, 0, 1);","}"].join(""),t=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(t,a),gl.compileShader(t),gl.getShaderParameter(t,gl.COMPILE_STATUS)||(r=window.console)==null||r.log(`Fragment shader failed to compile. Log: ${gl.getShaderInfoLog(t)}`);const i=gl.createProgram();return gl.attachShader(i,e),gl.attachShader(i,t),gl.linkProgram(i),gl.useProgram(i),i}function init_webgl_stuff(){tessy=initTesselator(),op_canvas_webgl=document.createElement("canvas"),op_canvas_2d=document.createElement("canvas"),op_ctx_2d=op_canvas_2d.getContext("2d"),initWebGL(op_canvas_webgl);let n;op_canvas_webgl.addEventListener("webglcontextlost",e=>{var a;e.preventDefault(),(a=window.console)==null||a.warn("WebGL context lost"),clamp_brush_sizes(),n=setTimeout(()=>{show_error_message("The WebGL context was lost. You may need to refresh the web page, or restart your computer.")},3e3)},!1),op_canvas_webgl.addEventListener("webglcontextrestored",()=>{var e;initWebGL(op_canvas_webgl),(e=window.console)==null||e.warn("WebGL context restored"),clearTimeout(n),clamp_brush_sizes(),$G.triggerHandler("invalidate-brush-canvases"),$G.triggerHandler("redraw-tool-options-because-webglcontextrestored")},!1)}function clamp_brush_sizes(){window.globAppstate.brush_size>100&&(window.globAppstate.brush_size=100,show_error_message("Brush size clamped to 100")),window.globAppstate.pencil_size>100&&(window.globAppstate.pencil_size=100,show_error_message("Pencil size clamped to 100")),window.globAppstate.stroke_size>100&&(window.globAppstate.stroke_size=100,show_error_message("Stroke size clamped to 100"))}function draw_line_strip(n,e){draw_polygon_or_line_strip(n,e,!0,!1,!1)}function draw_polygon(n,e,a,t){draw_polygon_or_line_strip(n,e,a,t,!0)}function draw_polygon_or_line_strip(n,e,a,t,i){if(!gl){show_error_message("Failed to get WebGL context. You may need to refresh the web page, or restart your computer.");return}a&&window.globAppstate.stroke_size>1&&update_brush_for_drawing_lines(window.globAppstate.stroke_size);const s=n.strokeStyle,r=n.fillStyle,u=e.length,h=u*2;if(u===0)return;let o=1/0,d=-1/0,_=1/0,b=-1/0;for(const{x:v,y:A}of e)o=Math.min(v,o),d=Math.max(v,d),_=Math.min(A,_),b=Math.max(A,b);d+=1,b+=1,o-=1,_-=1,op_canvas_webgl.width=d-o,op_canvas_webgl.height=b-_,gl.viewport(0,0,op_canvas_webgl.width,op_canvas_webgl.height);const f=new Float32Array(h);for(let v=0;v<u;v++)f[v*2+0]=(e[v].x-o)/op_canvas_webgl.width*2-1,f[v*2+1]=1-(e[v].y-_)/op_canvas_webgl.height*2;if(t){const A=triangulate([f]);let x=initArrayBuffer(A);gl.clear(gl.COLOR_BUFFER_BIT),gl.drawArrays(gl.TRIANGLES,0,x),op_canvas_2d.width=op_canvas_webgl.width,op_canvas_2d.height=op_canvas_webgl.height,op_ctx_2d.drawImage(op_canvas_webgl,0,0),replace_colors_with_swatch(op_ctx_2d,r,o,_),n.drawImage(op_canvas_2d,o,_)}if(a)if(window.globAppstate.stroke_size>1){const v=~~(window.globAppstate.stroke_size*1.1),A=o-v,x=_-v;op_canvas_2d.width=d-o+v*2,op_canvas_2d.height=b-_+v*2;for(let C=0;C<u-(i?0:1);C++){const M=e[C],I=e[(C+1)%u];draw_line_without_pattern_support(op_ctx_2d,M.x-A,M.y-x,I.x-A,I.y-x,window.globAppstate.stroke_size)}replace_colors_with_swatch(op_ctx_2d,s,A,x),n.drawImage(op_canvas_2d,A,x)}else{let v=initArrayBuffer(f);gl.clear(gl.COLOR_BUFFER_BIT),gl.drawArrays(i?gl.LINE_LOOP:gl.LINE_STRIP,0,v),op_canvas_2d.width=op_canvas_webgl.width,op_canvas_2d.height=op_canvas_webgl.height,op_ctx_2d.drawImage(op_canvas_webgl,0,0),replace_colors_with_swatch(op_ctx_2d,s,o,_),n.drawImage(op_canvas_2d,o,_)}}function copy_contents_within_polygon(n,e,a,t,i,s){i=Math.max(i,a+1),s=Math.max(s,t+1);const r=i-a,u=s-t,h=make_canvas(n);h.ctx.save(),h.ctx.globalCompositeOperation="destination-in",draw_polygon(h.ctx,e,!1,!0),h.ctx.restore();const o=make_canvas(r,u);return o.ctx.drawImage(h,a,t,r,u,0,0,r,u),o}function draw_with_swatch(n,e,a,t,i,s,r){const u=~~(window.globAppstate.stroke_size*1.1);t=Math.max(t,e+1),i=Math.max(i,a+1),op_canvas_2d.width=t-e+u*2,op_canvas_2d.height=i-a+u*2;const h=e-u,o=a-u;op_ctx_2d.save(),op_ctx_2d.translate(-h,-o),r(op_ctx_2d),op_ctx_2d.restore(),replace_colors_with_swatch(op_ctx_2d,s,h,o),n.drawImage(op_canvas_2d,h,o)}console.log("JS 실행:","tool-options.js");const ChooserCanvas=(n,e,a,t,i,s,r,u,h,o,d,_,b)=>{const f=b(a,t);let v=ChooserCanvas.cache[n];v||(v=ChooserCanvas.cache[n]=E("img"),v.onerror=()=>{delete ChooserCanvas.cache[n]},v.src=n);const A=()=>{try{f.ctx.drawImage(v,i,s,r,u,h,o,d,_)}catch{}f.style.filter=e?"invert()":""};return $(v).on("load",A),A(),f};ChooserCanvas.cache={};const ChooserDiv=(n,e,a,t,i,s,r,u,h,o,d,_,b,f)=>{const v=b(a,t);v.classList.add(n),v.style.width=r+"px",v.style.height=u+"px";const A=()=>{const x=window.devicePixelRatio!==1;v.classList.toggle("use-svg",x),v.style.backgroundPosition=`${-i}px ${-s-(f?1:0)}px`};return v._on_zoom_etc&&$G.off("theme-load resize",v._on_zoom_etc),$G.on("theme-load resize",A),v._on_zoom_etc=A,A(),v.style.borderColor="transparent",v.style.borderStyle="solid",v.style.borderLeftWidth=h+"px",v.style.borderTopWidth=o+"px",v.style.borderRightWidth=a-h-d+"px",v.style.borderBottomWidth=t-o-_+"px",v.style.backgroundClip="content-box",v.style.filter=e?"invert()":"",v},$Choose=(n,e,a,t,i)=>{const s=$(E("div")).addClass("chooser").css("touch-action","none"),r=u=>{t(u)||(a(u),$G.trigger("option-changed"))};return s.on("update",()=>{if(!s.is(":visible"))return;s.empty();for(let o=0;o<n.length;o++)(d=>{const _=$(E("div")).addClass("chooser-option").appendTo(s);_.data("thing",d);const b=(A,x)=>{let C=_.find("canvas")[0];return C?(C.width!==A&&(C.width=A),C.height!==x&&(C.height=x)):(C=make_canvas(A,x),_.append(C)),C},f=(A,x)=>{let C=_.find("div")[0];return C?(C.style.width!==A+"px"&&(C.style.width=A+"px"),C.style.height!==x+"px"&&(C.style.height=x+"px")):(C=E("div"),C.style.width=A+"px",C.style.height=x+"px",_.append(C)),C},v=()=>{const A=getComputedStyle(s[0]).getPropertyValue("--Hilight"),x=i?"rgb(192, 192, 192)":"";_.css({backgroundColor:t(d)?A:x}),e(d,t(d),b,f)};v(),$G.on("option-changed theme-load redraw-tool-options-because-webglcontextrestored",v)})(n[o]);const u=o=>{const d=o.target.closest(".chooser-option");d&&r($(d).data("thing"))},h=o=>{const d=o.originalEvent.changedTouches[0],b=document.elementFromPoint(d.clientX,d.clientY).closest(".chooser-option");b&&r($(b).data("thing")),o.preventDefault()};s.on("pointerdown click",o=>{const d=o.target.closest(".chooser-option");d&&r($(d).data("thing")),o.type==="pointerdown"&&(s.on("pointerover",u),s.on("touchmove",h))}),$G.on("pointerup pointercancel",()=>{s.off("pointerover",u),s.off("touchmove",h)})}),s},$ChooseShapeStyle=()=>{const n=$Choose([{stroke:!0,fill:!1},{stroke:!0,fill:!0},{stroke:!1,fill:!0}],({stroke:e,fill:a},t,i)=>{const s=i(39,21),r=s.ctx;let u=5;const h=getComputedStyle(s);return r.fillStyle=t?h.getPropertyValue("--HilightText"):h.getPropertyValue("--WindowText"),e&&r.fillRect(u,u,s.width-u*2,s.height-u*2),u+=1,r.fillStyle=h.getPropertyValue("--ButtonShadow"),a?r.fillRect(u,u,s.width-u*2,s.height-u*2):r.clearRect(u,u,s.width-u*2,s.height-u*2),s},({stroke:e,fill:a})=>{n.stroke=e,n.fill=a},({stroke:e,fill:a})=>n.stroke===e&&n.fill===a).addClass("choose-shape-style");return n.fill=!1,n.stroke=!0,n},$choose_brush=$Choose((()=>{const n=["circle","square","reverse_diagonal","diagonal"],e=[7,4,1],a=[8,5,2],t=[];return n.forEach(i=>{(i==="circle"?e:a).forEach(r=>{t.push({shape:i,size:r})})}),t})(),(n,e,a)=>{const t=a(10,10),i=getComputedStyle(t),s=n.shape,r=n.size,u=e?i.getPropertyValue("--HilightText"):i.getPropertyValue("--WindowText");return stamp_brush_canvas(t.ctx,5,5,s,r),replace_colors_with_swatch(t.ctx,u),t},({shape:n,size:e})=>{window.globAppstate.brush_shape=n,window.globAppstate.brush_size=e},({shape:n,size:e})=>window.globAppstate.brush_shape===n&&window.globAppstate.brush_size===e).addClass("choose-brush"),$choose_eraser_size=$Choose([4,6,8,10],(n,e,a)=>{const t=a(39,16),i=getComputedStyle(t);return t.ctx.fillStyle=e?i.getPropertyValue("--HilightText"):i.getPropertyValue("--WindowText"),render_brush(t.ctx,"square",n),t},n=>{window.globAppstate.eraser_size=n},n=>window.globAppstate.eraser_size===n).addClass("choose-eraser"),$choose_stroke_size=$Choose([1,2,3,4,5],(n,e,a)=>{const r=a(39,12),u=(12-n)/2,h=getComputedStyle(r);return r.ctx.fillStyle=e?h.getPropertyValue("--HilightText"):h.getPropertyValue("--WindowText"),r.ctx.fillRect(5,~~u,39-5*2,n),r},n=>{window.globAppstate.stroke_size=n},n=>window.globAppstate.stroke_size===n).addClass("choose-stroke-size"),magnifications=[1,2,6,8,10],$choose_magnification=$Choose(magnifications,(n,e,a,t)=>{const i=magnifications.indexOf(n),s=n===10,r=ChooserDiv("magnification-option",e,39,s?2:13,i*23,0,23,9,8,2,23,9,t);return s&&$(r).addClass("secret-option"),r},n=>{set_magnification(n)},n=>n===window.globAppstate.magnification,!0).addClass("choose-magnification").css({position:"relative"});$choose_magnification.on("update",()=>{$choose_magnification.find(".secret-option").parent().css({position:"absolute",bottom:"-2px",left:0,opacity:0,height:2,overflow:"hidden"})});const airbrush_sizes=[9,16,24],$choose_airbrush_size=$Choose(airbrush_sizes,(n,e,a)=>{const i=airbrush_sizes.indexOf(n),s=airbrush_sizes.length,u=i===2?0:4,h=72/s-u*2,o=23,d=72/s*i+u;return ChooserCanvas("images/options-airbrush-size.png",e,h,o,d,0,h,o,0,0,h,o,a)},n=>{window.globAppstate.airbrush_size=n},n=>n===window.globAppstate.airbrush_size,!0).addClass("choose-airbrush-size"),$choose_transparent_mode=$Choose([!1,!0],(n,e,a,t)=>ChooserDiv("transparent-mode-option",!1,2+35+2,2+23+2,0,n?22:0,35,23,2,2,35,23,t,n),n=>{window.globAppstate.tool_transparent_mode=n},n=>n===window.globAppstate.tool_transparent_mode,!0).addClass("choose-transparent-mode");console.log("JS 실행:","tools.js");const TOOL_FREE_FORM_SELECT="TOOL_FREE_FORM_SELECT",TOOL_SELECT="TOOL_SELECT",TOOL_ERASER="TOOL_ERASER",TOOL_FILL="TOOL_FILL",TOOL_PICK_COLOR="TOOL_PICK_COLOR",TOOL_MAGNIFIER="TOOL_MAGNIFIER",TOOL_PENCIL="TOOL_PENCIL",TOOL_BRUSH="TOOL_BRUSH",TOOL_AIRBRUSH="TOOL_AIRBRUSH",TOOL_LINE="TOOL_LINE",TOOL_CURVE="TOOL_CURVE",TOOL_RECTANGLE="TOOL_RECTANGLE",TOOL_POLYGON="TOOL_POLYGON",TOOL_ELLIPSE="TOOL_ELLIPSE",TOOL_ROUNDED_RECTANGLE="TOOL_ROUNDED_RECTANGLE",tools=[{id:TOOL_FREE_FORM_SELECT,name:localize("Free-Form Select"),speech_recognition:[],help_icon:"p_free.gif",description:localize("Selects a free-form part of the picture to move, copy, or edit."),cursor:["precise",[16,16],"crosshair"],preview_canvas:null,points:[],x_min:1/0,x_max:-1/0,y_min:1/0,y_max:-1/0,pointerdown(){this.x_min=window.globAppstate.pointer.x,this.x_max=window.globAppstate.pointer.x+1,this.y_min=window.globAppstate.pointer.y,this.y_max=window.globAppstate.pointer.y+1,this.points=[],this.preview_canvas=make_canvas(window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),deselect()},paint(n,e,a){window.globAppstate.pointer.x=Math.min(window.globAppstate.main_canvas.width,window.globAppstate.pointer.x),window.globAppstate.pointer.x=Math.max(0,window.globAppstate.pointer.x),window.globAppstate.pointer.y=Math.min(window.globAppstate.main_canvas.height,window.globAppstate.pointer.y),window.globAppstate.pointer.y=Math.max(0,window.globAppstate.pointer.y),this.points.push(window.globAppstate.pointer),this.x_min=Math.min(window.globAppstate.pointer.x,this.x_min),this.x_max=Math.max(window.globAppstate.pointer.x,this.x_max),this.y_min=Math.min(window.globAppstate.pointer.y,this.y_min),this.y_max=Math.max(window.globAppstate.pointer.y,this.y_max),bresenham_line(window.globAppstate.pointer_previous.x,window.globAppstate.pointer_previous.y,window.globAppstate.pointer.x,window.globAppstate.pointer.y,(t,i)=>{this.ffs_paint_iteration(t,i)})},ffs_paint_iteration(n,e){n=Math.min(window.globAppstate.main_canvas.width,n),n=Math.max(0,n),e=Math.min(window.globAppstate.main_canvas.height,e),e=Math.max(0,e);const a=2,t=~~(n-a/2),i=~~(e-a/2),s=a,r=a,u=this.preview_canvas.ctx,h=window.globAppstate.main_ctx.getImageData(t,i,s,r),o=u.getImageData(t,i,s,r);for(let d=0,_=o.data.length;d<_;d+=4)o.data[d+0]=255-h.data[d+0],o.data[d+1]=255-h.data[d+1],o.data[d+2]=255-h.data[d+2],o.data[d+3]=255;u.putImageData(o,t,i)},pointerup(){this.preview_canvas.width=1,this.preview_canvas.height=1;const n=copy_contents_within_polygon(window.globAppstate.main_canvas,this.points,this.x_min,this.y_min,this.x_max,this.y_max);window.globAppstate.selection&&(show_error_message("This isn't supposed to happen: Free-Form Select after Select in the tool chain?"),meld_selection_into_canvas()),undoable({name:localize("Free-Form Select"),icon:get_icon_for_tool(get_tool_by_id(TOOL_FREE_FORM_SELECT)),soft:!0},()=>{window.globAppstate.selection=new OnCanvasSelection(this.x_min,this.y_min,this.x_max-this.x_min,this.y_max-this.y_min,n),window.globAppstate.selection.cut_out_background()})},cancel(){this.preview_canvas&&(this.preview_canvas.width=1,this.preview_canvas.height=1)},drawPreviewUnderGrid(n,e,a,t,i,s,r){!window.globAppstate.pointer_active&&!window.globAppstate.pointer_over_canvas||this.preview_canvas&&(n.scale(i,i),n.translate(s,r),n.drawImage(this.preview_canvas,0,0))},$options:$choose_transparent_mode},{id:TOOL_SELECT,name:localize("Select"),speech_recognition:[],help_icon:"p_sel.gif",description:localize("Selects a rectangular part of the picture to move, copy, or edit."),cursor:["precise",[16,16],"crosshair"],selectBox(n,e,a,t){if(a>1&&t>1){var i=window.globAppstate.selection;if(window.globAppstate.selection&&meld_selection_into_canvas(),window.globAppstate.ctrl)undoable({name:"Crop"},()=>{var _=make_canvas(a,t);_.ctx.drawImage(window.globAppstate.main_canvas,-n,-e),window.globAppstate.main_ctx.copy(_),window.globApp.canvas_handles.show(),window.globApp.$canvas_area.trigger("resize")});else if(i){var s=Math.min(i.x,n),r=Math.min(i.y,e),u=Math.max(i.x+i.width,n+a),h=Math.max(i.y+i.height,e+t),o=make_canvas(u-s,h-r),d=make_canvas(u-s,h-r);d.ctx.drawImage(window.globAppstate.main_canvas,n,e,a,t,n-s,e-r,a,t),o.ctx.drawImage(i.canvas,i.x-s,i.y-r),o.ctx.globalCompositeOperation="xor",o.ctx.drawImage(d,0,0),undoable({name:`${localize("Free-Form Select")}⊕${localize("Select")}`,icon:get_icon_for_tools([get_tool_by_id(TOOL_FREE_FORM_SELECT),get_tool_by_id(TOOL_SELECT)]),soft:!0},()=>{window.globAppstate.selection=new OnCanvasSelection(s,r,u-s,h-r,o),window.globAppstate.cut_out_background()})}else undoable({name:localize("Select"),icon:get_icon_for_tool(get_tool_by_id(TOOL_SELECT)),soft:!0},()=>{window.globAppstate.selection=new OnCanvasSelection(n,e,a,t)})}},$options:$choose_transparent_mode},{id:TOOL_ERASER,name:localize("Eraser/Color Eraser"),speech_recognition:[],help_icon:"p_erase.gif",description:localize("Erases a portion of the picture, using the selected eraser shape."),cursor:["precise",[16,16],"crosshair"],mask_canvas:null,get_rect(n,e){const a=Math.ceil(n-window.globAppstate.eraser_size/2),t=Math.ceil(e-window.globAppstate.eraser_size/2),i=window.globAppstate.eraser_size,s=window.globAppstate.eraser_size;return{rect_x:a,rect_y:t,rect_w:i,rect_h:s}},drawPreviewUnderGrid(n,e,a,t,i,s,r){if(!window.globAppstate.pointer_active&&!window.globAppstate.pointer_over_canvas)return;const{rect_x:u,rect_y:h,rect_w:o,rect_h:d}=this.get_rect(e,a);n.scale(i,i),n.translate(s,r),this.mask_canvas&&this.render_from_mask(n,!0),n.fillStyle=window.globAppstate.selected_colors.background,n.fillRect(u,h,o,d)},drawPreviewAboveGrid(n,e,a,t,i,s,r){if(!window.globAppstate.pointer_active&&!window.globAppstate.pointer_over_canvas)return;const{rect_x:u,rect_y:h,rect_w:o,rect_h:d}=this.get_rect(e,a);n.scale(i,i),n.translate(s,r);const _=1/i;n.strokeStyle="black",n.lineWidth=_,t?n.strokeRect(u+n.lineWidth/2,h+n.lineWidth/2,o,d):n.strokeRect(u+n.lineWidth/2,h+n.lineWidth/2,o-n.lineWidth,d-n.lineWidth)},pointerdown(){this.mask_canvas=make_canvas(window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height)},render_from_mask(n,e){n.save(),n.globalCompositeOperation="destination-out",n.drawImage(this.mask_canvas,0,0),n.restore();let a=window.globAppstate.selected_colors.background;get_rgba_from_color(a)[3]<1&&(a=e?"rgba(255, 0, 0, 0.3)":window.globAppstate.selected_colors.background);const i=make_canvas(this.mask_canvas);replace_colors_with_swatch(i.ctx,a,0,0),n.drawImage(i,0,0)},pointerup(){this.mask_canvas&&undoable({name:get_language().match(/^en\b/)?this.color_eraser_mode?"Color Eraser":"Eraser":localize("Eraser/Color Eraser"),icon:get_icon_for_tool(this)},()=>{this.render_from_mask(window.globAppstate.main_ctx),this.mask_canvas=null})},cancel(){this.mask_canvas=null},paint(n,e,a){bresenham_line(window.globAppstate.pointer_previous.x,window.globAppstate.pointer_previous.y,window.globAppstate.pointer.x,window.globAppstate.pointer.y,(t,i)=>{this.eraser_paint_iteration(n,t,i)})},eraser_paint_iteration(n,e,a){const{rect_x:t,rect_y:i,rect_w:s,rect_h:r}=this.get_rect(e,a);if(this.color_eraser_mode=window.globAppstate.button!==0,!this.color_eraser_mode)this.mask_canvas.ctx.fillStyle="white",this.mask_canvas.ctx.fillRect(t,i,s,r);else{const u=get_rgba_from_color(window.globAppstate.selected_colors.foreground),h=n.getImageData(t,i,s,r),o=this.mask_canvas.ctx.getImageData(t,i,s,r),d=1;for(let _=0,b=h.data.length;_<b;_+=4)Math.abs(h.data[_+0]-u[0])<=d&&Math.abs(h.data[_+1]-u[1])<=d&&Math.abs(h.data[_+2]-u[2])<=d&&Math.abs(h.data[_+3]-u[3])<=d&&(o.data[_+0]=255,o.data[_+1]=255,o.data[_+2]=255,o.data[_+3]=255);this.mask_canvas.ctx.putImageData(o,t,i)}},$options:$choose_eraser_size},{id:TOOL_FILL,name:localize("Fill With Color"),speech_recognition:[],help_icon:"p_paint.gif",description:"Fills an area with the selected drawing color.",cursor:["fill-bucket",[8,22],"crosshair"],pointerdown(n,e,a){window.globAppstate.shift?undoable({name:"Replace Color",icon:get_icon_for_tool(this)},()=>{draw_noncontiguous_fill(n,e,a,window.globAppstate.fill_color)}):undoable({name:localize("Fill With Color"),icon:get_icon_for_tool(this)},()=>{draw_fill(n,e,a,window.globAppstate.fill_color)})}},{id:TOOL_PICK_COLOR,name:localize("Pick Color"),speech_recognition:[],help_icon:"p_eye.gif",description:localize("Picks up a color from the picture for drawing."),cursor:["eye-dropper",[9,22],"crosshair"],deselect:!0,current_color:"",display_current_color(){this.$options.css({background:this.current_color})},pointerdown(){$G.one("pointerup",()=>{this.$options.css({background:""})})},paint(n,e,a){if(e>=0&&a>=0&&e<window.globAppstate.main_canvas.width&&a<window.globAppstate.main_canvas.height){const t=n.getImageData(~~e,~~a,1,1),[i,s,r,u]=t.data;this.current_color=`rgba(${i},${s},${r},${u/255})`}else this.current_color="white";this.display_current_color()},pointerup(){window.globAppstate.selected_colors[window.globAppstate.pick_color_slot]=this.current_color,$G.trigger("option-changed")},$options:$(E("div"))},{id:TOOL_MAGNIFIER,name:localize("Magnifier"),speech_recognition:[],help_icon:"p_zoom.gif",description:localize("Changes the magnification."),cursor:["magnifier",[16,16],"zoom-in"],deselect:!1,getProspectiveMagnification:(n=1)=>{const e={.5:1,1:2,2:3,3:4,4:5,5:6,6:8,8:10,10:12,12:15,15:20,20:25,25:30,30:40,40:50,50:60,60:75,75:100,100:100},a={100:75,75:60,60:50,50:40,40:30,30:25,25:20,20:15,15:12,12:10,10:8,8:6,6:5,5:4,4:3,3:2,2:1,1:.5,.5:.5};function t(i){const s=Object.keys(e).map(Number).sort((r,u)=>r-u);for(let r=s.length-1;r>=0;r--)if(i>=s[r])return s[r];return s[0]}return n==2?a[t(window.globAppstate.magnification)]:e[t(window.globAppstate.magnification)]},drawPreviewAboveGrid(n,e,a,t,i,s,r){if(!window.globAppstate.pointer_active&&!window.globAppstate.pointer_over_canvas||window.globAppstate.pointer_active)return;const u=this.getProspectiveMagnification();if(console.log(u,window.globAppstate.magnification),u<window.globAppstate.magnification?window.globApp.$canvas.css({cursor:make_css_cursor("magnifier",[16,16],"zoom-out")}):window.globApp.$canvas.css({cursor:make_css_cursor("magnifier",[16,16],"zoom-in")}),u<window.globAppstate.magnification)return;const h=window.globApp.$canvas_area.width()/u,o=window.globApp.$canvas_area.height()/u;let d=~~(e-h/2),_=~~(a-o/2);d=Math.max(0,d),_=Math.max(0,_),d=Math.min(window.globAppstate.main_canvas.width-h,d),_=Math.min(window.globAppstate.main_canvas.height-o,_);let b=d+h,f=_+o;d=Math.max(0,d),_=Math.max(0,_),b=Math.min(window.globAppstate.main_canvas.width,b),f=Math.min(window.globAppstate.main_canvas.height,f);const v=b-d,A=f-_,x=d,C=_,M=window.globAppstate.main_canvas.ctx.getImageData(x,C,v+1,A+1),I=n.getImageData((x+s)*i,(C+r)*i,v*i+1,A*i+1);function w(l,c){const p=~~(l/i),m=~~(c/i),y=(p+m*M.width)*4,P=(l+c*I.width)*4;I.data[P+0]=255-M.data[y+0],I.data[P+1]=255-M.data[y+1],I.data[P+2]=255-M.data[y+2],I.data[P+3]=255}for(let l=0,c=I.width;l<c;l+=1)w(l,0),w(l,I.height-1);for(let l=1,c=I.height-1;l<c;l+=1)w(0,l),w(I.width-1,l);n.putImageData(I,(x+s)*i,(C+r)*i)},pointerdown(n,e,a){const t=window.globAppstate.magnification,i=this.getProspectiveMagnification(window.globAppstate.button);if(set_magnification(i),window.globAppstate.magnification>t){const s=window.globApp.$canvas_area.width()/window.globAppstate.magnification,r=window.globApp.$canvas_area.height()/window.globAppstate.magnification;window.globApp.$canvas_area.scrollLeft((e-s/2)*window.globAppstate.magnification),window.globApp.$canvas_area.scrollTop((a-r/2)*window.globAppstate.magnification),window.globApp.$canvas_area.trigger("scroll")}},$options:$choose_magnification},{id:TOOL_PENCIL,name:localize("Pencil"),speech_recognition:[],help_icon:"p_pencil.gif",description:localize("Draws a free-form line one pixel wide."),cursor:["pencil",[13,23],"crosshair"],stroke_only:!0,get_brush(){return{size:window.globAppstate.pencil_size,shape:"circle"}}},{id:TOOL_BRUSH,name:localize("Brush"),speech_recognition:[],help_icon:"p_brush.gif",description:localize("Draws using a brush with the selected shape and size."),cursor:["precise-dotted",[16,16],"crosshair"],dynamic_preview_cursor:!0,get_brush(){return{size:window.globAppstate.brush_size,shape:window.globAppstate.brush_shape}},$options:$choose_brush},{id:TOOL_AIRBRUSH,name:localize("Airbrush"),speech_recognition:[],help_icon:"p_airb.gif",description:localize("Draws using an airbrush of the selected size."),cursor:["airbrush",[7,22],"crosshair"],paint_on_time_interval:5,paint_mask(n,e,a){const t=window.globAppstate.airbrush_size/2;for(let i=0;i<6+t/5;i++){const s=(Math.random()*2-1)*t,r=(Math.random()*2-1)*t;s*s+r*r<=t*t&&n.fillRect(e+~~s,a+~~r,1,1)}update_helper_layer()},$options:$choose_airbrush_size},{id:TOOL_LINE,name:localize("Line"),speech_recognition:["line","line segment","straight line","lines","line segments","straight lines"],help_icon:"p_line.gif",description:localize("Draws a straight line with the selected line width."),cursor:["precise",[16,16],"crosshair"],stroke_only:!0,shape(n,e,a,t,i){update_brush_for_drawing_lines(window.globAppstate.stroke_size),draw_line(n,e,a,e+t,a+i,window.globAppstate.stroke_size)},$options:$choose_stroke_size},{id:TOOL_CURVE,name:localize("Curve"),speech_recognition:["curve","curved line","curvy","curvy line","Bezier","Bezier curve","spline","curves","splines","curved","curving","wave","wavy line","rounded line","round line","oscilloscope","sine wave","cosine","cosine wave"],help_icon:"p_curve.gif",description:localize("Draws a curved line with the selected line width."),cursor:["precise",[16,16],"crosshair"],stroke_only:!0,points:[],preview_canvas:null,pointerup(n,e,a){this.points.length>=4&&(undoable({name:localize("Curve"),icon:get_icon_for_tool(this)},()=>{n.drawImage(this.preview_canvas,0,0)}),this.points=[])},pointerdown(n,e,a){this.points.length<1?(this.preview_canvas=make_canvas(window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),this.points.push({x:e,y:a}),$("body").hasClass("eye-gaze-mode")||this.points.push({x:e,y:a})):this.points.push({x:e,y:a})},paint(n,e,a){if(this.points.length<1)return;update_brush_for_drawing_lines(window.globAppstate.stroke_size);const t=this.points.length-1;this.points[t].x=e,this.points[t].y=a,this.preview_canvas.ctx.clearRect(0,0,this.preview_canvas.width,this.preview_canvas.height),this.preview_canvas.ctx.strokeStyle=window.globAppstate.stroke_color,this.points.length===4?draw_bezier_curve(this.preview_canvas.ctx,this.points[0].x,this.points[0].y,this.points[2].x,this.points[2].y,this.points[3].x,this.points[3].y,this.points[1].x,this.points[1].y,window.globAppstate.stroke_size):this.points.length===3?draw_quadratic_curve(this.preview_canvas.ctx,this.points[0].x,this.points[0].y,this.points[2].x,this.points[2].y,this.points[1].x,this.points[1].y,window.globAppstate.stroke_size):this.points.length===2?draw_line(this.preview_canvas.ctx,this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,window.globAppstate.stroke_size):draw_line(this.preview_canvas.ctx,this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y,window.globAppstate.stroke_size),e-this.points[0].x,a-this.points[0].y},drawPreviewUnderGrid(n,e,a,t,i,s,r){this.preview_canvas&&(n.scale(i,i),n.translate(s,r),this.points.length>=1&&n.drawImage(this.preview_canvas,0,0))},cancel(){this.points=[]},end(){this.points=[],update_helper_layer()},$options:$choose_stroke_size},{id:TOOL_RECTANGLE,name:localize("Rectangle"),speech_recognition:["rectangle","square","box","rect","sharp rectangle","sharp square","sharp box","sharp rect","sharp corners rectangle","sharp corners square","sharp corners box","sharp corners rect","sharp cornered rectangle","sharp cornered square","sharp cornered box","sharp cornered rect","rectangle with sharp corners","square with sharp corners","box with sharp corners","rect with sharp corners","rectangles","squares","boxes","rects","sharp rectangles","sharp squares","sharp boxes","sharp rects","sharp corners rectangles","sharp corners squares","sharp corners boxes","sharp corners rects","sharp cornered rectangles","sharp cornered squares","sharp cornered boxes","sharp cornered rects","rectangles with sharp corners","squares with sharp corners","boxes with sharp corners","rects with sharp corners"],help_icon:"p_rect.gif",description:localize("Draws a rectangle with the selected fill style."),cursor:["precise",[16,16],"crosshair"],shape(n,e,a,t,i){t<0&&(e+=t,t=-t),i<0&&(a+=i,i=-i),this.$options.fill&&n.fillRect(e,a,t,i),this.$options.stroke&&(t<window.globAppstate.stroke_size*2||i<window.globAppstate.stroke_size*2?(n.save(),n.fillStyle=n.strokeStyle,n.fillRect(e,a,t,i),n.restore()):(n.save(),n.fillStyle=n.strokeStyle,n.fillRect(e,a,window.globAppstate.stroke_size,i),n.fillRect(e+t-window.globAppstate.stroke_size,a,window.globAppstate.stroke_size,i),n.fillRect(e,a,t,window.globAppstate.stroke_size),n.fillRect(e,a+i-window.globAppstate.stroke_size,t,window.globAppstate.stroke_size),n.restore()))},$options:$ChooseShapeStyle()},{id:TOOL_POLYGON,name:localize("Polygon"),speech_recognition:["polygon","poly","shape","n-gon","free-form polygon","freeform polygon","free form polygon","triangle","quadrangle","pentagon","hexagon","heptagon","octagon","nonagon","decagon","undecagon","dodecagon","polygons","polys","shapes","n-gons","free-form polygons","freeform polygons","free form polygons","triangles","quadrangles","pentagons","hexagons","heptagons","octagons","nonagons","decagons","undecagons","dodecagons"],help_icon:"p_poly.gif",description:localize("Draws a polygon with the selected fill style."),cursor:["precise",[16,16],"crosshair"],last_click_pointerdown:{x:-1/0,y:-1/0,time:-1/0},last_click_pointerup:{x:-1/0,y:-1/0,time:-1/0},points:[],preview_canvas:null,pointerup(n,e,a){if(this.points.length<1)return;const t=this.points.length-1;this.points[t].x=e,this.points[t].y=a;const i=this.points[t].x-this.points[0].x,s=this.points[t].y-this.points[0].y,r=Math.sqrt(i*i+s*s);$("body").hasClass("eye-gaze-mode")?this.points.length>=3&&r<window.globAppstate.stroke_size*10+20&&this.complete(n):r<window.globAppstate.stroke_size*5.1010101&&this.complete(n),this.last_click_pointerup={x:e,y:a,time:+new Date},this.updateStatus()},pointerdown(n,e,a){if(this.points.length<1)this.preview_canvas=make_canvas(window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),this.points.push({x:e,y:a}),$("body").hasClass("eye-gaze-mode")||this.points.push({x:e,y:a});else{const t=this.last_click_pointerdown.x,i=this.last_click_pointerdown.y,s=this.last_click_pointerdown.time,r=e-t,u=a-i,h=+new Date-s;Math.sqrt(r*r+u*u)<4.1010101&&h<250?this.complete(n):this.points.push({x:e,y:a})}this.last_click_pointerdown={x:e,y:a,time:+new Date}},paint(n,e,a){if(this.points.length<1)return;const t=this.points.length-1;if(this.points[t].x=e,this.points[t].y=a,this.preview_canvas.ctx.clearRect(0,0,this.preview_canvas.width,this.preview_canvas.height),this.$options.fill&&!this.$options.stroke){this.preview_canvas.ctx.drawImage(window.globAppstate.main_canvas,0,0),this.preview_canvas.ctx.strokeStyle="white",this.preview_canvas.ctx.globalCompositeOperation="difference";var i=window.globAppstate.stroke_size;window.globAppstate.stroke_size=2,draw_line_strip(this.preview_canvas.ctx,this.points),window.globAppstate.stroke_size=i}else this.points.length>1?(this.preview_canvas.ctx.strokeStyle=window.globAppstate.stroke_color,draw_line_strip(this.preview_canvas.ctx,this.points)):draw_line(this.preview_canvas.ctx,this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y,window.globAppstate.stroke_size);this.updateStatus()},drawPreviewUnderGrid(n,e,a,t,i,s,r){this.preview_canvas&&(n.scale(i,i),n.translate(s,r),n.drawImage(this.preview_canvas,0,0))},complete(n){this.points.length>=3&&undoable({name:localize("Polygon"),icon:get_icon_for_tool(this)},()=>{n.fillStyle=window.globAppstate.fill_color,n.strokeStyle=window.globAppstate.stroke_color;var e=window.globAppstate.stroke_size;this.$options.fill&&!this.$options.stroke&&(window.globAppstate.stroke_size=2,n.strokeStyle=window.globAppstate.fill_color),draw_polygon(n,this.points,this.$options.stroke||this.$options.fill&&!this.$options.stroke,this.$options.fill),window.globAppstate.stroke_size=e}),this.reset()},cancel(){this.reset()},end(n){this.complete(n),update_helper_layer()},updateStatus(){let n=1/0,e=-1/0,a=1/0,t=-1/0;for(const i of this.points)n=Math.min(i.x,n),e=Math.max(i.x,e),a=Math.min(i.y,a),t=Math.max(i.y,t)},reset(){this.points=[],this.last_click_pointerdown={x:-1/0,y:-1/0,time:-1/0},this.last_click_pointerup={x:-1/0,y:-1/0,time:-1/0},this.preview_canvas&&(this.preview_canvas.width=1,this.preview_canvas.height=1)},shape_colors:!0,$options:$ChooseShapeStyle()},{id:TOOL_ELLIPSE,name:localize("Ellipse"),speech_recognition:["ellipse","circle","oval","ovoid","ovaloid","oviform","elliptical","oblong circle","stretched circle","ball","sphere","round tool","rounded tool","ellipses","circles","ovals","ovoids","ovaloids","oviforms","ellipticals","oblong circles","stretched circles","balls","spheres"],help_icon:"p_oval.gif",description:localize("Draws an ellipse with the selected fill style."),cursor:["precise",[16,16],"crosshair"],shape(n,e,a,t,i){t<0&&(e+=t,t=-t),i<0&&(a+=i,i=-i),t<window.globAppstate.stroke_size||i<window.globAppstate.stroke_size?(n.fillStyle=n.strokeStyle,draw_ellipse(n,e,a,t,i,!1,!0)):draw_ellipse(n,e+~~(window.globAppstate.stroke_size/2),a+~~(window.globAppstate.stroke_size/2),t-window.globAppstate.stroke_size,i-window.globAppstate.stroke_size,this.$options.stroke,this.$options.fill)},$options:$ChooseShapeStyle()},{id:TOOL_ROUNDED_RECTANGLE,name:localize("Rounded Rectangle"),speech_recognition:["rounded rectangle","rounded square","rounded box","round rectangle","round square","round box","rounded corners rectangle","rounded corners square","rounded corners box","round cornered rectangle","round cornered square","round cornered box","rounded cornered rectangle","rounded cornered square","rounded cornered box","rounded corner rectangle","rounded corner square","rounded corner box","rectangle with round corners","square with round corners","box with round corners","rectangle with rounded corners","square with rounded corners","box with rounded corners","soft rectangle","soft square","soft box","soft corners rectangle","soft corners square","soft corners box","soft cornered rectangle","soft cornered square","soft cornered box","soft corner rectangle","soft corner square","soft corner box","rectangle with soft corners","square with soft corners","box with soft corners","round rect","roundrect","rounded rectangles","rounded squares","rounded boxes","round rectangles","round squares","round boxes","rounded corners rectangles","rounded corners squares","rounded corners boxes","round cornered rectangles","round cornered squares","round cornered boxes","rounded cornered rectangles","rounded cornered squares","rounded cornered boxes","rounded corner rectangles","rounded corner squares","rounded corner boxes","rectangles with round corners","squares with round corners","boxes with round corners","rectangles with rounded corners","squares with rounded corners","boxes with rounded corners","soft rectangles","soft squares","soft boxes","soft corners rectangles","soft corners squares","soft corners boxes","soft cornered rectangles","soft cornered squares","soft cornered boxes","soft corner rectangles","soft corner squares","soft corner boxes","rectangles with soft corners","squares with soft corners","boxes with soft corners","round rects","roundrects"],help_icon:"p_rrect.gif",description:localize("Draws a rounded rectangle with the selected fill style."),cursor:["precise",[16,16],"crosshair"],shape(n,e,a,t,i){if(t<0&&(e+=t,t=-t),i<0&&(a+=i,i=-i),t<window.globAppstate.stroke_size||i<window.globAppstate.stroke_size){n.fillStyle=n.strokeStyle;const s=Math.min(8,t/2,i/2);draw_rounded_rectangle(n,e,a,t,i,s,s,!1,!0)}else{const s=Math.min(8,(t-window.globAppstate.stroke_size)/2,(i-window.globAppstate.stroke_size)/2);draw_rounded_rectangle(n,e+~~(window.globAppstate.stroke_size/2),a+~~(window.globAppstate.stroke_size/2),t-window.globAppstate.stroke_size,i-window.globAppstate.stroke_size,s,s,this.$options.stroke,this.$options.fill)}},$options:$ChooseShapeStyle()}];tools.forEach(n=>{if(n.selectBox){let e=0,a=0,t=!1,i=0,s=0,r=0,u=0;n.pointerdown=()=>{e=window.globAppstate.pointer.x,a=window.globAppstate.pointer.y,t=!1,$G.one("pointermove",()=>{t=!0}),window.globAppstate.selection&&meld_selection_into_canvas(),window.globApp.canvas_handles.hide()},n.paint=()=>{i=~~Math.max(0,Math.min(e,window.globAppstate.pointer.x)),s=~~Math.max(0,Math.min(a,window.globAppstate.pointer.y)),r=~~Math.min(window.globAppstate.main_canvas.width,Math.max(e,window.globAppstate.pointer.x)+1)-i,u=~~Math.min(window.globAppstate.main_canvas.height,Math.max(a,window.globAppstate.pointer.y+1))-s},n.pointerup=()=>{window.globApp.canvas_handles.show(),n.selectBox(i,s,r,u)},n.cancel=()=>{window.globApp.canvas_handles.show()},n.drawPreviewUnderGrid=(h,o,d,_,b,f,v)=>{window.globAppstate.pointer_active&&t&&(h.scale(b,b),h.translate(f,v),h.drawImage(window.globAppstate.main_canvas,0,0))},n.drawPreviewAboveGrid=(h,o,d,_,b,f,v)=>{window.globAppstate.pointer_active&&t&&draw_selection_box(h,i,s,r,u,b,f,v)}}n.shape&&(n.shape_canvas=null,n.pointerdown=()=>{n.shape_canvas=make_canvas(window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height)},n.paint=()=>{n.shape_canvas.ctx.clearRect(0,0,n.shape_canvas.width,n.shape_canvas.height),n.shape_canvas.ctx.fillStyle=window.globAppstate.main_ctx.fillStyle,n.shape_canvas.ctx.strokeStyle=window.globAppstate.main_ctx.strokeStyle,n.shape_canvas.ctx.lineWidth=window.globAppstate.main_ctx.lineWidth,n.shape(n.shape_canvas.ctx,window.globAppstate.pointer_start.x,window.globAppstate.pointer_start.y,window.globAppstate.pointer.x-window.globAppstate.pointer_start.x,window.globAppstate.pointer.y-window.globAppstate.pointer_start.y),window.globAppstate.pointer.x-window.globAppstate.pointer_start.x,window.globAppstate.pointer.y-window.globAppstate.pointer_start.y},n.pointerup=()=>{n.shape_canvas&&undoable({name:n.name,icon:get_icon_for_tool(n)},()=>{window.globAppstate.main_ctx.drawImage(n.shape_canvas,0,0),n.shape_canvas=null})},n.drawPreviewUnderGrid=(e,a,t,i,s,r,u)=>{window.globAppstate.pointer_active&&n.shape_canvas&&(e.scale(s,s),e.translate(r,u),e.drawImage(n.shape_canvas,0,0))}),n.paint_mask&&(n.mask_canvas=null,n.pointerdown=(e,a,t)=>{n.mask_canvas||(n.mask_canvas=make_canvas(window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height)),n.mask_canvas.width!==window.globAppstate.main_canvas.width&&(n.mask_canvas.width=window.globAppstate.main_canvas.width),n.mask_canvas.height!==window.globAppstate.main_canvas.height&&(n.mask_canvas.height=window.globAppstate.main_canvas.height),n.mask_canvas.ctx.disable_image_smoothing()},n.pointerup=()=>{n.mask_canvas&&undoable({name:n.name,icon:get_icon_for_tool(n)},()=>{n.render_from_mask(window.globAppstate.main_ctx),n.mask_canvas.width=1,n.mask_canvas.height=1})},n.paint=(e,a,t)=>{n.paint_mask(n.mask_canvas.ctx,a,t)},n.cancel=()=>{n.mask_canvas&&(n.mask_canvas.width=1,n.mask_canvas.height=1)},n.render_from_mask=(e,a)=>{e.save(),e.globalCompositeOperation="destination-out",e.drawImage(n.mask_canvas,0,0),e.restore();let t=window.globAppstate.stroke_color;const i=make_canvas(n.mask_canvas);return replace_colors_with_swatch(i.ctx,t,0,0),e.drawImage(i,0,0),!0},n.drawPreviewUnderGrid=(e,a,t,i,s,r,u)=>{!window.globAppstate.pointer_active&&!window.globAppstate.pointer_over_canvas||(e.scale(s,s),e.translate(r,u),n.mask_canvas&&n.render_from_mask(e,!0)&&requestAnimationFrame(()=>{update_helper_layer()}))}),n.get_brush&&(n.mask_canvas=null,n.init_mask_canvas=(e,a,t)=>{n.mask_canvas||(n.mask_canvas=make_canvas(window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height)),n.mask_canvas.width!==window.globAppstate.main_canvas.width&&(n.mask_canvas.width=window.globAppstate.main_canvas.width),n.mask_canvas.height!==window.globAppstate.main_canvas.height&&(n.mask_canvas.height=window.globAppstate.main_canvas.height),n.mask_canvas.ctx.disable_image_smoothing()},n.pointerdown=(e,a,t)=>{n.init_mask_canvas()},n.pointerup=()=>{undoable({name:n.name,icon:get_icon_for_tool(n)},()=>{n.render_from_mask(window.globAppstate.main_ctx),n.mask_canvas.width=1,n.mask_canvas.height=1})},n.paint=()=>{const e=n.get_brush(),a=get_circumference_points_for_brush(e.shape,e.size);n.mask_canvas.ctx.fillStyle=window.globAppstate.stroke_color,(e.size>1?bresenham_dense_line:bresenham_line)(window.globAppstate.pointer_previous.x,window.globAppstate.pointer_previous.y,window.globAppstate.pointer.x,window.globAppstate.pointer.y,(i,s)=>{for(const r of a)n.mask_canvas.ctx.fillStyle="white",n.mask_canvas.ctx.fillRect(i+r.x,s+r.y,1,1)}),stamp_brush_canvas(n.mask_canvas.ctx,window.globAppstate.pointer_previous.x,window.globAppstate.pointer_previous.y,e.shape,e.size),stamp_brush_canvas(n.mask_canvas.ctx,window.globAppstate.pointer.x,window.globAppstate.pointer.y,e.shape,e.size)},n.cancel=()=>{n.mask_canvas&&(n.mask_canvas.width=1,n.mask_canvas.height=1)},n.render_from_mask=(e,a)=>{let t=window.globAppstate.stroke_color;const i=make_canvas(n.mask_canvas);if(a&&n.dynamic_preview_cursor){const s=n.get_brush();stamp_brush_canvas(i.ctx,window.globAppstate.pointer.x,window.globAppstate.pointer.y,s.shape,s.size)}return replace_colors_with_swatch(i.ctx,t,0,0),e.drawImage(i,0,0),!0},n.drawPreviewUnderGrid=(e,a,t,i,s,r,u)=>{if(!window.globAppstate.pointer_active&&!window.globAppstate.pointer_over_canvas)return;e.scale(s,s),e.translate(r,u),n.init_mask_canvas(),n.render_from_mask(e,!0)&&requestAnimationFrame(()=>{update_helper_layer()})})});console.log("JS 실행:","OnCanvasSelection.js");class OnCanvasSelection extends OnCanvasObject{constructor(e,a,t,i,s){super(e,a,t,i,!0),this.$el.addClass("selection");let r=window.globAppstate.tool_transparent_mode,u=window.globAppstate.selected_colors.background;this._on_option_changed=()=>{this.source_canvas&&(r!==window.globAppstate.tool_transparent_mode||u!==window.globAppstate.selected_colors.background)&&(r=window.globAppstate.tool_transparent_mode,u=window.globAppstate.selected_colors.background,this.update_tool_transparent_mode())},$(window).on("option-changed",this._on_option_changed),this.instantiate(s)}position(){super.position(!0),update_helper_layer()}instantiate(e){this.$el.css({cursor:make_css_cursor("move",[8,8],"move"),touchAction:"none"}),this.position(),(()=>{e?(this.source_canvas=make_canvas(e),this.source_canvas.width!==this.width&&(this.source_canvas.width=this.width),this.source_canvas.height!==this.height&&(this.source_canvas.height=this.height),this.canvas=make_canvas(this.source_canvas)):(this.source_canvas=make_canvas(this.width,this.height),this.source_canvas.ctx.drawImage(window.globAppstate.main_canvas,this.x,this.y,this.width,this.height,0,0,this.width,this.height),this.canvas=make_canvas(this.source_canvas),this.cut_out_background()),this.$el.append(this.canvas),this.handles=new Handles({$handles_container:this.$el,$object_container:window.globApp.$canvas_area,outset:2,get_rect:()=>({x:this.x,y:this.y,width:this.width,height:this.height}),set_rect:({x:r,y:u,width:h,height:o})=>{undoable({name:"Resize Selection",icon:get_icon_for_tool(get_tool_by_id(TOOL_SELECT)),soft:!0},()=>{this.x=r,this.y=u,this.width=h,this.height=o,this.position(),this.resize()})},get_ghost_offset_left:()=>parseFloat(window.globApp.$canvas_area.css("padding-left"))+1,get_ghost_offset_top:()=>parseFloat(window.globApp.$canvas_area.css("padding-top"))+1});let t,i;const s=r=>{make_or_update_undoable({match:u=>r.shiftKey&&/^(Smear|Stamp|Move) Selection$/.test(u.name)||!r.shiftKey&&/^Move Selection$/.test(u.name),name:r.shiftKey?"Smear Selection":"Move Selection",update_name:!0,icon:get_icon_for_tool(get_tool_by_id(TOOL_SELECT)),soft:!0},()=>{const u=to_canvas_coords(r);this.x=Math.max(Math.min(u.x-t,window.globAppstate.main_canvas.width),-this.width),this.y=Math.max(Math.min(u.y-i,window.globAppstate.main_canvas.height),-this.height),this.position(),r.shiftKey&&this.draw()})};this.canvas_pointerdown=r=>{r.preventDefault();const u=this.canvas.getBoundingClientRect(),h=r.clientX-u.left,o=r.clientY-u.top;t=~~(h/u.width*this.canvas.width),i=~~(o/u.height*this.canvas.height),$(window).on("pointermove",s),this.dragging=!0,update_helper_layer(),$(window).one("pointerup",()=>{$(window).off("pointermove",s),this.dragging=!1,update_helper_layer()}),r.shiftKey?undoable({name:"Stamp Selection",icon:get_icon_for_tool(get_tool_by_id(TOOL_SELECT)),soft:!0},()=>{this.draw()}):r.ctrlKey&&undoable({name:"Stamp Selection",icon:get_icon_for_tool(get_tool_by_id(TOOL_SELECT)),soft:!0},()=>{this.draw()})},$(this.canvas).on("pointerdown",this.canvas_pointerdown),window.globApp.$canvas_area.trigger("resize")})()}cut_out_background(){const e=this.canvas,a=window.globAppstate.main_ctx.getImageData(this.x,this.y,this.width,this.height),t=e.ctx.getImageData(0,0,this.width,this.height),i=make_canvas(e);replace_colors_with_swatch(i.ctx,window.globAppstate.selected_colors.background,this.x,this.y);for(let s=0;s<t.data.length;s+=4)t.data[s+3]>0?(t.data[s+0]=a.data[s+0],t.data[s+1]=a.data[s+1],t.data[s+2]=a.data[s+2],t.data[s+3]=a.data[s+3],a.data[s+0]=0,a.data[s+1]=0,a.data[s+2]=0,a.data[s+3]=0):(t.data[s+0]=0,t.data[s+1]=0,t.data[s+2]=0,t.data[s+3]=0);window.globAppstate.main_ctx.putImageData(a,this.x,this.y),e.ctx.putImageData(t,0,0),this.update_tool_transparent_mode(),(!window.globAppstate.transparency||window.globAppstate.tool_transparent_mode)&&window.globAppstate.main_ctx.drawImage(i,this.x,this.y),$(window).triggerHandler("session-update"),update_helper_layer()}update_tool_transparent_mode(){const e=this.source_canvas.ctx.getImageData(0,0,this.width,this.height),a=this.canvas.ctx.createImageData(this.width,this.height),t=get_rgba_from_color(window.globAppstate.selected_colors.background),i=1;for(let s=0;s<a.data.length;s+=4){let r=e.data[s+3]>1;window.globAppstate.tool_transparent_mode&&Math.abs(e.data[s+0]-t[0])<=i&&Math.abs(e.data[s+1]-t[1])<=i&&Math.abs(e.data[s+2]-t[2])<=i&&Math.abs(e.data[s+3]-t[3])<=i&&(r=!1),r&&(a.data[s+0]=e.data[s+0],a.data[s+1]=e.data[s+1],a.data[s+2]=e.data[s+2],a.data[s+3]=e.data[s+3])}this.canvas.ctx.putImageData(a,0,0),update_helper_layer()}replace_source_canvas(e){this.source_canvas=e;const a=make_canvas(e);$(this.canvas).replaceWith(a),this.canvas=a;const t=this.x+this.width/2,i=this.y+this.height/2,s=a.width,r=a.height;this.x=~~(t-s/2),this.y=~~(i-r/2),this.width=s,this.height=r,this.position(),$(this.canvas).on("pointerdown",this.canvas_pointerdown),this.$el.triggerHandler("resize"),this.update_tool_transparent_mode()}resize(){const e=make_canvas(this.width,this.height);e.ctx.drawImage(this.source_canvas,0,0,this.width,this.height),this.replace_source_canvas(e)}scale(e){const a=Math.max(1,this.width*e),t=Math.max(1,this.height*e),i=make_canvas(a,t);i.ctx.drawImage(this.source_canvas,0,0,i.width,i.height),this.replace_source_canvas(i)}draw(){try{window.globAppstate.main_ctx.drawImage(this.canvas,this.x,this.y)}catch{}}destroy(){super.destroy(),$(window).off("option-changed",this._on_option_changed),update_helper_layer()}}console.log("JS 실행:","color-data.js");const default_palette=["rgb(0,0,0)","rgb(128,128,128)","rgb(128,0,0)","rgb(128,128,0)","rgb(0,128,0)","rgb(0,128,128)","rgb(0,0,128)","rgb(128,0,128)","rgb(128,128,64)","rgb(0,64,64)","rgb(0,128,255)","rgb(0,64,128)","rgb(64,0,255)","rgb(128,64,0)","rgb(128,64,0,0.1)","rgb(128,64,0,0.2)","rgb(255,255,255)","rgb(192,192,192)","rgb(255,0,0)","rgb(255,255,0)","rgb(0,255,0)","rgb(0,255,255)","rgb(0,0,255)","rgb(255,0,255)","rgb(255,255,128)","rgb(0,255,128)","rgb(128,255,255)","rgb(128,128,255)","rgb(255,0,128)","rgb(255,128,64)","rgb(128,64,0,0.3)","rgb(128,64,0,0)"];console.log("JS 실행:","file-format-data.js");let image_formats=[];const add_image_format=(n,e,a=image_formats)=>{const t={formatID:n,mimeType:n,name:localize(e).replace(/\s+\([^(]+$/,""),nameWithExtensions:localize(e),extensions:[]},i=/\*\.([^);,]+)/g;if(get_direction()==="rtl"){const r="‏",u="‎";t.nameWithExtensions=t.nameWithExtensions.replace(i,`${r}*.${u}$1${r}`)}let s;for(;s=i.exec(e);){const r=s[1];t.extensions.push(r)}a.push(t)};add_image_format("image/png","PNG (*.png)");add_image_format("image/webp","WebP (*.webp)");add_image_format("image/gif","GIF (*.gif)");add_image_format("image/tiff","TIFF (*.tif;*.tiff)");add_image_format("image/jpeg","JPEG (*.jpg;*.jpeg;*.jpe;*.jfif)");add_image_format("image/x-bmp-1bpp","Monochrome Bitmap (*.bmp;*.dib)");add_image_format("image/x-bmp-4bpp","16 Color Bitmap (*.bmp;*.dib)");add_image_format("image/x-bmp-8bpp","256 Color Bitmap (*.bmp;*.dib)");add_image_format("image/bmp","24-bit Bitmap (*.bmp;*.dib)");const palette_formats=[];console.log("AnyPalette:",AnyPalette);for(const[n,e]of Object.entries(AnyPalette.formats))if(e.write){const a=e.fileExtensions.map(t=>`*.${t}`).join(";");palette_formats.push({formatID:n,name:e.name,nameWithExtensions:`${e.name} (${a})`,extensions:e.fileExtensions})}palette_formats.sort((n,e)=>+(e.formatID==="RIFF_PALETTE")-+(n.formatID==="RIFF_PALETTE")||+(e.formatID==="GIMP_PALETTE")-+(n.formatID==="GIMP_PALETTE")||0);console.log("JS 실행:","storage.js");const localStore={get(n,e){let a;try{if(typeof n=="string"){const t=n,i=localStorage.getItem(t);i&&(a=JSON.parse(i))}else if(a={},Array.isArray(n)){const t=n;for(let i=0,s=t.length;i<s;i++){const r=t[i],u=localStorage.getItem(r);u&&(a[r]=JSON.parse(u))}}else{const t=n;for(const i in t){let s=t[i];const r=localStorage.getItem(i);r?a[i]=JSON.parse(r):a[i]=s}}}catch(t){e(t);return}e(null,a)},set(n,e,a){let t={};if(typeof n=="string")t={[n]:e};else{if(Array.isArray(n))throw new TypeError("Cannot set an array of keys (to what?)");t=n,a=e}for(const i in t){const s=t[i];try{localStorage.setItem(i,JSON.stringify(s))}catch(r){r.quotaExceeded=r.code===22||r.name==="NS_ERROR_DOM_QUOTA_REACHED"||r.number===-2147024882,a(r);return}}return a(null)}};console.log("JS 실행:","functions.js");const param_types={"eye-gaze-mode":"bool","vertical-color-box-mode":"bool","speech-recognition-mode":"bool",local:"string",session:"string",load:"string"},exclusive_params=["local","session","load"];function get_all_url_params(){const n={};location.hash.replace(/^#/,"").split(/,/).forEach(e=>{const a=e.indexOf(":");if(a===-1){const t=e;n[t]=!0}else{const t=e.slice(0,a),i=e.slice(a+1);n[t]=decodeURIComponent(i)}});for(const[e,a]of Object.entries(param_types))a==="bool"&&!n[e]&&(n[e]=!1);return n}function change_url_param(n,e,{replace_history_state:a=!1}={}){change_some_url_params({[n]:e},{replace_history_state:a})}function change_some_url_params(n,{replace_history_state:e=!1}={}){for(const a of exclusive_params)n[a]&&exclusive_params.forEach(t=>{t!==a&&(n[t]=null)});set_all_url_params(Object.assign({},get_all_url_params(),n),{replace_history_state:e})}function set_all_url_params(n,{replace_history_state:e=!1}={}){let a="";for(const[s,r]of Object.entries(param_types))n[s]&&(a.length&&(a+=","),a+=encodeURIComponent(s),r!=="bool"&&(a+=":"+encodeURIComponent(n[s])));let t=location.search;t.includes("frame_id")||(t="");const i=`${location.origin}${location.pathname}${t}#${a}`;try{e?history.replaceState(null,document.title,i):history.pushState(null,document.title,i)}catch{location.hash=a}$G.triggerHandler("change-url-params")}function update_magnified_canvas_size(){const n=window.devicePixelRatio,a=roundDPR(n)/n,t=window.globAppstate.magnification*a;window.globApp.$canvas.css("width",window.globAppstate.main_canvas.width*t),window.globApp.$canvas.css("height",window.globAppstate.main_canvas.height*t),update_canvas_rect()}function update_canvas_rect(){window.globApp.canvas_bounding_client_rect=window.globAppstate.main_canvas.getBoundingClientRect(),update_helper_layer()}let helper_layer_update_queued=!1,info_for_updating_pointer;function update_helper_layer(n){n&&isFinite(n.clientX)&&(info_for_updating_pointer={clientX:n.clientX,clientY:n.clientY,devicePixelRatio}),!helper_layer_update_queued&&(helper_layer_update_queued=!0,requestAnimationFrame(()=>{helper_layer_update_queued=!1,update_helper_layer_immediately()}))}function update_helper_layer_immediately(){if(info_for_updating_pointer){const e=info_for_updating_pointer.devicePixelRatio/devicePixelRatio;info_for_updating_pointer.clientX*=e,info_for_updating_pointer.clientY*=e,info_for_updating_pointer.devicePixelRatio=devicePixelRatio,window.globAppstate.pointer=to_canvas_coords(info_for_updating_pointer)}const n=window.globAppstate.magnification*window.devicePixelRatio;if(window.globAppstate.helper_layer||(window.globAppstate.helper_layer=new OnCanvasHelperLayer(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height,!1,n)),(window.globAppstate.helper_layer.canvas.width!=window.globAppstate.main_canvas.width||window.globAppstate.helper_layer.canvas.height!=window.globAppstate.main_canvas.height)&&(console.log("같지않음"),window.globAppstate.helper_layer.canvas.width=window.globAppstate.main_canvas.width,window.globAppstate.helper_layer.canvas.height=window.globAppstate.main_canvas.height,window.globAppstate.helper_layer.canvas.ctx.disable_image_smoothing(),window.globAppstate.helper_layer.width=window.globAppstate.main_canvas.width,window.globAppstate.helper_layer.height=window.globAppstate.main_canvas.height,window.globAppstate.helper_layer.x=0,window.globAppstate.helper_layer.y=0,window.globAppstate.helper_layer.position()),render_canvas_view(window.globAppstate.helper_layer.canvas,1,0,0,!0),window.globAppstate.thumbnail_canvas&&window.globAppstate.$thumbnail_window.is(":visible")){const e=parseFloat(window.globApp.$canvas_area.css("padding-left")),a=parseFloat(window.globApp.$canvas_area.css("padding-top")),t=window.globAppstate.main_canvas.clientWidth+e-window.globApp.$canvas_area[0].clientWidth,i=window.globAppstate.main_canvas.clientHeight+a-window.globApp.$canvas_area[0].clientHeight;let s=window.globApp.$canvas_area[0].scrollLeft/Math.max(1,t),r=window.globApp.$canvas_area[0].scrollTop/Math.max(1,i);s=Math.min(s,1),r=Math.min(r,1);let u=Math.floor(Math.max(s*(window.globAppstate.main_canvas.width-window.globAppstate.thumbnail_canvas.width),0)),h=Math.floor(Math.max(r*(window.globAppstate.main_canvas.height-window.globAppstate.thumbnail_canvas.height),0));render_canvas_view(window.globAppstate.thumbnail_canvas,1,u,h,!1)}}function render_canvas_view(n,e,a,t,i){window.globApp.update_fill_and_stroke_colors_and_lineWidth(window.globAppstate.selected_tool);const s=window.globAppstate.show_grid&&window.globAppstate.magnification>=4&&window.devicePixelRatio*window.globAppstate.magnification>=4&&i,r=n.ctx;r.clearRect(0,0,n.width,n.height),i||r.drawImage(window.globAppstate.main_canvas,a,t,n.width,n.height,0,0,n.width,n.height);var u=[...window.globAppstate.selected_tools];$("body").hasClass("dragging")&&!window.globAppstate.pointer_active&&(u=u.filter(o=>o.id===TOOL_CURVE||o.id===TOOL_POLYGON)),u.sort((o,d)=>o.selectBox&&!d.selectBox?-1:!o.selectBox&&d.selectBox?1:0);var h=u.findIndex(o=>o.selectBox);h>=0&&(u=u.filter((o,d)=>!o.selectBox||d==h)),u.forEach(o=>{o.drawPreviewUnderGrid&&window.globAppstate.pointer&&window.globAppstate.pointers.length<2&&(r.save(),o.drawPreviewUnderGrid(r,window.globAppstate.pointer.x,window.globAppstate.pointer.y,s,e,-a,-t),r.restore())}),window.globAppstate.selection&&(r.save(),r.scale(e,e),r.translate(-a,-t),r.drawImage(window.globAppstate.selection.canvas,window.globAppstate.selection.x,window.globAppstate.selection.y),r.restore(),!i&&!window.globAppstate.selection.dragging&&draw_selection_box(r,window.globAppstate.selection.x,window.globAppstate.selection.y,window.globAppstate.selection.width,window.globAppstate.selection.height,e,-a,-t)),s&&draw_grid(r,e),u.forEach(o=>{o.drawPreviewAboveGrid&&window.globAppstate.pointer&&window.globAppstate.pointers.length<2&&(r.save(),o.drawPreviewAboveGrid(r,window.globAppstate.pointer.x,window.globAppstate.pointer.y,s,e,-a,-t),r.restore())})}function update_disable_aa(){window.devicePixelRatio*window.globAppstate.magnification>=1?window.globApp.$canvas_area.addClass("pixeled-canvas").removeClass("smooth-canvas"):window.globApp.$canvas_area.addClass("smooth-canvas").removeClass("pixeled-canvas")}function roundDPR(n){const e=[.25,.5,1,2,4,8,16];let a=e[0];for(let t=1;t<e.length;t++)Math.abs(n-e[t])<Math.abs(n-a)&&(a=e[t]);return a}function set_magnification(n,e){e=e??{x:window.globApp.$canvas_area.scrollLeft()/window.globAppstate.magnification,y:window.globApp.$canvas_area.scrollTop()/window.globAppstate.magnification};const a=from_canvas_coords(e);window.globAppstate.magnification=n,n!==1&&(window.globAppstate.return_to_magnification=n),update_magnified_canvas_size();const t=from_canvas_coords(e);window.globApp.$canvas_area[0].scrollBy({left:t.clientX-a.clientX,top:t.clientY-a.clientY,behavior:"instant"}),$G.triggerHandler("resize"),$G.trigger("option-changed"),$G.trigger("magnification-changed")}function reset_selected_colors(){window.globAppstate.selected_colors={foreground:"#000000",background:"#ffffff",ternary:""},$G.trigger("option-changed")}function reset_file(){window.globAppstate.system_file_handle=null,window.globAppstate.file_name=localize("untitled"),window.globAppstate.file_format="image/png",window.globAppstate.saved=!0,update_title()}function reset_canvas_and_history(){window.globAppstate.undos.length=0,window.globAppstate.redos.length=0,window.globAppstate.current_history_node=window.globAppstate.root_history_node=make_history_node({name:localize("New"),icon:get_help_folder_icon("p_blank.png")}),window.globAppstate.history_node_to_cancel_to=null,console.log("캔버스 리셋!"),window.globAppstate.main_canvas.width=Math.max(1,window.globAppstate.my_canvas_width),window.globAppstate.main_canvas.height=Math.max(1,window.globAppstate.my_canvas_height),window.globAppstate.main_ctx.disable_image_smoothing(),window.globAppstate.main_ctx.fillStyle=window.globAppstate.selected_colors.background,window.globAppstate.main_ctx.fillRect(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),window.globAppstate.current_history_node.image_data=window.globAppstate.main_ctx.getImageData(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),window.globApp.$canvas_area.trigger("resize"),$G.triggerHandler("history-update")}function make_history_node({parent:n=null,futures:e=[],timestamp:a=Date.now(),soft:t=!1,image_data:i=null,selection_image_data:s=null,selection_x:r,selection_y:u,text_tool_font:h=null,tool_transparent_mode:o=!1,foreground_color:d,background_color:_,ternary_color:b,name:f,icon:v=null}){return{parent:n,futures:e,timestamp:a,soft:t,image_data:i,selection_image_data:s,selection_x:r,selection_y:u,text_tool_font:h,tool_transparent_mode:o,foreground_color:d,background_color:_,ternary_color:b,name:f,icon:v}}function update_title(){document.title=`${window.globAppstate.file_name} - ${is_pride_month?"June Solidarity ":""}${localize("Paint")}`,is_pride_month&&$("link[rel~='icon']").attr("href","./images/icons/gay-es-paint-16x16-light-outline.png"),window.setRepresentedFilename&&window.setRepresentedFilename(window.globAppstate.system_file_handle??""),window.setDocumentEdited&&window.setDocumentEdited(!window.globAppstate.saved)}function get_uris(n){const e=n.split(/[\n\r]+/).filter(t=>t[0]!=="#"&&t);if(e.length>15)return[];const a=[];for(let t=0;t<e.length;t++)try{const i=new URL(e[t]);a.push(i.href)}catch{}return a}async function load_image_from_uri(n){const e=n.match(/^blob:/i),a=!n.match(/^(blob|data|file):/i),t=n.match(/^(http|https):\/\/((127\.0\.0\.1|localhost)|.*(\.(local|localdomain|domain|lan|home|host|corp|invalid)))\b/i);if(e&&n.indexOf(`blob:${location.origin}`)===-1){const u=new Error("can't load blob: URI from another domain");throw u.code="cross-origin-blob-uri",u}const i=a&&!t?[n,`https://cors.bridged.cc/${n}`,`https://jspaint-cors-proxy.herokuapp.com/${n}`,`https://web.archive.org/${n}`]:[n],s=[];for(let u=0;u<i.length;u+=1){const h=i[u];try{const o=({loaded:v,total:A})=>{};a&&console.log(`Try loading image from URI (${u+1}/${i.length}): "${h}"`);const d=await fetch(h);let _=d;if(!d.ok){s.push({status:d.status,statusText:d.statusText,url:h});continue}if(!d.body)a&&console.log("ReadableStream not yet supported in this browser. Progress won't be shown for image requests.");else{const v=d.headers.get("content-encoding"),A=d.headers.get(v?"x-file-size":"content-length");if(A===null)a&&console.log("Response size header unavailable. Progress won't be shown for this image request.");else{const x=parseInt(A,10);let C=0;_=new Response(new ReadableStream({start(M){const I=d.body.getReader();w();function w(){I.read().then(({done:l,value:c})=>{if(l){M.close();return}C+=c.byteLength,o({loaded:C,total:x}),M.enqueue(c),w()}).catch(l=>{console.error(l),M.error(l)})}}}))}}const b=await _.blob();return a&&console.log("Download complete."),await new Promise((v,A)=>{read_image_file(b,(x,C)=>{x?A(x):v(C)})})}catch(o){s.push({url:h,error:o})}}const r=new Error(`failed to fetch image from any of ${i.length} URI(s):
  ${s.map(u=>(u.statusText?`${u.status} ${u.statusText} `:"")+u.url+(u.error?`
    ${u.error}`:"")).join(`
  `)}`);throw r.code="access-failure",r.fails=s,r}function open_from_image_info(n,e,a,t,i){are_you_sure(({canvas_modified_while_loading:s}={})=>{deselect(),cancel(),t||($G.triggerHandler("session-update"),new_local_session()),reset_file(),reset_selected_colors(),reset_canvas_and_history(),set_magnification(window.globAppstate.default_magnification),window.globAppstate.main_ctx.copy(n.image||n.image_data),apply_file_format_and_palette_info(n),window.globAppstate.transparency=has_any_transparency(window.globAppstate.main_ctx),window.globApp.$canvas_area.trigger("resize"),window.globAppstate.current_history_node.name=localize("Open"),window.globAppstate.current_history_node.image_data=window.globAppstate.main_ctx.getImageData(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),window.globAppstate.current_history_node.icon=get_help_folder_icon("p_open.png"),(s||!i)&&$G.triggerHandler("session-update"),$G.triggerHandler("history-update"),n.source_blob instanceof File&&(window.globAppstate.file_name=n.source_blob.name,window.globAppstate.system_file_handle=n.source_blob.path),n.source_file_handle&&(window.globAppstate.system_file_handle=n.source_file_handle),window.globAppstate.saved=!0,update_title(),e==null||e()},a,i)}function open_from_file(n,e){if(n instanceof File&&n.name.match(/\.theme(pack)?$/i)){n.text().then(load_theme_from_text,a=>{show_error_message(localize("Paint cannot open this file."),a)});return}read_image_file(n,(a,t)=>{if(a){AnyPalette.loadPalette(n,(i,s)=>{var r;if(i){show_file_format_errors({as_image_error:a,as_palette_error:i});return}window.globAppstate.palette=s.map(u=>u.toString()),(r=window.console)==null||r.log(`Loaded palette: ${window.globAppstate.palette.map(()=>"%c█").join("")}`,...window.globAppstate.palette.map(u=>`color: ${u};`))});return}t.source_file_handle=e,open_from_image_info(t)})}function apply_file_format_and_palette_info(n){var e;window.globAppstate.file_format=n.file_format,window.globAppstate.enable_palette_loading_from_indexed_images&&(n.palette?((e=window.console)==null||e.log(`Loaded palette from image file: ${n.palette.map(()=>"%c█").join("")}`,...n.palette.map(a=>`color: ${a};`)),window.globAppstate.palette=n.palette,window.globAppstate.selected_colors.foreground=window.globAppstate.palette[0],window.globAppstate.selected_colors.background=window.globAppstate.palette.length===14*2?window.globAppstate.palette[14]:window.globAppstate.palette[1],$G.trigger("option-changed")):monochrome&&!n.monochrome&&(window.globAppstate.palette=default_palette,reset_selected_colors()),monochrome=n.monochrome)}function load_theme_from_text(n){var e=parseThemeFileString(n);if(!e){show_error_message(localize("Paint cannot open this file."));return}applyCSSProperties(e,{recurseIntoIframes:!0}),window.themeCSSProperties=e,$G.triggerHandler("theme-load")}function file_new(){are_you_sure(()=>{deselect(),cancel(),$G.triggerHandler("session-update"),new_local_session(),reset_file(),reset_selected_colors(),reset_canvas_and_history(),set_magnification(window.globAppstate.default_magnification),$G.triggerHandler("session-update")})}async function file_open(){const{file:n,fileHandle:e}=await systemHooks.showOpenFileDialog({formats:image_formats});open_from_file(n,e)}let acknowledged_overwrite_capability=!1;const confirmed_overwrite_key="jspaint confirmed overwrite capable";try{acknowledged_overwrite_capability=localStorage[confirmed_overwrite_key]==="true"}catch(n){acknowledged_overwrite_capability=Date.now()>=2e12}function file_save(n=()=>{},e=!0){deselect();const a=window.globAppstate.system_file_handle;if(!a||window.globAppstate.file_name.match(/\.(svg|pdf)$/i))return file_save_as(n,e);write_image_file(window.globAppstate.main_canvas,window.globAppstate.file_format,async t=>{const i=await systemHooks.writeBlobToHandle(a,t);i===!0&&(window.globAppstate.saved=!0,update_title()),i!==!1&&(e&&update_from_saved_file(t),n())})}function file_save_as(n=()=>{},e=!0){deselect(),systemHooks.showSaveFileDialog({dialogTitle:localize("Save As"),formats:image_formats,defaultFileName:window.globAppstate.file_name,defaultPath:typeof window.globAppstate.system_file_handle=="string"?window.globAppstate.system_file_handle:null,defaultFileFormatID:window.globAppstate.file_format,getBlob:a=>new Promise(t=>{write_image_file(window.globAppstate.main_canvas,a,i=>{t(i)})}),savedCallbackUnreliable:({newFileName:a,newFileFormatID:t,newFileHandle:i,newBlob:s})=>{window.globAppstate.saved=!0,window.globAppstate.system_file_handle=i,window.globAppstate.file_name=a,window.globAppstate.file_format=t,update_title(),n(),e&&update_from_saved_file(s)}})}function are_you_sure(n,e,a){window.globAppstate.saved?n():a?showMessageBox({message:localize(`You've modified the document while an existing document was loading.
Save the new document?`,window.globAppstate.file_name),buttons:[{label:localize("Yes"),value:"save",default:!0},{label:localize("No"),value:"discard"}]}).then(t=>{t==="save"?file_save(()=>{n()},!1):t==="discard"?n({canvas_modified_while_loading:!0}):n()}):showMessageBox({message:localize("Save changes to %1?",window.globAppstate.file_name),buttons:[{label:localize("Yes"),value:"save",default:!0},{label:localize("No"),value:"discard"},{label:localize("Cancel"),value:"cancel"}]}).then(t=>{t==="save"?file_save(()=>{n()},!1):t==="discard"?n():e==null||e()})}function show_error_message(n,e){var t,i,s,r;const{$message:a}=showMessageBox({iconID:"error",message:n});if(e){const u=$("<details><summary><span>Details</span></summary></details>").appendTo(a),h=e;let o=h.stack;if(o)h.message&&o.indexOf(h.message)===-1?o=`${e.toString()}

${o}`:h.name&&o.indexOf(h.name)===-1&&(o=`${h.name}

${o}`);else if(o=e.toString(),o==="[object Object]")try{o=JSON.stringify(e,null,2)}catch(d){o="Error details could not be stringified: "+d}$(E("pre")).text(o).appendTo(u).css({background:"white",color:"#333",fontFamily:"monospace",width:"500px",maxWidth:"100%",overflow:"auto"})}e?(i=(t=window.console)==null?void 0:t.error)==null||i.call(t,n,e):(r=(s=window.console)==null?void 0:s.error)==null||r.call(s,n)}function show_resource_load_error_message(n){const{$window:e,$message:a}=showMessageBox({}),t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;n.code==="cross-origin-blob-uri"?a.html(`
			<p>Can't load image from address starting with "blob:".</p>
			${t?'<p>Try "Copy Image" instead of "Copy Image Location".</p>':'<p>Try "Copy image" instead of "Copy image address".</p>'}
		`):n.code==="html-not-image"?a.html(`
			<p>Address points to a web page, not an image file.</p>
			<p>Try copying and pasting an image instead of a URL.</p>
		`):n.code==="decoding-failure"?a.html(`
			<p>Address doesn't point to an image file of a supported format.</p>
			<p>Try copying and pasting an image instead of a URL.</p>
		`):n.code==="access-failure"?navigator.onLine?(a.html(`
				<p>Failed to download image.</p>
				<p>Try copying and pasting an image instead of a URL.</p>
			`),n.fails&&$("<ul>").append(n.fails.map(({status:i,statusText:s,url:r})=>$("<li>").text(r).prepend($("<b>").text(`${i||""} ${s||"Failed"} `)))).appendTo(a)):a.html(`
				<p>Failed to download image.</p>
				<p>You're offline. Connect to the internet and try again.</p>
				<p>Or copy and paste an image instead of a URL, if possible.</p>
			`):a.html(`
			<p>Failed to load image from URL.</p>
			<p>Check your browser's devtools for details.</p>
		`),a.css({maxWidth:"500px"}),e.center()}function show_file_format_errors({as_image_error:n,as_palette_error:e}){let a=`
		<p>${localize("Paint cannot open this file.")}</p>
	`;n&&(a+=`
			<details>
				<summary>${localize("Bitmap Image")}</summary>
				<p>${localize("This is not a valid bitmap file, or its format is not currently supported.")}</p>
			</details>
		`);var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};const i=u=>String(u).replace(/[&<>"'`=/]/g,h=>t[h]),s=u=>u.charAt(0).toUpperCase()+u.slice(1),r=e&&!n;if(e){let u="";"errors"in e?u=`<ul dir="ltr">${e.errors.map(h=>{const o=h.__PATCHED_LIB_TO_ADD_THIS__format;return o&&h.error?`<li><b>${i(`${o.name}`)}</b>: ${i(s(h.error.message))}</li>`:`<li>${i(h.message||h)}</li>`}).join(`
`)}</ul>`:u=`<p>${i(e.message||e)}</p>`,a+=`
			<details>
				<summary>${r?"Details":localize("Palette|*.pal|").split("|")[0]}</summary>
				<p>${localize("Unexpected file format.")}</p>
				${u}
			</details>
		`}showMessageBox({messageHTML:a})}let $about_paint_window;const $about_paint_content=$("#about-paint"),$this_version_news=$("#news");let $latest_news=$this_version_news;location.origin!=="https://jspaint.app"&&$this_version_news.prepend($("<p>For the latest news, visit <a href='https://jspaint.app'>jspaint.app</a></p>").css({padding:"8px 15px"}));function show_about_paint(){$about_paint_window&&$about_paint_window.close(),$about_paint_window=$Window({title:localize("About Paint"),resizable:!1,maximizeButton:!1,minimizeButton:!1}),$about_paint_window.addClass("about-paint squish"),is_pride_month&&$("#about-paint-icon").attr("src","./images/icons/gay-es-paint-128x128.png"),$about_paint_window.$content.append($about_paint_content.show()).css({padding:"15px"}),$("#jspaint-update-status-area").removeAttr("hidden"),$("#failed-to-check-if-outdated").attr("hidden","hidden"),$("#outdated").attr("hidden","hidden"),$about_paint_window.$Button(localize("OK"),()=>{$about_paint_window.close()}).attr("id","close-about-paint").focus().css({float:"right",marginBottom:"10px"}),$("#refresh-to-update").on("click",e=>{e.preventDefault(),are_you_sure(()=>{exit_fullscreen_if_ios(),location.reload()})}),$about_paint_window.css({left:-innerWidth,top:-innerHeight}),$about_paint_window.center(),$("#checking-for-updates").removeAttr("hidden");const n="https://jspaint.app/?news";fetch(n).then(e=>e.text()).then(e=>{const t=new DOMParser().parseFromString(e,"text/html");$latest_news=$(t).find("#news");const i=$latest_news.find(".news-entry"),s=$this_version_news.find(".news-entry");if(!i.length)throw $latest_news=$this_version_news,new Error(`No news found at fetched site (${n})`);function r(o,d){return o.get().some(_=>d===_.id)}const u=i.get().filter(o=>!r(s,o.id)),h=s.get().filter(o=>!r(i,o.id));u.length>0?$("#outdated").removeAttr("hidden"):h.length>0&&($latest_news=$this_version_news),$("#checking-for-updates").attr("hidden","hidden"),update_css_classes_for_conditional_messages()}).catch(e=>{var a;$("#failed-to-check-if-outdated").removeAttr("hidden"),$("#checking-for-updates").attr("hidden","hidden"),update_css_classes_for_conditional_messages(),(a=window.console)==null||a.log("Couldn't check for updates.",e)})}function exit_fullscreen_if_ios(){if($("body").hasClass("ios"))try{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}catch{}}function update_css_classes_for_conditional_messages(){$(".on-dev-host, .on-third-party-host, .on-official-host").hide(),location.hostname.match(/localhost|127.0.0.1/)?$(".on-dev-host").show():location.hostname.match(/jspaint.app/)?$(".on-official-host").show():$(".on-third-party-host").show(),$(".navigator-online, .navigator-offline").hide(),navigator.onLine?$(".navigator-online").show():$(".navigator-offline").show()}function paste_image_from_file(n){read_image_file(n,(e,a)=>{if(e){show_file_format_errors({as_image_error:e});return}paste(a.image||make_canvas(a.image_data))})}async function choose_file_to_paste(){const{file:n}=await systemHooks.showOpenFileDialog({formats:image_formats});if(n.type.match(/^image|application\/pdf/)){paste_image_from_file(n);return}show_error_message(localize("This is not a valid bitmap file, or its format is not currently supported."))}function paste(n){resize_canvas_and_save_dimensions(Math.max(window.globAppstate.main_canvas.width,n.width),Math.max(window.globAppstate.main_canvas.height,n.height),{name:"Enlarge Canvas For Paste",icon:get_help_folder_icon("p_stretch_both.png")}),e(),window.globApp.$canvas_area.trigger("resize");function e(){deselect(),select_tool(get_tool_by_id(TOOL_SELECT));const a=Math.max(0,Math.ceil(window.globApp.$canvas_area.scrollLeft()/window.globAppstate.magnification)),t=Math.max(0,Math.ceil(window.globApp.$canvas_area.scrollTop()/window.globAppstate.magnification));undoable({name:localize("Paste"),icon:get_help_folder_icon("p_paste.png"),soft:!0},()=>{window.globAppstate.selection=new OnCanvasSelection(a,t,n.width,n.height,n)})}}function go_to_history_node(n,e){var r;const a=window.globAppstate.current_history_node;if(!n.image_data){e||(show_error_message("History entry has no image data."),(r=window.console)==null||r.log("Target history entry has no image data:",n));return}window.globAppstate.current_history_node=n,deselect(!0),e||cancel(!0),window.globAppstate.saved=!1,update_title(),window.globAppstate.main_ctx.copy(n.image_data),n.selection_image_data&&(window.globAppstate.selection&&window.globAppstate.selection.destroy(),n.name===localize("Free-Form Select")?select_tool(get_tool_by_id(TOOL_FREE_FORM_SELECT)):select_tool(get_tool_by_id(TOOL_SELECT)),window.globAppstate.selection=new OnCanvasSelection(n.selection_x,n.selection_y,n.selection_image_data.width,n.selection_image_data.height,n.selection_image_data));const t=get_history_ancestors(n);window.globAppstate.undos=[...t],window.globAppstate.undos.reverse();const i=window.globAppstate.redos.length>0?[window.globAppstate.redos[0],...get_history_ancestors(window.globAppstate.redos[0])]:[a,...get_history_ancestors(a)];window.globAppstate.redos.length=0;let s=n;for(;s.futures.length>0;){const u=[...s.futures];u.sort((h,o)=>i.indexOf(h)>-1?-1:i.indexOf(o)>-1?1:0),s=u[0],window.globAppstate.redos.unshift(s)}window.globApp.$canvas_area.trigger("resize"),$G.triggerHandler("session-update"),$G.triggerHandler("history-update")}function undoable({name:n,icon:e,use_loose_canvas_changes:a,soft:t,assume_saved:i},s){var o;i||(window.globAppstate.saved=!1,update_title());const r=window.globAppstate.current_history_node;s==null||s(),window.globAppstate.current_history_node!==r&&(show_error_message(`History node switched during undoable callback for ${n}. This shouldn't happen.`),(o=window.console)==null||o.log(`History node switched during undoable callback for ${n}, from`,r,"to",window.globAppstate.current_history_node));const u=window.globAppstate.main_ctx.getImageData(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height);window.globAppstate.redos.length=0,window.globAppstate.undos.push(window.globAppstate.current_history_node);const h=make_history_node({image_data:u,selection_image_data:window.globAppstate.selection&&window.globAppstate.selection.canvas.ctx.getImageData(0,0,window.globAppstate.selection.canvas.width,window.globAppstate.selection.canvas.height),selection_x:window.globAppstate.selection&&window.globAppstate.selection.x,selection_y:window.globAppstate.selection&&window.globAppstate.selection.y,text_tool_font:JSON.parse(JSON.stringify(window.globAppstate.text_tool_font)),tool_transparent_mode:window.globAppstate.tool_transparent_mode,foreground_color:window.globAppstate.selected_colors.foreground,background_color:window.globAppstate.selected_colors.background,ternary_color:window.globAppstate.selected_colors.ternary,parent:window.globAppstate.current_history_node,name:n,icon:e,soft:t});window.globAppstate.current_history_node.futures.push(h),window.globAppstate.current_history_node=h,$G.triggerHandler("history-update"),$G.triggerHandler("session-update")}function make_or_update_undoable(n,e){window.globAppstate.current_history_node.futures.length===0&&n.match(window.globAppstate.current_history_node)?(e(),window.globAppstate.current_history_node.image_data=window.globAppstate.main_ctx.getImageData(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),window.globAppstate.current_history_node.selection_image_data=window.globAppstate.selection&&window.globAppstate.selection.canvas.ctx.getImageData(0,0,window.globAppstate.selection.canvas.width,window.globAppstate.selection.canvas.height),window.globAppstate.current_history_node.selection_x=window.globAppstate.selection&&window.globAppstate.selection.x,window.globAppstate.current_history_node.selection_y=window.globAppstate.selection&&window.globAppstate.selection.y,n.update_name&&(window.globAppstate.current_history_node.name=n.name),$G.triggerHandler("history-update")):undoable(n,e)}function undo(){if(window.globAppstate.undos.length<1)return!1;window.globAppstate.redos.push(window.globAppstate.current_history_node);let n=window.globAppstate.undos.pop();for(;n.soft&&window.globAppstate.undos.length;)window.globAppstate.redos.push(n),n=window.globAppstate.undos.pop();return go_to_history_node(n),!0}let $document_history_prompt_window;function redo(){if(window.globAppstate.redos.length<1)return $document_history_prompt_window&&$document_history_prompt_window.close(),(!$document_history_window||$document_history_window.closed)&&($document_history_prompt_window=showMessageBox({title:"Redo",messageHTML:"To view all branches of the history tree, click <b>Edit > History</b>.",iconID:"info"}).$window),!1;window.globAppstate.undos.push(window.globAppstate.current_history_node);let n=window.globAppstate.redos.pop();for(;n.soft&&window.globAppstate.redos.length;)window.globAppstate.undos.push(n),n=window.globAppstate.redos.pop();return go_to_history_node(n),!0}function get_history_ancestors(n){const e=[];for(n=n.parent;n;n=n.parent)e.push(n);return e}let $document_history_window;function show_document_history(){$document_history_prompt_window&&$document_history_prompt_window.close(),$document_history_window&&$document_history_window.close();const n=$document_history_window=$Window({title:"Document History",resizable:!1,maximizeButton:!1,minimizeButton:!1});n.addClass("history-window squish"),n.$content.html(`
		<label>
			<select id="history-view-mode" class="inset-deep">
				<option value="linear">Linear timeline</option>
				<option value="tree">Tree</option>
			</select>
		</label>
		<div class="history-view" tabIndex="0"></div>
	`);const e=n.$content.find(".history-view");e.focus();let a=0,t=[],i,s=n.$content.find("#history-view-mode");s.css({margin:"10px"});let r=s.val();s.on("change",()=>{r=s.val(),h()});function u(d){const _=$(`
			<div class="history-entry">
				<div class="history-entry-icon-area"></div>
				<div class="history-entry-name"></div>
			</div>
		`);if(_.find(".history-entry-name").text((d.name||"Unknown")+(d===window.globAppstate.root_history_node?" (Start of History)":"")),_.find(".history-entry-icon-area").append(d.icon),r==="tree"){let b=0;for(let f=d.parent;f;f=f.parent)b++;_.css({marginInlineStart:`${b*8}px`})}d===window.globAppstate.current_history_node?(_.addClass("current"),i=_,requestAnimationFrame(()=>{e[0].scrollTop=Math.min(_[0].offsetTop,Math.max(a,_[0].offsetTop-e[0].clientHeight+_.outerHeight()))})):get_history_ancestors(window.globAppstate.current_history_node).indexOf(d)>-1&&_.addClass("ancestor-of-current");for(const b of d.futures)u(b);_.on("click",()=>{go_to_history_node(d)}),_.history_node=d,t.push(_)}const h=()=>{a=e.scrollTop(),e.empty(),t=[],u(window.globAppstate.root_history_node),r==="linear"?t.sort((d,_)=>d.history_node.timestamp<_.history_node.timestamp?-1:_.history_node.timestamp<d.history_node.timestamp?1:0):t.reverse(),t.forEach(d=>{e.append(d)})};h();const o=d=>{const b=t.indexOf(i)+d;t[b]&&t[b].click()};e.on("keydown",d=>{!d.ctrlKey&&!d.altKey&&!d.shiftKey&&!d.metaKey&&(d.key==="ArrowDown"||d.key==="Down"?(o(1),d.preventDefault()):(d.key==="ArrowUp"||d.key==="Up")&&(o(-1),d.preventDefault()))}),$G.on("history-update",h),n.on("close",()=>{$G.off("history-update",h)}),n.center()}function cancel(n,e){var t;if(!window.globAppstate.history_node_to_cancel_to)return;const a=e&&window.globAppstate.current_history_node.parent&&window.globAppstate.current_history_node!==window.globAppstate.history_node_to_cancel_to&&window.globAppstate.current_history_node.futures.length===0?window.globAppstate.current_history_node:null;$G.triggerHandler("pointerup",["canceling",e]);for(const i of window.globAppstate.selected_tools)(t=i.cancel)==null||t.call(i);if(!n&&(go_to_history_node(window.globAppstate.history_node_to_cancel_to,!0),a)){const i=a.parent.futures.indexOf(a);i===-1?(show_error_message("History node not found. Please report this bug."),console.log("history_node_to_discard",a),console.log("window.globAppstate.current_history_node",window.globAppstate.current_history_node),console.log("history_node_to_discard.parent",a.parent)):(a.parent.futures.splice(i,1),$G.triggerHandler("history-update"))}window.globAppstate.history_node_to_cancel_to=null,update_helper_layer()}function meld_selection_into_canvas(n){window.globAppstate.selection.draw(),window.globAppstate.selection.destroy(),window.globAppstate.selection=null,n||undoable({name:"Deselect",icon:get_icon_for_tool(get_tool_by_id(TOOL_SELECT)),use_loose_canvas_changes:!0},()=>{})}function deselect(n){var e;window.globAppstate.selection&&meld_selection_into_canvas(n);for(const a of window.globAppstate.selected_tools)(e=a.end)==null||e.call(a,window.globAppstate.main_ctx)}function delete_selection(n={}){window.globAppstate.selection&&undoable({name:n.name||localize("Clear Selection"),icon:n.icon||get_help_folder_icon("p_delete.png")},()=>{window.globAppstate.selection.destroy(),window.globAppstate.selection=null})}function select_all(){deselect(),select_tool(get_tool_by_id(TOOL_SELECT)),undoable({name:localize("Select All"),icon:get_icon_for_tool(get_tool_by_id(TOOL_SELECT)),soft:!0},()=>{window.globAppstate.selection=new OnCanvasSelection(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height)})}const ctrlOrCmd=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?"⌘":"Ctrl",recommendationForClipboardAccess=`Please use the keyboard: ${ctrlOrCmd}+C to copy, ${ctrlOrCmd}+X to cut, ${ctrlOrCmd}+V to paste. If keyboard is not an option, try using Chrome version 76 or higher.`;function try_exec_command(n){if(document.queryCommandEnabled(n)){if(document.execCommand(n),!navigator.userAgent.includes("Firefox")||n==="paste")return show_error_message(`That ${n} probably didn't work. ${recommendationForClipboardAccess}`)}else return show_error_message(`Cannot perform ${n}. ${recommendationForClipboardAccess}`)}function getSelectionText(){const n=document.activeElement,e=n?n.tagName.toLowerCase():null;if(e=="textarea"||e=="input"&&/^(?:text|search|password|tel|url)$/i.test(n.type)){const a=n;if(typeof a.selectionStart=="number")return a.value.slice(a.selectionStart,a.selectionEnd)}return window.getSelection?window.getSelection().toString():""}function edit_copy(n){const e=getSelectionText();if(e.length>0){if(!navigator.clipboard||!navigator.clipboard.writeText){if(n)return try_exec_command("copy");show_error_message(`${localize("Error getting the Clipboard Data!")} ${recommendationForClipboardAccess}`);return}navigator.clipboard.writeText(e)}else if(window.globAppstate.selection&&window.globAppstate.selection.canvas){if(!navigator.clipboard||!navigator.clipboard.write){if(n)return try_exec_command("copy");show_error_message(`${localize("Error getting the Clipboard Data!")} ${recommendationForClipboardAccess}`);return}window.globAppstate.selection.canvas.toBlob(a=>{sanity_check_blob(a,()=>{navigator.clipboard.write([new ClipboardItem(Object.defineProperty({},a.type,{value:a,enumerable:!0}))]).then(()=>{var t;(t=window.console)==null||t.log("Copied image to the clipboard.")},t=>{show_error_message("Failed to copy to the Clipboard.",t)})})})}}function edit_cut(n){if(!navigator.clipboard||!navigator.clipboard.write){if(n)return try_exec_command("cut");show_error_message(`${localize("Error getting the Clipboard Data!")} ${recommendationForClipboardAccess}`);return}edit_copy(),delete_selection({name:localize("Cut"),icon:get_help_folder_icon("p_cut.png")})}async function edit_paste(n){if(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement){if(!navigator.clipboard||!navigator.clipboard.readText){if(n)return try_exec_command("paste");show_error_message(`${localize("Error getting the Clipboard Data!")} ${recommendationForClipboardAccess}`);return}const e=await navigator.clipboard.readText();document.execCommand("InsertText",!1,e);return}if(!navigator.clipboard||!navigator.clipboard.read){if(n)return try_exec_command("paste");show_error_message(`${localize("Error getting the Clipboard Data!")} ${recommendationForClipboardAccess}`);return}try{const a=await(await navigator.clipboard.read())[0].getType("image/png");paste_image_from_file(a)}catch(e){if(e.name==="NotFoundError")try{const a=await navigator.clipboard.readText();if(a){const t=get_uris(a);t.length>0?load_image_from_uri(t[0]).then(i=>{paste(i.image||make_canvas(i.image_data))},i=>{show_resource_load_error_message(i)}):show_error_message("The information on the Clipboard can't be inserted into Paint.")}else show_error_message("The information on the Clipboard can't be inserted into Paint.")}catch(a){show_error_message(localize("Error getting the Clipboard Data!"),a)}else show_error_message(localize("Error getting the Clipboard Data!"),e)}}function image_invert_colors(){apply_image_transformation({name:localize("Invert Colors"),icon:get_help_folder_icon("p_invert.png")},(n,e,a,t)=>{invert_rgb(e,t)})}function clear(){deselect(),cancel(),undoable({name:localize("Clear Image"),icon:get_help_folder_icon("p_blank.png")},()=>{window.globAppstate.saved=!1,update_title(),window.globAppstate.transparency?window.globAppstate.main_ctx.clearRect(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height):(window.globAppstate.main_ctx.fillStyle=window.globAppstate.selected_colors.background,window.globAppstate.main_ctx.fillRect(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height))})}let cleanup_bitmap_view=()=>{};function view_bitmap(){cleanup_bitmap_view();const n=document.createElement("div");n.classList.add("bitmap-view","inset-deep"),document.body.appendChild(n),$(n).css({display:"flex",alignItems:"center",justifyContent:"center",position:"fixed",top:"0",left:"0",width:"100%",height:"100%",zIndex:"9999",background:"var(--Background)"}),n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen();let e,a=!1,t=setInterval(()=>{document.fullscreenElement===n||document.webkitFullscreenElement===n?a=!0:a&&cleanup_bitmap_view()},100);cleanup_bitmap_view=()=>{document.removeEventListener("fullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("keydown",r),document.removeEventListener("mousedown",u),setTimeout(()=>{document.removeEventListener("contextmenu",h)},100),URL.revokeObjectURL(e),clearInterval(t),(document.fullscreenElement===n||document.webkitFullscreenElement===n)&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()),n.remove(),cleanup_bitmap_view=()=>{}},document.addEventListener("fullscreenchange",i,{once:!0}),document.addEventListener("webkitfullscreenchange",i,{once:!0}),document.addEventListener("keydown",r),document.addEventListener("mousedown",u),document.addEventListener("contextmenu",h);function i(){document.fullscreenElement!==n&&document.webkitFullscreenElement!==n&&cleanup_bitmap_view()}let s=!1;function r(o){if(s=s||o.repeat&&(o.key==="f"||o.key==="F"),!o.repeat){if(s&&(o.key==="f"||o.key==="F")){s=!1;return}o.preventDefault(),cleanup_bitmap_view()}}function u(o){cleanup_bitmap_view()}function h(o){o.preventDefault(),cleanup_bitmap_view()}window.globAppstate.main_canvas.toBlob(o=>{e=URL.createObjectURL(o);const d=document.createElement("img");d.src=e,n.appendChild(d)},"image/png")}function get_tool_by_id(n){for(let e=0;e<tools.length;e++)if(tools[e].id==n)return tools[e]}function select_tools(n){}function select_tool(n,e){if(deselect(),window.globAppstate.selected_tools.length===1&&window.globAppstate.selected_tool.deselect||(window.globAppstate.return_to_tools=[...window.globAppstate.selected_tools]),e){const a=window.globAppstate.selected_tools.indexOf(n);a===-1?(window.globAppstate.selected_tools.push(n),window.globAppstate.selected_tools.sort((t,i)=>tools.indexOf(t)<tools.indexOf(i)?-1:tools.indexOf(t)>tools.indexOf(i)?1:0)):window.globAppstate.selected_tools.splice(a,1),window.globAppstate.selected_tools.length>0?window.globAppstate.selected_tool=window.globAppstate.selected_tools[window.globAppstate.selected_tools.length-1]:(window.globAppstate.selected_tool=window.globAppstate.default_tool,window.globAppstate.selected_tools=[window.globAppstate.selected_tool])}else window.globAppstate.selected_tool=n,window.globAppstate.selected_tools=[n];n.preload&&n.preload()}function has_any_transparency(n){const e=n.getImageData(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height);for(let a=0,t=e.data.length;a<t;a+=4)if(e.data[a+3]<253)return!0;return!1}function make_opaque(){undoable({name:"Make Opaque",icon:get_help_folder_icon("p_make_opaque.png")},()=>{window.globAppstate.main_ctx.save(),window.globAppstate.main_ctx.globalCompositeOperation="destination-atop",window.globAppstate.main_ctx.fillStyle="white",window.globAppstate.main_ctx.fillRect(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height),window.globAppstate.main_ctx.restore()})}function resize_canvas_without_saving_dimensions(n,e,a={}){const t=Math.max(1,n),i=Math.max(1,e);(window.globAppstate.main_canvas.width!==t||window.globAppstate.main_canvas.height!==i)&&undoable({name:a.name||"Resize Canvas",icon:a.icon||get_help_folder_icon("p_stretch_both.png")},()=>{try{console.log("리사이즈");const s=window.globAppstate.main_ctx.getImageData(0,0,t,i);window.globAppstate.main_canvas.width=t,window.globAppstate.main_canvas.height=i,window.globAppstate.main_ctx.disable_image_smoothing(),window.globAppstate.transparency||(window.globAppstate.main_ctx.fillStyle=window.globAppstate.selected_colors.background,window.globAppstate.main_ctx.fillRect(0,0,window.globAppstate.main_canvas.width,window.globAppstate.main_canvas.height));const r=make_canvas(s);window.globAppstate.main_ctx.drawImage(r,0,0)}catch(s){s.name==="NS_ERROR_FAILURE"?show_error_message(localize("Insufficient memory to perform operation."),s):show_error_message(localize("An unknown error has occurred."),s);return}window.globApp.$canvas_area.trigger("resize")})}function resize_canvas_and_save_dimensions(n,e,a={}){resize_canvas_without_saving_dimensions(n,e,a),localStore.set({width:window.globAppstate.main_canvas.width.toString(),height:window.globAppstate.main_canvas.height.toString()},t=>{})}function image_attributes(){image_attributes.$window&&image_attributes.$window.close();const n=image_attributes.$window=$DialogWindow(localize("Attributes"));n.addClass("attributes-window");const e=n.$main,a={[localize("File last saved:")]:localize("Not Available"),[localize("Size on disk:")]:localize("Not Available"),[localize("Resolution:")]:"72 x 72 dots per inch"},t=$(E("table")).appendTo(e);for(const A in a){const x=$(E("tr")).appendTo(t);$(E("td")).appendTo(x).text(A);const C=$(E("td")).appendTo(x).text(a[A]);a[A].indexOf("72")!==-1&&C.css("direction","ltr")}const i={px:1,in:72,cm:28.3465};let s=image_attributes.unit=image_attributes.unit||"px",r=window.globAppstate.main_canvas.width,u=window.globAppstate.main_canvas.height;const h=$(E("label")).appendTo(e).html(render_access_key(localize("&Width:"))),o=$(E("label")).appendTo(e).html(render_access_key(localize("&Height:"))),d=$(E("input")).attr({type:"number",min:1,"aria-keyshortcuts":"Alt+W W W"}).addClass("no-spinner inset-deep").appendTo(h),_=$(E("input")).attr({type:"number",min:1,"aria-keyshortcuts":"Alt+H H H"}).addClass("no-spinner inset-deep").appendTo(o);e.find("input").css({width:"40px"}).on("change keyup keydown keypress pointerdown pointermove paste drop",()=>{r=Number(d.val())*i[s],u=Number(_.val())*i[s]});const b=$(E("fieldset")).appendTo(e).append(`
		<legend>${localize("Units")}</legend>
		<div class="fieldset-body">
			<div class="radio-field"><input type="radio" name="units" id="unit-in" value="in" aria-keyshortcuts="Alt+I I"><label for="unit-in">${render_access_key(localize("&Inches"))}</label></div>
			<div class="radio-field"><input type="radio" name="units" id="unit-cm" value="cm" aria-keyshortcuts="Alt+M M"><label for="unit-cm">${render_access_key(localize("C&m"))}</label></div>
			<div class="radio-field"><input type="radio" name="units" id="unit-px" value="px" aria-keyshortcuts="Alt+P P"><label for="unit-px">${render_access_key(localize("&Pixels"))}</label></div>
		</div>
	`);b.find(`[value=${s}]`).attr({checked:!0}),b.on("change",()=>{const A=String(b.find(":checked").val());d.val(r/i[A]),_.val(u/i[A]),s=A}).triggerHandler("change");const f=$(E("fieldset")).appendTo(e).append(`
		<legend>${localize("Colors")}</legend>
		<div class="fieldset-body">
			<div class="radio-field"><input type="radio" name="colors" id="attribute-monochrome" value="monochrome" aria-keyshortcuts="Alt+B B"><label for="attribute-monochrome">${render_access_key(localize("&Black and white"))}</label></div>
			<div class="radio-field"><input type="radio" name="colors" id="attribute-polychrome" value="polychrome" aria-keyshortcuts="Alt+L L"><label for="attribute-polychrome">${render_access_key(localize("Co&lors"))}</label></div>
		</div>
	`);f.find(`[value=${monochrome?"monochrome":"polychrome"}]`).attr({checked:!0});const v=$(E("fieldset")).appendTo(e).append(`
		<legend>${localize("Transparency")}</legend>
		<div class="fieldset-body">
			<div class="radio-field"><input type="radio" name="transparency" id="attribute-transparent" value="transparent"><label for="attribute-transparent">${localize("Transparent")}</label></div>
			<div class="radio-field"><input type="radio" name="transparency" id="attribute-opaque" value="opaque"><label for="attribute-opaque">${localize("Opaque")}</label></div>
		</div>
	`);v.find(`[value=${window.globAppstate.transparency?"transparent":"opaque"}]`).attr({checked:!0}),n.$Button(localize("OK"),()=>{const A=v.find(":checked").val();f.find(":checked").val();const x=String(b.find(":checked").val());image_attributes.unit=x,window.globAppstate.transparency=A=="transparent",A=="transparent"&&(window.globAppstate.selected_colors.background="transparent");const C=i[x],M=Number(d.val())*C,I=Number(_.val())*C;resize_canvas_and_save_dimensions(~~M,~~I),!window.globAppstate.transparency&&has_any_transparency(window.globAppstate.main_ctx)&&make_opaque(),image_attributes.$window.close()},{type:"submit"}),n.$Button(localize("Cancel"),()=>{image_attributes.$window.close()}),n.$Button($.parseHTML(render_access_key(localize("&Default")))[0],()=>{r=window.globAppstate.default_canvas_width,u=window.globAppstate.default_canvas_height,d.val(r/i[s]),_.val(u/i[s])}).attr("aria-keyshortcuts","Alt+D D"),handle_keyshortcuts(n),d.select(),image_attributes.$window.center()}image_attributes.$window=null;image_attributes.unit="px";function image_flip_and_rotate(){const n=$DialogWindow(localize("Flip and Rotate"));n.addClass("flip-and-rotate"),$(E("fieldset")).appendTo(n.$main).append(`
		<legend>${localize("Flip or rotate")}</legend>
	// 	<div class="radio-wrapper">
	// 		<input
	// 			type="radio"
	// 			name="flip-or-rotate"
	// 			id="flip-horizontal"
	// 			value="flip-horizontal"
	// 			aria-keyshortcuts="Alt+F"
	// 			checked
	// 		/><label for="flip-horizontal">${render_access_key(localize("&Flip horizontal"))}</label>
	// 	</div>
	// 	<div class="radio-wrapper">
	// 		<input
	// 			type="radio"
	// 			name="flip-or-rotate"
	// 			id="flip-vertical"
	// 			value="flip-vertical"
	// 			aria-keyshortcuts="Alt+V"
	// 		/><label for="flip-vertical">${render_access_key(localize("Flip &vertical"))}</label>
	// 	</div>
	// 	<div class="radio-wrapper">
	// 		<input
	// 			type="radio"
	// 			name="flip-or-rotate"
	// 			id="rotate-by-angle"
	// 			value="rotate-by-angle"
	// 			aria-keyshortcuts="Alt+R"
	// 		/><label for="rotate-by-angle">${render_access_key(localize("&Rotate by angle"))}</label>
	// 	</div>
	// `)}function handle_keyshortcuts(n){n.on("keydown",e=>{const a=n.find("[aria-keyshortcuts]");for(let t of a){const i=$(t).attr("aria-keyshortcuts").split(" ");for(const s of i)if(!!s.match(/Alt\+/i)===e.altKey&&!!s.match(/Ctrl\+/i)===e.ctrlKey&&!!s.match(/Meta\+/i)===e.metaKey&&!!s.match(/Shift\+/i)===e.shiftKey&&s.split("+").pop().toUpperCase()===e.key.toUpperCase()){e.preventDefault(),e.stopPropagation(),t.disabled&&(t=t.closest(".radio-wrapper")),t.click(),t.focus();return}}}),n.on("focusin focusout",e=>{if($(e.target).is('textarea, input:not([type="checkbox"]):not([type="radio"]):not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="image"]):not([type="file"]):not([type="color"]):not([type="range"])'))for(const a of n.find("[aria-keyshortcuts]"))a._original_aria_keyshortcuts=a._original_aria_keyshortcuts??a.getAttribute("aria-keyshortcuts"),a.setAttribute("aria-keyshortcuts",a.getAttribute("aria-keyshortcuts").split(" ").filter(t=>t.match(/(Alt|Ctrl|Meta)\+/i)).join(" "));else for(const a of n.find("[aria-keyshortcuts]"))a._original_aria_keyshortcuts&&a.setAttribute("aria-keyshortcuts",a._original_aria_keyshortcuts)})}function write_image_file(n,e,a){const t=n.getContext("2d"),i=e.match(/^image\/(?:x-)?bmp\s*(?:-(\d+)bpp)?/);if(i){const s=encodeBMP(t.getImageData(0,0,n.width,n.height),parseInt(i[1]||"24",10)),r=new Blob([s]);sanity_check_blob(r,()=>{a(r)})}else if(e==="image/png"){const s=t.getImageData(0,0,n.width,n.height),r=UPNG.encode([s.data.buffer],s.width,s.height),u=new Blob([r]);sanity_check_blob(u,()=>{a(u)})}else if(e==="image/tiff"){const s=t.getImageData(0,0,n.width,n.height),r={t305:["jspaint (UTIF.js)"]},u=UTIF.encodeImage(s.data.buffer,s.width,s.height,r),h=new Blob([u]);sanity_check_blob(h,()=>{a(h)})}else n.toBlob(s=>{sanity_check_blob(s,()=>{a(s)},[137,80,78,71,13,10,26,10],e==="image/png")},e)}function read_image_file(n,e){let a,t,i=!1;n.arrayBuffer().then(s=>{const r={png:[137,80,78,71,13,10,26,10],bmp:[66,77],jpeg:[255,216,255],gif:[71,73,70,56],webp:[87,69,66,80],tiff_be:[77,77,0,42],tiff_le:[73,73,42,0],ico:[0,0,1,0],cur:[0,0,2,0],icns:[105,99,110,115]},u=new Uint8Array(s);let h;for(const[M,I]of Object.entries(r))I.every((l,c)=>l===u[c])&&(h=M);if(h||String.fromCharCode(...u.slice(0,1024)).includes("%PDF")&&(h="pdf"),h==="bmp"){const{colorTable:M,bitsPerPixel:I,imageData:w}=decodeBMP(s);a=I===24?"image/bmp":`image/bmp;bpp=${I}`,M.length>=2&&(t=M.map(l=>`rgb(${l.r}, ${l.g}, ${l.b})`),i=!1),e(null,{file_format:a,monochrome:i,palette:t,image_data:w,source_blob:n})}else if(h==="png"){const M=UPNG.decode(s),I=UPNG.toRGBA8(M)[0],{width:w,height:l,tabs:c,ctype:p}=M;if(c.PLTE&&c.PLTE.length>=3*2&&p===3){t=new Array(c.PLTE.length/3);for(let y=0;y<t.length;y++)c.tRNS&&c.tRNS.length>=y+1?t[y]=`rgba(${c.PLTE[y*3+0]}, ${c.PLTE[y*3+1]}, ${c.PLTE[y*3+2]}, ${c.tRNS[y]/255})`:t[y]=`rgb(${c.PLTE[y*3+0]}, ${c.PLTE[y*3+1]}, ${c.PLTE[y*3+2]})`;i=!1}a="image/png";const m=new ImageData(new Uint8ClampedArray(I),w,l);e(null,{file_format:a,monochrome:i,palette:t,image_data:m,source_blob:n})}else if(h==="tiff_be"||h==="tiff_le"){var o=UTIF.decode(s),d=o,_=0,b=d[0];o[0].subIFD&&(d=d.concat(o[0].subIFD));for(var f=0;f<d.length;f++){var v=d[f];if(!(v.t258==null||v.t258.length<3)){var A=v.t256*v.t257;A>_&&(_=A,b=v)}}UTIF.decodeImage(s,b,o);var x=UTIF.toRGBA8(b),C=new ImageData(new Uint8ClampedArray(x.buffer),b.width,b.height);a="image/tiff",e(null,{file_format:a,monochrome:i,palette:t,image_data:C,source_blob:n})}else if(h==="pdf"){a="application/pdf",pdfjs$1.GlobalWorkerOptions.workerSrc="lib/pdf.js/build/pdf.worker.js";const M=new Uint8Array(s);pdfjs$1.getDocument({data:M,cMapUrl:"lib/pdf.js/web/cmaps/",cMapPacked:!0}).promise.then(w=>{console.log("PDF loaded");var l=1;w.getPage(l).then(c=>{console.log("Page loaded");var p=1.5,m=c.getViewport({scale:p}),y=make_canvas(m.width,m.height),P={canvasContext:y.ctx,viewport:m},F=c.render(P);F.promise.then(()=>{console.log("Page rendered");const R=y.ctx.getImageData(0,0,y.width,y.height);e(null,{file_format:a,monochrome:i,palette:t,image_data:R,source_blob:n})})})},w=>{e(new Error(`Failed to load PDF. ${w}`))})}else{i=!1,a={png:"image/png",webp:"image/webp",jpeg:"image/jpeg",gif:"image/gif",tiff_be:"image/tiff",tiff_le:"image/tiff",ico:"image/x-icon",cur:"image/x-win-bitmap",icns:"image/icns"}[h]||n.type;const M=URL.createObjectURL(n),I=new Image,w=()=>{URL.revokeObjectURL(M),n.text().then(l=>{const c=new Error("failed to decode blob as an image");c.code=l.match(/^\s*<!doctype\s+html/i)?"html-not-image":"decoding-failure",e(c)},l=>{const c=new Error("failed to decode blob as image or text");c.code="decoding-failure",e(c)})};I.onload=()=>{if(URL.revokeObjectURL(M),!I.complete||typeof I.naturalWidth>"u"||I.naturalWidth===0){w();return}e(null,{file_format:a,monochrome:i,palette:t,image:I,source_blob:n})},I.onerror=w,I.src=M}},s=>{e(s)})}function update_from_saved_file(n){read_image_file(n,(e,a)=>{if(e){show_error_message("The file has been saved, however... "+localize("Paint cannot read this file."),e);return}apply_file_format_and_palette_info(a);const t=image_formats.find(({mimeType:i})=>i===a.file_format);undoable({name:`${localize("Save As")} ${t?t.name:a.file_format}`,icon:get_help_folder_icon("p_save.png"),assume_saved:!0},()=>{window.globAppstate.main_ctx.copy(a.image||a.image_data)})})}function save_selection_to_file(){window.globAppstate.selection&&window.globAppstate.selection.canvas&&systemHooks.showSaveFileDialog({dialogTitle:localize("Save As"),defaultFileName:"selection.png",defaultFileFormatID:"image/png",formats:image_formats,getBlob:n=>new Promise(e=>{write_image_file(window.globAppstate.selection.canvas,n,a=>{e(a)})})})}function sanity_check_blob(n,e,a,t=!0){n.size>0?a?n.arrayBuffer().then(i=>{const s=new Uint8Array(i);a.every((u,h)=>u===s[h])===t?e():showMessageBox({message:window.is_electron_app?"Writing images in this file format is not supported.":"Your browser does not support writing images in this file format.",iconID:"error"})},i=>{show_error_message(localize("An unknown error has occurred."),i)}):e():show_error_message(localize("Failed to save document."))}console.log("JS 실행:","menus.js");const looksLikeChrome=!!(window.chrome&&(window.chrome.loadTimes||window.chrome.csi));localize("&File")+"",{label:localize("&New"),...shortcut(window.is_electron_app?"Ctrl+N":"Ctrl+Alt+N"),description:localize("Creates a new document.")},{label:localize("&Open"),...shortcut("Ctrl+O"),description:localize("Opens an existing document.")},{label:localize("&Save"),...shortcut("Ctrl+S"),description:localize("Saves the active document.")},{label:localize("Save &As"),...shortcut("Ctrl+Shift+S"),description:localize("Saves the active document with a new name.")},localize("&Language"),available_languages.map(n=>({emoji_icon:get_language_emoji(n),label:get_language_endonym(n),action:()=>{set_language(n)},enabled:()=>get_language()!=n,description:localize("Changes the language to %1.",get_iso_language_name(n))})),localize("&About Paint"),localize("Displays information about this application."),{label:localize("E&xit"),...shortcut(window.is_electron_app?"Alt+F4":""),description:localize("Quits Paint.")},localize("&Edit")+"",{label:localize("&Undo"),...shortcut("Ctrl+Z"),description:localize("Undoes the last action.")},{label:localize("&Repeat"),...shortcut("F4"),description:localize("Redoes the previously undone action.")},{label:localize("Cu&t"),...shortcut("Ctrl+X"),description:localize("Cuts the selection and puts it on the Clipboard.")},{label:localize("&Copy"),...shortcut("Ctrl+C"),description:localize("Copies the selection and puts it on the Clipboard.")},{label:localize("&Paste"),...shortcut("Ctrl+V"),description:localize("Inserts the contents of the Clipboard.")},{label:localize("C&lear Selection"),...shortcut("Del"),description:localize("Deletes the selection.")},{label:localize("Select &All"),...shortcut("Ctrl+A"),description:localize("Selects everything.")},`${localize("C&opy To")}`,localize("Copies the selection to a file."),`${localize("Paste &From")}`,localize("Pastes a file into the selection."),localize("&View")+"",localize("Zoom To &Window"),localize("Zooms the picture to fit within the view."),{label:localize("&View Bitmap"),...shortcut("Ctrl+F"),description:localize("Displays the entire picture.")},{label:localize("&Fullscreen"),...shortcut("F11"),description:localize("Makes the application take up the entire screen.")},localize("&Image")+"",{label:`${localize("&Attributes")}`,...shortcut("Ctrl+E"),description:localize("Changes the attributes of the picture.")},{label:localize("&Clear Image"),...shortcut(window.is_electron_app||!looksLikeChrome?"Ctrl+Shift+N":""),description:localize("Clears the picture.")},localize("&Draw Opaque"),localize("Makes the current selection either opaque or transparent.");function shortcut(n){if(!n)return{};const e=n.replace(/Ctrl/g,"Control").replace(/\bDel\b/,"Delete");return validateAriaKeyshortcuts(e)||console.error(`Invalid ARIA key shortcuts: ${JSON.stringify(e)} (from shortcut label: ${JSON.stringify(n)}) (or validator is incomplete)`),{shortcutLabel:n,ariaKeyShortcuts:e}}function validateAriaKeyshortcuts(n){const e=["Alt","Control","Shift","Meta","AltGraph"],a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1","2","3","4","5","6","7","8","9","0","Delete","Enter","Tab","ArrowRight","ArrowLeft","ArrowUp","ArrowDown","PageUp","PageDown","End","Home","Escape","Space","Plus","Minus","Comma","Period","Slash","Backslash","Quote","Semicolon","BracketLeft","BracketRight","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],t=n.split(" ");function i(s){const r=s.split("+");if(r.length===0)return!1;let u=!1;for(let h=0;h<r.length;h++){const o=r[h];if(e.includes(o)){if(u)return!1}else if(a.includes(o)){if(u)return!1;u=!0}else return!1}return u}for(let s=0;s<t.length;s++)if(!i(t[s]))return!1;return!0}const ariaKeyShortcutsTestCases=[["Control+A Shift+Alt+B",!0],["Control+Shift+1",!0],["Shift+Alt+T Control+5",!0],["T",!0],["ArrowLeft",!0],["Shift+T Alt+Control",!1],["T+Shift",!1],["Alt",!1],["IncredibleKey",!1],["Ctrl+Shift+A",!1]];for(const[n,e]of ariaKeyShortcutsTestCases){const a=validateAriaKeyshortcuts(n);a!==e&&console.error(`validateAriaKeyshortcuts("${n}") returned ${a} but expected ${e}`)}export{$G as $,update_canvas_rect as A,update_disable_aa as B,update_magnified_canvas_size as C,open_from_file as D,show_document_history as E,deselect as F,cancel as G,Handles as H,edit_cut as I,delete_selection as J,edit_copy as K,edit_paste as L,TOOL_BRUSH as M,TOOL_ERASER as N,TOOL_AIRBRUSH as O,TOOL_LINE as P,TOOL_CURVE as Q,TOOL_RECTANGLE as R,TOOL_ROUNDED_RECTANGLE as S,TOOL_PENCIL as T,TOOL_ELLIPSE as U,TOOL_POLYGON as V,update_helper_layer as W,set_magnification as X,image_flip_and_rotate as Y,clear as Z,file_new as _,are_you_sure as a,image_attributes as a0,image_invert_colors as a1,select_all as a2,file_save_as as a3,file_save as a4,file_open as a5,view_bitmap as a6,rotate as a7,paste as a8,paste_image_from_file as a9,reset_selected_colors as aa,reset_canvas_and_history as ab,make_or_update_undoable as ac,init_webgl_stuff as ad,resize_canvas_and_save_dimensions as ae,TAU as af,select_tools as ag,show_error_message as b,select_tool as c,get_uris as d,exit_fullscreen_if_ios as e,change_url_param as f,get_tool_by_id as g,show_resource_load_error_message as h,localStore as i,debounce as j,to_canvas_coords as k,load_image_from_uri as l,make_css_cursor as m,make_canvas as n,open_from_image_info as o,image_data_match as p,undoable as q,reset_file as r,showMessageBox as s,tools as t,update_title as u,get_help_folder_icon as v,undo as w,redo as x,default_palette as y,make_history_node as z};
